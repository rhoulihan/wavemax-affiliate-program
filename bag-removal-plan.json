{
  "project": "WaveMAX Bag Removal Plan",
  "created": "2025-06-03T00:00:00Z",
  "description": "Comprehensive plan to remove bag tracking from the WaveMAX system while preserving bag purchase credits",
  "phases": [
    {
      "phase": 1,
      "name": "Update Related Models and Controllers",
      "status": "completed",
      "tasks": [
        {
          "id": "1.1",
          "file": "server/models/Order.js",
          "action": "remove",
          "target": "bagIDs field (line 45)",
          "description": "Remove bagIDs array from Order schema",
          "status": "completed"
        },
        {
          "id": "1.2",
          "file": "server/controllers/orderController.js",
          "action": "modify",
          "target": "Any references to order.bagIDs",
          "description": "Remove any logic that populates or uses bagIDs",
          "status": "completed"
        },
        {
          "id": "1.3",
          "file": "server/controllers/affiliateController.js",
          "action": "modify",
          "target": "Bag-related methods",
          "description": "Remove any bag management functionality for affiliates",
          "status": "completed"
        },
        {
          "id": "1.4",
          "file": "server/controllers/customerController.js",
          "action": "modify",
          "target": "Bag-related methods",
          "description": "Remove any bag viewing/management for customers",
          "status": "completed"
        }
      ]
    },
    {
      "phase": 2,
      "name": "Remove Bag Routes and Controller",
      "status": "completed",
      "tasks": [
        {
          "id": "2.1",
          "file": "server.js",
          "action": "remove",
          "target": "Line 312: apiV1Router.use('/bags', bagRoutes);",
          "description": "Remove bag routes mounting",
          "status": "completed"
        },
        {
          "id": "2.2",
          "file": "server.js",
          "action": "remove",
          "target": "Lines 326-331: Bag fee configuration endpoint",
          "description": "Remove bag fee configuration endpoint",
          "status": "completed"
        },
        {
          "id": "2.3",
          "file": "server.js",
          "action": "remove",
          "target": "const bagRoutes import",
          "description": "Remove bagRoutes import statement",
          "status": "completed"
        },
        {
          "id": "2.4",
          "file": "server/routes/bagRoutes.js",
          "action": "delete",
          "target": "entire file",
          "description": "Delete the bag routes file",
          "status": "completed"
        },
        {
          "id": "2.5",
          "file": "server/controllers/bagController.js",
          "action": "delete",
          "target": "entire file",
          "description": "Delete the bag controller file",
          "status": "completed"
        }
      ]
    },
    {
      "phase": 3,
      "name": "Remove Bag Model",
      "status": "completed",
      "tasks": [
        {
          "id": "3.1",
          "file": "server/models/Bag.js",
          "action": "delete",
          "target": "entire file",
          "description": "Delete the Bag model file",
          "status": "completed"
        }
      ]
    },
    {
      "phase": 4,
      "name": "Update Test Infrastructure",
      "status": "completed",
      "tasks": [
        {
          "id": "4.1",
          "file": "tests/integration/bag.test.js",
          "action": "delete",
          "target": "entire file",
          "description": "Delete bag integration tests",
          "status": "completed"
        },
        {
          "id": "4.2",
          "file": "tests/unit/bagController.test.js",
          "action": "delete",
          "target": "entire file",
          "description": "Delete bag controller unit tests",
          "status": "completed"
        },
        {
          "id": "4.3",
          "file": "tests/unit/models.test.js",
          "action": "modify",
          "target": "Bag Model tests section",
          "description": "Remove Bag model tests",
          "status": "completed"
        },
        {
          "id": "4.4",
          "file": "tests/setup.js",
          "action": "modify",
          "target": "Any Bag model cleanup",
          "description": "Remove Bag from test cleanup if present",
          "status": "completed"
        },
        {
          "id": "4.5",
          "file": "jest.config.js",
          "action": "modify",
          "target": "Coverage exclusions",
          "description": "Remove bag-related files from coverage if listed",
          "status": "completed"
        }
      ]
    },
    {
      "phase": 5,
      "name": "Update Frontend and Documentation",
      "status": "completed",
      "tasks": [
        {
          "id": "5.1",
          "file": "public/assets/js/order-confirmation.js",
          "action": "modify",
          "target": "Bag-related logic",
          "description": "Remove any bag tracking UI elements",
          "status": "completed"
        },
        {
          "id": "5.2",
          "file": "public/assets/js/customer-dashboard.js",
          "action": "modify",
          "target": "Bag display logic",
          "description": "Remove bag information display",
          "status": "completed"
        },
        {
          "id": "5.3",
          "file": "server/templates/emails/affiliate-lost-bag.html",
          "action": "delete",
          "target": "entire file",
          "description": "Delete lost bag email template",
          "status": "completed"
        },
        {
          "id": "5.4",
          "file": "docs/api-reference.html",
          "action": "modify",
          "target": "Lines 1000-1038",
          "description": "Remove bag API documentation",
          "status": "completed"
        },
        {
          "id": "5.5",
          "file": "server/utils/fieldFilter.js",
          "action": "modify",
          "target": "Bag field definitions",
          "description": "Remove bag field filtering if present",
          "status": "completed"
        },
        {
          "id": "5.6",
          "file": "server/config/csrf-config.js",
          "action": "modify",
          "target": "Bag endpoint exclusions",
          "description": "Remove bag endpoints from CSRF config",
          "status": "completed"
        },
        {
          "id": "5.7",
          "file": "server/utils/emailService.js",
          "action": "modify",
          "target": "sendAffiliateLostBagEmail method",
          "description": "Remove lost bag email sending method",
          "status": "completed"
        }
      ]
    },
    {
      "phase": 6,
      "name": "Database Cleanup",
      "status": "completed",
      "tasks": [
        {
          "id": "6.1",
          "action": "script",
          "description": "Create migration script to drop bags collection",
          "status": "completed"
        },
        {
          "id": "6.2",
          "action": "script",
          "description": "Create script to remove bagIDs from existing orders",
          "status": "completed"
        },
        {
          "id": "6.3",
          "action": "verify",
          "description": "Verify bag purchase credits remain in customer accounts",
          "status": "completed"
        }
      ]
    }
  ],
  "rollback": {
    "git_branch": "main",
    "backup_required": true,
    "backup_collections": ["bags", "orders"],
    "notes": "Ensure database backup before starting. All changes should be committed incrementally for easy rollback."
  },
  "verification": {
    "tests_to_run": [
      "npm test -- --testPathIgnorePatterns=bag",
      "npm test -- tests/integration/order.test.js",
      "npm test -- tests/integration/customer.test.js",
      "npm test -- tests/integration/affiliate.test.js"
    ],
    "manual_checks": [
      "Verify customer can still purchase bag credits",
      "Verify bag credits are applied to customer account",
      "Verify no bag tracking UI elements remain",
      "Verify all API endpoints still function"
    ]
  },
  "progress": {
    "total_tasks": 29,
    "completed_tasks": 29,
    "current_phase": 6,
    "last_updated": "2025-06-04T01:00:00Z"
  }
}