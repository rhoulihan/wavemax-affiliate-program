
> wavemax-affiliate-program@1.0.0 test
> jest --runInBand --forceExit

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/logger.test.js
  Logger Utility
    ✓ should export logger methods (142 ms)
    ✓ should be a winston logger instance (18 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/routingRoutes.test.js
  Routing Routes
    GET /
      ✓ should serve filmwalk index.html (23 ms)
      ✓ should handle root path without trailing slash (5 ms)
      ✓ should return 404 for non-existent paths (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentModel.test.js
  Payment Model Methods
    Instance Methods
      ✓ should determine if payment can be captured (96 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/encryption.test.js
  Encryption Utility
    ✓ should hash password correctly (66 ms)
    ✓ should verify password correctly (176 ms)
    ✓ should encrypt and decrypt data correctly (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paygistixService.test.js
  Paygistix Service
    getConfig
      ✓ should return client config from paygistixConfig (2 ms)
    isConfigured
      ✓ should return true when properly configured (1 ms)
      ✓ should return false when not configured

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailServiceHelpers.test.js (5.155 s)
  EmailService Helper Functions
    formatSize
      ✓ should format small size correctly (1 ms)
      ✓ should format medium size correctly (1 ms)
      ✓ should format large size correctly
      ✓ should return original value for unknown sizes
      ✓ should handle empty string
      ✓ should handle null value
      ✓ should handle undefined value (1 ms)
      ✓ should handle numeric values
      ✓ should handle uppercase input
      ✓ should handle mixed case input (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/qrCodeGenerator.test.js
  QR Code Generator
    generateQRCode
      ✓ should generate a customer QR code with timestamp when no ID provided (1 ms)
      ✓ should generate an order QR code with timestamp when no ID provided
      ✓ should generate a customer QR code with provided ID (1 ms)
      ✓ should generate an order QR code with provided ID
      ✓ should convert type to uppercase
      ✓ should use default type of customer when not specified (1 ms)
      ✓ should generate unique codes on consecutive calls
      ✓ should handle special characters in ID
      ✓ should handle empty string ID as null
      ✓ should handle null ID parameter (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paginationMiddleware.test.js
  Pagination Middleware
    ✓ should set default pagination values when no query params provided (2 ms)
    ✓ should parse page and limit from query params
    ✓ should enforce minimum values (1 ms)
    ✓ should enforce maximum limit
    ✓ should handle non-numeric values
    ✓ should calculate skip correctly for different pages (1 ms)
    ✓ should handle floating point numbers
    ✓ should preserve other query parameters (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/helpers.test.js
  Helpers Utility Functions
    formatCurrency
      ✓ should format a number as USD currency by default (34 ms)
      ✓ should handle null and undefined amounts (1 ms)
      ✓ should handle NaN values
      ✓ should parse string amounts (1 ms)
      ✓ should format with different currencies (1 ms)
      ✓ should handle negative amounts (1 ms)
      ✓ should round to 2 decimal places (1 ms)
    formatDate
      ✓ should format date with short format by default (5 ms)
      ✓ should format date with long format (1 ms)
      ✓ should format date with ISO format (1 ms)
      ✓ should handle string dates
      ✓ should handle null and undefined dates (1 ms)
      ✓ should handle invalid dates
      ✓ should handle different format cases (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportGoogleOnly.test.js
  Google OAuth Passport Configuration - Isolated
    ✓ should handle Google OAuth callback correctly (1 ms)
    ✓ should configure Google strategy with correct parameters (1 ms)
    ✓ should support state parameter for context detection (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/quickbooksRoutesSimple.test.js
  QuickBooks Routes - Simple
    GET /api/quickbooks/vendors/export
      ✓ should export vendors (17 ms)
      ✓ should export vendors as CSV (3 ms)
    GET /api/quickbooks/payments/export
      ✓ should export payment summary (3 ms)
    GET /api/quickbooks/commissions/export
      ✓ should export commission detail (2 ms)
    GET /api/quickbooks/exports
      ✓ should get export history (2 ms)
      ✓ should filter export history by type (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateModel.test.js
  Affiliate Model Methods
    Virtual Properties
      ✓ should calculate full name virtual property (161 ms)
    Payment Methods
      ✓ should determine if affiliate can receive payments (150 ms)
    W9 Status Display
      ✓ should return correct W9 status display text (147 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportLinkedInOnly.test.js
  LinkedIn OAuth Passport Configuration - Isolated
    ✓ should handle LinkedIn OAuth callback correctly (1 ms)
    ✓ should configure LinkedIn strategy with correct scope (1 ms)
    ✓ should configure LinkedIn strategy with correct parameters

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportFacebookOnly.test.js
  Facebook OAuth Passport Configuration - Isolated
    ✓ should handle Facebook OAuth callback correctly (1 ms)
    ✓ should configure Facebook strategy with profile fields (1 ms)
    ✓ should configure Facebook strategy with correct parameters

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administratorAdditional.test.js
  Administrator Model - Additional Coverage
    Permission Methods
      ✓ should check single permission with hasPermission (222 ms)
      ✓ should check all permissions with hasAllPermissions (198 ms)
    Password History
      ✓ should check if password is in history (706 ms)
      ✓ should handle empty password history (178 ms)
    Virtual Properties
      ✓ should calculate isLocked virtual property correctly (139 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [Coverage Route] GET /non-existent-file.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /protected-file.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /file%20with%20spaces.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /../../../etc/passwd

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /styles.css

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /script.js

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] POST /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] PUT /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] DELETE /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /critical-files

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/critical-files.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /test-templates

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/test-templates.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /action-plan

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/action-plan.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

PASS tests/unit/coverageRoutesAdditional.test.js
  Coverage Routes - Additional Coverage
    Error Handler Function
      ✓ should handle file not found errors (13 ms)
      ✓ should handle permission denied errors (4 ms)
    Static File Serving Edge Cases
      ✓ should handle requests with special characters in filename (5 ms)
      ✓ should handle requests with directory traversal attempts (4 ms)
      ✓ should serve CSS files with proper headers (4 ms)
      ✓ should serve JS files with proper headers (17 ms)
    Environment-specific Behavior
      ✓ should handle staging environment (2 ms)
    Request Method Handling
      ✓ should reject POST requests (6 ms)
      ✓ should reject PUT requests (5 ms)
      ✓ should reject DELETE requests (5 ms)
    Concurrent Request Handling
      ✓ should handle multiple simultaneous requests (28 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderRoutesSimple.test.js
  Order Routes - Simple
    POST /api/orders
      ✓ should create order with valid data (18 ms)
    GET /api/orders/export
      ✓ should export orders (19 ms)
    GET /api/orders/search
      ✓ should search orders (4 ms)
    GET /api/orders/statistics
      ✓ should get order statistics (3 ms)
    PUT /api/orders/bulk/status
      ✓ should bulk update order status (3 ms)
    POST /api/orders/bulk/cancel
      ✓ should bulk cancel orders (3 ms)
    GET /api/orders/:orderId
      ✓ should get order details (3 ms)
    PUT /api/orders/:orderId/status
      ✓ should update order status (3 ms)
    POST /api/orders/:orderId/cancel
      ✓ should cancel order (5 ms)
    PUT /api/orders/:orderId/payment-status
      ✓ should update payment status (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderModelSimple.test.js
  Order Model - Line Coverage
    SystemConfig Error Handling (Line 110)
      ✓ should use default base rate when SystemConfig.getValue throws error (189 ms)
    Status Timestamp Updates (Lines 132-148)
      ✓ should set processingStartedAt when status changes to processing (229 ms)
      ✓ should set processedAt when status changes to processed (240 ms)
      ✓ should set completedAt when status changes to complete (291 ms)
      ✓ should set cancelledAt when status changes to cancelled (228 ms)
      ✓ should not overwrite existing timestamps (228 ms)
    Actual Weight and Commission Calculations
      ✓ should calculate actualTotal and commission when actualWeight is set (238 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:01:56.354Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:01:56.501Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T15:01:56.543Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:01:56.698Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:01:56.814Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:01:57.444Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:01:57.555Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

PASS tests/unit/docusignToken.test.js
  DocuSignToken Model
    saveToken
      ✓ should save a new token with all fields (150 ms)
      ✓ should update existing token if one exists (198 ms)
      ✓ should calculate expiration time correctly (115 ms)
    getCurrentToken
      ✓ should return the most recent token (158 ms)
      ✓ should return null if no tokens exist (103 ms)
    clearTokens
      ✓ should remove all tokens (228 ms)
    token expiration
      ✓ should identify expired tokens (138 ms)
      ✓ should handle tokens without refresh token (112 ms)
    lastUsed tracking
      ✓ should update lastUsed when token is accessed (249 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-09-02T13:01:58.524Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-09-02T13:01:59.207Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-09-02T13:01:59.608Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-09-02T13:01:59.974Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-09-02T13:02:01.185Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-09-02T13:02:01.551Z"}
PASS tests/unit/administratorControllerRateLimits.test.js
  Administrator Controller - Reset Rate Limits
    resetRateLimits
      ✓ should reset all rate limits when no filters provided (683 ms)
      ✓ should reset rate limits with type filter (401 ms)
      ✓ should reset rate limits with IP filter (366 ms)
      ✓ should handle IP filter overwriting type filter (447 ms)
      ✓ should handle database errors gracefully (376 ms)
      ✓ should handle missing database connection (1 ms)
      ✓ should handle collection not found error (387 ms)
      ✓ should report zero deletions correctly (366 ms)
      ✓ should handle special regex characters in IP (384 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'customer_12345' },
      headers: {},
      state: 'customer_12345',
      stateStartsWithCustomer: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_12345',
      isCustomerRequest: true,
      willDelegate: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:997:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_123' },
      headers: {},
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_123' },
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_error' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_error',
      sessionId: null,
      allParams: { state: 'customer_error' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1647:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_123' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_123',
      sessionId: 'oauth_123',
      allParams: { state: 'customer_oauth_123' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1647:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_test_session_456' },
      headers: {},
      state: 'oauth_test_session_456',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test_session_456',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test_session_456',
      sessionId: 'oauth_test_session_456',
      allParams: { state: 'oauth_test_session_456' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: undefined },
      headers: {},
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: { state: undefined } }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

PASS tests/unit/oauthCallbacksSimple.test.js
  OAuth Callback Functions - Simple
    handleSocialCallback
      ✓ should delegate to customer handler for customer requests (354 ms)
      ✓ should handle failed authentication with popup (166 ms)
      ✓ should handle errors gracefully (167 ms)
    handleCustomerSocialCallback
      ✓ should handle missing user (158 ms)
      ✓ should store session data for popup requests (159 ms)
    State Parameter Parsing
      ✓ should extract sessionId from oauth_ prefixed state (161 ms)
      ✓ should handle missing state parameter (162 ms)
      ✓ should detect popup from referer header (159 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/modelsAdditional.test.js
  Models - Additional Coverage
    Administrator Model - Pre-save Hook
      ✓ should add password to history on password change (286 ms)
      ✓ should limit password history to 5 entries (124 ms)
    Payment Model - Helper Methods
      ✓ should have a method to format payment display (109 ms)
      ✓ should validate payment can be refunded (108 ms)
      ✓ should calculate net amount after fees (110 ms)
    Edge Cases and Error Handling
      ✓ should handle missing required fields gracefully (114 ms)
      ✓ should handle invalid enum values (103 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderRoutes.isolated.test.js
  Order Routes - Isolated V2
    ✓ POST /api/orders - should create a new order (19 ms)
    ✓ GET /api/orders/export - should export orders (4 ms)
    ✓ GET /api/orders/search - should search orders (3 ms)
    ✓ GET /api/orders/statistics - should get statistics (4 ms)
    ✓ PUT /api/orders/bulk/status - should bulk update (5 ms)
    ✓ POST /api/orders/bulk/cancel - should bulk cancel (4 ms)
    ✓ GET /api/orders/:orderId - should get order details (4 ms)
    ✓ PUT /api/orders/:orderId/status - should update status (3 ms)
    ✓ POST /api/orders/:orderId/cancel - should cancel order (3 ms)
    ✓ PUT /api/orders/:orderId/payment-status - should update payment (3 ms)
    ✓ Error handling - should return 404 for unknown routes (4 ms)
    ✓ Error handling - should handle controller errors (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error generating monitoring status: Error: Uptime error
        at process.uptime (/var/www/wavemax/wavemax-affiliate-program/tests/unit/monitoringRoutes.test.js:93:15)
        at uptime (/var/www/wavemax/wavemax-affiliate-program/server/routes/monitoringRoutes.js:23:23)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:284:15
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/server/routes/monitoringRoutes.js:11:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/tests/unit/monitoringRoutes.test.js:26:7)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at expressInit (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/middleware/init.js:40:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at query (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/middleware/query.js:45:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/application.js:181:10)
        at Server.app (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/express.js:39:9)
        at Server.emit (node:events:524:28)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17)

      112 |     res.json(monitoringData);
      113 |   } catch (error) {
    > 114 |     console.error('Error generating monitoring status:', error);
          |             ^
      115 |     res.status(500).json({
      116 |       success: false,
      117 |       message: 'Failed to retrieve monitoring status'

      at error (server/routes/monitoringRoutes.js:114:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (server/routes/monitoringRoutes.js:11:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (tests/unit/monitoringRoutes.test.js:26:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

PASS tests/unit/monitoringRoutes.test.js
  Monitoring Routes
    Security Headers Middleware
      ✓ should add security headers to all monitoring routes (11 ms)
    GET /api/monitoring/status
      ✓ should return monitoring status data (4 ms)
      ✓ should include service history with timestamps and response times (9 ms)
      ✓ should handle errors gracefully (27 ms)
    GET /api/monitoring/
      ✓ should serve monitoring dashboard HTML with CSP nonce (4 ms)
    GET /api/monitoring/dashboard
      ✓ should serve monitoring dashboard HTML with CSP nonce (2 ms)
    404 Handler
      ✓ should return 404 for non-existent monitoring endpoints (2 ms)
    Service Status Data Structure
      ✓ should return critical services with proper structure (3 ms)
      ✓ should return non-critical services with proper structure (3 ms)
      ✓ should generate realistic service metrics (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/authRoutesSimple.test.js
  Auth Routes - Simple
    POST /api/auth/login
      ✓ should login with valid credentials (8 ms)
      ✓ should reject invalid credentials (4 ms)
    POST /api/auth/register
      ✓ should register new user (3 ms)
    POST /api/auth/logout
      ✓ should logout with valid token (3 ms)
      ✓ should reject logout without token (2 ms)
    POST /api/auth/forgot-password
      ✓ should send password reset email (3 ms)
    POST /api/auth/reset-password
      ✓ should reset password with valid token (3 ms)
    GET /api/auth/verify-email/:token
      ✓ should verify email with valid token (2 ms)
    POST /api/auth/refresh-token
      ✓ should refresh token (4 ms)
    GET /api/auth/me
      ✓ should get current user with valid token (3 ms)
      ✓ should reject without token (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateLoginInit.test.js
  Affiliate Login Initialization
    Module Loading
      ✓ should initialize when form is found (6 ms)
      ✓ should handle missing form gracefully
    URL Parameter Handling Logic
      ✓ should correctly parse customer parameter from URL (1 ms)
      ✓ should handle URL without customer parameter
      ✓ should construct redirect URL correctly with customer parameter (1 ms)
      ✓ should construct redirect URL correctly without customer parameter
    URL Validation
      ✓ should validate customer ID format (1 ms)
      ✓ should handle URL encoding correctly
    Integration with Email URLs
      ✓ should parse email-generated URLs correctly (1 ms)
      ✓ should handle both login and customer parameters together (1 ms)
    Parameter Preservation Logic
      ✓ should preserve customer parameter through login flow
      ✓ should handle multiple URL parameters correctly (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.isolated.test.js
  Payment Routes - Isolated
    GET /api/v1/payments/config
      ✓ should return payment configuration (6 ms)
    POST /api/v1/payments/log-submission
      ✓ should log payment submission (7 ms)
    POST /api/v1/payments/create-token
      ✓ should create payment token (3 ms)
    GET /api/v1/payments/check-status/:token
      ✓ should check payment status (2 ms)
    POST /api/v1/payments/cancel-token/:token
      ✓ should cancel payment token (2 ms)
    POST /api/v1/payments/update-status/:token
      ✓ should update payment status (2 ms)
    GET /api/v1/payments/pool-stats
      ✓ should return pool statistics (3 ms)
    Error Handling
      ✓ should handle controller errors gracefully (2 ms)
      ✓ should handle missing routes with 404 (9 ms)
    Request Validation
      ✓ should pass through request headers (2 ms)
      ✓ should handle JSON parsing errors (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-affiliate',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: true,
      userObject: {
        provider: 'google',
        socialId: 'google123',
        email: 'affiliate@example.com',
        isExistingAffiliate: true,
        affiliate: {
          _id: 'aff123',
          affiliateId: 'AFF001',
          email: 'affiliate@example.com'
        }
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1889:13)

  console.log
    [handleCustomerSocialCallback] User is an existing affiliate, showing conflict message

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1895:15)

  console.log
    [handleCustomerSocialCallback] Using nonce for affiliate conflict: test-nonce

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1921:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

PASS tests/unit/authControllerCoverage.test.js
  Auth Controller - Additional Coverage Tests Fixed
    handleCustomerSocialCallback - Fixed Tests
      ✓ should handle existing affiliate trying to register as customer (10 ms)
      ✓ should handle customer without affiliate (4 ms)
    resetPassword - Fixed Tests
      ✓ should reset password for administrator (2 ms)
      ✓ should handle operator password reset attempt

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Export orders error: Error: Export failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderControllerUncovered.test.js:114:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      927 |     }
      928 |   } catch (error) {
    > 929 |     console.error('Export orders error:', error);
          |             ^
      930 |     res.status(500).json({
      931 |       success: false,
      932 |       message: 'An error occurred while exporting orders'

      at error (server/controllers/orderController.js:929:13)
      at Object.<anonymous> (tests/unit/orderControllerUncovered.test.js:117:7)

  console.error
    Search orders error: Error: Search failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderControllerUncovered.test.js:237:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1138 |     });
      1139 |   } catch (error) {
    > 1140 |     console.error('Search orders error:', error);
           |             ^
      1141 |     res.status(500).json({
      1142 |       success: false,
      1143 |       message: 'An error occurred while searching orders'

      at error (server/controllers/orderController.js:1140:13)
      at Object.<anonymous> (tests/unit/orderControllerUncovered.test.js:240:7)

PASS tests/unit/orderControllerUncovered.test.js
  Order Controller - Uncovered Functions
    exportOrders
      ✓ should export orders as CSV (265 ms)
      ✓ should export orders as Excel (120 ms)
      ✓ should export orders as JSON by default (106 ms)
      ✓ should handle export errors (122 ms)
    searchOrders
      ✓ should search orders by customer name (106 ms)
      ✓ should search orders without search term (111 ms)
      ✓ should handle search with no results (116 ms)
      ✓ should handle search errors (108 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administratorEmailService.test.js
  Administrator Email Service Tests
    sendAdministratorWelcomeEmail
      ✓ should call sendAdministratorWelcomeEmail function (1 ms)
      ✓ should handle admin with different permission sets
      ✓ should handle admin with single permission (1 ms)
      ✓ should handle admin with no permissions
    sendAdministratorPasswordResetEmail
      ✓ should call sendAdministratorPasswordResetEmail function
      ✓ should handle different reset URLs (1 ms)
    Email template data processing
      ✓ should replace uppercase placeholders correctly
      ✓ should handle missing placeholders gracefully (1 ms)
      ✓ should include current year in template data
      ✓ should format permissions correctly as comma-separated string
      ✓ should handle empty permissions array
      ✓ should handle single permission
    Email service integration
      ✓ should be available as a module export
      ✓ should not throw error when sending welcome email
      ✓ should not throw error when sending password reset email
    Admin data validation
      ✓ should handle admin with required fields (1 ms)
      ✓ should handle admin with different adminId formats (1 ms)
      ✓ should handle admin with different email formats

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateModelAdditional.test.js
  Affiliate Model - Additional Coverage
    Payment Method Default
      ✓ should default payment method to check for social registration (56 ms)
      ✓ should not set default payment method for traditional registration (65 ms)
      ✓ should not set default payment method when registrationMethod is not set (64 ms)
    Pre-save hooks
      ✓ should test password hashing in pre-save hook (104 ms)
      ✓ should not hash password if passwordHash already exists (100 ms)
      ✓ should test account number encryption in pre-save hook (92 ms)
      ✓ should not encrypt non-string values (89 ms)
      ✓ should not encrypt if fields are not modified (123 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/createAdminDirectly.test.js (5.575 s)
  Create Admin Directly Script Unit Tests
    generateAdminId function
      ✓ should generate ADM001 when no administrators exist (2 ms)
      ✓ should generate next sequential ID when administrators exist
      ✓ should handle double-digit admin IDs correctly (1 ms)
    Permission selection
      ✓ should handle "all" permission selection
      ✓ should handle specific permission selection (1 ms)
      ✓ should filter out invalid permission numbers
    Database operations
      ✓ should connect to MongoDB successfully (2 ms)
      ✓ should create administrator with correct data
      ✓ should handle database save errors
    Email functionality
      ✓ should send welcome email after admin creation (1 ms)
      ✓ should handle email sending errors gracefully
    Input validation
      ✓ should handle empty input fields (1 ms)
      ✓ should handle whitespace in permission input
    Error handling
      ✓ should handle MongoDB connection errors (1 ms)
      ✓ should close database connection in finally block
      ✓ should close readline interface in finally block

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderModel.test.js
  Order Model - Additional Coverage
    Pre-save Hook Coverage
      SystemConfig Error Handling
        ✓ should use default base rate when SystemConfig.getValue throws error (303 ms)
      Status Timestamp Updates
        ✓ should set processingStartedAt timestamp when status changes to processing (204 ms)
        ✓ should not overwrite existing processingStartedAt timestamp (198 ms)
      Actual Weight and Commission Calculations
        ✓ should calculate actual total and commission when actual weight is set (201 ms)
        ✓ should set processedAt timestamp when status changes to processed (201 ms)
        ✓ should set completedAt timestamp when status changes to complete (200 ms)
        ✓ should set cancelledAt timestamp when status changes to cancelled (203 ms)
        ✓ should properly calculate commission with different fee structures (169 ms)
        ✓ should not overwrite existing timestamps (202 ms)
      Edge Cases
        ✓ should handle status change to processing (206 ms)
        ✓ should calculate commission for large orders (166 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/cspHelper.test.js
  CSP Helper Utilities
    injectNonce
      ✓ should return original HTML if nonce is not provided (1 ms)
      ✓ should replace {{CSP_NONCE}} placeholders (1 ms)
      ✓ should add nonce to script tags without nonce (1 ms)
      ✓ should not add nonce to script tags that already have nonce
      ✓ should add nonce to style tags without nonce
      ✓ should not add nonce to style tags that already have nonce (1 ms)
      ✓ should add nonce to stylesheet link tags
      ✓ should not add nonce to non-stylesheet link tags
      ✓ should update meta tag with name="csp-nonce" (1 ms)
      ✓ should handle complex HTML with multiple elements
      ✓ should handle script tags with attributes
      ✓ should handle style tags with attributes
    readHTMLWithNonce
      ✓ should read file and inject nonce
      ✓ should handle file read errors (8 ms)
      ✓ should pass empty nonce through to injectNonce (1 ms)
    serveHTMLWithNonce
      ✓ should serve HTML with nonce successfully (1 ms)
      ✓ should handle errors when serving HTML (1 ms)
      ✓ should handle missing nonce in res.locals
      ✓ should construct correct file path

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailService.test.js
  Email Service Mock
    All Email Functions
      ✓ should have all required email functions mocked (2 ms)
      ✓ should return expected mock response for all functions (2 ms)
      ✓ should track function calls correctly (1 ms)
      ✓ should handle errors when mocked to reject (11 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/controllersAdditional.test.js
  Controllers - Additional Function Coverage
    Order Controller - Additional Functions
      searchOrders - Additional Cases
        ✓ should handle search with affiliate filter (57 ms)
        ✓ should handle empty search query (59 ms)
      exportOrders - Edge Cases
        ✓ should handle export with date filters (61 ms)
      getOrderStatistics - Various Scenarios
        ✓ should get order statistics with time range (59 ms)
        ✓ should handle statistics for affiliate user (58 ms)
    Affiliate Controller - Additional Functions
      getAffiliateDashboardStats - Edge Cases
        ✓ should handle empty statistics (54 ms)
        ✓ should handle date range filters (66 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error creating administrator: Error [ValidationError]: Invalid permission
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:56:31)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      189 |
      190 |   } catch (error) {
    > 191 |     console.error('Error creating administrator:', error);
          |             ^
      192 |
      193 |     // Handle validation errors from model pre-save hooks
      194 |     if (error.name === 'ValidationError') {

      at error (server/controllers/administratorController.js:191:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:62:7)

  console.error
    Error creating administrator: Error: Duplicate key
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:79:30)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34) {
      code: 11000
    }

      189 |
      190 |   } catch (error) {
    > 191 |     console.error('Error creating administrator:', error);
          |             ^
      192 |
      193 |     // Handle validation errors from model pre-save hooks
      194 |     if (error.name === 'ValidationError') {

      at error (server/controllers/administratorController.js:191:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:85:7)

  console.error
    Error deleting administrator: TypeError: Cannot read properties of undefined (reading 'length')
        at length (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:353:27)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:164:7)

      386 |
      387 |   } catch (error) {
    > 388 |     console.error('Error deleting administrator:', error);
          |             ^
      389 |     res.status(500).json({
      390 |       success: false,
      391 |       message: 'Failed to delete administrator'

      at error (server/controllers/administratorController.js:388:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:164:7)

  console.error
    Error fetching dashboard data: Error: Database connection lost
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:225:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1250 |
      1251 |   } catch (error) {
    > 1252 |     console.error('Error fetching dashboard data:', error);
           |             ^
      1253 |     res.status(500).json({
      1254 |       success: false,
      1255 |       message: 'Failed to fetch dashboard data'

      at error (server/controllers/administratorController.js:1252:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:227:7)

PASS tests/unit/administratorControllerAdditional.test.js
  Administrator Controller - Additional Coverage
    createAdministrator - Error Handling
      ✓ should handle validation errors from pre-save hooks (150 ms)
      ✓ should handle duplicate email errors (109 ms)
    updateAdministrator - Edge Cases
      ✓ should prevent self-deactivation (56 ms)
      ✓ should handle administrator not found (68 ms)
    deleteAdministrator - Error Cases
      ✓ should prevent deleting the last administrator with full permissions (57 ms)
      ✓ should handle deletion errors (67 ms)
    getDashboard - Complex Scenarios
      ✓ should handle empty analytics data (54 ms)
      ✓ should handle database errors gracefully (54 ms)
    getOrderAnalytics - Date Range Handling
      ✓ should handle custom date range (52 ms)
      ✓ should handle invalid date format (54 ms)
    Helper Functions
      ✓ should export updateOperatorStats function (57 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paygistixConfig.test.js
  Paygistix Config
    validateEnvironment
      ✓ should warn when required environment variables are missing (1 ms)
      ✓ should not warn when all required variables are present (1 ms)
    getEnvironment
      ✓ should return configured environment
      ✓ should default to production if not configured (1 ms)
    getMerchantId
      ✓ should return merchant ID when configured (1 ms)
      ✓ should throw error when not configured (12 ms)
    getFormId
      ✓ should return form ID when configured (1 ms)
      ✓ should throw error when not configured (1 ms)
    getFormHash
      ✓ should return form hash when configured (1 ms)
      ✓ should throw error when not configured (1 ms)
    getFormActionUrl
      ✓ should return configured form action URL (1 ms)
      ✓ should return default URL when not configured (1 ms)
    getReturnUrl
      ✓ should return configured return URL (1 ms)
      ✓ should return default URL when not configured
    isConfigured
      ✓ should return true when all required config is present (1 ms)
      ✓ should return false and log error when config is incomplete (1 ms)
    getClientConfig
      ✓ should return complete client config when properly configured (1 ms)
      ✓ should throw and log error when config is missing (1 ms)
      ✓ should set testModeEnabled to false when not configured (1 ms)
    getFullConfig
      ✓ should return complete config including hash
      ✓ should throw and log error when config is missing (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateDashboardInit.test.js
  Affiliate Dashboard Customer Filtering
    URL Parameter Detection Logic
      ✓ should detect customer parameter from URL search params (1 ms)
      ✓ should handle URL without customer parameter
      ✓ should parse customer parameter from complex URL
      ✓ should handle regex pattern matching for customer parameter
    Customer Highlighting Logic
      ✓ should identify highlighted customer correctly (1 ms)
      ✓ should generate correct CSS classes for highlighted customer
      ✓ should generate correct HTML content for highlighted customer (1 ms)
      ✓ should not highlight non-matching customers
    Tab Switching Logic
      ✓ should determine correct tab activation based on customer parameter
      ✓ should not switch tabs when no customer parameter
      ✓ should handle empty string customer parameter
    Authentication Check Logic
      ✓ should identify authenticated state correctly
      ✓ should identify unauthenticated state when missing token (1 ms)
      ✓ should identify unauthenticated state when missing affiliate
    Customer Data Processing
      ✓ should handle empty customer list
      ✓ should process customer list without filtering
      ✓ should filter customer list by customer ID
    URL Construction and Validation
      ✓ should construct API URLs correctly (1 ms)
      ✓ should validate customer ID format
    Timing and Delays
      ✓ should calculate correct delay for tab switching (1 ms)
      ✓ should handle immediate execution when no customer parameter

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.test.js
  Payment Routes
    Static Routes
      GET /api/v1/payments/config
        ✓ should return payment configuration (12 ms)
      POST /api/v1/payments/log-submission
        ✓ should log payment submission (15 ms)
      POST /api/v1/payments/create-token
        ✓ should create payment token (3 ms)
      GET /api/v1/payments/check-status/:token
        ✓ should check payment status (3 ms)
      POST /api/v1/payments/cancel-token/:token
        ✓ should cancel payment token (3 ms)
      POST /api/v1/payments/update-status/:token
        ✓ should update payment status (3 ms)
      GET /api/v1/payments/pool-stats
        ✓ should return pool statistics (3 ms)
    Dynamic Callback Routes
      ✓ should handle GET callback routes (3 ms)
      ✓ should handle POST callback routes (2 ms)
      ✓ should handle multiple callback paths (5 ms)
    Error Handling
      ✓ should handle controller errors gracefully (3 ms)
      ✓ should handle missing routes with 404 (3 ms)
      ✓ should handle JSON parsing errors (4 ms)
    Request Validation
      ✓ should pass through request headers (4 ms)
      ✓ should handle empty request bodies (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/fieldFilterWdfCredit.test.js
  Field Filter WDF Credit Support
    Customer WDF Credit Fields
      ✓ should include WDF credit fields for customer viewing own profile (1 ms)
      ✓ should include WDF credit fields for affiliate viewing customer
      ✓ should include WDF credit fields for admin viewing customer (1 ms)
      ✓ should NOT include WDF credit for public access (1 ms)
      ✓ should NOT include WDF credit for other customers
    Order WDF Credit Fields
      ✓ should include WDF fields for customer viewing own order (1 ms)
      ✓ should include WDF fields for affiliate viewing order (1 ms)
      ✓ should include WDF fields for admin viewing order
    Field Definition Verification
      ✓ should have WDF credit fields defined in customer field definitions (1 ms)
      ✓ should have WDF credit fields defined in order field definitions (1 ms)
    Array Filtering
      ✓ should filter WDF credit fields in customer arrays (1 ms)
      ✓ should filter WDF credit fields in order arrays
    Edge Cases
      ✓ should handle null/undefined WDF credit values (1 ms)
      ✓ should handle zero WDF credit values

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/errorHandler.test.js
  Error Handler Middleware
    errorHandler
      ✓ should handle generic errors with 500 status (16 ms)
      ✓ should handle custom status codes (1 ms)
      ✓ should handle Mongoose validation errors (1 ms)
      ✓ should handle MongoDB duplicate key errors
      ✓ should handle JWT errors (1 ms)
      ✓ should handle JWT token expiration errors (1 ms)
      ✓ should handle rate limiting errors
      ✓ should handle CastError (invalid MongoDB ObjectId) (1 ms)
      ✓ should include user context when available
      ✓ should handle errors with customer context
      ✓ should hide error details in production (1 ms)
      ✓ should show error details in development (2 ms)
      ✓ should use original message for non-500 errors in production
      ✓ should handle errors without message (1 ms)
      ✓ should handle errors with code property (1 ms)
      ✓ should log all console error sections (1 ms)
    AppError
      ✓ should create custom error with status code
      ✓ should have stack trace (1 ms)
      ✓ should work with error handler
    Edge cases
      ✓ should handle null error (4 ms)
      ✓ should handle undefined error
      ✓ should handle non-error objects
      ✓ should handle errors thrown from within error handler (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderWithSystemConfig.test.js (11.262 s)
  Order Model with SystemConfig Integration
    Dynamic WDF Pricing
      ✓ should fetch base rate from SystemConfig on order creation (965 ms)
      ✓ should use default rate when SystemConfig is not available (1127 ms)
      ✓ should calculate estimated total using SystemConfig rate (773 ms)
      ✓ should calculate actual total using SystemConfig rate (748 ms)
    Commission Calculations
      ✓ should calculate affiliate commission correctly with custom WDF rate (744 ms)
      ✓ should calculate commission for zero delivery fee (755 ms)
      ✓ should handle commission calculation for large orders (749 ms)
    Edge Cases
      ✓ should handle commission when only estimated size is available (776 ms)
      ✓ should update calculations when base rate changes (923 ms)
      ✓ should validate minimum and maximum base rates (1070 ms)
    Revenue Calculator Scenarios
      ✓ should match revenue calculator example - 10 customers scenario (1303 ms)
      ✓ should match revenue calculator with different parameters (762 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentLinkService.test.js (7.92 s)
  PaymentLinkService
    generatePaymentLinks
      ✓ should generate payment links for all providers (2004 ms)
      ✓ should handle decimal amounts correctly (1779 ms)
      ✓ should handle short order IDs (1735 ms)
    generateVenmoLink
      ✓ should generate correct Venmo deep link (201 ms)
      ✓ should handle @ symbol in handle (138 ms)
    generatePayPalLink
      ✓ should generate correct PayPal.me link (219 ms)
    generateCashAppLink
      ✓ should generate correct CashApp link (213 ms)
      ✓ should add $ symbol if missing (113 ms)
    translations
      ✓ should provide translations for all supported languages (119 ms)
      ✓ should default to English for unsupported languages (120 ms)
      ✓ should generate Spanish payment buttons HTML (124 ms)
      ✓ should generate Portuguese QR codes HTML (122 ms)
      ✓ should generate German payment buttons HTML (117 ms)
    HTML generation
      ✓ should generate valid payment buttons HTML (120 ms)
      ✓ should generate valid QR codes HTML (119 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/facebookUtils.test.js
  Facebook Utils
    parseSignedRequest
      ✓ should parse valid signed request (2 ms)
      ✓ should return null for invalid signature
      ✓ should return null for malformed signed request (1 ms)
      ✓ should return null when missing parameters
      ✓ should handle invalid JSON in payload (1 ms)
    base64UrlDecode
      ✓ should decode base64 URL encoded strings
      ✓ should handle strings without padding
      ✓ should handle strings with URL-safe characters
    generateStatusUrl
      ✓ should generate correct status URL
      ✓ should handle base URL with trailing slash
      ✓ should handle base URL with path
    deleteFacebookData
      ✓ should delete all Facebook data from user
      ✓ should handle user without Facebook data (1 ms)
      ✓ should handle user without socialAccounts
      ✓ should only update registration method if it was facebook (1 ms)
    findUsersByFacebookId
      ✓ should find both affiliate and customer (1 ms)
      ✓ should handle when only affiliate exists (1 ms)
      ✓ should handle when no users exist
    anonymizeUserData
      ✓ should anonymize all user data (6 ms)
      ✓ should handle user with partial data
      ✓ should handle user with no personal data (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.full.test.js
  Payment Routes - Full Coverage
    Dynamic Route Loading
      ✓ should load dynamic callback routes when not in test environment (33 ms)
      ✓ should handle GET requests on dynamic callback routes (28 ms)
      ✓ should handle POST requests on dynamic callback routes (35 ms)
      ✓ should handle errors when loading config file (18 ms)
      ✓ should handle invalid JSON in config file (22 ms)
      ✓ should skip dynamic route loading in test environment (28 ms)
    Static Routes
      ✓ should handle GET /config (25 ms)
      ✓ should handle POST /log-submission (31 ms)
      ✓ should handle POST /create-token (28 ms)
      ✓ should handle GET /check-status/:token (34 ms)
      ✓ should handle POST /cancel-token/:token (23 ms)
      ✓ should handle POST /update-status/:token (32 ms)
      ✓ should handle GET /pool-stats (22 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/customerDashboardWdfCredit.test.js (12.489 s)
  Customer Dashboard WDF Credit Display
    Dashboard Stats with WDF Credit
      ✓ should include WDF credit information in dashboard response (6384 ms)
      ✓ should show zero WDF credit for new customers (565 ms)
      ✓ should show negative WDF credit (debit) correctly (590 ms)
      ✓ should include both bag credit and WDF credit (629 ms)
    Dashboard with Order History
      ✓ should show WDF credit alongside order statistics (718 ms)
    Access Control
      ✓ should allow affiliates to see customer WDF credit (673 ms)
      ✓ should not allow unrelated affiliates to see customer WDF credit (491 ms)
      ✓ should allow admins to see any customer WDF credit (589 ms)
    Edge Cases
      ✓ should handle null WDF credit fields gracefully (580 ms)
      ✓ should handle very small WDF credit amounts (578 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching test customer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:95:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      28 |         res.json(customer);
      29 |     } catch (error) {
    > 30 |         console.error('Error fetching test customer:', error);
         |                 ^
      31 |         res.status(500).json({ error: 'Failed to fetch test customer' });
      32 |     }
      33 | });

      at error (server/routes/testRoutes.js:30:17)

  console.error
    Error creating test customer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:185:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      106 |         res.json(customer);
      107 |     } catch (error) {
    > 108 |         console.error('Error creating test customer:', error);
          |                 ^
      109 |         res.status(500).json({ error: 'Failed to create test customer' });
      110 |     }
      111 | });

      at error (server/routes/testRoutes.js:108:17)

  console.error
    Error creating test order: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:289:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      206 |         res.json(order);
      207 |     } catch (error) {
    > 208 |         console.error('Error creating test order:', error);
          |                 ^
      209 |         res.status(500).json({ error: 'Failed to create test order: ' + error.message });
      210 |     }
      211 | });

      at error (server/routes/testRoutes.js:208:17)

  console.error
    Error cleaning up test data: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:319:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      236 |         res.json({ message: 'Test data cleaned up successfully' });
      237 |     } catch (error) {
    > 238 |         console.error('Error cleaning up test data:', error);
          |                 ^
      239 |         res.status(500).json({ error: 'Failed to cleanup test data' });
      240 |     }
      241 | });

      at error (server/routes/testRoutes.js:238:17)

PASS tests/unit/testRoutes.test.js
  Test Routes
    testOnlyMiddleware
      ✓ should allow access in test environment (6 ms)
      ✓ should block access in production without ENABLE_TEST_ROUTES (3 ms)
      ✓ should allow access in production with ENABLE_TEST_ROUTES (2 ms)
    GET /api/test/customer
      ✓ should return existing test customer (2 ms)
      ✓ should return 404 when test customer not found (2 ms)
      ✓ should handle database errors (19 ms)
    POST /api/test/customer
      ✓ should return existing customer if already exists (7 ms)
      ✓ should create new customer and affiliate if not exists (113 ms)
      ✓ should use existing affiliate if already exists (71 ms)
      ✓ should handle database errors (5 ms)
    POST /api/test/order
      ✓ should create order for specified customer (5 ms)
      ✓ should find test customer by email if customerId not provided (3 ms)
      ✓ should delete existing test orders when recreate is true (14 ms)
      ✓ should return 400 when customer not found (2 ms)
      ✓ should handle database errors (3 ms)
    DELETE /api/test/cleanup
      ✓ should delete all test data (2 ms)
      ✓ should handle database errors during cleanup (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] Google callback: {
      error: null,
      user: 'exists',
      userObject: { id: '12345', email: 'test@example.com', provider: 'google' },
      isExistingAffiliate: undefined,
      info: null
    }

      at log (server/routes/socialAuthRoutes.js:40:13)

PASS tests/unit/socialAuthRoutes.full.test.js
  Social Auth Routes - Full Coverage
    Google OAuth Routes
      ✓ should initiate Google OAuth when configured (73 ms)
      ✓ should return 404 when Google OAuth is not configured (64 ms)
      ✓ should handle Google OAuth callback (68 ms)
      ✓ should pass state parameter through OAuth (68 ms)
    Facebook OAuth Routes
      ✓ should initiate Facebook OAuth when configured (90 ms)
      ✓ should return 404 when Facebook OAuth is not configured (66 ms)
    LinkedIn OAuth Routes
      ✓ should return 404 as LinkedIn OAuth is not implemented (58 ms)
    Customer OAuth Routes
      ✓ should initiate Google OAuth for customers (72 ms)
      ✓ should redirect customer Google OAuth callback (59 ms)
      ✓ should handle customer Facebook OAuth callback (64 ms)
      ✓ should initiate Facebook OAuth for customers (59 ms)
      ✓ should return 404 when Facebook OAuth is not configured for customers (69 ms)
      ✓ should return 404 as LinkedIn OAuth is not implemented for customers (59 ms)
      ✓ should return 404 for LinkedIn OAuth regardless of configuration (63 ms)
      ✓ should return 404 for customer LinkedIn OAuth callback (58 ms)
    Social Registration Completion
      ✓ should complete affiliate social registration (74 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/tokenBlacklist.test.js
  TokenBlacklist Model
    Schema Validation
      ✓ should create a valid token blacklist entry (286 ms)
      ✓ should use default values for blacklistedAt and reason (134 ms)
      ✓ should require all mandatory fields (84 ms)
      ✓ should enforce unique token constraint (280 ms)
      ✓ should validate userType enum (79 ms)
      ✓ should accept all valid userTypes (229 ms)
    Static Methods
      blacklistToken
        ✓ should successfully blacklist a token (130 ms)
        ✓ should use default reason when not provided (115 ms)
        ✓ should return null when token already blacklisted (301 ms)
        ✓ should handle custom reasons (120 ms)
        ✓ should propagate non-duplicate errors (93 ms)
      isBlacklisted
        ✓ should return true for blacklisted token (155 ms)
        ✓ should return false for non-blacklisted token (110 ms)
        ✓ should handle empty token (106 ms)
        ✓ should handle null token (120 ms)
      cleanupExpired
        ✓ should delete expired tokens (234 ms)
        ✓ should return 0 when no expired tokens (223 ms)
        ✓ should handle empty collection (112 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error resetting rate limits: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/simpleRouteHandlers.test.js:153:40)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      88 |           
      89 |         } catch (error) {
    > 90 |           console.error('Error resetting rate limits:', error);
         |                   ^
      91 |           res.status(500).json({
      92 |             success: false,
      93 |             message: 'Error resetting rate limits'

      at error (tests/unit/simpleRouteHandlers.test.js:90:19)

  console.error
    Error serving documentation with nonce: Error: Processing error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/simpleRouteHandlers.test.js:272:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      42 |     res.type('html').send(html);
      43 |   } catch (error) {
    > 44 |     console.error('Error serving documentation with nonce:', error);
         |             ^
      45 |     next(error);
      46 |   }
      47 | };

      at error (server/routes/docsRoutes.js:44:13)

PASS tests/unit/simpleRouteHandlers.test.js
  Simple Route Handlers
    Administrator Rate Limit Reset
      ✓ should reset all rate limits when no filters provided (8 ms)
      ✓ should reset rate limits by type filter (4 ms)
      ✓ should reset rate limits by IP filter (2 ms)
      ✓ should handle database errors (14 ms)
    Documentation Serving with CSP Nonce
      ✓ should serve HTML files with CSP nonce (6 ms)
      ✓ should default to index.html for root path (2 ms)
      ✓ should skip nonce injection for example files (3 ms)
      ✓ should skip non-HTML files (3 ms)
      ✓ should handle non-existent files (2 ms)
      ✓ should handle errors during file processing (4 ms)
    Basic Auth Route Handlers
      ✓ should handle successful authentication (3 ms)
      ✓ should handle missing credentials (2 ms)
      ✓ should handle invalid credentials (8 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Get new customers count error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/operatorController.bagLabels.test.js:65:49)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1635 |     });
      1636 |   } catch (error) {
    > 1637 |     console.error('Get new customers count error:', error);
           |             ^
      1638 |     res.status(500).json({ 
      1639 |       success: false,
      1640 |       message: 'Error fetching new customers count' 

      at Object.error [as getNewCustomersCount] (server/controllers/operatorController.js:1637:13)
      at Object.<anonymous> (tests/unit/operatorController.bagLabels.test.js:67:7)

PASS tests/unit/operatorController.bagLabels.test.js
  Operator Controller - Bag Label Printing
    getNewCustomersCount
      ✓ should return count of customers without bag labels (333 ms)
      ✓ should return zero when no new customers (169 ms)
      ✓ should handle database error (183 ms)
    printNewCustomerLabels
      ✓ should generate labels for all new customers (156 ms)
      ✓ should handle no new customers (158 ms)
      ✓ should handle customer with zero bags (160 ms)
      ✓ should handle database error during find (156 ms)
      ✓ should handle customers with missing names (154 ms)
      ✓ should generate correct number of labels for each customer (155 ms)
      ✓ should handle undefined numberOfBags (155 ms)
    Customer Model bagLabels fields
      ✓ should have correct schema fields (160 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderAddOns.test.js
  Order Model - Add-on Functionality
    Add-on Total Calculations
      ✓ should calculate add-on total correctly with one add-on selected (305 ms)
      ✓ should calculate add-on total correctly with multiple add-ons selected (142 ms)
      ✓ should calculate zero add-on total when no add-ons selected (140 ms)
      ✓ should handle missing add-ons object gracefully (139 ms)
      ✓ should recalculate add-on total when weight changes (172 ms)
      ✓ should use actual weight for add-on calculation when available (150 ms)
    Add-on Impact on Totals and Commission
      ✓ should include add-ons in estimated total but not in commission (140 ms)
      ✓ should correctly calculate totals with add-ons and WDF credit (139 ms)
      ✓ should handle all edge cases for add-on calculations (173 ms)
    Add-on Default Values
      ✓ should have default false values for all add-ons when not specified (145 ms)
    Add-on Updates
      ✓ should recalculate totals when add-ons are modified (266 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/validators.test.js
  Validators
    isValidEmail
      ✓ should validate correct email addresses (3 ms)
      ✓ should reject invalid email addresses
    isValidPhone
      ✓ should validate correct US phone numbers
      ✓ should reject invalid phone numbers (1 ms)
    isValidUsername
      ✓ should validate correct usernames
      ✓ should reject invalid usernames (1 ms)
    isValidZipCode
      ✓ should validate correct US zip codes
      ✓ should reject invalid zip codes (1 ms)
    isValidTimeFormat
      ✓ should validate correct time formats
      ✓ should reject invalid time formats (1 ms)
    isValidName
      ✓ should validate correct names
      ✓ should reject invalid names (1 ms)
    mongooseValidators
      ✓ should provide email validator
      ✓ should provide phone validator
      ✓ should provide username validator (1 ms)
      ✓ should provide zipCode validator
      ✓ should provide timeFormat validator
      ✓ should provide name validator
    expressValidators
      ✓ should provide email validator function
      ✓ should provide phone validator function
      ✓ should provide username validator function
      ✓ should provide zipCode validator function (1 ms)
      ✓ should provide timeFormat validator function
      ✓ should provide name validator function
    Client-side validation functions
      validateEmail
        ✓ should return validation result for emails (1 ms)
      validatePhone
        ✓ should return validation result for phones
      validateUsername
        ✓ should return validation result for usernames (1 ms)
      validateZipCode
        ✓ should return validation result for zip codes
      validateTimeFormat
        ✓ should return validation result for time formats (1 ms)
      validateName
        ✓ should return validation result for names

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error creating administrator: Error [ValidationError]: Invalid permission: invalid_permission
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerUncovered.test.js:49:31)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      189 |
      190 |   } catch (error) {
    > 191 |     console.error('Error creating administrator:', error);
          |             ^
      192 |
      193 |     // Handle validation errors from model pre-save hooks
      194 |     if (error.name === 'ValidationError') {

      at Object.error [as createAdministrator] (server/controllers/administratorController.js:191:13)
      at Object.<anonymous> (tests/unit/administratorControllerUncovered.test.js:70:7)

  console.error
    Error creating administrator: Error: E11000 duplicate key error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerUncovered.test.js:88:30)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34) {
      code: 11000
    }

      189 |
      190 |   } catch (error) {
    > 191 |     console.error('Error creating administrator:', error);
          |             ^
      192 |
      193 |     // Handle validation errors from model pre-save hooks
      194 |     if (error.name === 'ValidationError') {

      at Object.error [as createAdministrator] (server/controllers/administratorController.js:191:13)
      at Object.<anonymous> (tests/unit/administratorControllerUncovered.test.js:109:7)

PASS tests/unit/administratorControllerUncovered.test.js
  Administrator Controller - Uncovered Functions
    createAdministrator - Additional Error Cases
      ✓ should handle pre-save validation errors (65 ms)
      ✓ should handle duplicate email error (11000) (61 ms)
    deleteAdministrator - Last Admin Check
      ✓ should prevent deleting the last administrator with full permissions (56 ms)
    getDashboard - All Statistics
      ✓ should return dashboard with all statistics (61 ms)
    getOrderAnalytics - With Date Filters
      ✓ should handle date range in analytics (54 ms)
    exportReport - Different Formats
      ✓ should export orders report (52 ms)
      ✓ should handle invalid report type (53 ms)
    getAffiliatesList - With Filters
      ✓ should get filtered affiliates list (53 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /critical-files

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/critical-files.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /test-templates

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/test-templates.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /action-plan

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/action-plan.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /non-existent-page

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /action-plan.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /critical-files.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /missing

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

PASS tests/unit/coverageRoutes.test.js
  Coverage Routes
    Access Control Middleware
      ✓ should allow access in development environment (28 ms)
      ✓ should allow access in test environment (7 ms)
      ✓ should deny access in production without key (1 ms)
      ✓ should allow access in production with valid key (9 ms)
      ✓ should deny access in production with invalid key (3 ms)
    Embedded Access Prevention
      ✓ should deny access when Sec-Fetch-Dest is iframe (3 ms)
      ✓ should deny access when X-Frame-Options is present (2 ms)
      ✓ should deny access when referer contains /embed (2 ms)
      ✓ should allow access with normal referer (9 ms)
    Route Handlers
      ✓ should serve index.html at root path (6 ms)
      ✓ should serve critical-files page (6 ms)
      ✓ should serve test-templates page (6 ms)
      ✓ should serve action-plan page (13 ms)
      ✓ should return 404 for non-existent pages (5 ms)
    Static File Headers
      ✓ should set no-cache headers for static files (8 ms)
      ✓ should set no-cache headers for HTML files (6 ms)
      ✓ should set no-cache headers for other HTML files (6 ms)
    Environment Variable Handling
      ✓ should handle missing COVERAGE_ACCESS_KEY (4 ms)
      ✓ should handle empty COVERAGE_ACCESS_KEY (6 ms)
    Multiple Middleware Interaction
      ✓ should check embedded access before access control (2 ms)
      ✓ should apply X-Frame-Options even with valid access (5 ms)
    HTML Response Validation
      ✓ should return valid HTML for access denied page (2 ms)
      ✓ should return valid HTML for 404 page (5 ms)
    Query Parameter Handling
      ✓ should ignore extra query parameters (12 ms)
      ✓ should handle URL-encoded keys (7 ms)
    Edge Cases
      ✓ should handle root path without trailing slash (9 ms)
      ✓ should handle specific route handlers (7 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/modelMethods.test.js (5.812 s)
  Model Methods
    Administrator Model
      setPassword method
        ✓ should set password hash and salt for new admin (552 ms)
        ✓ should add previous password to history when changing password (403 ms)
        ✓ should keep only last 5 passwords in history (368 ms)
        ✓ should handle undefined password history (342 ms)
    Operator Model
      isPasswordInHistory method
        ✓ should return false when no password history exists (217 ms)
        ✓ should return false when password history is empty (215 ms)
        ✓ should return true when password exists in history (327 ms)
        ✓ should return false when password does not exist in history (319 ms)
        ✓ should check multiple passwords in history (669 ms)
    Payment Model
      pre-save middleware
        ✓ should prevent modification of paygistixId after creation (216 ms)
        ✓ should prevent modification of orderId after creation (213 ms)
        ✓ should allow modification of other fields (220 ms)
    DataDeletionRequest Model
      markAsFailed method
        ✓ should mark request as failed with errors (217 ms)
        ✓ should mark request as failed without errors (216 ms)
      findStaleRequests static method
        ✓ should find pending requests older than default 24 hours (224 ms)
        ✓ should find pending requests older than specified hours (229 ms)
        ✓ should handle zero hours parameter (277 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailServiceAdditional.test.js
  Email Service - Additional Coverage
    Affiliate Commission Email
      ✓ should send affiliate commission email successfully (5 ms)
      ✓ should handle email sending error (3 ms)
    Customer Password Reset Email
      ✓ should send customer password reset email (2 ms)
    Administrator Emails
      ✓ should send administrator welcome email with language support (2 ms)
      ✓ should send administrator password reset email (2 ms)
    Operator Emails
      ✓ should send operator PIN reset email (2 ms)
      ✓ should send operator shift reminder email (3 ms)
    System Alerts
      ✓ should send service down alert to multiple admins (2 ms)
      ✓ should handle service alert with minimal details (2 ms)
    Template Loading Errors
      ✓ should handle template file read errors (4 ms)
    Console Email Provider
      ✓ should log emails to console when using console provider (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/encryptionEnhanced.test.js
  Encryption Utility - Enhanced Coverage
    Encryption Error Paths
      ✓ should return null for falsy inputs (2 ms)
      ✓ should throw error with invalid encryption key length (14 ms)
      ✓ should throw error when encryption key is missing (1 ms)
      ✓ should handle crypto errors gracefully (1 ms)
    Decryption Error Paths
      ✓ should return null for falsy inputs (1 ms)
      ✓ should throw error with invalid encrypted object structure (3 ms)
      ✓ should throw error with tampered data (1 ms)
      ✓ should throw error with wrong encryption key (1 ms)
      ✓ should handle corrupted encrypted data (1 ms)
    Password Hashing Error Paths
      ✓ should handle crypto.randomBytes failure (2 ms)
      ✓ should handle crypto.pbkdf2Sync failure (2 ms)
      ✓ should handle empty password (80 ms)
    Password Verification Error Paths
      ✓ should throw error when pbkdf2Sync fails (1 ms)
      ✓ should handle invalid inputs gracefully (176 ms)
      ✓ should return false for invalid salt format (75 ms)
    Token and Barcode Generation
      ✓ should generate tokens of correct length (1 ms)
      ✓ should generate unique tokens (1 ms)
      ✓ should handle token generation errors (1 ms)
      ✓ should generate barcodes with correct format
      ✓ should generate unique barcodes (1 ms)
      ✓ should handle barcode generation errors (1 ms)
    Edge Cases and Security Tests
      ✓ should handle large data encryption/decryption (7 ms)
      ✓ should handle unicode and special characters (2 ms)
      ✓ should produce different IVs for same input (2 ms)
      ✓ should validate encryption output structure (2 ms)
      ✓ should handle password edge cases (1473 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'customer_12345' },
      headers: {},
      state: 'customer_12345',
      stateStartsWithCustomer: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_12345',
      isCustomerRequest: true,
      willDelegate: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:997:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_123' },
      headers: {},
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_456' },
      headers: {},
      state: 'oauth_session_456',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_456',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_456',
      sessionId: 'oauth_session_456',
      allParams: { state: 'oauth_session_456' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: 'oauth_session_456',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: null },
      headers: {},
      state: null,
      stateStartsWithCustomer: null
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: null, isCustomerRequest: null, willDelegate: null }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: null, sessionId: null, allParams: { state: null } }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: null,
      referer: undefined,
      isPopup: undefined,
      userIsNew: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_123' },
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-affiliate',
      query: { state: 'customer_oauth_789' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_789',
      sessionId: 'oauth_789',
      allParams: { state: 'customer_oauth_789' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_789',
      referer: undefined,
      isPopup: true,
      userIsNew: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: true,
      userObject: {
        email: 'affiliate@example.com',
        provider: 'google',
        isExistingAffiliate: true,
        affiliate: {
          _id: 'aff123',
          affiliateId: 'AFF001',
          email: 'affiliate@example.com',
          firstName: 'Jane',
          lastName: 'Doe',
          businessName: "Jane's Business"
        }
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1889:13)

  console.log
    [handleCustomerSocialCallback] User is an existing affiliate, showing conflict message

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1895:15)

  console.log
    [handleCustomerSocialCallback] Using nonce for affiliate conflict: test-nonce

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1921:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_999' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_999',
      sessionId: 'oauth_999',
      allParams: { state: 'customer_oauth_999' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_999',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'new-user',
      query: { state: 'customer_oauth_100' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_100',
      sessionId: 'oauth_100',
      allParams: { state: 'customer_oauth_100' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_100',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: undefined,
      userObject: {
        email: 'newcustomer@example.com',
        provider: 'google',
        firstName: 'New',
        lastName: 'Customer',
        socialId: 'google123',
        isNewUser: true
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1889:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_error' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_error',
      sessionId: null,
      allParams: { state: 'customer_error' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1647:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_12345' },
      headers: {},
      state: 'oauth_session_12345',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_12345',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_12345',
      sessionId: 'oauth_session_12345',
      allParams: { state: 'oauth_session_12345' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'popup=true' },
      headers: {},
      state: 'popup=true',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'popup=true', isCustomerRequest: false, willDelegate: false }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'popup=true',
      sessionId: null,
      allParams: { state: 'popup=true' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: { referer: 'https://accounts.google.com/oauth/authorize' },
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

PASS tests/unit/oauthCallbacks.test.js
  OAuth Callback Functions
    handleSocialCallback
      ✓ should handle customer OAuth request by delegating to customer handler (330 ms)
      ✓ should handle popup request with no user (auth failed) (124 ms)
      ✓ should handle existing user login with popup (118 ms)
      ✓ should handle new user registration flow (113 ms)
      ✓ should handle OAuth callback errors (107 ms)
    handleCustomerSocialCallback
      ✓ should handle affiliate conflict when social account is already an affiliate (112 ms)
      ✓ should handle existing customer login (110 ms)
      ✓ should handle new customer registration (110 ms)
      ✓ should handle errors during customer OAuth callback (110 ms)
    OAuth State Parameter Handling
      ✓ should correctly parse sessionId from state parameter (109 ms)
      ✓ should handle state parameter without oauth_ prefix (108 ms)
      ✓ should detect popup from referer headers (109 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching public configs: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:88:55)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      21 |     res.json(formattedConfigs);
      22 |   } catch (error) {
    > 23 |     console.error('Error fetching public configs:', error);
         |             ^
      24 |     res.status(500).json({ error: 'Failed to fetch public configurations' });
      25 |   }
      26 | });

      at error (server/routes/systemConfigRoutes.js:23:13)

  console.error
    Error fetching config: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:141:46)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      47 |     });
      48 |   } catch (error) {
    > 49 |     console.error('Error fetching config:', error);
         |             ^
      50 |     res.status(500).json({ error: 'Failed to fetch configuration' });
      51 |   }
      52 | });

      at error (server/routes/systemConfigRoutes.js:49:13)

  console.error
    Error fetching configs: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:190:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      70 |     res.json(configs);
      71 |   } catch (error) {
    > 72 |     console.error('Error fetching configs:', error);
         |             ^
      73 |     res.status(500).json({ error: 'Failed to fetch configurations' });
      74 |   }
      75 | });

      at error (server/routes/systemConfigRoutes.js:72:13)

  console.error
    Error updating config: Error: Invalid value
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:333:47)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

  console.error
    Error initializing configs: Error: Init failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:359:57)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      103 |     res.json({ message: 'Default configurations initialized' });
      104 |   } catch (error) {
    > 105 |     console.error('Error initializing configs:', error);
          |             ^
      106 |     res.status(500).json({ error: 'Failed to initialize configurations' });
      107 |   }
      108 | });

      at error (server/routes/systemConfigRoutes.js:105:13)

PASS tests/unit/systemConfigRoutes.test.js
  System Config Routes
    GET /api/system-config/public
      ✓ should return public configurations (16 ms)
      ✓ should handle errors when fetching public configs (4 ms)
    GET /api/system-config/public/:key
      ✓ should return specific public configuration (2 ms)
      ✓ should return 404 for non-existent public config (2 ms)
      ✓ should handle errors when fetching specific config (3 ms)
    GET /api/system-config (authenticated)
      ✓ should return all configurations for admin (2 ms)
      ✓ should filter configurations by category (2 ms)
      ✓ should handle errors when fetching all configs (3 ms)
      ✓ should require authentication (2 ms)
      ✓ should require administrator role (58 ms)
    PUT /api/system-config/:key
      ✓ should update configuration value (8 ms)
      ✓ should require system_config permission (68 ms)
      ✓ should handle validation errors (5 ms)
    POST /api/system-config/initialize
      ✓ should initialize default configurations (3 ms)
      ✓ should handle errors during initialization (4 ms)
      ✓ should require authentication and admin role (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.warn
    Email template placeholder [shift_date] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2071:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:79:7)

  console.warn
    Email template placeholder [shift_date] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2071:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:98:7)

  console.warn
    Email template placeholder [content] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2071:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:351:7)

PASS tests/unit/emailServiceUncovered.test.js
  Email Service - Uncovered Functions
    sendOperatorShiftReminderEmail
      ✓ should send shift reminder email successfully (18 ms)
      ✓ should handle email sending error (4 ms)
    sendOperatorPasswordResetEmail
      ✓ should log error since operators use PINs (2 ms)
      ✓ should still log error even with missing reset URL (2 ms)
    sendServiceDownAlert
      ✓ should send service down alert to all admin emails (2 ms)
      ✓ should handle empty admin emails (4 ms)
      ○ skipped should handle email sending errors gracefully
    sendOrderReadyNotification
      ✓ should send order ready notification successfully (1 ms)
      ✓ should handle missing data fields (2 ms)
    sendOrderPickedUpNotification
      ✓ should send order picked up notification successfully (2 ms)
      ○ skipped should handle email error and log it
    Console Email Provider
      ✓ should log emails when using console provider (5 ms)
    Template Loading Errors
      ✓ should handle template file not found (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Starting payment verification job - checking every 5 minutes

      at PaymentVerificationJob.log [as start] (server/jobs/paymentVerificationJob.js:43:15)

  console.log
    [2025-09-02T13:03:33.586Z] Starting payment verification check

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:84:15)

  console.error
    Error in payment verification job: TypeError: Cannot read properties of undefined (reading 'length')
        at PaymentVerificationJob.length [as runVerification] (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:89:27)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentVerificationJob.start (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:51:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:104:7)

       98 |       
       99 |     } catch (error) {
    > 100 |       console.error('Error in payment verification job:', error);
          |               ^
      101 |     } finally {
      102 |       this.running = false;
      103 |     }

      at PaymentVerificationJob.error [as runVerification] (server/jobs/paymentVerificationJob.js:100:15)
      at PaymentVerificationJob.start (server/jobs/paymentVerificationJob.js:51:7)
      at Object.<anonymous> (tests/unit/paymentVerificationJob.test.js:104:7)

  console.log
    Payment verification job started successfully

      at PaymentVerificationJob.log [as start] (server/jobs/paymentVerificationJob.js:53:15)

  console.log
    Payment verification job stopped

      at PaymentVerificationJob.log [as stop] (server/jobs/paymentVerificationJob.js:66:15)

  console.log
    Payment verification job not started - V1 payment system active

      at PaymentVerificationJob.log [as start] (server/jobs/paymentVerificationJob.js:31:17)

  console.log
    [2025-09-02T13:03:34.566Z] Starting payment verification check

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:84:15)

  console.log
    Verified 1 payments from email scan

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:90:17)

  console.error
    Error checking pending payments: CastError: Cast to ObjectId failed for value "CUST-f0c39802-42c1-40b6-8278-bb8653690afb" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
        at Array.map (<anonymous>)
        at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async Promise.all (index 0)
        at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
        at async Promise.all (index 0)
        at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
        at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
        at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:138:7) {
      stringValue: '"CUST-f0c39802-42c1-40b6-8278-bb8653690afb"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-f0c39802-42c1-40b6-8278-bb8653690afb',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
          at Array.map (<anonymous>)
          at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at async Promise.all (index 0)
          at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
          at async Promise.all (index 0)
          at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
          at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
          at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:138:7),
      valueType: 'string'
    }

      130 |       }
      131 |     } catch (error) {
    > 132 |       console.error('Error checking pending payments:', error);
          |               ^
      133 |     }
      134 |   }
      135 |

      at PaymentVerificationJob.error [as checkPendingPayments] (server/jobs/paymentVerificationJob.js:132:15)
      at PaymentVerificationJob.runVerification (server/jobs/paymentVerificationJob.js:94:7)
      at Object.<anonymous> (tests/unit/paymentVerificationJob.test.js:138:7)

  console.log
    Payment verification completed in 92ms

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:97:15)

  console.log
    Payment timeout for order 68b6eb2741003e9a4a590bcf - escalating to admin

      at PaymentVerificationJob.log [as processOrder] (server/jobs/paymentVerificationJob.js:171:17)

  console.log
    Escalating payment timeout for order 68b6eb2741003e9a4a590bcf to admin

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:337:15)

  console.log
    Admin escalation details: {
      orderId: 'ORD642577',
      orderMongoId: new ObjectId('68b6eb2741003e9a4a590bcf'),
      customerName: 'Test Customer',
      customerEmail: 'customer@test.com',
      customerPhone: '555-0002',
      affiliateName: 'undefined undefined',
      affiliateEmail: 'Unknown',
      paymentAmount: 27.5,
      hoursSinceRequest: 0,
      paymentRequestedAt: 2025-09-02T13:03:35.511Z,
      attemptsMade: 48
    }

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:365:15)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68b6eb2741003e9a4a590bcf

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:371:15)

  console.log
    Sending payment reminder to customer@test.com for order 68b6eb2941003e9a4a590c1b (0 hours elapsed, 4 hours remaining)

      at PaymentVerificationJob.log [as sendPaymentReminder] (server/jobs/paymentVerificationJob.js:225:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Payment Reminder - Order #874080 - $27.50

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Payment Reminder - WaveMAX Laundry</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .email-container {
                background-color: #ffffff;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            .header {
                background: linear-gradient(135deg, #f56565 0%, #ed8936 100%);
                color: white;
                padding: 30px;
                text-align: center;
            }
            .header.urgent {
                background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            }
            .header h1 {
                margin: 0;
                font-size: 28px;
            }
            .content {
                padding: 30px;
            }
            .urgency-banner {
                background-color: #fef2e8;
                border: 2px solid #fed7aa;
                border-radius: 8px;
                padding: 15px;
                margin: 20px 0;
                text-align: center;
            }
            .urgency-banner.critical {
                background-color: #fee2e2;
                border-color: #fca5a5;
                color: #991b1b;
            }
            .time-indicator {
                font-size: 24px;
                font-weight: bold;
                color: #e53e3e;
                text-align: center;
                margin: 20px 0;
            }
            .order-info {
                background-color: #f8f9fa;
                border-left: 4px solid #ed8936;
                padding: 15px;
                margin: 20px 0;
            }
            .amount-due {
                font-size: 32px;
                color: #2d3748;
                font-weight: bold;
                text-align: center;
                margin: 20px 0;
            }
            .already-paid-section {
                background: linear-gradient(135deg, #f0f4ff 0%, #e9ecff 100%);
                border: 2px solid #667eea;
                border-radius: 8px;
                padding: 20px;
                margin: 30px 0;
                text-align: center;
            }
            .already-paid-btn {
                display: inline-block;
                padding: 12px 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                text-decoration: none;
                border-radius: 6px;
                font-weight: bold;
                font-size: 16px;
                margin-top: 10px;
            }
            .payment-methods {
                margin: 30px 0;
            }
            .payment-method {
                display: block;
                background-color: #ffffff;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                padding: 15px;
                margin: 10px 0;
                text-decoration: none;
                color: #333;
            }
            .payment-method:hover {
                border-color: #ed8936;
                box-shadow: 0 4px 12px rgba(237, 137, 54, 0.2);
            }
            .btn {
                display: inline-block;
                padding: 12px 24px;
                background-color: #ed8936;
                color: white;
                text-decoration: none;
                border-radius: 6px;
                font-weight: bold;
                margin: 10px 5px;
            }
            .btn-venmo { background-color: #3D95CE; }
            .btn-paypal { background-color: #0070BA; }
            .btn-cashapp { background-color: #00D632; }
            .footer {
                background-color: #f8f9fa;
                padding: 20px;
                text-align: center;
                color: #718096;
                font-size: 14px;
            }
            .warning-icon {
                font-size: 48px;
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <div class="email-container">
            <div class="header ">
                <h1>Payment Reminder</h1>
                <p>Your payment is still pending</p>
            </div>
            
            <div class="content">
                <p>Hi Test Customer,</p>
                
                
                
                <div class="time-indicator">
                    {{hoursElapsed}} hours since payment requested
                </div>
                
                <div class="order-info">
                    <strong>Order Details:</strong><br>
                    Order ID: #ORD874080<br>
                    Weight: 22 lbs<br>
                    Status: Ready for payment<br>
                    Payment Requested: 9/2/2025, 1:03:37 PM<br>
                </div>
                
                <div class="amount-due">
                    Amount Due: $27.50
                </div>
                
                <!-- Already Paid Section -->
                <div class="already-paid-section">
                    <h3 style="margin-top: 0;">Already sent payment?</h3>
                    <p>If you've already paid through Venmo, PayPal, or CashApp, please let us know so we can verify it immediately.</p>
                    <a href="{{confirmationLink}}" class="already-paid-btn">I've Already Paid →</a>
                </div>
                
                <p style="text-align: center; font-weight: bold; color: #e53e3e;">
                    If you haven't paid yet, please use one of these methods:
                </p>
                
                <div class="payment-methods">
                    <a href="venmo://test" class="payment-method">
                        <div style="text-align: center;">
                            <span class="btn btn-venmo">Pay with Venmo</span>
                            <p style="margin: 10px 0 0 0; color: #718096;">@wavemax</p>
                        </div>
                    </a>
                    
                    <a href="https://paypal.me/test" class="payment-method">
                        <div style="text-align: center;">
                            <span class="btn btn-paypal">Pay with PayPal</span>
                            <p style="margin: 10px 0 0 0; color: #718096;">paypal.me/wavemax</p>
                        </div>
                    </a>
                    
                    <a href="https://cash.app/test" class="payment-method">
                        <div style="text-align: center;">
                            <span class="btn btn-cashapp">Pay with CashApp</span>
                            <p style="margin: 10px 0 0 0; color: #718096;">$wavemax</p>
                        </div>
                    </a>
                </div>
                
                <p style="background-color: #fef2e8; padding: 15px; border-radius: 6px;">
                    <strong>⏰ Time Remaining:</strong> {{hoursRemaining}} hour(s)<br>
                    
                </p>
                
                <p><strong>Remember:</strong> Include <strong>Order #874080</strong> in your payment note/memo.</p>
                
                <p>If you're having trouble with payment or have any questions, please contact us immediately.</p>
                
                <p>Thank you for your prompt attention to this matter.</p>
            </div>
            
            <div class="footer">
                <p>WaveMAX Laundry<br>
                Premium Pickup & Delivery Service<br>
                <a href="https://wavemax.promo" style="color: #667eea;">wavemax.promo</a></p>
                <p style="font-size: 12px;">
                    This is reminder 1 of 3.<br>
                    Payment reminders are sent hourly until payment is received.
                </p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    V2 payment reminder sent to customer@test.com for order ORD874080

      at Object.log [as sendV2PaymentReminder] (server/utils/emailService.js:2453:13)

  console.log
    Payment reminder #0 sent to customer@test.com for order ORD874080

      at PaymentVerificationJob.log [as sendReminderEmail] (server/jobs/paymentVerificationJob.js:291:15)

  console.log
    Sending payment reminder to customer@test.com for order 68b6eb2941003e9a4a590c30 (3 hours elapsed, 1 hours remaining)

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    === EMAIL CONSOLE LOG ===

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    To: customer@test.com

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Subject: URGENT: Payment Reminder - Order #187701 - $27.50

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    HTML: <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Payment Reminder - WaveMAX Laundry</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .email-container {
                background-color: #ffffff;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            .header {
                background: linear-gradient(135deg, #f56565 0%, #ed8936 100%);
                color: white;
                padding: 30px;
                text-align: center;
            }
            .header.urgent {
                background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            }
            .header h1 {
                margin: 0;
                font-size: 28px;
            }
            .content {
                padding: 30px;
            }
            .urgency-banner {
                background-color: #fef2e8;
                border: 2px solid #fed7aa;
                border-radius: 8px;
                padding: 15px;
                margin: 20px 0;
                text-align: center;
            }
            .urgency-banner.critical {
                background-color: #fee2e2;
                border-color: #fca5a5;
                color: #991b1b;
            }
            .time-indicator {
                font-size: 24px;
                font-weight: bold;
                color: #e53e3e;
                text-align: center;
                margin: 20px 0;
            }
            .order-info {
                background-color: #f8f9fa;
                border-left: 4px solid #ed8936;
                padding: 15px;
                margin: 20px 0;
            }
            .amount-due {
                font-size: 32px;
                color: #2d3748;
                font-weight: bold;
                text-align: center;
                margin: 20px 0;
            }
            .already-paid-section {
                background: linear-gradient(135deg, #f0f4ff 0%, #e9ecff 100%);
                border: 2px solid #667eea;
                border-radius: 8px;
                padding: 20px;
                margin: 30px 0;
                text-align: center;
            }
            .already-paid-btn {
                display: inline-block;
                padding: 12px 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                text-decoration: none;
                border-radius: 6px;
                font-weight: bold;
                font-size: 16px;
                margin-top: 10px;
            }
            .payment-methods {
                margin: 30px 0;
            }
            .payment-method {
                display: block;
                background-color: #ffffff;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                padding: 15px;
                margin: 10px 0;
                text-decoration: none;
                color: #333;
            }
            .payment-method:hover {
                border-color: #ed8936;
                box-shadow: 0 4px 12px rgba(237, 137, 54, 0.2);
            }
            .btn {
                display: inline-block;
                padding: 12px 24px;
                background-color: #ed8936;
                color: white;
                text-decoration: none;
                border-radius: 6px;
                font-weight: bold;
                margin: 10px 5px;
            }
            .btn-venmo { background-color: #3D95CE; }
            .btn-paypal { background-color: #0070BA; }
            .btn-cashapp { background-color: #00D632; }
            .footer {
                background-color: #f8f9fa;
                padding: 20px;
                text-align: center;
                color: #718096;
                font-size: 14px;
            }
            .warning-icon {
                font-size: 48px;
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <div class="email-container">
            <div class="header urgent">
                <h1>Payment Reminder</h1>
                <p>Urgent: Your payment is still pending</p>
            </div>
            
            <div class="content">
                <p>Hi Test Customer,</p>
                
                
                <div class="urgency-banner critical">
                    <div class="warning-icon">⚠️</div>
                    <strong>URGENT: Payment Required</strong><br>
                    Your payment has been pending for {{hoursElapsed}} hours.<br>
                    Please submit payment within the next {{hoursRemaining}} hour(s) to avoid delays.
                </div>
                {{else}}
                <div class="urgency-banner">
                    <strong>Friendly Reminder</strong><br>
                    We're still waiting for your payment for order #187701.
                </div>
                
                
                <div class="time-indicator">
                    {{hoursElapsed}} hours since payment requested
                </div>
                
                <div class="order-info">
                    <strong>Order Details:</strong><br>
                    Order ID: #ORD187701<br>
                    Weight: 22 lbs<br>
                    Status: Ready for payment<br>
                    Payment Requested: 9/2/2025, 1:03:37 PM<br>
                </div>
                
                <div class="amount-due">
                    Amount Due: $27.50
                </div>
                
                <!-- Already Paid Section -->
                <div class="already-paid-section">
                    <h3 style="margin-top: 0;">Already sent payment?</h3>
                    <p>If you've already paid through Venmo, PayPal, or CashApp, please let us know so we can verify it immediately.</p>
                    <a href="{{confirmationLink}}" class="already-paid-btn">I've Already Paid →</a>
                </div>
                
                <p style="text-align: center; font-weight: bold; color: #e53e3e;">
                    If you haven't paid yet, please use one of these methods:
                </p>
                
                <div class="payment-methods">
                    <a href="#" class="payment-method">
                        <div style="text-align: center;">
                            <span class="btn btn-venmo">Pay with Venmo</span>
                            <p style="margin: 10px 0 0 0; color: #718096;">@wavemax</p>
                        </div>
                    </a>
                    
                    <a href="#" class="payment-method">
                        <div style="text-align: center;">
                            <span class="btn btn-paypal">Pay with PayPal</span>
                            <p style="margin: 10px 0 0 0; color: #718096;">paypal.me/wavemax</p>
                        </div>
                    </a>
                    
                    <a href="#" class="payment-method">
                        <div style="text-align: center;">
                            <span class="btn btn-cashapp">Pay with CashApp</span>
                            <p style="margin: 10px 0 0 0; color: #718096;">$wavemax</p>
                        </div>
                    </a>
                </div>
                
                <p style="background-color: #fef2e8; padding: 15px; border-radius: 6px;">
                    <strong>⏰ Time Remaining:</strong> {{hoursRemaining}} hour(s)<br>
                    
                    <span style="color: #e53e3e;">Your order may be delayed if payment is not received soon.</span>
                    {{else}}
                    Please submit payment to ensure timely delivery of your clean laundry.
                    
                </p>
                
                <p><strong>Remember:</strong> Include <strong>Order #187701</strong> in your payment note/memo.</p>
                
                <p>If you're having trouble with payment or have any questions, please contact us immediately.</p>
                
                <p>Thank you for your prompt attention to this matter.</p>
            </div>
            
            <div class="footer">
                <p>WaveMAX Laundry<br>
                Premium Pickup & Delivery Service<br>
                <a href="https://wavemax.promo" style="color: #667eea;">wavemax.promo</a></p>
                <p style="font-size: 12px;">
                    This is reminder 3 of 3.<br>
                    Payment reminders are sent hourly until payment is received.
                </p>
            </div>
        </div>
    </body>
    </html>

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    =========================

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Email sent: console-message-id

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    V2 payment reminder sent to customer@test.com for order ORD187701

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Payment reminder #3 sent to customer@test.com for order ORD187701

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Escalating payment timeout for order 68b6eb2a41003e9a4a590c45 to admin

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation details: {
      orderId: 'ORD887145',
      orderMongoId: new ObjectId('68b6eb2a41003e9a4a590c45'),
      customerName: 'Test Customer',
      customerEmail: 'customer@test.com',
      customerPhone: '555-0002',
      affiliateName: 'undefined undefined',
      affiliateEmail: 'Unknown',
      paymentAmount: 27.5,
      hoursSinceRequest: 4,
      paymentRequestedAt: 2025-09-02T09:03:38.448Z,
      attemptsMade: 48
    }

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68b6eb2a41003e9a4a590c45

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Escalating payment timeout for order 68b6eb2a41003e9a4a590c59 to admin

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation details: {
      orderId: 'ORD730402',
      orderMongoId: new ObjectId('68b6eb2a41003e9a4a590c59'),
      customerName: 'Test Customer',
      customerEmail: 'customer@test.com',
      customerPhone: '555-0002',
      affiliateName: 'undefined undefined',
      affiliateEmail: 'Unknown',
      paymentAmount: 27.5,
      hoursSinceRequest: 0,
      paymentRequestedAt: 2025-09-02T13:03:38.873Z,
      attemptsMade: 0
    }

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68b6eb2a41003e9a4a590c59

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Manual payment verification triggered

      at PaymentVerificationJob.log [as triggerManual] (server/jobs/paymentVerificationJob.js:394:13)

  console.log
    [2025-09-02T13:03:40.928Z] Starting payment verification check

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:84:15)

  console.error
    Error checking pending payments: CastError: Cast to ObjectId failed for value "CUST-abaebaa0-0ff4-4d7d-860e-759ebaffffa1" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
        at Array.map (<anonymous>)
        at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async Promise.all (index 0)
        at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
        at async Promise.all (index 0)
        at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
        at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
        at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
        at PaymentVerificationJob.triggerManual (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:395:5)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:369:7) {
      stringValue: '"CUST-abaebaa0-0ff4-4d7d-860e-759ebaffffa1"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-abaebaa0-0ff4-4d7d-860e-759ebaffffa1',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
          at Array.map (<anonymous>)
          at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at async Promise.all (index 0)
          at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
          at async Promise.all (index 0)
          at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
          at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
          at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
          at PaymentVerificationJob.triggerManual (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:395:5)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:369:7),
      valueType: 'string'
    }

      130 |       }
      131 |     } catch (error) {
    > 132 |       console.error('Error checking pending payments:', error);
          |               ^
      133 |     }
      134 |   }
      135 |

      at PaymentVerificationJob.error [as checkPendingPayments] (server/jobs/paymentVerificationJob.js:132:15)
      at PaymentVerificationJob.runVerification (server/jobs/paymentVerificationJob.js:94:7)
      at PaymentVerificationJob.triggerManual (server/jobs/paymentVerificationJob.js:395:5)
      at Object.<anonymous> (tests/unit/paymentVerificationJob.test.js:369:7)

  console.log
    Payment verification completed in 33ms

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:97:15)

PASS tests/unit/paymentVerificationJob.test.js (9.153 s)
  PaymentVerificationJob
    Job initialization
      ✓ should start when V2 payment system is enabled (776 ms)
      ✓ should not start when V1 payment system is active (503 ms)
    Payment verification
      ✓ should check for payments via email scanner (517 ms)
      ✓ should increment check attempts for unverified payments (483 ms)
      ✓ should mark order as failed after max attempts (542 ms)
    Payment reminders
      ✓ should send first reminder after 30 minutes (6 attempts) (441 ms)
      ✓ should send hourly reminders after first 30 minutes (425 ms)
      ✓ should not send reminders between hourly intervals (421 ms)
      ✓ should generate fresh payment links when sending reminder (532 ms)
      ✓ should include urgency information in reminders (512 ms)
    Admin escalation
      ✓ should escalate to admin after 4 hours (484 ms)
      ✓ should include detailed order information in escalation (455 ms)
    Order processing
      ✓ should skip non-V2 customers (594 ms)
      ✓ should handle orders already verified (510 ms)
    Job status
      ✓ should return correct status information (437 ms)
      ✓ should allow manual triggering (457 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/v2-payment-core.test.js (6.114 s)
  V2 Payment Core Functionality
    Payment Link Generation
      ✓ should generate correct payment links (1888 ms)
      ✓ should generate QR codes for payment links (1774 ms)
      ○ skipped should include translations in payment data (feature not implemented)
    Payment Email Parsing
      ✓ should parse Venmo payment email correctly (159 ms)
      ✓ should parse PayPal payment email correctly (161 ms)
      ✓ should parse CashApp payment email correctly (160 ms)
      ✓ should handle various order ID formats (161 ms)
    Payment Verification Job Logic
      ✓ should not send reminder before 30 minutes (162 ms)
      ○ skipped should determine when to send first reminder (30 minutes)
      ○ skipped should send hourly reminders after first reminder
      ○ skipped should determine urgency correctly
      ○ skipped should determine when to escalate to admin (4 hours)
    Order State Transitions
      ✓ should transition from pending to awaiting when weighed (164 ms)
      ✓ should transition from awaiting to confirming on customer confirmation (162 ms)
      ✓ should transition from confirming to verified when payment detected (162 ms)
    Amount Tolerance
      ✓ should accept payment within tolerance (164 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/adminIdGeneration.test.js
  Admin ID Generation Logic Tests
    generateAdminId function logic
      ✓ should generate ADM001 when no administrators exist (144 ms)
      ✓ should generate ADM002 when ADM001 exists (240 ms)
      ✓ should generate ADM003 when ADM001 and ADM002 exist (297 ms)
      ✓ should handle non-sequential admin IDs correctly (299 ms)
      ✓ should handle double-digit admin IDs (222 ms)
      ✓ should handle triple-digit admin IDs (229 ms)
      ✓ should handle large admin ID numbers (222 ms)
    Admin ID format validation
      ✓ should maintain three-digit padding for numbers below 100 (103 ms)
      ✓ should handle numbers above 999 without padding issues (107 ms)
    Admin ID parsing logic
      ✓ should correctly parse admin ID numbers (106 ms)
      ✓ should handle edge cases in admin ID parsing (105 ms)
    Admin ID generation with mixed data
      ✓ should work correctly with inactive administrators (286 ms)
      ✓ should work correctly with different creation dates (284 ms)
      ✓ should work correctly with different permissions (300 ms)
    Performance and reliability
      ✓ should handle database query efficiently (236 ms)
      ✓ should handle concurrent admin creation scenario (253 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/csrfConfig.test.js
  CSRF Configuration
    CSRF_CONFIG
      ✓ should define all endpoint categories (1 ms)
      ✓ should have valid endpoint patterns (11 ms)
      ✓ should not have duplicate endpoints across categories
      ✓ should include critical security endpoints (1 ms)
      ✓ should exclude authentication endpoints from CSRF
      ✓ should exclude registration endpoints from CSRF (1 ms)
    shouldEnforceCsrf
      HTTP method checks
        ✓ should not enforce CSRF for GET requests
        ✓ should not enforce CSRF for HEAD requests
        ✓ should not enforce CSRF for OPTIONS requests (1 ms)
        ✓ should consider CSRF for POST requests
        ✓ should consider CSRF for PUT requests
        ✓ should consider CSRF for DELETE requests (1 ms)
        ✓ should consider CSRF for PATCH requests
      Public endpoints
        ✓ should not enforce CSRF for public endpoints
        ✓ should not enforce CSRF for health check endpoints
      Authentication endpoints
        ✓ should not enforce CSRF for login endpoints
        ✓ should not enforce CSRF for forgot password
        ✓ should not enforce CSRF for refresh token
      Registration endpoints
        ✓ should not enforce CSRF for affiliate registration
        ✓ should not enforce CSRF for customer registration
      Critical endpoints
        ✓ should enforce CSRF for logout
        ✓ should enforce CSRF for order creation
        ✓ should enforce CSRF for order cancellation (1 ms)
        ✓ should enforce CSRF for password changes
        ✓ should enforce CSRF for data deletion
        ✓ should enforce CSRF for admin operations (1 ms)
        ✓ should enforce CSRF for operator shift changes
        ✓ should enforce CSRF for order status updates
      High priority endpoints
        ✓ should not enforce CSRF for high priority endpoints when CSRF_PHASE < 2 (1 ms)
        ✓ should enforce CSRF for high priority endpoints when CSRF_PHASE >= 2
        ✓ should handle bag management endpoints based on phase
        ✓ should handle payment updates based on phase
      Read-only endpoints
        ✓ should not enforce CSRF for dashboard endpoints
        ✓ should enforce CSRF for search endpoints with state-changing methods
        ✓ should enforce CSRF for export endpoints with state-changing methods (1 ms)
      Pattern matching
        ✓ should match parameterized routes
        ✓ should match nested parameterized routes
        ✓ should not match partial paths (1 ms)
        ✓ should handle complex IDs in paths
      Default behavior
        ✓ should enforce CSRF for unknown state-changing endpoints
        ✓ should enforce CSRF for unmatched PUT requests (2 ms)
        ✓ should not enforce CSRF for unknown GET endpoints
      Edge cases
        ✓ should handle missing CSRF_PHASE environment variable (1 ms)
        ✓ should handle non-numeric CSRF_PHASE
        ✓ should handle paths with query parameters
        ✓ should handle paths with trailing slashes (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/v2PaymentModels.test.js (5.321 s)
  V2 Payment System Model Updates
    Customer Model V2 Fields
      ✓ should create customer with V1 registration by default (487 ms)
      ✓ should create V2 customer with custom bag count (321 ms)
      ✓ should validate registrationVersion enum values (254 ms)
      ✓ should validate initialBagsRequested range (263 ms)
    Order Model V2 Payment Fields
      ✓ should create order with V2 payment fields defaults (359 ms)
      ✓ should update V2 payment status correctly (470 ms)
      ✓ should store payment links and QR codes (441 ms)
      ✓ should track payment check attempts (489 ms)
      ✓ should validate V2 payment status enum (281 ms)
      ✓ should validate V2 payment method enum (303 ms)
      ✓ should store payment notes (357 ms)
    V1 Compatibility
      ✓ should not affect existing V1 customers (301 ms)
      ✓ should not affect existing V1 orders (344 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportCustomerOAuth.test.js
  Passport Customer OAuth Flow
    Facebook Strategy - Customer Context
      ✓ should handle existing customer login with Facebook ID (12 ms)
      ✓ should link Facebook to existing customer by email (4 ms)
      ✓ should detect when affiliate exists with same Facebook account (4 ms)
      ✓ should handle new customer registration (3 ms)
      ✓ should parse display name when structured name not available (4 ms)
      ✓ should handle single name in display name (3 ms)
    Facebook Strategy - Affiliate Context with Customer Check
      ✓ should detect when customer exists during affiliate OAuth (4 ms)
      ✓ should parse display name in affiliate context (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:371:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:371:42)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:390:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:390:42)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:414:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:414:42)

PASS tests/unit/rateLimitingMiddleware.test.js
  Rate Limiting Middleware
    createMongoStore
      ✓ should return undefined in test environment (5 ms)
      ✓ should create MongoStore in non-test environment (1 ms)
      ✓ should handle MongoStore creation errors (2 ms)
    Key Generators
      ✓ should generate key for sensitive operations based on user ID (42 ms)
      ✓ should generate key for sensitive operations based on IP when no user (17 ms)
      ✓ should generate key for email verification based on email (31 ms)
      ✓ should generate key for email verification based on user ID when no email (24 ms)
      ✓ should generate key for email verification based on IP when no email or user (16 ms)
      ✓ should generate key for file upload based on user ID (23 ms)
      ✓ should generate key for admin login based on IP and username (21 ms)
      ✓ should generate key for admin login based on IP and email when no username (24 ms)
    Skip Functions
      ✓ should skip admin operation limiter for non-admin users (24 ms)
      ✓ should not skip admin operation limiter for admin users (20 ms)
      ✓ should skip admin operation limiter when no user (22 ms)
    createCustomLimiter
      ✓ should create limiter with custom options (16 ms)
      ✓ should merge defaults with custom options (15 ms)
      ✓ should use custom windowMs for store creation (15 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/models.test.js (7.644 s)
  Model Tests
    Affiliate Model
      ✓ should create a valid affiliate (691 ms)
      ✓ should require required fields (323 ms)
      ✓ should enforce unique constraints (672 ms)
      ✓ should handle payment information correctly (356 ms)
      ✓ should save affiliate with venmo payment method (354 ms)
    Customer Model
      ✓ should create a valid customer (360 ms)
    Order Model
      ✓ should create a valid order (387 ms)
      ✓ should calculate estimated total correctly (383 ms)
      ✓ should calculate actual total and commission when weight is set (386 ms)
      ✓ should update timestamps for status changes (527 ms)
    Transaction Model
      ✓ should create a valid transaction (357 ms)
      ✓ should validate transaction type (393 ms)
      ✓ should validate transaction status (412 ms)
    RefreshToken Model
      ✓ should create a valid refresh token (681 ms)
      ✓ should validate user type (341 ms)
      ✓ should check if token is expired (388 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/fieldFilter.test.js
  Field Filter Utility
    filterFields
      ✓ should filter object to include only allowed fields (1 ms)
      ✓ should handle empty allowed fields array (1 ms)
      ✓ should handle null or undefined objects
      ✓ should handle non-object inputs
      ✓ should handle missing fields gracefully
      ✓ should not include inherited properties
      ✓ should handle nested objects without deep filtering
    filterArray
      ✓ should filter array of objects
      ✓ should handle empty array
      ✓ should handle non-array inputs (1 ms)
      ✓ should handle arrays with mixed types
    fieldDefinitions
      ✓ should have definitions for all data types (1 ms)
      ✓ should have different field sets for different roles (1 ms)
      ✓ should not expose sensitive fields in public view
      ✓ should include appropriate fields for each role (1 ms)
    getFilteredData
      ✓ should filter data based on admin role
      ✓ should filter data based on public role (1 ms)
      ✓ should handle self context for customers
      ✓ should handle arrays of data (1 ms)
      ✓ should return data as-is for unknown data types
      ✓ should handle null or undefined data
      ✓ should use fallback field definitions
    responseFilter middleware
      ✓ should create filtered json method (1 ms)
      ✓ should filter response data when _filterType is provided
      ✓ should not filter when _filterType is not provided (1 ms)
      ✓ should handle public role when user is not authenticated
      ✓ should extract user ID from different user types (1 ms)
      ✓ should preserve other response properties
      ✓ should handle responses without data property
      ✓ should maintain this context in json method (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/storeIPs.test.js
  storeIPs configuration
    IP whitelist configuration
      ✓ should load single store IP from environment (5 ms)
      ✓ should handle empty store IP (1 ms)
      ✓ should load additional IPs from environment (1 ms)
      ✓ should trim whitespace from IPs
      ✓ should filter out empty IP entries (1 ms)
      ✓ should load IP ranges from environment
      ✓ should handle empty IP ranges (1 ms)
    Session renewal configuration
      ✓ should use default session renewal settings
      ✓ should load custom session renewal settings from environment (1 ms)
      ✓ should handle invalid numeric values (1 ms)
    isWhitelisted function
      ✓ should return true for directly whitelisted IPs
      ✓ should return false for non-whitelisted IPs (1 ms)
      ✓ should check IP ranges (5 ms)
      ✓ should return false for IPs outside ranges (1 ms)
    isInRange function
      ✓ should correctly check IPs in /24 subnet
      ✓ should correctly check IPs in /16 subnet
      ✓ should correctly check IPs in /8 subnet (1 ms)
      ✓ should correctly check IPs in /32 subnet (single host)
      ✓ should correctly check IPs in /0 subnet (all IPs) (1 ms)
      ✓ should handle invalid CIDR notation
      ✓ should handle invalid mask bits (1 ms)
      ✓ should handle invalid IP addresses (1 ms)
      ✓ should handle IP parts out of range
      ✓ should handle edge cases with console error (1 ms)
      ✓ should correctly handle boundary cases (1 ms)
      ✓ should handle various subnet sizes correctly (1 ms)
    Configuration export structure
      ✓ should export all required properties and functions (1 ms)
      ✓ should have correct session renewal properties (3 ms)
    Integration scenarios
      ✓ should handle complex whitelist configuration (1 ms)
      ✓ should work with no configuration (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/callbackPoolManager.test.js
  CallbackPoolManager
    constructor
      ✓ should initialize with correct configuration (1 ms)
    initializePool
      ✓ should create or update callback entries for all paths (2 ms)
      ✓ should start cleanup job after initialization
    acquireCallback
      ✓ should acquire callback successfully (1 ms)
      ✓ should return null when no callbacks available (1 ms)
    releaseCallback
      ✓ should release callback successfully (1 ms)
      ✓ should handle null callback gracefully (1 ms)
    getPoolStatus
      ✓ should return pool status with all handler details (1 ms)
      ✓ should handle empty pool (16 ms)
    startCleanupJob
      ✓ should start cleanup interval (3 ms)
      ✓ should run cleanup task every 5 minutes (2 ms)
      ✓ should handle cleanup errors gracefully (1 ms)
      ✓ should not log when no locks are released (1 ms)
    stopCleanupJob
      ✓ should stop cleanup interval when running (1 ms)
      ✓ should handle stopping when no interval exists
    integration scenarios
      ✓ should handle complete payment flow (1 ms)
      ✓ should handle concurrent acquire attempts (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passwordValidator.test.js
  Password Validator Utility
    validatePasswordStrength
      Basic Requirements
        ✓ should validate minimum length requirement (2 ms)
        ✓ should require uppercase letters
        ✓ should require lowercase letters
        ✓ should require numbers
        ✓ should require special characters (1 ms)
      Security Validations
        ✓ should reject common passwords (1 ms)
        ✓ should reject passwords containing username
        ✓ should reject passwords containing email (1 ms)
        ✓ should reject sequential characters (1 ms)
        ✓ should reject repeated characters
      Valid Passwords
        ✓ should accept strong valid passwords (1 ms)
      Edge Cases
        ✓ should handle empty password
        ✓ should handle null/undefined password
        ✓ should handle case-insensitive username/email checks
    customPasswordValidator
      ✓ should work as express-validator custom validator (13 ms)
      ✓ should include validation errors in thrown message (1 ms)
    passwordValidationMiddleware
      ✓ should create middleware function
      ✓ should validate password and call next on success
      ✓ should return error response on validation failure (2 ms)
    isPasswordInHistory
      ✓ should return false for empty history
      ✓ should return false for password not in history (71 ms)
      ✓ should handle null/undefined history
    getPasswordStrength
      ✓ should return higher scores for stronger passwords (1 ms)
      ✓ should score length appropriately
      ✓ should score character variety (1 ms)
      ✓ should penalize common patterns
    commonPasswords array
      ✓ should contain common passwords (1 ms)
      ✓ should contain domain-specific passwords

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/callbackPool.test.js (6.733 s)
  CallbackPool Model
    Schema and Indexes
      ✓ should have required fields (179 ms)
      ✓ should have default values (164 ms)
      ✓ should have unique constraint on callbackPath (178 ms)
      ✓ should create document with defaults (176 ms)
    Instance Methods
      lock()
        ✓ should lock callback with payment token (199 ms)
        ✓ should increment usage count on each lock (284 ms)
        ✓ should update lastUsedAt timestamp (208 ms)
      release()
        ✓ should release locked callback (254 ms)
        ✓ should handle releasing already unlocked callback (193 ms)
    Static Methods
      acquireCallback()
        ✓ should acquire available unlocked callback (209 ms)
        ✓ should use least recently used callback (309 ms)
        ✓ should acquire expired locked callback (252 ms)
        ✓ should return null when no callbacks available (259 ms)
        ✓ should increment usage count atomically (303 ms)
      releaseCallback()
        ✓ should release callback by payment token (210 ms)
        ✓ should return null if no callback found with token (176 ms)
        ✓ should only release callback locked by specific token (231 ms)
      releaseExpiredLocks()
        ✓ should release callbacks locked longer than timeout (274 ms)
        ✓ should not release recently locked callbacks (244 ms)
        ✓ should handle custom timeout values (287 ms)
        ✓ should return 0 when no expired locks (264 ms)
        ✓ should handle empty collection (236 ms)
    Edge Cases and Error Handling
      ✓ should handle concurrent lock attempts (175 ms)
      ✓ should maintain data integrity with rapid lock/release cycles (807 ms)
      ✓ should handle invalid ObjectId gracefully (172 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/sanitization.test.js
  Sanitization Middleware
    sanitizeInput
      ✓ should sanitize string input (1 ms)
      ✓ should sanitize arrays recursively
      ✓ should sanitize objects recursively (1 ms)
      ✓ should handle null values
      ✓ should handle undefined values
      ✓ should handle numbers
      ✓ should handle booleans
      ✓ should handle deeply nested objects
      ✓ should handle arrays of objects
      ✓ should not modify prototype properties (1 ms)
    sanitizeRequest
      ✓ should sanitize request body
      ✓ should sanitize query parameters (1 ms)
      ✓ should sanitize URL parameters
      ✓ should handle missing request properties (1 ms)
      ✓ should handle all properties in one request (2 ms)
    sanitizeEmail
      ✓ should sanitize and validate email (1 ms)
      ✓ should remove HTML from email
      ✓ should return empty string for invalid email (1 ms)
      ✓ should handle null and undefined
      ✓ should handle non-string inputs
      ✓ should handle empty string (1 ms)
      ✓ should validate complex email formats
    sanitizePhone
      ✓ should keep only allowed characters
      ✓ should remove invalid characters (1 ms)
      ✓ should handle international format
      ✓ should remove HTML and special characters
      ✓ should handle null and undefined (1 ms)
      ✓ should handle non-string inputs
      ✓ should trim whitespace
      ✓ should handle empty string (1 ms)
    sanitizeId
      ✓ should keep alphanumeric characters and hyphens
      ✓ should remove special characters
      ✓ should remove spaces
      ✓ should handle script injection attempts (1 ms)
      ✓ should handle null and undefined
      ✓ should handle non-string inputs
      ✓ should trim whitespace
      ✓ should handle empty string (1 ms)
      ✓ should handle MongoDB ObjectId format
    sanitizePath
      ✓ should allow valid file paths
      ✓ should remove directory traversal attempts (1 ms)
      ✓ should remove multiple directory traversal attempts
      ✓ should allow valid characters in paths
      ✓ should remove invalid characters
      ✓ should handle Windows-style paths (1 ms)
      ✓ should handle null and undefined
      ✓ should handle non-string inputs
      ✓ should handle empty string
      ✓ should handle complex path traversal attempts (1 ms)
      ✓ should preserve forward slashes
    Integration tests
      ✓ should work with express middleware chain (1 ms)
      ✓ should handle complex nested structures

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error checking active orders: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderControllerAdditional.test.js:99:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      87 |     });
      88 |   } catch (error) {
    > 89 |     console.error('Error checking active orders:', error);
         |             ^
      90 |     res.status(500).json({
      91 |       success: false,
      92 |       message: 'Failed to check active orders'

      at Object.error [as checkActiveOrders] (server/controllers/orderController.js:89:13)
      at Object.<anonymous> (tests/unit/orderControllerAdditional.test.js:102:7)

  console.log
    Creating order with data: {
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 20
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

PASS tests/unit/orderControllerAdditional.test.js
  Order Controller - Additional Coverage
    checkActiveOrders
      ✓ should check active orders for authenticated customer (60 ms)
      ✓ should return no active orders when none exist (62 ms)
      ✓ should handle missing customer ID (54 ms)
      ✓ should handle database errors (69 ms)
    createOrder error handling
      ✓ should handle general errors during order creation (381 ms)
    exportOrders
      ✓ should export orders as CSV (52 ms)
      ✓ should export orders as JSON when format=json (293 ms)
      ✓ should handle export errors (299 ms)
      ✓ should handle unauthorized access (294 ms)
    updateOrderStatus edge cases
      ✓ should handle invalid status transitions (52 ms)
    cancelOrder method
      ✓ should handle order not found (58 ms)
      ✓ should handle cancellation of non-cancellable order (287 ms)
    updatePaymentStatus
      ✓ should handle order not found (68 ms)
      ✓ should prevent payment updates on non-complete orders (51 ms)
      ✓ should allow refund on complete orders regardless of payment status (303 ms)
    bulkUpdateOrderStatus
      ✓ should handle invalid order IDs format (292 ms)
      ✓ should handle empty order IDs array (60 ms)
      ✓ should handle unauthorized access (55 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    No matching order found for ID: REFERENC

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:180:17)

  console.log
    No matching order found for ID: NOTFOUND

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:180:17)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order D964CE6A

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.00</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68b6eb5bc51f00d7d964ce6a</li>
              <li><strong>Short Order ID:</strong> D964CE6A</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.50</li>
              <li><strong>Difference:</strong> $28.00</li>
              <li><strong>Payment Method:</strong> venmo</li>
              <li><strong>Transaction ID:</strong> VENMO123</li>
              <li><strong>Sender:</strong> John Doe</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Admin notification sent: Overpayment Received - Order D964CE6A

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2696:13)

  console.log
    Admin notified about overpayment for order 68b6eb5bc51f00d7d964ce6a

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:541:15)

  console.log
    Payment verified for order 68b6eb5bc51f00d7d964ce6a

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:332:15)

  console.error
    Error sending payment confirmation: CastError: Cast to ObjectId failed for value "CUST-f05ac619-dccd-446b-bd55-0e6389a96cce" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
        at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:212:22) {
      stringValue: '"CUST-f05ac619-dccd-446b-bd55-0e6389a96cce"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-f05ac619-dccd-446b-bd55-0e6389a96cce',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
          at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:212:22),
      valueType: 'string'
    }

      367 |       // await emailService.sendV2PaymentConfirmation(order, customer);
      368 |     } catch (error) {
    > 369 |       console.error('Error sending payment confirmation:', error);
          |               ^
      370 |     }
      371 |   }
      372 |

      at PaymentEmailScanner.error [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:369:15)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:335:7)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:212:22)

  console.log
    Sending pickup notification for order 68b6eb5bc51f00d7d964ce6a

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:379:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order D964CE81

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.25</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68b6eb5cc51f00d7d964ce81</li>
              <li><strong>Short Order ID:</strong> D964CE81</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.75</li>
              <li><strong>Difference:</strong> $28.25</li>
              <li><strong>Payment Method:</strong> paypal</li>
              <li><strong>Transaction ID:</strong> PP123</li>
              <li><strong>Sender:</strong> Jane Doe</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Admin notification sent: Overpayment Received - Order D964CE81

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2696:13)

  console.log
    Admin notified about overpayment for order 68b6eb5cc51f00d7d964ce81

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:541:15)

  console.log
    Payment verified for order 68b6eb5cc51f00d7d964ce81

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:332:15)

  console.error
    Error sending payment confirmation: CastError: Cast to ObjectId failed for value "CUST-5a7dbb66-2347-4329-b627-45e7ccf646a6" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
        at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:233:22) {
      stringValue: '"CUST-5a7dbb66-2347-4329-b627-45e7ccf646a6"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-5a7dbb66-2347-4329-b627-45e7ccf646a6',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
          at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:233:22),
      valueType: 'string'
    }

      367 |       // await emailService.sendV2PaymentConfirmation(order, customer);
      368 |     } catch (error) {
    > 369 |       console.error('Error sending payment confirmation:', error);
          |               ^
      370 |     }
      371 |   }
      372 |

      at PaymentEmailScanner.error [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:369:15)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:335:7)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:233:22)

  console.log
    Sending pickup notification for order 68b6eb5cc51f00d7d964ce81

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:379:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order D964CE98

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $17.50</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68b6eb5cc51f00d7d964ce98</li>
              <li><strong>Short Order ID:</strong> D964CE98</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $45.00</li>
              <li><strong>Difference:</strong> $17.50</li>
              <li><strong>Payment Method:</strong> cashapp</li>
              <li><strong>Transaction ID:</strong> CA123</li>
              <li><strong>Sender:</strong> Bob Smith</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Admin notification sent: Overpayment Received - Order D964CE98

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2696:13)

  console.log
    Admin notified about overpayment for order 68b6eb5cc51f00d7d964ce98

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:541:15)

  console.log
    Payment verified for order 68b6eb5cc51f00d7d964ce98

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:332:15)

  console.error
    Error sending payment confirmation: CastError: Cast to ObjectId failed for value "CUST-5e5b3124-0db4-4f2e-8359-939e64bbddee" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
        at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:252:22) {
      stringValue: '"CUST-5e5b3124-0db4-4f2e-8359-939e64bbddee"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-5e5b3124-0db4-4f2e-8359-939e64bbddee',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
          at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:252:22),
      valueType: 'string'
    }

      367 |       // await emailService.sendV2PaymentConfirmation(order, customer);
      368 |     } catch (error) {
    > 369 |       console.error('Error sending payment confirmation:', error);
          |               ^
      370 |     }
      371 |   }
      372 |

      at PaymentEmailScanner.error [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:369:15)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:335:7)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:252:22)

  console.log
    Sending pickup notification for order 68b6eb5cc51f00d7d964ce98

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:379:15)

  console.log
    Order already verified: new ObjectId('68b6eb5dc51f00d7d964ceaf')

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:286:17)

  console.log
    Found 2 unread payment emails

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:72:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order D964CEC4

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.00</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68b6eb5ec51f00d7d964cec4</li>
              <li><strong>Short Order ID:</strong> D964CEC4</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.50</li>
              <li><strong>Difference:</strong> $28.00</li>
              <li><strong>Payment Method:</strong> venmo</li>
              <li><strong>Transaction ID:</strong> venmo-1756818270098</li>
              <li><strong>Sender:</strong> Unknown</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Admin notification sent: Overpayment Received - Order D964CEC4

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2696:13)

  console.log
    Admin notified about overpayment for order 68b6eb5ec51f00d7d964cec4

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:541:15)

  console.log
    Payment verified for order 68b6eb5ec51f00d7d964cec4

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:332:15)

  console.error
    Error sending payment confirmation: CastError: Cast to ObjectId failed for value "CUST-f9fffc63-ab68-4159-8df7-75a493a8b2b8" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
        at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
        at PaymentEmailScanner.scanForPayments (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:82:30)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:306:23) {
      stringValue: '"CUST-f9fffc63-ab68-4159-8df7-75a493a8b2b8"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-f9fffc63-ab68-4159-8df7-75a493a8b2b8',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
          at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
          at PaymentEmailScanner.scanForPayments (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:82:30)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:306:23),
      valueType: 'string'
    }

      367 |       // await emailService.sendV2PaymentConfirmation(order, customer);
      368 |     } catch (error) {
    > 369 |       console.error('Error sending payment confirmation:', error);
          |               ^
      370 |     }
      371 |   }
      372 |

      at PaymentEmailScanner.error [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:369:15)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:335:7)
      at PaymentEmailScanner.scanForPayments (server/services/paymentEmailScanner.js:82:30)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:306:23)

  console.log
    Sending pickup notification for order 68b6eb5ec51f00d7d964cec4

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:379:15)

  console.log
    Not a payment email from known provider: random@gmail.com

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:120:17)

  console.log
    Verified 1 payments

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:97:15)

  console.log
    No new payment emails found

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:67:17)

  console.log
    Found 1 unread payment emails

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:72:15)

  console.log
    No order ID found in payment note

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:137:17)

  console.log
    Verified 0 payments

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:97:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order D964CEFF

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.00</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68b6eb5fc51f00d7d964ceff</li>
              <li><strong>Short Order ID:</strong> D964CEFF</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.50</li>
              <li><strong>Difference:</strong> $28.00</li>
              <li><strong>Payment Method:</strong> paypal</li>
              <li><strong>Transaction ID:</strong> paypal-1756818271574</li>
              <li><strong>Sender:</strong> Unknown</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Admin notification sent: Overpayment Received - Order D964CEFF

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2696:13)

  console.log
    Admin notified about overpayment for order 68b6eb5fc51f00d7d964ceff

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:541:15)

  console.log
    Payment verified for order 68b6eb5fc51f00d7d964ceff

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:332:15)

  console.error
    Error sending payment confirmation: CastError: Cast to ObjectId failed for value "CUST-9e49e9bf-af6c-4dfb-832f-96ac5461595f" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
        at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
        at PaymentEmailScanner.checkOrderPayment (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:411:28)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:359:22) {
      stringValue: '"CUST-9e49e9bf-af6c-4dfb-832f-96ac5461595f"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-9e49e9bf-af6c-4dfb-832f-96ac5461595f',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
          at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
          at PaymentEmailScanner.checkOrderPayment (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:411:28)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:359:22),
      valueType: 'string'
    }

      367 |       // await emailService.sendV2PaymentConfirmation(order, customer);
      368 |     } catch (error) {
    > 369 |       console.error('Error sending payment confirmation:', error);
          |               ^
      370 |     }
      371 |   }
      372 |

      at PaymentEmailScanner.error [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:369:15)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:335:7)
      at PaymentEmailScanner.checkOrderPayment (server/services/paymentEmailScanner.js:411:28)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:359:22)

  console.log
    Sending pickup notification for order 68b6eb5fc51f00d7d964ceff

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:379:15)

  console.log
    Processing 2 pending orders

      at PaymentEmailScanner.log [as processAllPendingPayments] (server/services/paymentEmailScanner.js:445:15)

  console.log
    Processing 1 pending orders

      at PaymentEmailScanner.log [as processAllPendingPayments] (server/services/paymentEmailScanner.js:445:15)

  console.error
    Error checking order payment: Error: API error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:406:53)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      420 |       return false;
      421 |     } catch (error) {
    > 422 |       console.error('Error checking order payment:', error);
          |               ^
      423 |       return false;
      424 |     }
      425 |   }

      at PaymentEmailScanner.error [as checkOrderPayment] (server/services/paymentEmailScanner.js:422:15)
      at PaymentEmailScanner.processAllPendingPayments (server/services/paymentEmailScanner.js:449:28)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:408:23)

PASS tests/unit/paymentEmailScanner.test.js (11.5 s)
  PaymentEmailScanner
    Email parsing
      ✓ should identify Venmo payments (552 ms)
      ✓ should identify PayPal payments (439 ms)
      ✓ should identify CashApp payments (443 ms)
      ✓ should return null for unknown providers (436 ms)
      ✓ should strip HTML tags correctly (434 ms)
    Payment email parsing
      ✓ should parse Venmo payment email (466 ms)
      ✓ should parse PayPal payment email (463 ms)
      ✓ should parse CashApp payment email (459 ms)
      ✓ should return null if order ID not found in email (468 ms)
      ✓ should return null if order not found in database (462 ms)
    Order verification
      ✓ should verify and update order on successful payment match (642 ms)
      ✓ should allow small amount variance (580 ms)
      ✓ should reject large amount variance (585 ms)
      ✓ should skip already verified orders (523 ms)
    Batch payment scanning
      ✓ should process multiple payment emails (586 ms)
      ✓ should handle empty email list (432 ms)
      ✓ should handle email parsing errors gracefully (428 ms)
    Order payment checking
      ✓ should check specific order for payment (636 ms)
      ✓ should return false if no payment found (492 ms)
    Process all pending payments
      ✓ should process all orders awaiting payment (584 ms)
      ✓ should handle verification errors (491 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/auditLogger.test.js
  Audit Logger
    AuditEvents
      ✓ should define all audit event types (2 ms)
      ✓ should have unique event names
    logAuditEvent
      ✓ should log basic audit event (1 ms)
      ✓ should add request context when provided
      ✓ should handle customer context (1 ms)
      ✓ should use error level for critical events (1 ms)
      ✓ should use info level for non-critical events
      ✓ should handle missing user context (1 ms)
      ✓ should handle connection.remoteAddress fallback
    auditMiddleware
      ✓ should create middleware that logs on response finish (1 ms)
      ✓ should log successful responses (1 ms)
      ✓ should not log failed responses
      ✓ should include request context in logs (1 ms)
    logLoginAttempt
      ✓ should log successful login
      ✓ should log failed login with reason (1 ms)
      ✓ should handle null reason
    logSensitiveDataAccess
      ✓ should log sensitive data access
      ✓ should handle different data types and actions
    logPaymentActivity
      ✓ should log payment info access
      ✓ should log payment info update (1 ms)
      ✓ should handle additional details
    logSuspiciousActivity
      ✓ should log suspicious activity with error level (1 ms)
      ✓ should include request context
      ✓ should merge all details
    Logger configuration
      ✓ should export audit logger with required methods
      ✓ should not add console transport in production (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/facebookDataController.test.js
  Facebook Data Controller
    handleDeletionCallback
      ✓ should handle missing signed_request (2 ms)
      ✓ should handle missing app secret (1 ms)
      ✓ should handle invalid signed request
      ✓ should handle missing user_id in payload (1 ms)
      ✓ should handle case when no users are found (1 ms)
      ✓ should handle customer-only deletion request
      ✓ should handle errors during deletion callback (1 ms)
      ✓ should handle affiliate and customer (both) deletion (1 ms)
    checkDeletionStatus
      ✓ should handle missing confirmation code
      ✓ should handle deletion request not found (1 ms)
      ✓ should return completed deletion request status (1 ms)
      ✓ should handle errors during status check
    processStaleRequests
      ✓ should process stale deletion requests (1 ms)
      ✓ should handle errors during stale request processing
      ✓ should handle empty stale requests
    processDeletion error handling
      ✓ should handle errors during affiliate data deletion (1 ms)
      ✓ should handle errors during customer data deletion
      ✓ should handle general errors during deletion processing (10 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/createAdminScript.test.js (10.638 s)
  Create Admin Script Tests
    Script File Structure
      ✓ should exist and be readable (378 ms)
      ✓ should contain required functionality markers (396 ms)
    Admin ID Generation Logic
      ✓ should generate sequential admin IDs starting from ADM001 (601 ms)
      ✓ should calculate next admin ID correctly (654 ms)
    Password Security Requirements
      ✓ should enforce strong password requirements for admins (403 ms)
      ✓ should accept strong passwords for admins (743 ms)
    Permission System Validation
      ✓ should validate all permission types (471 ms)
      ✓ should handle partial permission sets (452 ms)
    Unique Constraint Validation
      ✓ should prevent duplicate administrator IDs (621 ms)
      ✓ should prevent duplicate emails (581 ms)
    Email Integration
      ✓ should handle admin creation with welcome email sending (496 ms)
    Data Validation and Sanitization
      ✓ should handle special characters in names correctly (473 ms)
      ✓ should normalize email addresses (499 ms)
      ✓ should validate email format (719 ms)
    Administrator Model Integration
      ✓ should integrate with existing administrator model schema (512 ms)
      ✓ should work with password hashing middleware (488 ms)
    Script Error Handling
      ✓ should handle database connection errors gracefully (404 ms)
      ✓ should handle invalid input gracefully (407 ms)
    Security Considerations
      ✓ should not log or expose passwords (453 ms)
      ✓ should generate secure random passwords when needed (375 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Jane Smith

      at Object.log [as createOrder] (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Test Affiliate

      at Object.log [as createOrder] (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 10,
        "perBagFee": 2,
        "totalFee": 10,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:252:13)

  console.log
    Updated customer isActive status to true for customer: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:274:15)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Test Affiliate

      at Object.log [as createOrder] (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 10,
        "perBagFee": 2,
        "totalFee": 10,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:252:13)

  console.log
    Updated customer isActive status to true for customer: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:274:15)

  console.error
    Failed to send notification emails: Error: Email failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderController.test.js:159:73)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      280 |       await emailService.sendAffiliateNewOrderEmail(affiliate, customer, newOrder);
      281 |     } catch (emailError) {
    > 282 |       console.error('Failed to send notification emails:', emailError);
          |               ^
      283 |       // Continue with the response even if emails fail
      284 |     }
      285 |

      at Object.error [as createOrder] (server/controllers/orderController.js:282:15)
      at Object.<anonymous> (tests/unit/orderController.test.js:162:7)

  console.log
    Creating order with data: {
      "customerId": "INVALID",
      "affiliateId": "AFF123"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

  console.log
    Customer not found with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:136:15)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "INVALID"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:161:13)

  console.log
    Affiliate not found with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:165:15)

  console.log
    Creating order with data: {
      "customerId": "CUST456",
      "affiliateId": "AFF123"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST456

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:171:13)

PASS tests/unit/orderController.test.js
  Order Controller
    createOrder
      ✓ should successfully create a new order (35 ms)
      ✓ should handle email sending failures gracefully (18 ms)
      ✓ should return error for invalid customer (4 ms)
      ✓ should return error for invalid affiliate (4 ms)
      ✓ should enforce authorization (6 ms)
    getOrderDetails
      ✓ should return order details for authorized user (1 ms)
      ✓ should return 404 for non-existent order
      ✓ should enforce authorization for customers (1 ms)
    updateOrderStatus
      ✓ should successfully update order status (1 ms)
      ✓ should update actual weight when processing
      ✓ should validate status transitions (1 ms)
      ✓ should send commission email when complete
    cancelOrder
      ✓ should successfully cancel an order (1 ms)
      ✓ should prevent cancelling non-cancellable orders

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Authorization failed for path: /api/test - User role: customer Allowed roles: [ 'admin', 'affiliate' ]

      at log (server/middleware/auth.js:146:15)

  console.log
    Authorization failed for path: /api/test - User role: undefined Allowed roles: [ 'admin' ]

      at log (server/middleware/auth.js:146:15)

  console.log
    Authorization failed - No user object on request for path: /api/test

      at log (server/middleware/auth.js:138:15)

  console.error
    Authentication error: Error: Generic error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authMiddleware.test.js:447:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as verify] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at verify (/var/www/wavemax/wavemax-affiliate-program/server/middleware/auth.js:52:21)
        at Object.authenticate (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authMiddleware.test.js:450:13)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      117 |     }
      118 |
    > 119 |     console.error('Authentication error:', error);
          |             ^
      120 |
      121 |     res.status(500).json({
      122 |       success: false,

      at error (server/middleware/auth.js:119:13)
      at Object.authenticate (tests/unit/authMiddleware.test.js:450:13)

  console.log
    Authorization failed for path: /api/test - User role: customer Allowed roles: [ 'admin', 'affiliate' ]

      at log (server/middleware/auth.js:146:15)

PASS tests/unit/authMiddleware.test.js (6.75 s)
  Auth Middleware
    authenticate
      ✓ should authenticate valid Bearer token (514 ms)
      ✓ should authenticate valid x-auth-token header (251 ms)
      ✓ should reject request with no token (227 ms)
      ✓ should reject request with invalid token (208 ms)
      ✓ should reject request with expired token (207 ms)
      ✓ should handle malformed Authorization header (208 ms)
      ✓ should reject blacklisted token (210 ms)
    authorize
      ✓ should authorize user with correct role (207 ms)
      ✓ should authorize user with one of multiple roles (204 ms)
      ✓ should reject user with incorrect role (218 ms)
      ✓ should reject user with no role (210 ms)
      ✓ should reject when user is not set (211 ms)
    authLimiter
      ✓ should be a function (204 ms)
      ✓ should have rate limit configuration (207 ms)
      ✓ should skip rate limiting in test environment (206 ms)
    validateRequest
      ✓ should pass valid request (212 ms)
      ✓ should reject invalid request (206 ms)
      ✓ should reject request with missing required fields (209 ms)
      ✓ should handle complex validation schemas (210 ms)
    authenticate - additional edge cases
      ✓ should handle requirePasswordChange flag (204 ms)
      ✓ should allow password change endpoint when requirePasswordChange is true (206 ms)
      ✓ should NOT renew operator tokens from store IP (security fix) (220 ms)
      ✓ should handle generic authentication errors (233 ms)
      ✓ should handle W9 endpoint logging (215 ms)
    authorize - array syntax
      ✓ should accept array of roles (212 ms)
      ✓ should reject user not in array of roles (209 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/oAuthSession.test.js (7.27 s)
  OAuthSession Model
    Schema Validation
      ✓ should create a valid OAuth session with all required fields (255 ms)
      ✓ should require sessionId field (220 ms)
      ✓ should require result field (216 ms)
      ✓ should automatically set createdAt (248 ms)
      ✓ should automatically set expiresAt to 5 minutes from now (255 ms)
      ✓ should enforce unique sessionId (290 ms)
      ✓ should allow complex result objects (242 ms)
    Static Methods
      createSession
        ✓ should create and save a new OAuth session (276 ms)
        ✓ should throw error for duplicate session IDs (284 ms)
        ✓ should handle database errors (213 ms)
      getSession
        ✓ should retrieve existing session result by sessionId (283 ms)
        ✓ should return null for non-existent session (281 ms)
      consumeSession
        ✓ should retrieve and delete session in one operation (334 ms)
        ✓ should return null when consuming non-existent session (246 ms)
        ✓ should handle race conditions safely (463 ms)
      cleanupExpired
        ✓ should manually delete expired sessions (497 ms)
        ✓ should return zero deletions when no expired sessions exist (311 ms)
    TTL Behavior
      ✓ should have TTL index configured on expiresAt field (246 ms)
      ✓ should respect custom expiresAt when provided (274 ms)
    Data Integrity
      ✓ should preserve all data types in result field (269 ms)
      ✓ should handle empty and minimal result objects (365 ms)
    Error Handling
      ✓ should handle MongoDB connection errors gracefully (254 ms)
      ✓ should handle very large result objects (336 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/payment.test.js
  Payment Model Unit Tests
    Schema Validation
      ✓ should create a valid payment (61 ms)
      ✓ should require orderId (59 ms)
      ✓ should require customerId (58 ms)
      ✓ should require paygistixId (66 ms)
      ✓ should require amount (57 ms)
      ✓ should validate amount is non-negative (59 ms)
      ✓ should default currency to USD (57 ms)
      ✓ should validate currency enum (60 ms)
      ✓ should reject invalid currency (57 ms)
      ✓ should validate status enum (63 ms)
      ✓ should reject invalid status (58 ms)
      ✓ should default status to pending (53 ms)
    Default Values
      ✓ should default capturedAmount to 0 (53 ms)
      ✓ should default refundedAmount to 0 (64 ms)
      ✓ should default hasDispute to false (52 ms)
      ✓ should have empty refunds array (52 ms)
    Virtual Properties
      ✓ should calculate netAmount correctly (51 ms)
      ✓ should handle zero amounts (57 ms)
      ✓ should handle full refund (56 ms)
    Instance Methods
      canRefund()
        ✓ should allow refund when status is captured (53 ms)
        ✓ should allow refund when status is partially_refunded (52 ms)
        ✓ should not allow refund when status is pending (52 ms)
        ✓ should not allow refund when fully refunded (52 ms)
        ✓ should validate refund amount (54 ms)
        ✓ should handle null amount parameter (53 ms)
      canCapture()
        ✓ should allow capture when status is authorized (53 ms)
        ✓ should not allow capture when status is captured (52 ms)
        ✓ should not allow capture when status is pending (53 ms)
      addRefund()
        ✓ should add refund to refunds array (55 ms)
        ✓ should update refundedAmount (53 ms)
        ✓ should update lastRefundAt (58 ms)
        ✓ should set status to partially_refunded for partial refund (52 ms)
        ✓ should set status to refunded for full refund (55 ms)
        ✓ should handle multiple refunds (53 ms)
        ✓ should handle refund that exceeds captured amount (53 ms)
    Static Methods
      findByOrder()
        ✓ should find payments by orderId (54 ms)
      findSuccessfulByCustomer()
        ✓ should find successful payments by customer with default limit (55 ms)
        ✓ should accept custom limit (55 ms)
      calculateRevenue()
        ✓ should calculate revenue for a period (53 ms)
    Middleware
      ✓ should have pre-save middleware defined (52 ms)
    Refund Schema
      ✓ should validate refund subdocument (56 ms)
      ✓ should require refundId in refund (64 ms)
      ✓ should require amount in refund (53 ms)
      ✓ should validate refund amount is non-negative (54 ms)
      ✓ should set default createdAt for refund (63 ms)
    Dispute Tracking
      ✓ should validate dispute status enum (55 ms)
      ✓ should allow dispute fields when hasDispute is true (53 ms)
      ✓ should validate dispute amount is non-negative (53 ms)
    Metadata and Response Fields
      ✓ should store metadata as Map (54 ms)
      ✓ should store response as mixed type (53 ms)
    JSON Transformation
      ✓ should remove __v and response fields from JSON (53 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentController.test.js
  Payment Controller
    getConfig
      ✓ should return payment configuration when properly configured (54 ms)
      ✓ should return error when Paygistix is not configured (61 ms)
      ✓ should handle errors gracefully (64 ms)
    logSubmission
      ✓ should log payment submission successfully (57 ms)
      ✓ should handle logging errors (52 ms)
    createPaymentToken
      ✓ should create payment token successfully (52 ms)
      ✓ should handle no available callbacks (57 ms)
      ✓ should handle token creation errors (55 ms)
    checkPaymentStatus
      ✓ should return payment status successfully (52 ms)
      ✓ should handle token not found (52 ms)
      ✓ should handle database errors (52 ms)
    cancelPaymentToken
      ✓ should cancel pending payment token (53 ms)
      ✓ should not cancel non-pending tokens (52 ms)
      ✓ should handle token not found (71 ms)
    updatePaymentStatus
      ✓ should update payment status to success (53 ms)
      ✓ should update payment status to failed (53 ms)
    handleFormCallback
      ✓ should process callback successfully (55 ms)
      ✓ should handle no pending payment for callback (52 ms)
      ✓ should handle callback processing errors (51 ms)
    processCallbackResult
      ✓ should process successful payment from query params (53 ms)
      ✓ should process failed payment (59 ms)
      ✓ should handle body parameters (54 ms)
      ✓ should redirect with all parameters (55 ms)
    getPoolStats
      ✓ should return pool statistics (53 ms)
      ✓ should handle stats retrieval errors (53 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentCallbackRoute.test.js
  Payment Callback Route
    GET /payment_callback
      Successful payment
        ✓ should handle approved payment successfully (11 ms)
        ✓ should handle success status as well as approved (15 ms)
        ✓ should update existing payment if found (4 ms)
        ✓ should handle customer not found gracefully (3 ms)
        ✓ should handle email send failure gracefully (3 ms)
        ✓ should not update customer if already active (3 ms)
      Failed payment
        ✓ should handle declined payment (3 ms)
        ✓ should handle failed status (2 ms)
        ✓ should increment payment attempts on failure (3 ms)
        ✓ should use default error message when none provided (2 ms)
      Error handling
        ✓ should handle order not found (3 ms)
        ✓ should handle unknown payment status (3 ms)
        ✓ should handle database errors gracefully (2 ms)
        ✓ should handle payment save error (3 ms)
      Edge cases
        ✓ should handle missing amount parameter (3 ms)
        ✓ should handle malformed maskedCard (2 ms)
        ✓ should log callback parameters (2 ms)
    POST /payment_callback
      ✓ should handle POST callback and return JSON response (17 ms)
      ✓ should handle POST callback errors (3 ms)
      ✓ should handle empty POST body (2 ms)
      ✓ should handle POST with form-urlencoded data (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-001', operatorId: 'op123' }

      at Object.log [as scanProcessed] (server/controllers/operatorController.js:1127:13)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-001', operatorId: 'op123' }

      at Object.log [as scanProcessed] (server/controllers/operatorController.js:1127:13)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-002', operatorId: 'op123' }

      at Object.log [as scanProcessed] (server/controllers/operatorController.js:1127:13)

  console.log
    completePickup called with: {
      bagIds: [ 'bag-001', 'bag-002' ],
      orderId: 'ORD-123456',
      operatorId: 'op123'
    }

      at Object.log [as completePickup] (server/controllers/operatorController.js:1380:13)

  console.log
    Updating bags to completed. Current bag statuses: [
      { bagId: 'bag-001', status: 'processed' },
      { bagId: 'bag-002', status: 'processed' }
    ]

      at Object.log [as completePickup] (server/controllers/operatorController.js:1416:13)

  console.log
    Before save - Order status: complete

      at Object.log [as completePickup] (server/controllers/operatorController.js:1429:13)

  console.log
    Before save - Bag statuses: [
      { bagId: 'bag-001', status: 'completed' },
      { bagId: 'bag-002', status: 'completed' }
    ]

      at Object.log [as completePickup] (server/controllers/operatorController.js:1430:13)

  console.log
    After save - Order status: complete

      at Object.log [as completePickup] (server/controllers/operatorController.js:1435:15)

  console.log
    After save - Bag statuses: [
      { bagId: 'bag-001', status: 'completed' },
      { bagId: 'bag-002', status: 'completed' }
    ]

      at Object.log [as completePickup] (server/controllers/operatorController.js:1436:15)

  console.log
    completePickup called with: { bagIds: [ 'bag-001' ], orderId: 'ORD-123456', operatorId: 'op123' }

      at Object.log [as completePickup] (server/controllers/operatorController.js:1380:13)

  console.log
    completePickup called with: {
      bagIds: [ 'bag-001', 'bag-wrong' ],
      orderId: 'ORD-123456',
      operatorId: 'op123'
    }

      at Object.log [as completePickup] (server/controllers/operatorController.js:1380:13)

PASS tests/unit/bagTracking.test.js
  Bag Tracking System
    scanBag
      ✓ should parse new QR format correctly (2 ms)
      ✓ should handle legacy QR format (1 ms)
    weighBags
      ✓ should add bags to order and update status (1 ms)
      ✓ should prevent duplicate bag IDs (1 ms)
    scanProcessed
      ✓ should update bag status to processed (7 ms)
      ✓ should show warning for already processed bag (2 ms)
      ✓ should trigger completion actions when all bags processed (2 ms)
    completePickup
      ✓ should complete order when all bags scanned (3 ms)
      ✓ should reject if bag count mismatch (1 ms)
      ✓ should reject if wrong bag scanned (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-123

      at Object.log [as exportVendors] (server/controllers/quickbooksController.js:102:13)

  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-123

      at Object.log [as exportVendors] (server/controllers/quickbooksController.js:94:15)

PASS tests/unit/quickbooksController.test.js
  QuickBooks Controller
    exportVendors
      ✓ should export vendors as JSON (9 ms)
      ✓ should export vendors as CSV (2 ms)
      ✓ should return 404 when no verified vendors found (1 ms)
      ✓ should handle errors gracefully
    exportPaymentSummary
      ✓ should export payment summary as JSON (2 ms)
      ✓ should export payment summary as CSV (1 ms)
      ✓ should return 400 when dates are missing
      ✓ should return 404 when no payable commissions found
      ✓ should filter out orders without verified W-9 (1 ms)
    exportCommissionDetail
      ✓ should export commission detail as JSON (1 ms)
      ✓ should return 400 when required parameters are missing
      ✓ should return 404 when affiliate not found
      ✓ should return 400 when affiliate has no verified W-9
    getExportHistory
      ✓ should get export history (1 ms)
      ✓ should filter by type

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching dashboard data: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:216:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1250 |
      1251 |   } catch (error) {
    > 1252 |     console.error('Error fetching dashboard data:', error);
           |             ^
      1253 |     res.status(500).json({
      1254 |       success: false,
      1255 |       message: 'Failed to fetch dashboard data'

      at Object.error [as getDashboard] (server/controllers/administratorController.js:1252:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:218:7)

  console.error
    Error fetching order analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:276:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1382 |
      1383 |   } catch (error) {
    > 1384 |     console.error('Error fetching order analytics:', error);
           |             ^
      1385 |     res.status(500).json({
      1386 |       success: false,
      1387 |       message: 'Failed to fetch order analytics'

      at Object.error [as getOrderAnalytics] (server/controllers/administratorController.js:1384:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:278:7)

  console.error
    Error fetching operator analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:338:44)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1511 |
      1512 |   } catch (error) {
    > 1513 |     console.error('Error fetching operator analytics:', error);
           |             ^
      1514 |     res.status(500).json({
      1515 |       success: false,
      1516 |       message: 'Failed to fetch operator analytics'

      at Object.error [as getOperatorAnalytics] (server/controllers/administratorController.js:1513:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:340:7)

  console.error
    Error fetching affiliate analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:393:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1613 |
      1614 |   } catch (error) {
    > 1615 |     console.error('Error fetching affiliate analytics:', error);
           |             ^
      1616 |     res.status(500).json({
      1617 |       success: false,
      1618 |       message: 'Failed to fetch affiliate analytics'

      at Object.error [as getAffiliateAnalytics] (server/controllers/administratorController.js:1615:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:395:7)

  console.error
    Error exporting report: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:502:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as find] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at find (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1863:30)
        at Object.generateOrdersReport [as exportReport] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1642:26)
        at Object.exportReport (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:505:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1678 |
      1679 |   } catch (error) {
    > 1680 |     console.error('Error exporting report:', error);
           |             ^
      1681 |     res.status(500).json({
      1682 |       success: false,
      1683 |       message: 'Failed to export report'

      at Object.error [as exportReport] (server/controllers/administratorController.js:1680:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:505:7)

  console.error
    Error fetching affiliates list: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:564:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as find] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at Object.find [as getAffiliatesList] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1715:40)
        at Object.getAffiliatesList (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:567:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1732 |     });
      1733 |   } catch (error) {
    > 1734 |     console.error('Error fetching affiliates list:', error);
           |             ^
      1735 |     res.status(500).json({
      1736 |       success: false,
      1737 |       message: 'Failed to fetch affiliates list',

      at Object.error [as getAffiliatesList] (server/controllers/administratorController.js:1734:13)
      at Object.getAffiliatesList (tests/unit/adminDashboard.test.js:567:37)

PASS tests/unit/adminDashboard.test.js
  Admin Dashboard Functions
    getDashboard
      ✓ should fetch comprehensive dashboard data (2 ms)
      ✓ should handle errors in dashboard data fetching (17 ms)
    getOrderAnalytics
      ✓ should fetch order analytics with timeline and distribution (1 ms)
      ✓ should handle errors (2 ms)
    getOperatorAnalytics
      ✓ should fetch operator performance analytics
      ✓ should handle errors (2 ms)
    getAffiliateAnalytics
      ✓ should fetch affiliate performance analytics (1 ms)
      ✓ should handle errors (1 ms)
    exportReport
      ✓ should export orders report (1 ms)
      ✓ should export comprehensive report
      ✓ should handle invalid report type (1 ms)
      ✓ should handle export errors (25 ms)
    getAffiliatesList
      ✓ should fetch filtered affiliates list (1 ms)
      ✓ should handle errors in affiliates list (2 ms)
    Report Generation Functions
      ✓ should generate orders report (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/socialAuthRoutes.test.js
  Social Auth Routes - Simple Tests
    Google OAuth Routes
      ✓ should initiate Google OAuth when configured (7 ms)
      ✓ should return 404 when Google OAuth is not configured (3 ms)
      ✓ should handle Google OAuth callback (3 ms)
    Facebook OAuth Routes
      ✓ should initiate Facebook OAuth when configured (2 ms)
      ✓ should return 404 when Facebook OAuth is not configured (2 ms)
      ✓ should handle Facebook OAuth callback (2 ms)
    LinkedIn OAuth Routes
      ✓ should initiate LinkedIn OAuth when configured (1 ms)
      ✓ should return 404 when LinkedIn OAuth is not configured (1 ms)
      ✓ should handle LinkedIn OAuth callback (2 ms)
    Social Registration Route
      ✓ should handle social registration with valid data (5 ms)
      ✓ should validate required fields for social registration (2 ms)
      ✓ should validate service radius range (3 ms)
      ✓ should validate payment method (3 ms)
      ✓ should accept valid payment methods including venmo (6 ms)
    Social Account Linking Route
      ✓ should handle social account linking (2 ms)
      ✓ should validate provider for account linking (3 ms)
      ✓ should require social token for account linking (3 ms)
    Social Login Callback Route
      ✓ should handle social login callback (10 ms)
      ✓ should validate social login data (3 ms)
    Customer OAuth Routes
      ✓ should initiate Google OAuth for customers (4 ms)
      ✓ should handle customer Google OAuth callback redirect (3 ms)
      ✓ should handle customer Facebook callback (4 ms)
      ✓ should handle customer LinkedIn callback (2 ms)
    Customer Social Registration Route
      ✓ should handle customer social registration (3 ms)
      ✓ should validate customer registration fields (2 ms)
      ✓ should validate service frequency (3 ms)
    Error Handling
      ✓ should handle errors gracefully (18 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passwordValidatorEnhanced.test.js
  Enhanced Password Validator
    validatePasswordStrength
      Length Requirements
        ✓ should reject passwords shorter than 8 characters (1 ms)
        ✓ should accept passwords with 8 or more characters
      Character Type Requirements
        ✓ should require at least one uppercase letter (1 ms)
        ✓ should require at least one lowercase letter
        ✓ should require at least one number (1 ms)
        ✓ should require at least one special character (1 ms)
        ✓ should accept passwords with all required character types
      Common Password Detection
        ✓ should reject common passwords (1 ms)
        ✓ should accept non-common passwords (1 ms)
      Sequential Character Detection
        ✓ should reject passwords with sequential numbers
        ✓ should reject passwords with sequential letters (4 ms)
        ✓ should accept passwords without sequential characters (1 ms)
      Repeated Character Detection
        ✓ should reject passwords with too many repeated characters
        ✓ should accept passwords with acceptable repeated characters
      Username/Email Inclusion Check
        ✓ should reject passwords containing username (1 ms)
        ✓ should reject passwords containing email
        ✓ should accept passwords not containing username or email
      Password History Check
        ✓ should reject passwords in history
        ✓ should accept passwords not in history
      Complete Valid Passwords
        ✓ should accept completely valid passwords (1 ms)
    getPasswordStrength
      ✓ should return correct strength scores
      ✓ should return correct strength labels (1 ms)
    isPasswordInHistory
      ✓ should return true for passwords in history
      ✓ should return false for passwords not in history (1 ms)
      ✓ should handle empty history
    customPasswordValidator
      ✓ should return custom validator function
      ✓ should validate passwords correctly in express-validator context
      ✓ should throw for invalid passwords in express-validator context (17 ms)
      ✓ should include admin-specific validation when userType is admin (1 ms)
      ✓ should include admin-specific validation when userType is operator
    passwordValidationMiddleware
      ✓ should call next() for valid passwords (1 ms)
      ✓ should return 400 error for invalid passwords (1 ms)
      ✓ should skip validation if no password in request
      ✓ should include strength assessment in response for invalid passwords
    Edge Cases and Security
      ✓ should handle null and undefined inputs gracefully (1 ms)
      ✓ should handle very long passwords
      ✓ should handle special Unicode characters
      ✓ should be case-sensitive for username/email checks

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administrator.test.js (7.96 s)
  Administrator Model
    Schema Validation
      ✓ should create a valid administrator (191 ms)
      ✓ should require all mandatory fields (89 ms)
      ✓ should enforce email format validation (147 ms)
      ✓ should enforce unique email constraint (552 ms)
      ✓ should enforce unique adminId constraint (562 ms)
      ✓ should validate permission enum values (149 ms)
      ✓ should accept valid permissions (178 ms)
      ✓ should trim whitespace from string fields (185 ms)
      ✓ should convert email to lowercase (193 ms)
      ✓ should not allow role to be changed after creation (246 ms)
    Password Handling
      ✓ should store password as hash and salt (203 ms)
      ✓ should verify correct password (308 ms)
      ✓ should reject incorrect password (262 ms)
      ✓ should not expose password in JSON output (174 ms)
    Login Attempts and Account Locking
      ✓ should increment login attempts (235 ms)
      ✓ should lock account after 5 failed attempts (244 ms)
      ✓ should reset login attempts on successful login (243 ms)
      ✓ should reset attempts if lock has expired (232 ms)
      ✓ should correctly identify locked accounts (188 ms)
    Password Reset
      ✓ should generate password reset token (188 ms)
      ✓ should set password reset expiry to 30 minutes (173 ms)
    Permissions
      ✓ should check single permission correctly (174 ms)
      ✓ should check multiple permissions with AND operation (178 ms)
      ✓ should check multiple permissions with OR operation (178 ms)
      ✓ should set default permissions if none provided (182 ms)
    Static Methods
      ✓ should find active administrators (330 ms)
      ✓ should find administrator by email with password (213 ms)
      ✓ should handle case-insensitive email search (201 ms)
      ✓ should return null for non-existent email (113 ms)
    Timestamps
      ✓ should auto-generate timestamps on creation (178 ms)
      ✓ should update updatedAt on modification (311 ms)
    Admin ID Generation
      ✓ should auto-generate unique admin ID (270 ms)
      ✓ should not override provided admin ID (172 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/generalPaymentCallback.test.js
  General Payment Callback Routes
    GET /
      Registration Payment
        ✓ should redirect to success page on approved registration payment (7 ms)
        ✓ should redirect to success page on success status (2 ms)
        ✓ should redirect to register page with error on failed registration payment (2 ms)
        ✓ should handle missing response message on failure (2 ms)
        ✓ should handle registration payment callback errors (2 ms)
      Order Payment
        ✓ should handle approved order payment successfully (4 ms)
        ✓ should handle success status for order payment (5 ms)
        ✓ should update existing payment record (3 ms)
        ✓ should handle declined order payment (3 ms)
        ✓ should handle failed order payment (2 ms)
        ✓ should handle unknown payment status (2 ms)
        ✓ should handle order not found (8 ms)
        ✓ should handle missing orderId in query (3 ms)
        ✓ should handle email service failure gracefully (2 ms)
        ✓ should skip customer update if customer not found (3 ms)
        ✓ should not update already active customer (2 ms)
        ✓ should handle payment callback errors (2 ms)
        ✓ should use order amount if payment amount not provided (3 ms)
        ✓ should handle partial masked card (2 ms)
        ✓ should handle missing masked card (3 ms)
      General error handling
        ✓ should handle general callback errors (2 ms)
    POST /
      Registration Payment
        ✓ should create customer on approved registration payment with session (9 ms)
        ✓ should handle success status for registration (4 ms)
        ✓ should handle customer creation error (3 ms)
        ✓ should handle no pending registration (2 ms)
        ✓ should handle declined registration payment (1 ms)
        ✓ should handle failed registration payment without message (1 ms)
      Order Payment POST
        ✓ should acknowledge order payment callback (2 ms)
        ✓ should handle order payment with explicit type (1 ms)
      General POST error handling
        ✓ should handle POST callback errors (17 ms)
        ✓ should log POST callback data (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/rbac.test.js
  RBAC Middleware
    Role Hierarchy
      ✓ should define correct role hierarchy (1 ms)
      ✓ should define allowed roles
    checkRole Middleware
      ✓ should reject when no user is present (1 ms)
      ✓ should reject when user has no role
      ✓ should reject when user has invalid role (1 ms)
      ✓ should accept when user has exact required role
      ✓ should accept when user has higher role in hierarchy (1 ms)
      ✓ should reject when user has lower role in hierarchy
      ✓ should handle array of required roles
      ✓ should accept administrator accessing operator resources (1 ms)
      ✓ should reject operator accessing administrator resources
    checkAllRoles Middleware
      ✓ should reject when no user is present (1 ms)
      ✓ should accept when user has access to all required roles
      ✓ should reject when user lacks access to any required role (1 ms)
      ✓ should accept admin for any combination of roles
    checkResourceOwnership Middleware
      ✓ should reject when no user is present (1 ms)
      ✓ should allow admin access to any resource
      ✓ should allow administrator access to any resource
      ✓ should allow affiliate access to own resource via params (1 ms)
      ✓ should allow customer access to own resource via body
      ✓ should allow operator access to own resource
      ✓ should reject affiliate access to another affiliate resource (1 ms)
      ✓ should prefer params over body for resource ID
    checkAdminPermission Middleware
      ✓ should reject when user is not administrator (1 ms)
      ✓ should reject when administrator not found
      ✓ should reject when administrator is not active
      ✓ should accept when administrator has required permission
      ✓ should handle array of required permissions
      ✓ should reject when administrator lacks any required permission (1 ms)
      ✓ should handle database errors
    checkOperatorStatus Middleware
      ✓ should skip check for non-operators
      ✓ should reject when operator not found
      ✓ should reject when operator is not active (1 ms)
      ✓ should reject when operator is not on shift
      ✓ should accept active operator on shift (1 ms)
      ✓ should handle database errors (5 ms)
    filterResponseFields Middleware
      ✓ should pass through data when no user present (1 ms)
      ✓ should pass through data when user has no role
      ✓ should pass through all fields when role has wildcard permission (1 ms)
      ✓ should filter fields based on role permissions
      ✓ should handle nested field permissions (1 ms)
      ✓ should handle array data
      ✓ should handle standard response format with data property
      ✓ should use default permissions when role not specified (1 ms)
      ✓ should handle deeply nested fields
      ✓ should handle non-object data gracefully (1 ms)
      ✓ should handle empty allowed fields

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[31merror[39m: Failed to retrieve PKCE verifier: ENOENT: no such file or directory, open '/var/www/wavemax/wavemax-affiliate-program/temp/pkce/test_state_789.json' {"code":"ENOENT","errno":-2,"path":"/var/www/wavemax/wavemax-affiliate-program/temp/pkce/test_state_789.json","service":"wavemax-affiliate","stack":"Error: ENOENT: no such file or directory, open '/var/www/wavemax/wavemax-affiliate-program/temp/pkce/test_state_789.json'\n    at open (node:internal/fs/promises:639:25)\n    at Object.readFile (node:internal/fs/promises:1246:14)\n    at DocuSignService.getPkceVerifier (/var/www/wavemax/wavemax-affiliate-program/server/services/docusignService.js:85:23)\n    at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/docusignService.test.js:113:31)","syscall":"open","timestamp":"2025-09-02T13:05:24.001Z"}
[32minfo[39m: Token exchange request: {"client_id":"test_integration_key","has_verifier":true,"redirect_uri":"https://test.com/callback","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:24.354Z","url":"https://account-d.docusign.com/oauth/token","verifier_length":13}
  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:05:24.355Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

[32minfo[39m: Token saved to database {"expiresAt":"2025-09-02T14:05:24.355Z","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:24.391Z","tokenId":"default"}
[32minfo[39m: Token exchange successful {"expiresIn":3600,"hasAccessToken":true,"hasRefreshToken":true,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:24.391Z"}
[31merror[39m: PKCE verifier not found for state: {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:24.502Z"}
[32minfo[39m: Token exchange request: {"client_id":"test_integration_key","has_verifier":true,"redirect_uri":"https://test.com/callback","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:24.603Z","url":"https://account-d.docusign.com/oauth/token","verifier_length":8}
[31merror[39m: Failed to exchange code for token: {"error":"Network error","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:24.603Z"}
  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:05:24.685Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:05:24.745Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-09-02T14:05:24.998Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

[32minfo[39m: DocuSign envelope created: {"affiliateId":"123456789","envelopeId":"test_envelope_id","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:25.404Z"}
[31merror[39m: Failed to create W9 envelope: {"affiliateEmail":"test@example.com","data":{"message":"Invalid template ID"},"service":"wavemax-affiliate","status":400,"templateId":"test_template_id","timestamp":"2025-09-02T13:05:25.490Z"}
[32minfo[39m: DocuSign in test mode - returning mock envelope {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:25.578Z"}
[32minfo[39m: Embedded signing URL generated: {"affiliateId":"123456","envelopeId":"test_envelope_id","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:25.658Z"}
[32minfo[39m: Processing DocuSign webhook event: {"envelopeId":"test_envelope_id","event":"envelope-completed","service":"wavemax-affiliate","status":"completed","timestamp":"2025-09-02T13:05:25.897Z"}
[32minfo[39m: Processing DocuSign webhook event: {"envelopeId":"test_envelope_id","event":"envelope-declined","service":"wavemax-affiliate","status":"declined","timestamp":"2025-09-02T13:05:25.976Z"}
[32minfo[39m: Downloaded completed W9: {"envelopeId":"test_envelope_id","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:26.140Z"}
[32minfo[39m: Voided envelope: {"envelopeId":"test_envelope_id","reason":"Cancelled by user","service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:26.221Z"}
[31merror[39m: Authentication required: {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:05:26.919Z"}
PASS tests/unit/docusignService.test.js
  DocuSign Service
    PKCE Generation
      ✓ should generate valid PKCE challenge and verifier (168 ms)
    PKCE Storage
      ✓ should store and retrieve PKCE verifier (82 ms)
      ✓ should delete verifier after retrieval (102 ms)
      ✓ should clean up old PKCE files (97 ms)
    Authorization URL
      ✓ should generate correct authorization URL (84 ms)
      ✓ should use provided state if given (81 ms)
    Token Exchange
      ✓ should exchange authorization code for tokens (147 ms)
      ✓ should throw error if PKCE verifier not found (100 ms)
      ✓ should handle token exchange errors (82 ms)
    Token Refresh
      ✓ should refresh access token using refresh token (207 ms)
      ✓ should throw error if no refresh token available (106 ms)
    Access Token Management
      ✓ should return valid access token if not expired (178 ms)
      ✓ should refresh token if expired (116 ms)
      ✓ should throw error if no valid token and no refresh token (112 ms)
    Envelope Creation
      ✓ should create W9 envelope for affiliate (78 ms)
      ✓ should handle envelope creation errors (90 ms)
      ✓ should return mock envelope in test mode (85 ms)
    Embedded Signing URL
      ✓ should generate embedded signing URL (79 ms)
    Webhook Signature Verification
      ✓ should verify valid webhook signature (80 ms)
      ✓ should reject invalid webhook signature (79 ms)
    Webhook Event Processing
      ✓ should process completed envelope event (80 ms)
      ✓ should handle declined envelope (80 ms)
    Envelope Status
      ✓ should get envelope status (80 ms)
    Document Download
      ✓ should download completed W9 document (83 ms)
    Envelope Voiding
      ✓ should void an envelope (80 ms)
    hasValidToken
      ✓ should return true when a valid token exists (168 ms)
      ✓ should return false when no valid token exists (110 ms)
      ✓ should return false when token is expired (139 ms)
    authenticate
      ✓ should return access token when authentication succeeds (174 ms)
      ✓ should throw error when authentication fails (106 ms)
    extractTaxInfoFromTabs
      ✓ should extract SSN tax info from tabs (81 ms)
      ✓ should extract EIN tax info from tabs (93 ms)
      ✓ should extract business name from tabs (79 ms)
      ✓ should return empty object when no tax info found (80 ms)
      ✓ should handle empty tabs (81 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Customer affiliateId: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: undefined, per-bag: undefined

      at Object.log [as customerLogin] (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "undefined undefined"
      }
    }

      at Object.log [as customerLogin] (server/controllers/authController.js:674:13)

  console.log
    Customer affiliateId: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: undefined, per-bag: undefined

      at Object.log [as customerLogin] (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "undefined undefined"
      }
    }

      at Object.log [as customerLogin] (server/controllers/authController.js:674:13)

  console.log
    Customer affiliateId: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: undefined, per-bag: undefined

      at Object.log [as customerLogin] (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "undefined undefined"
      }
    }

      at Object.log [as customerLogin] (server/controllers/authController.js:674:13)

  console.error
    Token verification error: Error: User data not found in request
        at Object.<anonymous>.exports.verifyToken (/var/www/wavemax/wavemax-affiliate-program/server/controllers/authController.js:871:13)
        at Object.verifyToken (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authController.test.js:370:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      892 |     });
      893 |   } catch (error) {
    > 894 |     console.error('Token verification error:', error);
          |             ^
      895 |     res.status(500).json({
      896 |       success: false,
      897 |       message: 'An error occurred during token verification'

      at Object.error [as verifyToken] (server/controllers/authController.js:894:13)
      at Object.verifyToken (tests/unit/authController.test.js:370:28)

PASS tests/unit/authController.test.js
  Auth Controller
    affiliateLogin
      ✓ should successfully login an affiliate with valid credentials (3 ms)
      ✓ should return 401 for non-existent affiliate (1 ms)
      ✓ should return 401 for incorrect password
    customerLogin
      ✓ should successfully login a customer with valid credentials (7 ms)
      ✓ should return 401 for non-existent customer (1 ms)
      ✓ should login customer using emailOrUsername field (2 ms)
      ✓ should prioritize emailOrUsername over username field (2 ms)
      ✓ should return error when neither username nor emailOrUsername provided (1 ms)
    verifyToken
      ✓ should verify a valid JWT token
      ✓ should handle missing user data (55 ms)
      ✓ should return customer user data
    refreshToken
      ✓ should refresh token successfully (1 ms)
      ✓ should return error for invalid refresh token (1 ms)
      ✓ should return error for expired refresh token
    administratorLogin
      ✓ should successfully login administrator (1 ms)
      ✓ should handle locked account
      ✓ should handle inactive administrator (1 ms)
    operatorLogin
      ✓ should successfully login operator with PIN (1 ms)
      ✓ should fail with invalid PIN
    logout
      ✓ should logout user and blacklist token
    forgotPassword
      ✓ should send password reset email for affiliate
      ✓ should handle non-existent email gracefully (1 ms)
    resetPassword
      ✓ should reset password with valid token (1 ms)
      ✓ should reject expired token

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_test-session-id', popup: 'true' },
      headers: {},
      state: 'oauth_test-session-id',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test-session-id',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test-session-id',
      sessionId: 'oauth_test-session-id',
      allParams: { state: 'oauth_test-session-id', popup: 'true' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: 'true',
      state: 'oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'customer_test-session-id', popup: 'true' },
      headers: {},
      state: 'customer_test-session-id',
      stateStartsWithCustomer: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_test-session-id',
      isCustomerRequest: true,
      willDelegate: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:997:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: {},
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_test-session-id', popup: 'true' },
      headers: {},
      state: 'oauth_test-session-id',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test-session-id',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test-session-id',
      sessionId: 'oauth_test-session-id',
      allParams: { state: 'oauth_test-session-id', popup: 'true' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: 'true',
      state: 'oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

info: undefined {"eventType":"LOGIN_SUCCESS","reason":"Social login successful","success":true,"timestamp":"2025-09-02T13:05:30.934Z","userType":"affiliate","username":"johndoe"}
  console.error
    Error storing OAuth session: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:128:64)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1098 |             await OAuthSession.createSession(sessionId, message);
      1099 |           } catch (dbError) {
    > 1100 |             console.error('Error storing OAuth session:', dbError);
           |                     ^
      1101 |           }
      1102 |         }
      1103 |

      at Object.error [as handleSocialCallback] (server/controllers/authController.js:1100:21)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:131:7)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_test-session-id', popup: 'true' },
      headers: {},
      state: 'oauth_test-session-id',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test-session-id',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test-session-id',
      sessionId: 'oauth_test-session-id',
      allParams: { state: 'oauth_test-session-id', popup: 'true' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: 'true',
      state: 'oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'new-user',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: undefined,
      userObject: {
        provider: 'google',
        socialId: 'google123',
        email: 'customer@example.com',
        firstName: 'Customer',
        lastName: 'User',
        isNewUser: true
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1889:13)

  console.warn
    Email template placeholder [AFFILIATE_ID] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:240:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: undefined

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi undefined,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> </p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=undefined">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=undefined</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=undefined">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=undefined</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

info: undefined {"action":"SOCIAL_REGISTRATION","details":{"provider":"google","registrationMethod":"social"},"eventType":"ACCOUNT_CREATED","timestamp":"2025-09-02T13:05:31.474Z","userType":"affiliate"}
  console.warn
    Email template placeholder [AFFILIATE_ID] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:330:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: undefined

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi undefined,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> </p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=undefined">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=undefined</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=undefined">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=undefined</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

info: undefined {"action":"SOCIAL_REGISTRATION","details":{"provider":"google","registrationMethod":"social"},"eventType":"ACCOUNT_CREATED","timestamp":"2025-09-02T13:05:32.140Z","userType":"affiliate"}
  console.error
    Missing customer or affiliate data for welcome email

      893 |     // Validate inputs
      894 |     if (!customer || !affiliate) {
    > 895 |       console.error('Missing customer or affiliate data for welcome email');
          |               ^
      896 |       return;
      897 |     }
      898 |

      at Object.error [as sendCustomerWelcomeEmail] (server/utils/emailService.js:895:15)
      at Object.sendCustomerWelcomeEmail [as completeSocialCustomerRegistration] (server/controllers/authController.js:2270:26)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:388:7)

info: undefined {"action":"SOCIAL_CUSTOMER_REGISTRATION","details":{"provider":"facebook","registrationMethod":"social"},"eventType":"ACCOUNT_CREATED","timestamp":"2025-09-02T13:05:32.515Z","userType":"customer"}
  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-success',
        provider: 'google',
        socialToken: 'social-jwt-token',
        socialId: 'google123',
        email: 'test@example.com',
        firstName: 'John',
        lastName: 'Doe'
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-success',
        provider: 'google',
        socialToken: 'social-jwt-token',
        socialId: 'google123',
        email: 'test@example.com',
        firstName: 'John',
        lastName: 'Doe'
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-login',
        token: 'jwt-token',
        refreshToken: 'refresh-token',
        affiliate: {
          affiliateId: 'AFF001',
          id: 'affiliate-id',
          firstName: 'John',
          lastName: 'Doe',
          email: 'john@example.com',
          businessName: 'Test Business'
        }
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-login',
        token: 'jwt-token',
        refreshToken: 'refresh-token',
        affiliate: {
          affiliateId: 'AFF001',
          id: 'affiliate-id',
          firstName: 'John',
          lastName: 'Doe',
          email: 'john@example.com',
          businessName: 'Test Business'
        }
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-error',
        message: 'Social authentication failed'
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-error',
        message: 'Social authentication failed'
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with an affiliate account. Would you like to login as an affiliate instead?',
        provider: 'google',
        accountType: 'affiliate',
        affiliateData: {
          affiliateId: 'AFF123456',
          firstName: 'John',
          lastName: 'Affiliate',
          email: 'john@example.com',
          businessName: 'Johns Business'
        }
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with an affiliate account. Would you like to login as an affiliate instead?',
        provider: 'google',
        accountType: 'affiliate',
        affiliateData: {
          affiliateId: 'AFF123456',
          firstName: 'John',
          lastName: 'Affiliate',
          email: 'john@example.com',
          businessName: 'Johns Business'
        }
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with a customer account. Would you like to login as a customer instead?',
        provider: 'google',
        accountType: 'customer',
        customerData: {
          firstName: 'Jane',
          lastName: 'Customer',
          email: 'jane@example.com'
        }
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with a customer account. Would you like to login as a customer instead?',
        provider: 'google',
        accountType: 'customer',
        customerData: {
          firstName: 'Jane',
          lastName: 'Customer',
          email: 'jane@example.com'
        }
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'not found',
      resultData: null
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.error
    OAuth session polling error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:583:65)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1592 |
      1593 |   } catch (error) {
    > 1594 |     console.error('OAuth session polling error:', error);
           |             ^
      1595 |     res.status(500).json({
      1596 |       success: false,
      1597 |       message: 'An error occurred while polling OAuth session'

      at Object.error [as pollOAuthSession] (server/controllers/authController.js:1594:13)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:585:7)

PASS tests/unit/authControllerEnhanced.test.js (5.664 s)
  Enhanced Auth Controller - OAuth Methods
    handleSocialCallback
      ✓ should create OAuth session and redirect for affiliate context (462 ms)
      ✓ should handle customer context from state parameter (175 ms)
      ✓ should handle missing user data gracefully (168 ms)
      ✓ should handle OAuth session creation errors (182 ms)
      ✓ should extract profile data correctly for different providers (162 ms)
    handleCustomerSocialCallback
      ✓ should create customer OAuth session (165 ms)
    completeSocialRegistration
      ✓ should complete social registration successfully (191 ms)
      ✓ should sanitize social data and reject if fields become empty (186 ms)
      ✓ should check for existing email and username (156 ms)
      ✓ should check for existing social account (160 ms)
      ✓ should generate unique username from social data (164 ms)
      ✓ should handle JWT verification errors (155 ms)
    completeSocialCustomerRegistration
      ✓ should complete customer social registration successfully (222 ms)
      ✓ should validate affiliate existence (162 ms)
      ✓ should sanitize customer social data (156 ms)
    pollOAuthSession
      ✓ should return complete session data when available (160 ms)
      ✓ should return social-auth-login session data (169 ms)
      ✓ should return social-auth-error session data (158 ms)
      ✓ should return social-auth-account-conflict session data for affiliate conflict (158 ms)
      ✓ should return social-auth-account-conflict session data for customer conflict (165 ms)
      ✓ should return pending status when session not ready (159 ms)
      ✓ should handle database errors gracefully (159 ms)
    Error Handling and Edge Cases
      ✓ should handle malformed JWT tokens (156 ms)
      ✓ should handle database connection errors (162 ms)
      ✓ should handle missing required fields in social data (158 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentExport.test.js
  PaymentExport Model Unit Tests
    Schema Validation
      ✓ should create a valid PaymentExport (61 ms)
      ✓ should generate exportId automatically (70 ms)
      ✓ should require type field (57 ms)
      ✓ should validate type enum values (58 ms)
      ✓ should reject invalid type values (62 ms)
      ✓ should require generatedBy field (54 ms)
    Period Fields
      ✓ should store period dates for payment summary (53 ms)
      ✓ should store period dates for commission detail (54 ms)
    Export Data
      ✓ should store vendor export data (55 ms)
      ✓ should store payment summary data (56 ms)
      ✓ should store commission detail data (55 ms)
    Affiliate IDs
      ✓ should store multiple affiliate IDs for vendor export (55 ms)
      ✓ should store single affiliate ID for commission detail (53 ms)
      ✓ should allow empty affiliate IDs array (59 ms)
    Timestamps
      ✓ should have createdAt and updatedAt timestamps (53 ms)
    Indexes
      ✓ should have required indexes defined (54 ms)
    Different Export Types
      ✓ should handle vendor export type correctly (56 ms)
      ✓ should handle payment summary export type correctly (60 ms)
      ✓ should handle commission detail export type correctly (60 ms)
    Export ID Generation
      ✓ should generate unique export IDs (54 ms)
    Reference Validation
      ✓ should validate generatedBy as ObjectId reference (55 ms)
      ✓ should accept valid ObjectId for generatedBy (55 ms)
    Instance Methods
      markDownloaded()
        ✓ should mark export as downloaded (180 ms)
        ✓ should increment download count on multiple downloads (234 ms)
        ✓ should not change status if already downloaded (170 ms)
        ✓ should update downloadedAt timestamp (190 ms)
      updateImportStatus()
        ✓ should update import status to success (170 ms)
        ✓ should update import status to failed (174 ms)
        ✓ should handle partial import status (174 ms)
    Static Methods
      findByPeriod()
        ✓ should find exports within period (152 ms)
        ✓ should filter by type when specified (155 ms)
        ✓ should return empty array when no matches (148 ms)
        ✓ should sort by generatedAt descending (186 ms)
      existsForPeriod()
        ✓ should find existing export for period (152 ms)
        ✓ should not find export for different period (147 ms)
        ✓ should exclude failed exports (231 ms)
        ✓ should find export with non-failed status (182 ms)
    Virtual Properties
      ageInDays
        ✓ should calculate age in days correctly (90 ms)
        ✓ should return 1 for exports created today (88 ms)
        ✓ should handle exports created in the past correctly (53 ms)
        ✓ should update as time passes (54 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportConfig.test.js
  Passport Configuration Tests
    Strategy Configuration
      ✓ should configure Google strategy when credentials are present (8 ms)
      ✓ should not configure Google strategy without credentials (2 ms)
      ✓ should configure Facebook strategy when credentials are present (2 ms)
      ✓ should not configure Facebook strategy without credentials (1 ms)
      ✓ should configure LinkedIn strategy when credentials are present (1 ms)
    Google OAuth Strategy
      ✓ should handle database errors (2 ms)
      Customer Context
        ✓ should handle existing customer with Google account (2 ms)
        ✓ should link Google account to existing customer (2 ms)
        ✓ should handle existing affiliate conflict (6 ms)
        ✓ should return new user data (2 ms)
      Affiliate Context
        ✓ should handle existing affiliate with Google account (3 ms)
        ✓ should handle customer conflict (2 ms)
        ✓ should link Google account to existing affiliate with email (3 ms)
        ✓ should return new affiliate user data (2 ms)
    Facebook OAuth Strategy
      ✓ should handle existing affiliate (2 ms)
      ✓ should return new user data for registration (1 ms)
      ✓ should link Facebook account to existing affiliate (2 ms)
      ✓ should handle Facebook error (2 ms)
    LinkedIn OAuth Strategy
      ✓ should handle existing affiliate (2 ms)
      ✓ should link LinkedIn account to existing affiliate (1 ms)
      ✓ should return new LinkedIn user data (1 ms)
      ✓ should handle LinkedIn error (2 ms)
    Serialization
      ✓ should serialize user with _id (2 ms)
      ✓ should serialize user with socialId (9 ms)
      ✓ should deserialize user (2 ms)
      ✓ should handle deserialization errors (29 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    V2 registration: 2 free bags, no payment required

      at Object.log [as registerCustomer] (server/controllers/customerController.js:124:15)

  console.log
    Creating new customer with email: john@test.com username: johndoe1756818340784

      at Object.log [as registerCustomer] (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at Object.log [as registerCustomer] (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-8ba3438e-6ca1-4575-9eb1-bc400f5c540f

      at Object.log [as registerCustomer] (server/controllers/customerController.js:181:13)

  console.log
    Payment version in test: v2

      at Object.log (tests/unit/v2ControllerLogic.test.js:110:15)

  console.log
    V2 registration: 2 free bags, no payment required

      at Object.log [as registerCustomer] (server/controllers/customerController.js:124:15)

  console.log
    Creating new customer with email: jane@test.com username: janesmith1756818341680

      at Object.log [as registerCustomer] (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at Object.log [as registerCustomer] (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-7e577b82-cb93-4af6-affd-4abdfefbec0a

      at Object.log [as registerCustomer] (server/controllers/customerController.js:181:13)

  console.log
    Creating new customer with email: bob@test.com username: bobwilson1756818342451

      at Object.log [as registerCustomer] (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at Object.log [as registerCustomer] (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-7746775e-2cb0-4062-9c7a-72e1254d5020

      at Object.log [as registerCustomer] (server/controllers/customerController.js:181:13)

  console.log
    Generated V2 payment links for order ORD417969 - Amount: $50

      at Object.log [as updateOrderStatus] (server/controllers/orderController.js:495:17)

  console.log
    V2 payment request would be sent to v2customer@test.com for order ORD417969

      at Object.log [as updateOrderStatus] (server/controllers/orderController.js:500:19)

  console.log
    Customer confirmed payment for order 68b6eba8216026b4ba4e28c9: { paymentMethod: 'venmo', paymentDetails: undefined }

      at Object.log [as confirmPayment] (server/controllers/orderController.js:1279:13)

  console.log
    Escalating payment timeout for order 68b6eba8216026b4ba4e28c9 to admin

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:337:15)

  console.log
    Admin escalation details: {
      orderId: 'ORD931892',
      orderMongoId: new ObjectId('68b6eba8216026b4ba4e28c9'),
      customerName: 'undefined undefined',
      customerEmail: 'Unknown',
      customerPhone: 'Unknown',
      affiliateName: 'undefined undefined',
      affiliateEmail: 'Unknown',
      paymentAmount: 45,
      hoursSinceRequest: 0,
      paymentRequestedAt: 2025-09-02T13:05:44.789Z,
      attemptsMade: 0
    }

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:365:15)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68b6eba8216026b4ba4e28c9

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:371:15)

  console.warn
    Mailcow API key not configured. Email scanning disabled.

      31 |       
      32 |       if (!encryptedKey) {
    > 33 |         console.warn('Mailcow API key not configured. Email scanning disabled.');
         |                 ^
      34 |         return;
      35 |       }
      36 |       

      at MailcowService.warn [as initialize] (server/services/mailcowService.js:33:17)
      at MailcowService.searchEmails (server/services/mailcowService.js:184:5)
      at PaymentEmailScanner.checkOrderPayment (server/services/paymentEmailScanner.js:405:22)
      at Object.<anonymous>.exports.confirmPayment (server/controllers/orderController.js:1297:22)
      at Object.<anonymous> (tests/unit/v2ControllerLogic.test.js:382:7)

  console.log
    Creating order with data: {
      "customerId": "CUST-f62da956-5177-4447-aa38-548263bfb74c",
      "affiliateId": "AFF-c70cd332-6331-478e-9ce4-b13e899afcdc",
      "pickupDate": "2025-09-03T13:05:47.126Z",
      "pickupTime": "morning",
      "numberOfBags": 3,
      "estimatedWeight": 35,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      }
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: false, stainRemover: true }

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: object

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: {"premiumDetergent":true,"fabricSoftener":false,"stainRemover":true}

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST-f62da956-5177-4447-aa38-548263bfb74c

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

  console.log
    Found customer: V2 Customer

      at Object.log [as createOrder] (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF-c70cd332-6331-478e-9ce4-b13e899afcdc

      at Object.log [as createOrder] (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Test Affiliate

      at Object.log [as createOrder] (server/controllers/orderController.js:171:13)

  console.log
    V2 customer order - payment will be collected after weighing

      at Object.log [as createOrder] (server/controllers/orderController.js:238:15)

  console.log
    Creating order with data: {
      "customerId": "CUST-f62da956-5177-4447-aa38-548263bfb74c",
      "affiliateId": "AFF-c70cd332-6331-478e-9ce4-b13e899afcdc",
      "pickupDate": "2025-09-03T13:05:47.126Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "status": "pending",
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-f62da956-5177-4447-aa38-548263bfb74c",
      "affiliateId": "AFF-c70cd332-6331-478e-9ce4-b13e899afcdc",
      "pickupDate": "2025-09-03T13:05:47.126Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ebab216026b4ba4e2940",
      "orderId": "ORD856365",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:05:47.271Z"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6ebab216026b4ba4e2940",
      "customerId": "CUST-f62da956-5177-4447-aa38-548263bfb74c",
      "affiliateId": "AFF-c70cd332-6331-478e-9ce4-b13e899afcdc",
      "pickupDate": "2025-09-03T13:05:47.126Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 7,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD856365",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:05:47.271Z",
      "updatedAt": "2025-09-02T13:05:47.271Z",
      "baseRate": 1.25,
      "estimatedTotal": 75.75,
      "__v": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: false, stainRemover: true }

      at Object.log [as createOrder] (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST-f62da956-5177-4447-aa38-548263bfb74c",
      "affiliateId": "AFF-c70cd332-6331-478e-9ce4-b13e899afcdc",
      "pickupDate": "2025-09-03T13:05:47.126Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "addOnTotal": 7,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ebab216026b4ba4e2940",
      "orderId": "ORD856365",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:05:47.271Z",
      "updatedAt": "2025-09-02T13:05:47.271Z",
      "baseRate": 1.25,
      "estimatedTotal": 75.75,
      "__v": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:252:13)

  console.log
    Creating order with data: {
      "customerId": "CUST-1bc12bd7-6aac-4726-acc7-cecc6cb56e60",
      "affiliateId": "AFF-b1915f9a-40ea-4246-8608-abef4dae99b4",
      "pickupDate": "2025-09-04T13:05:47.901Z",
      "pickupTime": "evening",
      "numberOfBags": 1,
      "estimatedWeight": 10
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST-1bc12bd7-6aac-4726-acc7-cecc6cb56e60

      at Object.log [as createOrder] (server/controllers/orderController.js:132:13)

  console.log
    Found customer: V2 Customer

      at Object.log [as createOrder] (server/controllers/orderController.js:142:13)

  console.log
    Customer already has an active order: ORD826420

      at Object.log [as createOrder] (server/controllers/orderController.js:151:15)

  console.log
    Creating new customer with email: edge@test.com username: edge1756818348400

      at Object.log [as registerCustomer] (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at Object.log [as registerCustomer] (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-fa252fea-1e35-4d2a-bf34-5eecaac29de0

      at Object.log [as registerCustomer] (server/controllers/customerController.js:181:13)

  console.error
    Order status update error: Error: QR code generation failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/v2ControllerLogic.test.js:681:9)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

      527 |     });
      528 |   } catch (error) {
    > 529 |     console.error('Order status update error:', error);
          |             ^
      530 |     res.status(500).json({
      531 |       success: false,
      532 |       message: 'An error occurred while updating the order status'

      at Object.error [as updateOrderStatus] (server/controllers/orderController.js:529:13)
      at Object.<anonymous> (tests/unit/v2ControllerLogic.test.js:702:7)

PASS tests/unit/v2ControllerLogic.test.js (9.92 s)
  V2 Controller Logic
    V2 Customer Registration
      ✓ should register customer with V2 settings when payment_version is v2 (997 ms)
      ✓ should limit initial bags to configured maximum (776 ms)
      ✓ should default to V1 registration when payment_version is v1 (786 ms)
    V2 Order Processing
      ✓ should generate payment links when order is weighed (WDF complete) (702 ms)
      ✓ should not generate payment links for V1 customers (790 ms)
      ✓ should handle payment confirmation from customer (896 ms)
      ✓ should allow admin to manually verify payment (762 ms)
      ✓ should not send pickup notification until payment is verified (799 ms)
    V2 Order Creation
      ✓ should create V2 order with pending payment status (707 ms)
      ✓ should prevent V2 customer from creating order if previous payment pending (568 ms)
    Edge Cases and Error Handling
      ✓ should handle missing SystemConfig gracefully (731 ms)
      ✓ should handle payment link generation failure gracefully (631 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/systemConfig.test.js (8.66 s)
  SystemConfig Model
    Schema Validation
      ✓ should create a valid system config (135 ms)
      ✓ should require mandatory fields (95 ms)
      ✓ should enforce unique key constraint (333 ms)
      ✓ should validate category enum (86 ms)
      ✓ should validate dataType enum (85 ms)
      ✓ should accept all valid categories (397 ms)
      ✓ should accept all valid data types (243 ms)
      ✓ should trim string fields (116 ms)
    Value Validation
      Number validation
        ✓ should reject non-number values for number dataType (81 ms)
        ✓ should enforce minimum value validation (85 ms)
        ✓ should enforce maximum value validation (149 ms)
        ✓ should accept valid number within range (119 ms)
      Boolean validation
        ✓ should reject non-boolean values for boolean dataType (80 ms)
        ✓ should accept boolean values (128 ms)
      String validation
        ✓ should reject non-string values for string dataType (80 ms)
        ✓ should enforce regex validation (81 ms)
        ✓ should accept valid string matching regex (114 ms)
      Array validation
        ✓ should reject non-array values for array dataType (89 ms)
        ✓ should accept array values (118 ms)
      Object validation
        ✓ should reject non-object values for object dataType (81 ms)
        ✓ should reject arrays for object dataType (80 ms)
        ✓ should accept object values (115 ms)
      Allowed values validation
        ✓ should enforce allowed values (82 ms)
        ✓ should accept allowed values (120 ms)
    Static Methods
      getValue
        ✓ should return config value (147 ms)
        ✓ should return defaultValue when value is undefined (141 ms)
        ✓ should return provided default when config not found (110 ms)
        ✓ should return null when config not found and no default provided (108 ms)
      setValue
        ✓ should update config value (174 ms)
        ✓ should throw error for non-existent config (113 ms)
        ✓ should throw error for non-editable config (155 ms)
        ✓ should update updatedBy when provided (246 ms)
        ✓ should validate new value according to dataType (160 ms)
      getByCategory
        ✓ should return all configs for a category (153 ms)
        ✓ should return only public configs when specified (151 ms)
        ✓ should return empty array for non-existent category (151 ms)
        ✓ should sort by key (191 ms)
      getPublicConfigs
        ✓ should return only public configs (146 ms)
        ✓ should sort by category then key (156 ms)
      initializeDefaults
        ✓ should create default configurations (641 ms)
        ✓ should not overwrite existing configurations (578 ms)
        ✓ should add missing configurations (591 ms)
    Timestamps
      ✓ should auto-generate timestamps on creation (114 ms)
      ✓ should update updatedAt on modification (250 ms)
    toJSON transformation
      ✓ should include currentValue in JSON output (116 ms)
      ✓ should use defaultValue when value is undefined (113 ms)
    Edge Cases
      ✓ should handle mixed types for value and defaultValue (114 ms)
      ✓ should handle empty validation object (116 ms)
      ✓ should skip validation when value is not modified (145 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Checking email availability for: new@example.com

      at Object.log [as checkEmail] (server/controllers/authController.js:2401:13)

  console.log
    Email check results: {
      email: 'new@example.com',
      affiliateFound: false,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at Object.log [as checkEmail] (server/controllers/authController.js:2411:13)

  console.log
    Checking email availability for: existing@example.com

      at Object.log [as checkEmail] (server/controllers/authController.js:2401:13)

  console.log
    Email check results: {
      email: 'existing@example.com',
      affiliateFound: true,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at Object.log [as checkEmail] (server/controllers/authController.js:2411:13)

  console.log
    Checking email availability for: customer@example.com

      at Object.log [as checkEmail] (server/controllers/authController.js:2401:13)

  console.log
    Email check results: {
      email: 'customer@example.com',
      affiliateFound: false,
      customerFound: true,
      administratorFound: false,
      operatorFound: false
    }

      at Object.log [as checkEmail] (server/controllers/authController.js:2411:13)

  console.log
    Checking email availability for: test@example.com

      at Object.log [as checkEmail] (server/controllers/authController.js:2401:13)

  console.error
    Check email error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerAdditional.test.js:130:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2425 |
      2426 |   } catch (error) {
    > 2427 |     console.error('Check email error:', error);
           |             ^
      2428 |     res.status(500).json({
      2429 |       success: false,
      2430 |       message: 'Error checking email availability'

      at Object.error [as checkEmail] (server/controllers/authController.js:2427:13)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:132:7)

  console.log
    Checking username availability for: newuser

      at Object.log [as checkUsername] (server/controllers/authController.js:2348:13)

  console.log
    Username check results: {
      username: 'newuser',
      affiliateFound: false,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at Object.log [as checkUsername] (server/controllers/authController.js:2358:13)

  console.log
    Checking username availability for: existinguser

      at Object.log [as checkUsername] (server/controllers/authController.js:2348:13)

  console.log
    Username check results: {
      username: 'existinguser',
      affiliateFound: true,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at Object.log [as checkUsername] (server/controllers/authController.js:2358:13)

  console.log
    Checking username availability for: testuser

      at Object.log [as checkUsername] (server/controllers/authController.js:2348:13)

  console.error
    Check username error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerAdditional.test.js:186:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2372 |
      2373 |   } catch (error) {
    > 2374 |     console.error('Check username error:', error);
           |             ^
      2375 |     res.status(500).json({
      2376 |       success: false,
      2377 |       message: 'Error checking username availability'

      at Object.error [as checkUsername] (server/controllers/authController.js:2374:13)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:188:7)

  console.log
    Auto-login attempt from IP: 127.0.0.1

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:387:13)

  console.log
    Auto-login attempt from IP: 192.168.1.1

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:387:13)

  console.log
    Auto-login denied - IP not whitelisted: 192.168.1.1

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:390:15)

  console.log
    Auto-login attempt from IP: 127.0.0.1

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:387:13)

  console.error
    Default operator not found: OP001

      400 |     
      401 |     if (!operator) {
    > 402 |       console.error('Default operator not found:', defaultOperatorId);
          |               ^
      403 |       return res.status(404).json({
      404 |         success: false,
      405 |         message: 'Default operator not configured'

      at Object.error [as operatorAutoLogin] (server/controllers/authController.js:402:15)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:282:7)

  console.log
    Auto-login attempt from IP: 127.0.0.1

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at Object.log [as operatorAutoLogin] (server/controllers/authController.js:387:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'affiliate' },
      headers: { referer: 'http://localhost:3000', 'user-agent': 'test-user-agent' },
      state: 'affiliate',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'affiliate', isCustomerRequest: false, willDelegate: false }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'affiliate',
      sessionId: null,
      allParams: { state: 'affiliate' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: 'affiliate',
      referer: 'http://localhost:3000',
      isPopup: false,
      userIsNew: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'affiliate' },
      headers: { referer: 'http://localhost:3000', 'user-agent': 'test-user-agent' },
      state: 'affiliate',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'affiliate', isCustomerRequest: false, willDelegate: false }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'affiliate',
      sessionId: null,
      allParams: { state: 'affiliate' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: 'affiliate',
      referer: 'http://localhost:3000',
      isPopup: false,
      userIsNew: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'affiliate' },
      headers: { referer: 'http://localhost:3000', 'user-agent': 'test-user-agent' },
      state: 'affiliate',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'affiliate', isCustomerRequest: false, willDelegate: false }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'affiliate',
      sessionId: null,
      allParams: { state: 'affiliate' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: 'http://localhost:3000',
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'new-user',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: 'http://localhost:3000',
      isPopup: true,
      userIsNew: true
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: undefined,
      userObject: {
        provider: 'google',
        socialId: 'google123',
        email: 'jane@example.com',
        firstName: 'Jane',
        lastName: 'Doe',
        isNewUser: true,
        displayName: 'Jane Doe'
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1889:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: session123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'session123',
      sessionResult: 'found',
      resultData: {
        sessionId: 'session123',
        status: 'completed',
        userId: 'user123',
        userType: 'affiliate',
        token: 'mock-token'
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        sessionId: 'session123',
        status: 'completed',
        userId: 'user123',
        userType: 'affiliate',
        token: 'mock-token'
      }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: session123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'session123',
      sessionResult: 'found',
      resultData: { sessionId: 'session123', status: 'pending' }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: { sessionId: 'session123', status: 'pending' }
    }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: invalid

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: { sessionId: 'invalid', sessionResult: 'not found', resultData: null }

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1571:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: session123

      at Object.log [as pollOAuthSession] (server/controllers/authController.js:1557:11)

  console.error
    OAuth session polling error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerAdditional.test.js:812:53)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1592 |
      1593 |   } catch (error) {
    > 1594 |     console.error('OAuth session polling error:', error);
           |             ^
      1595 |     res.status(500).json({
      1596 |       success: false,
      1597 |       message: 'An error occurred while polling OAuth session'

      at Object.error [as pollOAuthSession] (server/controllers/authController.js:1594:13)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:814:7)

PASS tests/unit/authControllerAdditional.test.js
  Auth Controller - Additional Coverage
    checkEmail
      ✓ should return available when email does not exist (9 ms)
      ✓ should return not available when email exists in Affiliate (1 ms)
      ✓ should return not available when email exists in Customer (1 ms)
      ✓ should handle errors (17 ms)
      ✓ should return error for missing email
    checkUsername
      ✓ should return available when username does not exist (7 ms)
      ✓ should return not available when username exists (1 ms)
      ✓ should handle errors (2 ms)
      ✓ should return error for missing username (1 ms)
    operatorAutoLogin
      ✓ should auto-login operator from store IP (4 ms)
      ✓ should fail from invalid IP (4 ms)
      ✓ should handle missing default operator (5 ms)
      ✓ should handle inactive operator (4 ms)
    handleSocialCallback
      ✓ should handle successful social auth callback for affiliate (6 ms)
      ✓ should redirect new user to registration (6 ms)
      ✓ should handle errors (4 ms)
    handleCustomerSocialCallback
      ✓ should handle customer social auth callback (12 ms)
      ✓ should handle new customer registration (4 ms)
    completeSocialRegistration
      ✓ should complete affiliate social registration (22 ms)
      ✓ should handle existing email (1 ms)
      ✓ should handle invalid token
      ✓ should handle missing social data (1 ms)
    completeSocialCustomerRegistration
      ✓ should complete customer social registration (1 ms)
      ✓ should handle invalid affiliate code (1 ms)
    pollOAuthSession
      ✓ should return completed session data (2 ms)
      ✓ should return session data for pending session (2 ms)
      ✓ should handle session not found (1 ms)
      ✓ should handle errors (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/operator.test.js (11.479 s)
  Operator Model
    Schema Validation
      ✓ should create a valid operator (193 ms)
      ✓ should require all mandatory fields (95 ms)
      ✓ should enforce email format validation (86 ms)
      ✓ should enforce unique email constraint (731 ms)
      ✓ should enforce unique username constraint (756 ms)
      ✓ should validate username format (90 ms)
      ✓ should validate shift time format (81 ms)
      ✓ should accept valid shift times (176 ms)
      ✓ should enforce quality score range (80 ms)
      ✓ should trim whitespace from string fields (182 ms)
      ✓ should convert email and username to lowercase (178 ms)
      ✓ should not allow role to be changed after creation (232 ms)
    Password Handling
      ✓ should hash password on save (210 ms)
      ✓ should verify correct password (258 ms)
      ✓ should reject incorrect password (261 ms)
      ✓ should not expose password in JSON output (173 ms)
    Login Attempts and Account Locking
      ✓ should increment login attempts (231 ms)
      ✓ should lock account after 5 failed attempts (483 ms)
      ✓ should lock for 30 minutes (506 ms)
      ✓ should reset login attempts on successful login (291 ms)
      ✓ should reset attempts if lock has expired (276 ms)
      ✓ should correctly identify locked accounts (174 ms)
    Password Reset
      ✓ should generate password reset token (81 ms)
      ✓ should set password reset expiry to 30 minutes (81 ms)
    Shift Management
      isOnShift virtual
        ✓ should return true when no shift times are set (80 ms)
        ✓ should correctly identify operator on shift during normal hours (81 ms)
        ✓ should correctly identify operator off shift (83 ms)
        ✓ should handle overnight shifts correctly (83 ms)
    Processing Statistics
      ✓ should update processing stats correctly (224 ms)
      ✓ should handle first order processing (211 ms)
      ✓ should update quality score with passing result (230 ms)
      ✓ should update quality score with failing result (214 ms)
    Static Methods
      findActive
        ✓ should find only active operators (298 ms)
      findOnShift
        ✓ should find only operators on shift (420 ms)
      findByEmailWithPassword
        ✓ should find operator by email with password (209 ms)
        ✓ should handle case-insensitive email search (227 ms)
        ✓ should return null for non-existent email (108 ms)
      findAvailableOperators
        ✓ should find operators with low order count (291 ms)
        ✓ should sort by current order count (291 ms)
        ✓ should respect limit parameter (1072 ms)
    Timestamps
      ✓ should auto-generate timestamps on creation (183 ms)
      ✓ should update updatedAt on modification (314 ms)
    Operator ID Generation
      ✓ should auto-generate unique operator ID (284 ms)
      ✓ should not override provided operator ID (174 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Failed to initiate W9 signing: Error: Template not found
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/w9ControllerDocuSign.test.js:250:58)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      258 |     });
      259 |   } catch (error) {
    > 260 |     console.error('Failed to initiate W9 signing:', error);
          |             ^
      261 |     logger.error('Failed to initiate W9 signing:', error);
      262 |     res.status(500).json({
      263 |       error: 'Failed to create W9 signing session',

      at error (server/controllers/w9ControllerDocuSign.js:260:13)

  console.log
    Envelope mismatch: { expected: 'test_envelope_id', received: 'wrong_envelope_id' }

      at log (server/controllers/w9ControllerDocuSign.js:291:15)

  console.log
    Envelope mismatch: { expected: undefined, received: 'test_envelope_id' }

      at log (server/controllers/w9ControllerDocuSign.js:291:15)

PASS tests/unit/w9ControllerDocuSign.test.js (8.302 s)
  W9 Controller DocuSign Methods
    Check DocuSign Auth
      ✓ should return authorized true if valid token exists (438 ms)
      ✓ should return authorization URL if no valid token (129 ms)
      ✓ should handle service errors (124 ms)
    OAuth Callback
      ✓ should handle successful OAuth callback (119 ms)
      ✓ should handle missing authorization code (124 ms)
      ✓ should handle missing state parameter (128 ms)
      ✓ should display error page on token exchange failure (129 ms)
    Initiate W9 Signing
      ✓ should create new envelope and return signing URL (210 ms)
      ✓ should return existing envelope if one is in progress (179 ms)
      ✓ should require DocuSign authorization if no valid token (146 ms)
      ✓ should handle affiliate not found (171 ms)
      ✓ should handle envelope creation errors (157 ms)
    Get Envelope Status
      ✓ should return envelope status from DocuSign (742 ms)
      ✓ should handle mismatched envelope ID (181 ms)
      ✓ should handle affiliate with no W9 information (214 ms)
      ✓ should return local status if DocuSign API fails (179 ms)
      ✓ should clear envelope ID if declined (236 ms)
    DocuSign Webhook
      ✓ should process completed envelope webhook (292 ms)
      ✓ should reject webhook with invalid signature (121 ms)
      ✓ should handle affiliate not found (147 ms)
      ✓ should process completed W9 without downloading document (259 ms)
    Check Authorization Status
      ✓ should return authorized true if valid token exists (118 ms)
      ✓ should return authorized false if no valid token (120 ms)
      ✓ should handle service errors (118 ms)
    Get W9 Signing Status
      ✓ should return W9 status for affiliate (118 ms)
      ✓ should include tax info for verified W9 (117 ms)
      ✓ should check DocuSign status for in-progress envelopes (117 ms)
      ✓ should handle affiliate not found (116 ms)
      ✓ should handle errors gracefully (118 ms)
    Cancel W9 Signing
      ✓ should cancel W9 signing successfully (207 ms)
      ✓ should handle no W9 signing in progress (147 ms)
      ✓ should handle affiliate not found (117 ms)
      ✓ should handle void envelope errors (157 ms)
    Resend W9 Request
      ✓ should resend W9 request successfully (151 ms)
      ✓ should handle affiliate not found (122 ms)
      ✓ should continue if voiding existing envelope fails (189 ms)
      ✓ should handle envelope creation errors (118 ms)
    Send W9 To Affiliate
      ✓ should send W9 to affiliate successfully (150 ms)
      ✓ should handle affiliate not found (116 ms)
      ✓ should prevent sending to affiliate with verified W9 (124 ms)
      ✓ should prevent sending to affiliate with submitted W9 (116 ms)
      ✓ should handle authorization errors (117 ms)
      ✓ should handle template configuration errors (119 ms)
      ✓ should handle general errors (117 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.warn
    Welcome email could not be sent: Error: Email failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:158:64)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      101 |       // Email sent successfully - no need to check result
      102 |     } catch (emailError) {
    > 103 |       console.warn('Welcome email could not be sent:', emailError);
          |               ^
      104 |       // Continue with registration process even if email fails
      105 |     }
      106 |

      at Object.warn [as registerAffiliate] (server/controllers/affiliateController.js:103:15)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:160:7)

  console.error
    Affiliate registration error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:175:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      111 |     });
      112 |   } catch (error) {
    > 113 |     console.error('Affiliate registration error:', error);
          |             ^
      114 |     res.status(500).json({
      115 |       success: false,
      116 |       message: 'An error occurred during registration'

      at Object.error [as registerAffiliate] (server/controllers/affiliateController.js:113:13)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:177:7)

  console.error
    Error decrypting PayPal email: Error: Decryption failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:272:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as decrypt] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at Object.decrypt [as getAffiliateProfile] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/affiliateController.js:175:28)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:275:7)

      176 |           : affiliate.paypalEmail;
      177 |       } catch (error) {
    > 178 |         console.error('Error decrypting PayPal email:', error);
          |                 ^
      179 |         // Don't include if decryption fails
      180 |       }
      181 |     }

      at Object.error [as getAffiliateProfile] (server/controllers/affiliateController.js:178:17)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:275:7)

  console.error
    Get affiliate orders error: TypeError: Cannot read properties of undefined (reading 'forEach')
        at Object.forEach [as getAffiliateOrders] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/affiliateController.js:598:15)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:692:7)

      646 |     });
      647 |   } catch (error) {
    > 648 |     console.error('Get affiliate orders error:', error);
          |             ^
      649 |     res.status(500).json({
      650 |       success: false,
      651 |       message: 'An error occurred while retrieving orders'

      at Object.error [as getAffiliateOrders] (server/controllers/affiliateController.js:648:13)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:692:7)

  console.error
    Get affiliate profile error: Error: Database connection lost
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:939:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      187 |     });
      188 |   } catch (error) {
    > 189 |     console.error('Get affiliate profile error:', error);
          |             ^
      190 |     res.status(500).json({
      191 |       success: false,
      192 |       message: 'An error occurred while retrieving affiliate profile'

      at Object.error [as getAffiliateProfile] (server/controllers/affiliateController.js:189:13)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:941:7)

  console.error
    Delete affiliate data error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:1028:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      898 |     });
      899 |   } catch (error) {
    > 900 |     console.error('Delete affiliate data error:', error);
          |             ^
      901 |     res.status(500).json({
      902 |       success: false,
      903 |       message: 'An error occurred while deleting data'

      at Object.error [as deleteAffiliateData] (server/controllers/affiliateController.js:900:13)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:1030:7)

PASS tests/unit/affiliateController.test.js
  Affiliate Controller
    registerAffiliate
      ✓ should successfully register a new affiliate (2 ms)
      ✓ should return validation errors (1 ms)
      ✓ should handle duplicate email or username
      ✓ should handle email service failure gracefully (29 ms)
      ✓ should handle database errors (1 ms)
    getAffiliateProfile
      ✓ should return affiliate profile for authorized user (1 ms)
      ✓ should return 404 for non-existent affiliate (1 ms)
      ✓ should return 403 for unauthorized access
      ✓ should handle decryption errors gracefully (20 ms)
    updateAffiliateProfile
      ✓ should successfully update affiliate profile (4 ms)
      ✓ should handle password change
      ✓ should reject incorrect current password (1 ms)
      ✓ should update payment method
    getAffiliateEarnings
      ✓ should return earnings for specified period (1 ms)
      ✓ should handle different time periods (1 ms)
      ✓ should handle missing customers gracefully
    getAffiliateCustomers
      ✓ should return paginated customers with search (1 ms)
      ✓ should handle different sort options
    getAffiliateOrders
      ✓ should return filtered orders (1 ms)
      ✓ should handle date filters correctly (2 ms)
    getAffiliateTransactions
      ✓ should return paginated transactions
    getAffiliateDashboardStats
      ✓ should return comprehensive dashboard statistics (1 ms)
      ✓ should handle empty data gracefully (1 ms)
    getPublicAffiliateInfo
      ✓ should return only public affiliate information (1 ms)
      ✓ should return 404 for non-existent affiliate
    Error handling
      ✓ should handle database connection errors (2 ms)
    deleteAffiliateData
      ✓ should delete all affiliate data in development environment (1 ms)
      ✓ should reject deletion in production environment
      ✓ should reject unauthorized deletion (1 ms)
      ✓ should handle deletion errors (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching administrators: TypeError: Administrator.find(...).select is not a function
        at select (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:55:8)
        at Object.getAdministrators (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerEnhanced.test.js:161:15)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      72 |
      73 |   } catch (error) {
    > 74 |     console.error('Error fetching administrators:', error);
         |             ^
      75 |     res.status(500).json({
      76 |       success: false,
      77 |       message: 'Failed to fetch administrators'

      at error (server/controllers/administratorController.js:74:13)
      at Object.getAdministrators (tests/unit/administratorControllerEnhanced.test.js:161:15)

  console.error
    Error updating operator profile: TypeError: updatedOperator.toObject is not a function
        at toObject (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:2257:70)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerEnhanced.test.js:1078:9)

      2263 |     });
      2264 |   } catch (error) {
    > 2265 |     console.error('Error updating operator profile:', error);
           |             ^
      2266 |     res.status(500).json({
      2267 |       success: false,
      2268 |       message: 'An error occurred while updating the profile'

      at error (server/controllers/administratorController.js:2265:13)
      at Object.<anonymous> (tests/unit/administratorControllerEnhanced.test.js:1078:9)

  console.error
    Error fetching administrators: Error: Connection timeout
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerEnhanced.test.js:1093:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      72 |
      73 |   } catch (error) {
    > 74 |     console.error('Error fetching administrators:', error);
         |             ^
      75 |     res.status(500).json({
      76 |       success: false,
      77 |       message: 'Failed to fetch administrators'

      at error (server/controllers/administratorController.js:74:13)
      at Object.<anonymous> (tests/unit/administratorControllerEnhanced.test.js:1096:7)

PASS tests/unit/administratorControllerEnhanced.test.js
  Administrator Controller - Enhanced Coverage
    Administrator Management
      getAdministrators
        ✓ should get all administrators with pagination (2 ms)
        ✓ should filter administrators by search query (1 ms)
        ✓ should handle database errors (54 ms)
      getAdministratorById
        ✓ should get administrator by ID
        ✓ should return 404 for non-existent administrator (1 ms)
        ✓ should return 400 for invalid ObjectId
      createAdministrator
        ✓ should create new administrator with valid data (57 ms)
        ✓ should return validation errors (1 ms)
        ✓ should handle duplicate email error
      updateAdministrator
        ✓ should update administrator successfully
        ✓ should not allow self-demotion of last super admin (1 ms)
      deleteAdministrator
        ✓ should delete administrator successfully (2 ms)
        ✓ should prevent self-deletion
        ✓ should prevent deletion of last administrator
      resetAdministratorPassword
        ✓ should reset administrator password (54 ms)
        ✓ should handle email sending failure (56 ms)
      getPermissions
        ✓ should return all available permissions (1 ms)
    Operator Management Extensions
      deactivateOperator
        ✓ should deactivate operator (1 ms)
        ✓ should handle non-existent operator
      resetOperatorPassword
        ✓ should reset operator password and send email (2 ms)
      resetOperatorPin
        ✓ should reset operator PIN (1 ms)
        ✓ should validate PIN format
      deleteOperator
        ✓ should delete operator permanently (1 ms)
      getAvailableOperators
        ✓ should get available operators for assignment
      updateOperatorStats
        ✓ should update operator statistics (1 ms)
    Analytics Extensions
      getOperatorAnalytics
        ✓ should get operator analytics with date range (1 ms)
        ✓ should handle missing date range
      getAffiliateAnalytics
        ✓ should get affiliate analytics
      exportReport
        ✓ should export report as CSV (1 ms)
        ✓ should export report as JSON (1 ms)
        ✓ should reject invalid report type
    Operator Self-Management
      getOperatorSelf
        ✓ should get current operator profile
        ✓ should handle non-operator users (1 ms)
      updateOperatorSelf
        ✓ should allow operator to update own profile
        ✓ should prevent changing restricted fields (2 ms)
    Error Handling
      ✓ should handle database connection errors (8 ms)
      ✓ should handle validation errors (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Free first bag policy active. Bags: 2, Credit: $10

      at Object.log [as registerCustomer] (server/controllers/customerController.js:130:17)

  console.log
    Creating new customer with email: jane@example.com username: janesmith

      at Object.log [as registerCustomer] (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at Object.log [as registerCustomer] (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST123456

      at Object.log [as registerCustomer] (server/controllers/customerController.js:181:13)

  console.error
    Delete customer data error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/customerController.test.js:472:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      697 |     });
      698 |   } catch (error) {
    > 699 |     console.error('Delete customer data error:', error);
          |             ^
      700 |     res.status(500).json({
      701 |       success: false,
      702 |       message: 'An error occurred while deleting data'

      at Object.error [as deleteCustomerData] (server/controllers/customerController.js:699:13)
      at Object.<anonymous> (tests/unit/customerController.test.js:474:7)

  console.error
    Get customer dashboard stats error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/customerController.test.js:747:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      585 |     });
      586 |   } catch (error) {
    > 587 |     console.error('Get customer dashboard stats error:', error);
          |             ^
      588 |     res.status(500).json({
      589 |       success: false,
      590 |       message: 'An error occurred while retrieving dashboard statistics'

      at Object.error [as getCustomerDashboardStats] (server/controllers/customerController.js:587:13)
      at Object.<anonymous> (tests/unit/customerController.test.js:749:7)

  console.error
    Update payment info error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/customerController.test.js:851:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      639 |     });
      640 |   } catch (error) {
    > 641 |     console.error('Update payment info error:', error);
          |             ^
      642 |     res.status(500).json({
      643 |       success: false,
      644 |       message: 'An error occurred while updating payment information'

      at Object.error [as updatePaymentInfo] (server/controllers/customerController.js:641:13)
      at Object.<anonymous> (tests/unit/customerController.test.js:853:7)

  console.error
    Update customer password error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/customerController.test.js:1016:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      769 |     });
      770 |   } catch (error) {
    > 771 |     console.error('Update customer password error:', error);
          |             ^
      772 |     res.status(500).json({
      773 |       success: false,
      774 |       message: 'An error occurred while updating password'

      at Object.error [as updateCustomerPassword] (server/controllers/customerController.js:771:13)
      at Object.<anonymous> (tests/unit/customerController.test.js:1018:7)

  console.error
    Get customers for admin error: TypeError: Cannot read properties of undefined (reading 'search')
        at Object.search [as getCustomersForAdmin] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/customerController.js:789:19)
        at Object.getCustomersForAdmin (/var/www/wavemax/wavemax-affiliate-program/tests/unit/customerController.test.js:1251:32)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      866 |     });
      867 |   } catch (error) {
    > 868 |     console.error('Get customers for admin error:', error);
          |             ^
      869 |     res.status(500).json({
      870 |       success: false,
      871 |       message: 'Failed to retrieve customers'

      at Object.error [as getCustomersForAdmin] (server/controllers/customerController.js:868:13)
      at Object.getCustomersForAdmin (tests/unit/customerController.test.js:1251:32)

  console.log
    Free first bag policy active. Bags: 1, Credit: $0

      at Object.log [as registerCustomer] (server/controllers/customerController.js:130:17)

  console.log
    Creating new customer with email: test@example.com username: testuser

      at Object.log [as registerCustomer] (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at Object.log [as registerCustomer] (server/controllers/customerController.js:179:13)

  console.error
    Customer registration error: Error: Database save failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/customerController.test.js:1318:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      234 |     });
      235 |   } catch (error) {
    > 236 |     console.error('Customer registration error:', error);
          |             ^
      237 |     res.status(500).json({
      238 |       success: false,
      239 |       message: 'An error occurred during registration'

      at Object.error [as registerCustomer] (server/controllers/customerController.js:236:13)
      at Object.<anonymous> (tests/unit/customerController.test.js:1337:7)

  console.log
    Free first bag policy active. Bags: 1, Credit: $0

      at Object.log [as registerCustomer] (server/controllers/customerController.js:130:17)

  console.log
    Creating new customer with email: test@example.com username: testuser

      at Object.log [as registerCustomer] (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at Object.log [as registerCustomer] (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST999

      at Object.log [as registerCustomer] (server/controllers/customerController.js:181:13)

PASS tests/unit/customerController.test.js
  Customer Controller
    registerCustomer
      ✓ should successfully register a new customer (14 ms)
      ✓ should return error for invalid affiliate
      ✓ should return error for duplicate email (1 ms)
    getCustomerProfile
      ✓ should return customer profile for authorized customer (1 ms)
      ✓ should return 403 for unauthorized access
      ✓ should return 404 for non-existent customer
    updateCustomerProfile
      ✓ should successfully update customer profile
      ✓ should prevent updating protected fields (2 ms)
    getCustomerOrders
      ✓ should return customer orders with pagination (1 ms)
    deleteCustomerData
      ✓ should delete all customer data in development environment (1 ms)
      ✓ should reject deletion in production environment
      ✓ should reject unauthorized deletion (1 ms)
      ✓ should handle deletion errors (20 ms)
      ✓ should return 404 for non-existent customer (1 ms)
    getCustomerDashboardStats
      ✓ should return dashboard stats for authorized customer (1 ms)
      ✓ should return 404 for non-existent customer
      ✓ should return 403 for unauthorized access (1 ms)
      ✓ should allow affiliate access to their customer dashboard
      ✓ should handle database errors gracefully (6 ms)
    updatePaymentInfo
      ✓ should successfully update payment information (1 ms)
      ✓ should return 404 for non-existent customer
      ✓ should return 403 for unauthorized access
      ✓ should allow admin to update customer payment info
      ✓ should handle database errors (2 ms)
    updateCustomerPassword
      ✓ should successfully update password (1 ms)
      ✓ should reject incorrect current password
      ✓ should validate new password length (1 ms)
      ✓ should return 404 for non-existent customer
      ✓ should return 403 for unauthorized access
      ✓ should handle missing new password (1 ms)
      ✓ should handle database errors (1 ms)
    getCustomersForAdmin
      ✓ should return all customers for admin (1 ms)
      ✓ should filter customers by search query (1 ms)
      ✓ should filter customers by affiliate
      ✓ should filter customers by active status (1 ms)
      ✓ should filter customers by inactive status
      ✓ should filter new customers with no orders (1 ms)
      ✓ should handle combined filters
      ✓ should handle database errors (8 ms)
      ✓ should ignore "all" filter values
    validation errors
      ✓ should return validation errors for registerCustomer (1 ms)
    error handling for registration
      ✓ should handle database save errors during registration (2 ms)
      ✓ should handle missing payment info gracefully (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    scanCustomer called with: { customerId: 'CUST123', bagId: undefined }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.log
    scanCustomer called with: { customerId: 'INVALID', bagId: undefined }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.log
    scanCustomer called with: { customerId: 'CUST123', bagId: 'CUST123' }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.log
    scanCustomer called with: { customerId: 'INVALID', bagId: 'INVALID' }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.error
    Error in scanCustomer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/operatorController.test.js:1070:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      771 |     res.json(response);
      772 |   } catch (error) {
    > 773 |     console.error('Error in scanCustomer:', error);
          |             ^
      774 |     if (logger && logger.error) {
      775 |       logger.error('Error scanning customer card:', error);
      776 |     }

      at Object.error [as scanCustomer] (server/controllers/operatorController.js:773:13)

  console.log
    scanCustomer called with: { customerId: 'CUST123', bagId: undefined }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.log
    scanCustomer called with: { customerId: 'CUST123', bagId: undefined }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.log
    scanCustomer called with: { customerId: 'CUST123', bagId: undefined }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.log
    scanCustomer called with: { customerId: 'CUST123', bagId: undefined }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.log
    scanCustomer called with: { customerId: 'CUST123', bagId: undefined }

      at Object.log [as scanCustomer] (server/controllers/operatorController.js:680:13)

  console.error
    Error in scanCustomer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/operatorController.test.js:1608:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      771 |     res.json(response);
      772 |   } catch (error) {
    > 773 |     console.error('Error in scanCustomer:', error);
          |             ^
      774 |     if (logger && logger.error) {
      775 |       logger.error('Error scanning customer card:', error);
      776 |     }

      at Object.error [as scanCustomer] (server/controllers/operatorController.js:773:13)
      at Object.<anonymous> (tests/unit/operatorController.test.js:1610:7)

PASS tests/unit/operatorController.test.js
  Operator Controller
    getOrderQueue
      ✓ should return available orders for operator workstation (1 ms)
    claimOrder
      ✓ should allow operator to claim an order (1 ms)
      ✓ should fail if order is already claimed
      ✓ should fail if order not found (1 ms)
      ✓ should handle database error during claim
    updateOrderStatus
      ✓ should update order status (1 ms)
      ✓ should handle invalid status transition
      ✓ should handle order not found (1 ms)
      ✓ should handle unauthorized operator
      ✓ should update workstation when washing status with new workstation (1 ms)
      ✓ should set processingCompleted when status is ready (1 ms)
      ✓ should handle database error
    performQualityCheck
      ✓ should record quality check results (1 ms)
      ✓ should handle order not found
      ✓ should handle order not ready for quality check
      ✓ should handle database error during quality check (7 ms)
    getMyOrders
      ✓ should return orders assigned to operator (2 ms)
    updateShiftStatus
      ✓ should update operator shift status
      ✓ should handle operator not found (1 ms)
      ✓ should end shift successfully
      ✓ should handle database error (1 ms)
    getPerformanceStats
      ✓ should return operator performance statistics (1 ms)
    getCustomerDetails
      ✓ should return customer details for an order
    addCustomerNote
      ✓ should add a note to an order (1 ms)
      ✓ should handle customer not found (1 ms)
      ✓ should handle errors during note addition
    Error handling in existing functions
      ✓ should handle error in getOrderQueue (1 ms)
      ✓ should handle different filters in getOrderQueue (1 ms)
      ✓ should handle operator at max capacity in claimOrder
      ✓ should handle quality check failure in performQualityCheck (1 ms)
      ✓ should handle workstation conflict in updateShiftStatus
      ✓ should handle incomplete orders when ending shift (1 ms)
      ✓ should handle invalid action in updateShiftStatus
      ✓ should handle missing workstation when starting shift (1 ms)
      ✓ should handle different time periods in getPerformanceStats
      ✓ should handle operator not found in getPerformanceStats (1 ms)
      ✓ should handle customer not found in getCustomerDetails
      ✓ should handle filters in getMyOrders (1 ms)
    scanCustomer
      ✓ should scan customer and return current order (11 ms)
      ✓ should handle customer not found (1 ms)
    scanBag
      ✓ should redirect to scanCustomer (2 ms)
      ✓ should handle error in scanBag (24 ms)
    receiveOrder
      ✓ should receive order and update status (1 ms)
      ✓ should handle order not found
    markBagProcessed
      ✓ should mark bag as processed (5 ms)
      ✓ should update order status when all bags processed (116 ms)
    confirmPickup
      ✓ should confirm pickup and complete order (1 ms)
      ✓ should handle partial pickup (1 ms)
    getTodayStats
      ✓ should return today's operator statistics (1 ms)
      ✓ should handle no orders for today
    getWorkstationStatus
      ✓ should return workstation status for all workstations (1 ms)
      ✓ should handle database error (1 ms)
    Additional coverage tests
      ✓ should handle error in getMyOrders
      ✓ should handle different performance stat periods
      ✓ should handle error in getPerformanceStats
      ✓ should handle error in getCustomerDetails
      ✓ should handle no active order in scanCustomer (2 ms)
      ✓ should handle different scan actions in scanCustomer (1 ms)
      ✓ should handle affiliate lookup in scanCustomer (1 ms)
      ✓ should handle error in scanCustomer (2 ms)
      ✓ should handle error in receiveOrder (1 ms)
      ✓ should handle order not found in markBagProcessed
      ✓ should handle error in markBagProcessed (1 ms)
      ✓ should handle order not found in confirmPickup
      ✓ should handle error in confirmPickup (1 ms)
      ✓ should handle error in getTodayStats
      ✓ should handle markOrderReady (deprecated function) (1 ms)
      ✓ should handle markOrderReady with affiliate notification
      ✓ should handle errors in markOrderReady (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching administrators: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:380:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      72 |
      73 |   } catch (error) {
    > 74 |     console.error('Error fetching administrators:', error);
         |             ^
      75 |     res.status(500).json({
      76 |       success: false,
      77 |       message: 'Failed to fetch administrators'

      at Object.error [as getAdministrators] (server/controllers/administratorController.js:74:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:383:7)

  console.error
    Error fetching administrator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:814:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      110 |
      111 |   } catch (error) {
    > 112 |     console.error('Error fetching administrator:', error);
          |             ^
      113 |     res.status(500).json({
      114 |       success: false,
      115 |       message: 'Failed to fetch administrator'

      at Object.error [as getAdministratorById] (server/controllers/administratorController.js:112:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:817:7)

  console.error
    Error changing administrator password: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:929:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      545 |
      546 |   } catch (error) {
    > 547 |     console.error('Error changing administrator password:', error);
          |             ^
      548 |     res.status(500).json({
      549 |       success: false,
      550 |       message: 'Failed to change password'

      at Object.error [as changeAdministratorPassword] (server/controllers/administratorController.js:547:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:932:7)

  console.error
    Error fetching operator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:996:47)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      850 |
      851 |   } catch (error) {
    > 852 |     console.error('Error fetching operator:', error);
          |             ^
      853 |     res.status(500).json({
      854 |       success: false,
      855 |       message: 'Failed to fetch operator details'

      at Object.error [as getOperatorById] (server/controllers/administratorController.js:852:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:999:7)

  console.error
    Error resetting operator password: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1062:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1035 |
      1036 |   } catch (error) {
    > 1037 |     console.error('Error resetting operator password:', error);
           |             ^
      1038 |     res.status(500).json({
      1039 |       success: false,
      1040 |       message: 'Failed to reset operator password'

      at Object.error [as resetOperatorPassword] (server/controllers/administratorController.js:1037:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1064:7)

  console.error
    Error fetching operator analytics: Error: Aggregation Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1117:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1511 |
      1512 |   } catch (error) {
    > 1513 |     console.error('Error fetching operator analytics:', error);
           |             ^
      1514 |     res.status(500).json({
      1515 |       success: false,
      1516 |       message: 'Failed to fetch operator analytics'

      at Object.error [as getOperatorAnalytics] (server/controllers/administratorController.js:1513:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1119:7)

  console.error
    Error fetching affiliate analytics: Error: Aggregation Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1171:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1613 |
      1614 |   } catch (error) {
    > 1615 |     console.error('Error fetching affiliate analytics:', error);
           |             ^
      1616 |     res.status(500).json({
      1617 |       success: false,
      1618 |       message: 'Failed to fetch affiliate analytics'

      at Object.error [as getAffiliateAnalytics] (server/controllers/administratorController.js:1615:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1173:7)

  console.error
    Error exporting report: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1293:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1678 |
      1679 |   } catch (error) {
    > 1680 |     console.error('Error exporting report:', error);
           |             ^
      1681 |     res.status(500).json({
      1682 |       success: false,
      1683 |       message: 'Failed to export report'

      at Object.error [as exportReport] (server/controllers/administratorController.js:1680:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1296:7)

  console.error
    Error fetching affiliates list: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1339:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1732 |     });
      1733 |   } catch (error) {
    > 1734 |     console.error('Error fetching affiliates list:', error);
           |             ^
      1735 |     res.status(500).json({
      1736 |       success: false,
      1737 |       message: 'Failed to fetch affiliates list',

      at Object.error [as getAffiliatesList] (server/controllers/administratorController.js:1734:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1342:7)

  console.error
    Error updating operator stats: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1520:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2082 |     });
      2083 |   } catch (error) {
    > 2084 |     console.error('Error updating operator stats:', error);
           |             ^
      2085 |     res.status(500).json({
      2086 |       success: false,
      2087 |       message: 'An error occurred while updating operator statistics'

      at Object.error [as updateOperatorStats] (server/controllers/administratorController.js:2084:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1522:7)

  console.error
    Error getting available operators: TypeError: Operator.find(...).sort(...).limit is not a function
        at Object.limit [as getAvailableOperators] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:2105:8)
        at Object.getAvailableOperators (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1570:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2111 |     });
      2112 |   } catch (error) {
    > 2113 |     console.error('Error getting available operators:', error);
           |             ^
      2114 |     res.status(500).json({
      2115 |       success: false,
      2116 |       message: 'An error occurred while fetching available operators'

      at Object.error [as getAvailableOperators] (server/controllers/administratorController.js:2113:13)
      at Object.getAvailableOperators (tests/unit/administratorController.test.js:1570:37)

  console.error
    Error deleting operator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1624:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2161 |     });
      2162 |   } catch (error) {
    > 2163 |     console.error('Error deleting operator:', error);
           |             ^
      2164 |     res.status(500).json({
      2165 |       success: false,
      2166 |       message: 'An error occurred while deleting the operator'

      at Object.error [as deleteOperator] (server/controllers/administratorController.js:2163:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1626:7)

  console.error
    Error resetting operator PIN: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1684:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2209 |     });
      2210 |   } catch (error) {
    > 2211 |     console.error('Error resetting operator PIN:', error);
           |             ^
      2212 |     res.status(500).json({
      2213 |       success: false,
      2214 |       message: 'An error occurred while resetting the PIN'

      at Object.error [as resetOperatorPin] (server/controllers/administratorController.js:2211:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1686:7)

  console.error
    Error fetching environment variables: TypeError: Cannot read properties of undefined (reading 'DEFAULT_ADMIN_EMAIL')
        at Object.DEFAULT_ADMIN_EMAIL [as getEnvironmentVariables] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:2404:56)
        at Object.getEnvironmentVariables (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1732:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2445 |
      2446 |   } catch (error) {
    > 2447 |     console.error('Error fetching environment variables:', error);
           |             ^
      2448 |     res.status(500).json({
      2449 |       success: false,
      2450 |       message: 'Failed to fetch environment variables'

      at Object.error [as getEnvironmentVariables] (server/controllers/administratorController.js:2447:13)
      at Object.getEnvironmentVariables (tests/unit/administratorController.test.js:1732:37)

  console.error
    Error updating administrator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1852:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      314 |
      315 |   } catch (error) {
    > 316 |     console.error('Error updating administrator:', error);
          |             ^
      317 |     res.status(500).json({
      318 |       success: false,
      319 |       message: 'Failed to update administrator'

      at Object.error [as updateAdministrator] (server/controllers/administratorController.js:316:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1855:7)

  console.error
    Error deleting administrator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1889:44)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      386 |
      387 |   } catch (error) {
    > 388 |     console.error('Error deleting administrator:', error);
          |             ^
      389 |     res.status(500).json({
      390 |       success: false,
      391 |       message: 'Failed to delete administrator'

      at Object.error [as deleteAdministrator] (server/controllers/administratorController.js:388:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1891:7)

PASS tests/unit/administratorController.test.js
  Administrator Controller
    getAdministrators
      ✓ should get administrators with pagination (1 ms)
      ✓ should handle errors (39 ms)
    createAdministrator
      ✓ should create administrator (1 ms)
      ✓ should handle validation errors
    updateAdministrator
      ✓ should update administrator
      ✓ should prevent self-deactivation
    deleteAdministrator
      ✓ should delete administrator (1 ms)
      ✓ should prevent self-deletion
    resetAdministratorPassword
      ✓ should reset password (1 ms)
    Operator Management
      ✓ createOperator should create new operator (1 ms)
      ✓ getOperators should return operators list (1 ms)
      ✓ updateOperator should update operator details (1 ms)
      ✓ deactivateOperator should deactivate operator
    Analytics Functions
      ✓ getDashboard should return dashboard data (1 ms)
      ✓ getOrderAnalytics should return order analytics (1 ms)
    System Configuration
      ✓ getSystemConfig should return configurations
      ✓ updateSystemConfig should update configuration (1 ms)
    getPermissions
      ✓ should return available permissions (1 ms)
    getAdministratorById
      ✓ should get administrator by id
      ✓ should handle not found (1 ms)
      ✓ should handle errors (2 ms)
    changeAdministratorPassword
      ✓ should change password successfully (1 ms)
      ✓ should reject incorrect current password
      ✓ should validate new password strength (1 ms)
      ✓ should handle errors (1 ms)
    getOperatorById
      ✓ should get operator by id
      ✓ should handle operator not found (1 ms)
      ✓ should handle errors (8 ms)
    resetOperatorPassword
      ✓ should reset operator password (1 ms)
      ✓ should handle operator not found
      ✓ should handle errors (2 ms)
    getOperatorAnalytics
      ✓ should get operator analytics (1 ms)
      ✓ should handle errors (1 ms)
    getAffiliateAnalytics
      ✓ should get affiliate analytics (1 ms)
      ✓ should handle errors (1 ms)
    exportReport
      ✓ should export orders report (1 ms)
      ✓ should export operators report
      ✓ should handle invalid report type (1 ms)
      ✓ should handle errors (1 ms)
    getAffiliatesList
      ✓ should get affiliates list (1 ms)
      ✓ should handle errors (1 ms)
    getSystemHealth
      ✓ should get system health status (1 ms)
      ✓ should handle database connection issues
      ✓ should handle errors
    updateOperatorStats
      ✓ should update operator stats with processing time (1 ms)
      ✓ should handle operator not found
      ✓ should validate processing time
      ✓ should handle errors (2 ms)
    getAvailableOperators
      ✓ should get available operators (1 ms)
      ✓ should handle errors (27 ms)
    deleteOperator
      ✓ should delete operator
      ✓ should prevent deletion with active orders
      ✓ should handle errors (2 ms)
    resetOperatorPin
      ✓ should reset operator PIN (1 ms)
      ✓ should handle operator not found
      ✓ should handle errors (1 ms)
    getEnvironmentVariables
      ✓ should get environment variables (1 ms)
      ✓ should handle errors (2 ms)
    Additional coverage for getAdministrators
      ✓ should handle search with active filter (1 ms)
    Additional coverage for createAdministrator
      ✓ should handle duplicate email (1 ms)
      ✓ should handle password validation failure
    Additional coverage for updateAdministrator
      ✓ should handle administrator not found (1 ms)
      ✓ should handle database errors (1 ms)
    Additional coverage for deleteAdministrator
      ✓ should prevent deleting last super admin (1 ms)
      ✓ should handle database errors (1 ms)
    Additional coverage for resetAdministratorPassword
      ✓ should handle admin not found (1 ms)
      ✓ should handle weak password

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:28.219Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:29.167Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b95d8adb283d703359215c4d389129b9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jHZf4fI4-yNv57C7BfyT5oeXJWqFdGJDjMRg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b95d8adb283d703359215c4d389129b9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pqjT4YEfug...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 30.208 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:29.210Z"}
  console.log
    Customer affiliateId: TEST_AFF_1756818388596

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: TEST_AFF_1756818388596

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 5, per-bag: 2

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "TEST_CUST_1756818388950",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "testcustomer1756818388950@example.com",
      "phone": "555-0456",
      "address": "456 Test Ave",
      "city": "Test City",
      "state": "CA",
      "zipCode": "90210",
      "affiliateId": "TEST_AFF_1756818388596",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "TEST_AFF_1756818388596",
        "name": "Test Affiliate",
        "minimumDeliveryFee": 5,
        "perBagDeliveryFee": 2
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 482.882 ms - 824[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:30.772Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'b95d8adb283d703359215c4d389129b9',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ab95d8adb283d703359215c4d389129b9.wNQ1YU0m9e6Mb5SGy2ENNtcfRMBSsMXjMW2dAfdjUpk',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1756818388950",
      "affiliateId": "TEST_AFF_1756818388596",
      "pickupDate": "2025-09-03T13:06:30.771Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: object

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: {"premiumDetergent":true,"fabricSoftener":false,"stainRemover":false}

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: TEST_CUST_1756818388950

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Test Customer

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: TEST_AFF_1756818388596

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:171:13)

  console.log
    Applying bag credit of $25 to first order for customer TEST_CUST_1756818388950

      at log (server/controllers/orderController.js:194:15)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1756818388950",
      "affiliateId": "TEST_AFF_1756818388596",
      "pickupDate": "2025-09-03T13:06:30.771Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "TEST_CUST_1756818388950",
      "affiliateId": "TEST_AFF_1756818388596",
      "pickupDate": "2025-09-03T13:06:30.771Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ebd685cb0d463de561c9",
      "orderId": "ORD218499",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:06:30.964Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "_id": "68b6ebd685cb0d463de561c9",
      "customerId": "TEST_CUST_1756818388950",
      "affiliateId": "TEST_AFF_1756818388596",
      "pickupDate": "2025-09-03T13:06:30.771Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 2,
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD218499",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:06:30.964Z",
      "updatedAt": "2025-09-02T13:06:30.964Z",
      "baseRate": 1.25,
      "estimatedTotal": 7,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "TEST_CUST_1756818388950",
      "affiliateId": "TEST_AFF_1756818388596",
      "pickupDate": "2025-09-03T13:06:30.771Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ebd685cb0d463de561c9",
      "orderId": "ORD218499",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:06:30.964Z",
      "updatedAt": "2025-09-02T13:06:30.964Z",
      "baseRate": 1.25,
      "estimatedTotal": 7,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Reset bag credit for customer TEST_CUST_1756818388950 after applying $25 to first order ORD218499

      at log (server/controllers/orderController.js:259:15)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: testcustomer1756818388950@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD218499
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $7.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Test Affiliate
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> test1756818388596@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1756818388596@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD218499
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, CA 90210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 20 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 327.172 ms - 237[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:32.294Z"}
  console.log
    CSRF token generation: {
      sessionID: '1c9aa0eb9b8d257622e76ef13bac48d9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZeF4oxW7-caxfa-0KFN2KXGDK6QTgVJuyD_0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1c9aa0eb9b8d257622e76ef13bac48d9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tZQQXwoQ2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.704 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:32.304Z"}
  console.log
    Customer affiliateId: TEST_AFF_1756818392174

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: TEST_AFF_1756818392174

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 5, per-bag: 2

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "TEST_CUST_1756818392261",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "testcustomer1756818392261@example.com",
      "phone": "555-0456",
      "address": "456 Test Ave",
      "city": "Test City",
      "state": "CA",
      "zipCode": "90210",
      "affiliateId": "TEST_AFF_1756818392174",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "TEST_AFF_1756818392174",
        "name": "Test Affiliate",
        "minimumDeliveryFee": 5,
        "perBagDeliveryFee": 2
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 150.990 ms - 824[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:33.083Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '1c9aa0eb9b8d257622e76ef13bac48d9',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A1c9aa0eb9b8d257622e76ef13bac48d9.NtEobVZscMAmnwriyROzkp1Lf44D%2Bd4h1m3kP3v2Gpw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1756818392261",
      "affiliateId": "TEST_AFF_1756818392174",
      "pickupDate": "2025-09-04T13:06:33.081Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "numberOfBags": 1
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: TEST_CUST_1756818392261

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Test Customer

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: TEST_AFF_1756818392174

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1756818392261",
      "affiliateId": "TEST_AFF_1756818392174",
      "pickupDate": "2025-09-04T13:06:33.081Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "numberOfBags": 1,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "TEST_CUST_1756818392261",
      "affiliateId": "TEST_AFF_1756818392174",
      "pickupDate": "2025-09-04T13:06:33.081Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ebd985cb0d463de56211",
      "orderId": "ORD357154",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:06:33.279Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "_id": "68b6ebd985cb0d463de56211",
      "customerId": "TEST_CUST_1756818392261",
      "affiliateId": "TEST_AFF_1756818392174",
      "pickupDate": "2025-09-04T13:06:33.081Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD357154",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:06:33.279Z",
      "updatedAt": "2025-09-02T13:06:33.279Z",
      "baseRate": 1.25,
      "estimatedTotal": 23.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "TEST_CUST_1756818392261",
      "affiliateId": "TEST_AFF_1756818392174",
      "pickupDate": "2025-09-04T13:06:33.081Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ebd985cb0d463de56211",
      "orderId": "ORD357154",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:06:33.279Z",
      "updatedAt": "2025-09-02T13:06:33.279Z",
      "baseRate": 1.25,
      "estimatedTotal": 23.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: testcustomer1756818392261@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD357154
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/4/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $23.75
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Test Affiliate
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> test1756818392174@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1756818392174@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD357154
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, CA 90210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/4/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 15 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 1
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 294.402 ms - 241[0m
PASS tests/integration/bagCredit.test.js (7.09 s)
  Bag Credit Functionality
    ✓ Should apply bag credit to first order (3580 ms)
    ✓ Should not apply bag credit to second order (2153 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:35.361Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Payment verified for order 675f563d3a17565879015010

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:332:15)

  console.error
    Error sending payment confirmation: CastError: Cast to ObjectId failed for value "CUST-TEST-VENMO" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
        at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/venmo-payment-parsing.test.js:146:24) {
      stringValue: '"CUST-TEST-VENMO"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-TEST-VENMO',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
          at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/venmo-payment-parsing.test.js:146:24),
      valueType: 'string'
    }

      367 |       // await emailService.sendV2PaymentConfirmation(order, customer);
      368 |     } catch (error) {
    > 369 |       console.error('Error sending payment confirmation:', error);
          |               ^
      370 |     }
      371 |   }
      372 |

      at PaymentEmailScanner.error [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:369:15)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:335:7)
      at Object.<anonymous> (tests/integration/venmo-payment-parsing.test.js:146:24)

  console.warn
    Payment insufficient. Expected: $2.35, Received: $1

      294 |       if (payment.amount < expectedAmount) {
      295 |         // Payment is less than required - notify admin but don't verify
    > 296 |         console.warn(`Payment insufficient. Expected: $${expectedAmount}, Received: $${payment.amount}`);
          |                 ^
      297 |         
      298 |         // Notify admin about insufficient payment
      299 |         try {

      at PaymentEmailScanner.warn [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:296:17)
      at Object.<anonymous> (tests/integration/venmo-payment-parsing.test.js:168:24)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Underpayment Received - Order 79015010

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Underpayment Alert</h2>
            
            <p>Customer has underpaid by $1.35</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 675f563d3a17565879015010</li>
              <li><strong>Short Order ID:</strong> 79015010</li>
              <li><strong>Customer:</strong> John Houlihan</li>
              <li><strong>Customer Email:</strong> john@example.com</li>
              <li><strong>Customer Phone:</strong> 555-1234</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $2.35</li>
              <li><strong>Received Amount:</strong> $1.00</li>
              <li><strong>Difference:</strong> $1.35</li>
              <li><strong>Payment Method:</strong> venmo</li>
              <li><strong>Transaction ID:</strong> 4410913674527352924</li>
              <li><strong>Sender:</strong> John Houlihan</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Payment verification was blocked. Please follow up with the customer for the remaining amount.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Admin notification sent: Underpayment Received - Order 79015010

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2696:13)

  console.log
    Admin notified about underpayment for order 675f563d3a17565879015010

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:541:15)

PASS tests/integration/venmo-payment-parsing.test.js
  Venmo Payment Email Parsing
    HTML Email Parsing
      ✓ should parse Venmo HTML payment confirmation email (513 ms)
      ✓ should correctly extract amount from Venmo HTML format (304 ms)
      ✓ should extract order ID from payment note (546 ms)
      ✓ should verify payment amount matches order total (455 ms)
      ✓ should reject payment with incorrect amount (501 ms)
    Order ID Matching
      ✓ should match order by last 8 characters of ID (355 ms)
      ✓ should handle TEST- prefix in order ID (311 ms)
    Email Provider Detection
      ✓ should identify Venmo emails (546 ms)
      ✓ should return null for unknown providers (320 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:40.295Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:40.672Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fcd88084473f8c8ea3d535df21e54637',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TJ1vhR2S-4_dqN9P6w05p1VKkZLnDXp46Bug

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fcd88084473f8c8ea3d535df21e54637

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: IT9PEqySj0...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.037 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:41.380Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:41.831Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:41.831Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:41.934Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-58bde812-b341-4e40-9912-8c1c3055d1bd",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 154.391 ms - 719[0m
[34mdebug[39m: GET /api/v1/payments/config {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:42.153Z"}
[32minfo[39m: Payment config accessed {"hasHash":true,"hostname":"127.0.0.1","ip":"::ffff:127.0.0.1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:42.156Z"}
[0mGET /api/v1/payments/config [32m200[0m 2.485 ms - 334[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.074Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ca939511fce7aebb6c1954886dc47393',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Jbf7j5BB--OJDpew9z9peYcrDzOzhfyJsX3k

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ca939511fce7aebb6c1954886dc47393

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: UqL9rVKs6P...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.562 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.220Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.530Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.531Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.623Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-daa7045e-77c1-4338-92b5-5841941a70c9",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 152.450 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.841Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbg1v-y3d0urq: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.876Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"test@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:43.910Z","token":"mf2kbg1v-y3d0urq"}
[0mPOST /api/v1/payments/create-token [32m200[0m 68.503 ms - 283[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:44.728Z"}
  console.log
    CSRF token generation: {
      sessionID: '43fbd9432556dbb4f3273b9a66d5f08a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1FmmxuEN-jrXSKSctKtRq798POw4gJwgxM1I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 43fbd9432556dbb4f3273b9a66d5f08a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1qbXC_dMCR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.069 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:44.877Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:45.196Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:45.196Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:45.290Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-82d20021-94ff-477c-88c1-6f5252e7c34c",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 149.476 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:45.506Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbhc4-b6vcscz: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:45.540Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"test@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:45.573Z","token":"mf2kbhc4-b6vcscz"}
[0mPOST /api/v1/payments/create-token [32m200[0m 67.566 ms - 283[0m
[34mdebug[39m: GET /api/v1/payments/check-status/mf2kbhc4-b6vcscz {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:45.577Z"}
[0mGET /api/v1/payments/check-status/mf2kbhc4-b6vcscz [32m200[0m 29.728 ms - 76[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:46.441Z"}
  console.log
    CSRF token generation: {
      sessionID: '2ffd69c1b4ef342b7d51d0c1af3bbf94',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RAYl4Alr-U_o3VtRS4oPfZowOrktTlBMbkkQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2ffd69c1b4ef342b7d51d0c1af3bbf94

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: b5QXQKFptc...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.858 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:46.592Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:46.910Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:46.910Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:47.006Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-2cab0671-8adb-42f5-af5b-f97ca64acf61",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 149.744 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:47.220Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbinq-ikyu8fa: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:47.254Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"test@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:47.287Z","token":"mf2kbinq-ikyu8fa"}
[0mPOST /api/v1/payments/create-token [32m200[0m 67.373 ms - 283[0m
[34mdebug[39m: POST /api/v1/payments/cancel-token/mf2kbinq-ikyu8fa {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:47.290Z"}
  console.log
    CSRF check for: /api/v1/payments/cancel-token/mf2kbinq-ikyu8fa {
      sessionID: '2ffd69c1b4ef342b7d51d0c1af3bbf94',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A2ffd69c1b4ef342b7d51d0c1af3bbf94.pAj%2BxYhXdmHDvDU3gViJTXigemoPdJL0FcSzFVNy1WU',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[32minfo[39m: Released callback handler for payment token mf2kbinq-ikyu8fa: {"callbackPath":"/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:47.385Z"}
[32minfo[39m: Payment token cancelled: {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:47.385Z","token":"mf2kbinq-ikyu8fa"}
[0mPOST /api/v1/payments/cancel-token/mf2kbinq-ikyu8fa [32m200[0m 95.010 ms - 73[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:48.210Z"}
  console.log
    CSRF token generation: {
      sessionID: '09e3403df505fa60bd13138068b35a50',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: aaEXHKLO-hQ2fecMSJdYueNgFPXI5vBBqMJA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 09e3403df505fa60bd13138068b35a50

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: M8nzSi616S...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.649 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:48.359Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:48.673Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:48.674Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:48.761Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-e9b972ef-21dd-4cba-8bab-9d1db9e74e98",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 152.619 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:48.994Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:48.998Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.000Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.001Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.003Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.005Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.006Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.007Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.009Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.011Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk13-dcswrll: {"callbackPath":"/api/v1/payments/callback/handler-2","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-2","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.041Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk10-fz6g3gn: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.044Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk15-7vtmhng: {"callbackPath":"/api/v1/payments/callback/handler-3","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-3","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.051Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk16-b8vvv52: {"callbackPath":"/api/v1/payments/callback/handler-4","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-4","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.053Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk19-bpcltdg: {"callbackPath":"/api/v1/payments/callback/handler-7","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-7","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.054Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk18-jdkdnfa: {"callbackPath":"/api/v1/payments/callback/handler-5","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-5","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.055Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk1e-h6j1jo2: {"callbackPath":"/api/v1/payments/callback/handler-6","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-6","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.057Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk1b-vus9d0f: {"callbackPath":"/api/v1/payments/callback/handler-9","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-9","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.058Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk1f-tlg8mxf: {"callbackPath":"/api/v1/payments/callback/handler-10","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-10","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.060Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kbk1c-j144agy: {"callbackPath":"/api/v1/payments/callback/handler-8","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-8","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.062Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-2","customerEmail":"customer1@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.073Z","token":"mf2kbk13-dcswrll"}
[0mPOST /api/v1/payments/create-token [32m200[0m 75.630 ms - 283[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"customer0@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.076Z","token":"mf2kbk10-fz6g3gn"}
[0mPOST /api/v1/payments/create-token [32m200[0m 81.889 ms - 283[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-3","customerEmail":"customer2@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.082Z","token":"mf2kbk15-7vtmhng"}
[0mPOST /api/v1/payments/create-token [32m200[0m 81.936 ms - 283[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-5","customerEmail":"customer4@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.090Z","token":"mf2kbk18-jdkdnfa"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-7","customerEmail":"customer5@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.091Z","token":"mf2kbk19-bpcltdg"}
[0mPOST /api/v1/payments/create-token [32m200[0m 87.315 ms - 283[0m
[0mPOST /api/v1/payments/create-token [32m200[0m 86.476 ms - 283[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-9","customerEmail":"customer6@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.092Z","token":"mf2kbk1b-vus9d0f"}
[0mPOST /api/v1/payments/create-token [32m200[0m 86.462 ms - 283[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-10","customerEmail":"customer9@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.094Z","token":"mf2kbk1f-tlg8mxf"}
[0mPOST /api/v1/payments/create-token [32m200[0m 82.997 ms - 285[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-8","customerEmail":"customer7@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.095Z","token":"mf2kbk1c-j144agy"}
[0mPOST /api/v1/payments/create-token [32m200[0m 87.503 ms - 283[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-6","customerEmail":"customer8@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.099Z","token":"mf2kbk1e-h6j1jo2"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-4","customerEmail":"customer3@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.101Z","token":"mf2kbk16-b8vvv52"}
[0mPOST /api/v1/payments/create-token [32m200[0m 89.695 ms - 283[0m
[0mPOST /api/v1/payments/create-token [32m200[0m 99.156 ms - 283[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.108Z"}
[33mwarn[39m: No callback handlers available. All handlers are currently in use. {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.136Z"}
[0mPOST /api/v1/payments/create-token [31m503[0m 28.392 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:49.985Z"}
  console.log
    CSRF token generation: {
      sessionID: '7f5a3e34dbb3f0ee9b398e66c8177b13',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ULr4ZurN-CrK1XHUSp4IKkEC__EI1r8BTnT4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7f5a3e34dbb3f0ee9b398e66c8177b13

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2OGLyd3n4n...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.894 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.125Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.428Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.428Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.519Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-307c967b-11c1-41ea-b430-c46f50e8ebed",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 147.928 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.732Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kblda-jnbpoq2: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.766Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"cancel@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.799Z","token":"mf2kblda-jnbpoq2"}
[0mPOST /api/v1/payments/create-token [32m200[0m 67.178 ms - 283[0m
[34mdebug[39m: POST /api/v1/payments/cancel-token/mf2kblda-jnbpoq2 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.802Z"}
  console.log
    CSRF check for: /api/v1/payments/cancel-token/mf2kblda-jnbpoq2 {
      sessionID: '7f5a3e34dbb3f0ee9b398e66c8177b13',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7f5a3e34dbb3f0ee9b398e66c8177b13.03RGUz4ep1YZ1A9qYmfMiz7LTx4cJV8fOKKkkIWzGDE',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[32minfo[39m: Released callback handler for payment token mf2kblda-jnbpoq2: {"callbackPath":"/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.893Z"}
[32minfo[39m: Payment token cancelled: {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.893Z","token":"mf2kblda-jnbpoq2"}
[0mPOST /api/v1/payments/cancel-token/mf2kblda-jnbpoq2 [32m200[0m 91.378 ms - 73[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.896Z"}
[32minfo[39m: Acquired callback handler for payment token mf2kblht-7hoh5xr: {"callbackPath":"/api/v1/payments/callback/handler-2","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-2","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.928Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-2","customerEmail":"new@example.com","service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:50.959Z","token":"mf2kblht-7hoh5xr"}
[0mPOST /api/v1/payments/create-token [32m200[0m 63.993 ms - 283[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:51.782Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c698c2ffd3cc66cb65ebb0453656c8ad',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jv0MTdDE-gU5Yc9ByuXcn1-Z91hQY7eFCd8o

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c698c2ffd3cc66cb65ebb0453656c8ad

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Q3f5AyGQSq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.079 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:51.919Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:52.241Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:52.241Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:52.335Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-d052a5fe-e197-48c4-9f3a-b03f213035df",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 170.653 ms - 719[0m
[34mdebug[39m: GET /api/v1/payments/pool-stats {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:52.572Z"}
[0mGET /api/v1/payments/pool-stats [32m200[0m 30.209 ms - -[0m
[32minfo[39m: Callback pool cleanup job stopped {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:53.462Z"}
PASS tests/integration/payment.test.js (13.928 s)
  Payment Integration Tests
    Payment Configuration Tests
      ✓ should get payment configuration (2412 ms)
    Payment Token Tests
      ✓ should create payment token (1653 ms)
      ✓ should check payment status (1713 ms)
      ✓ should cancel payment token (1769 ms)
    Payment Callback Tests
      ✓ should return 503 when all callback handlers are locked (1775 ms)
      ✓ should release callback handler when payment is cancelled (1797 ms)
    Pool Statistics Tests
      ✓ should get pool statistics (1680 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:54.465Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:55.358Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:06:56.082Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 725.356 ms - 629[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:57.388Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:06:57.564Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 175.999 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-b713c432-4d04-4d4a-9b7d-632588401fc7/customers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:57.579Z"}
[0mGET /api/v1/affiliates/AFF-b713c432-4d04-4d4a-9b7d-632588401fc7/customers [32m200[0m 122.143 ms - 437[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:58.970Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:06:59.123Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 152.985 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-714b416a-020e-420d-a1cf-cedf626adfae/customers?customerId=CUST-e7141496-f145-497c-96ce-64146ed4d89b {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:06:59.217Z"}
[0mGET /api/v1/affiliates/AFF-714b416a-020e-420d-a1cf-cedf626adfae/customers?customerId=CUST-e7141496-f145-497c-96ce-64146ed4d89b [32m200[0m 113.884 ms - 437[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:00.608Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:00.763Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 155.372 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-fc2373ce-ce9e-46b7-a98d-b756fcd82678/customers?customerId=NONEXISTENT123 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:00.768Z"}
[0mGET /api/v1/affiliates/AFF-fc2373ce-ce9e-46b7-a98d-b756fcd82678/customers?customerId=NONEXISTENT123 [32m200[0m 111.155 ms - 130[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:01.974Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:02.130Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 157.164 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-c410e19d-1159-4676-a8cb-ed103bfd6763/customers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:02.135Z"}
[0mGET /api/v1/affiliates/AFF-c410e19d-1159-4676-a8cb-ed103bfd6763/customers [33m401[0m 1.509 ms - 47[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:03.160Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:03.314Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 154.439 ms - 629[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:03.319Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:03.478Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 149.073 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-c1618ef6-4970-43b0-b439-2a574acb2f99/customers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:03.481Z"}
[0mGET /api/v1/affiliates/AFF-c1618ef6-4970-43b0-b439-2a574acb2f99/customers [32m200[0m 116.533 ms - 437[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-c1618ef6-4970-43b0-b439-2a574acb2f99/dashboard {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:03.601Z"}
[0mGET /api/v1/affiliates/AFF-c1618ef6-4970-43b0-b439-2a574acb2f99/dashboard [32m200[0m 141.820 ms - 217[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:05.025Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:05.179Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 154.465 ms - 629[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:06.187Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:06.348Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 161.167 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-f9a0bff2-edf5-4da1-91a8-da3d62bba427 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:06.352Z"}
[0mGET /api/v1/affiliates/AFF-f9a0bff2-edf5-4da1-91a8-da3d62bba427 [32m200[0m 57.906 ms - 565[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:07.456Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:07.606Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 150.683 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-c0060337-20cf-46b0-9b1c-a73475921748/dashboard {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:07.610Z"}
[0mGET /api/v1/affiliates/AFF-c0060337-20cf-46b0-9b1c-a73475921748/dashboard [32m200[0m 146.616 ms - 217[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:08.810Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:08.957Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 147.659 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-a7318e77-ab51-47a9-8afa-380db686db4f/customers?customerId=INVALID_ID {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:08.961Z"}
[0mGET /api/v1/affiliates/AFF-a7318e77-ab51-47a9-8afa-380db686db4f/customers?customerId=INVALID_ID [32m200[0m 113.441 ms - 130[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:10.310Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:10.479Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 169.399 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/INVALID_AFFILIATE/customers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:10.483Z"}
[0mGET /api/v1/affiliates/INVALID_AFFILIATE/customers [33m403[0m 28.630 ms - 42[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:11.734Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:12.162Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 428.339 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-a5422e93-75c1-45e6-8d26-ff4f4fa00a89/customers {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:12.166Z"}
[0mGET /api/v1/affiliates/AFF-a5422e93-75c1-45e6-8d26-ff4f4fa00a89/customers [32m200[0m 119.322 ms - 437[0m
PASS tests/integration/affiliateCustomerFiltering.test.js (19.978 s)
  Affiliate Customer Filtering Integration Tests
    Email URL Generation for Customer Filtering
      ✓ should generate correct dashboard URL with customer parameter (2404 ms)
    Affiliate Dashboard Customer Filtering API
      ✓ should return customers for authenticated affiliate (1612 ms)
      ✓ should filter customers by customerId when provided (1614 ms)
      ✓ should return empty array when filtering by non-existent customerId (1373 ms)
      ✓ should require authentication to access customer list (1206 ms)
    Complete Email-to-Dashboard Flow Simulation
      ✓ should handle complete flow from email generation to dashboard access (1831 ms)
      ✓ should handle URL parameters correctly throughout the flow (1180 ms)
    Dashboard Data Loading for Customer Highlighting
      ✓ should load affiliate profile data correctly (1278 ms)
      ✓ should load dashboard statistics correctly (1339 ms)
    Error Handling in Customer Filtering Flow
      ✓ should handle invalid customer ID gracefully (1508 ms)
      ✓ should handle invalid affiliate ID (1426 ms)
      ✓ should handle database connection issues gracefully (1857 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:14.721Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:15.091Z"}
  console.log
    CSRF token generation: {
      sessionID: '6128834f7d68262e43ec692763d4815a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lSXXOh0k-nd_pZx3Hep43lthnjn3tKeAhBus

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6128834f7d68262e43ec692763d4815a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2dI0WiYr28...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.855 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:15.323Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: new@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi New,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-936df6b6-cd5d-4791-8477-90f6fa8b33fd</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-936df6b6-cd5d-4791-8477-90f6fa8b33fd">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-936df6b6-cd5d-4791-8477-90f6fa8b33fd</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-936df6b6-cd5d-4791-8477-90f6fa8b33fd">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-936df6b6-cd5d-4791-8477-90f6fa8b33fd</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 551.189 ms - 120[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:17.077Z"}
  console.log
    CSRF token generation: {
      sessionID: '78ca90b711b5dab604de75f27de60ddb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Pep2lb5b-E0_LgQxtfAE_juEQqQlP9bvlh8c

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 78ca90b711b5dab604de75f27de60ddb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XFvF7W4qgE...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.031 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-9d7a5276-554f-49b2-a1d2-09d173d64d31 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:17.126Z"}
[0mGET /api/v1/affiliates/AFF-9d7a5276-554f-49b2-a1d2-09d173d64d31 [32m200[0m 56.805 ms - 487[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:17.984Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c068a0b9a5fe39a1287e449718e0307a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: rUat99ox-h7_j_6nUDM2YRjaeGxlQgnjcooY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c068a0b9a5fe39a1287e449718e0307a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 6rZhcuaCIe...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.498 ms - 67[0m
[34mdebug[39m: PUT /api/v1/affiliates/AFF-207607af-b146-40f8-8a82-1d40e3f3c70a {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:18.026Z"}
[0mPUT /api/v1/affiliates/AFF-207607af-b146-40f8-8a82-1d40e3f3c70a [32m200[0m 89.586 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:18.946Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b0f33236b412fe89db28ee9a4652c225',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tP6RHrx9-SD__J1PkQpXfVZZprEuxJUVL4q4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b0f33236b412fe89db28ee9a4652c225

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: kijZ69WZWJ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.492 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:19.082Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:07:19.229Z","userType":"affiliate","username":"testaffiliate"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 147.584 ms - 629[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:20.036Z"}
  console.log
    CSRF token generation: {
      sessionID: 'de84eef8d91886736fabe078a560e4dc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KZiCTzhP-aBSjKvzvnGHXokj-U1FHqoJK2BY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: de84eef8d91886736fabe078a560e4dc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: K5UNLBDOGd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.886 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-33476bde-b212-4d7a-a3af-6c8fcf82f946/customers?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:20.113Z"}
[0mGET /api/v1/affiliates/AFF-33476bde-b212-4d7a-a3af-6c8fcf82f946/customers?page=1&limit=10 [32m200[0m 118.211 ms - 689[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:21.046Z"}
  console.log
    CSRF token generation: {
      sessionID: '2792923ee88fefc38cea2452d2e75d57',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 52G4T7Z4-Wce42pd3l6xJ2RGirkPQXH3sWIw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2792923ee88fefc38cea2452d2e75d57

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dMwVn0rO3D...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.659 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-45d9b715-a923-412f-9986-968e69568f70/orders?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:21.169Z"}
[0mGET /api/v1/affiliates/AFF-45d9b715-a923-412f-9986-968e69568f70/orders?page=1&limit=10 [32m200[0m 114.391 ms - 576[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:22.106Z"}
  console.log
    CSRF token generation: {
      sessionID: '94138610ec7d6e23a135e67b7d77380b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mL1LtTFO-3DZzEmbNjD27ljZUAJGyEazXjUQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 94138610ec7d6e23a135e67b7d77380b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: T5p9Vfx6p5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.764 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-3de9a77a-e1cd-47b3-977e-b874111b5c75/transactions?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:22.183Z"}
[0mGET /api/v1/affiliates/AFF-3de9a77a-e1cd-47b3-977e-b874111b5c75/transactions?page=1&limit=10 [32m200[0m 117.004 ms - 849[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:23.140Z"}
  console.log
    CSRF token generation: {
      sessionID: '8ede82900d6582e34fbebdd259fc758b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HDGJkCuw-7OQ8jqyiJF2iwwST6lWqWI940kk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8ede82900d6582e34fbebdd259fc758b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XS2F375e2W...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.178 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/affiliates/AFF-beb12618-966b-4b8a-bacc-301828b5b11a/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:23.275Z"}
  console.log
    CSRF check for: /api/v1/affiliates/AFF-beb12618-966b-4b8a-bacc-301828b5b11a/delete-all-data {
      sessionID: '8ede82900d6582e34fbebdd259fc758b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A8ede82900d6582e34fbebdd259fc758b.TG2eNtv4lgr0hCjxiQjUxHPTddCd%2BxS9ozwUTXd0d9I',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/affiliates/AFF-beb12618-966b-4b8a-bacc-301828b5b11a/delete-all-data [32m200[0m 207.397 ms - 191[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:24.380Z"}
  console.log
    CSRF token generation: {
      sessionID: '8f35f3fe5369b3caafb0b5da7223485b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: sZ4iFqI9-KGstTltI8Xn19EqiheU1ldCGePo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8f35f3fe5369b3caafb0b5da7223485b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: HpGncZlbQH...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.325 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/affiliates/AFF-df62dfd0-48ed-4f67-a3fd-bf2ca04c416d/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:24.423Z"}
  console.log
    CSRF check for: /api/v1/affiliates/AFF-df62dfd0-48ed-4f67-a3fd-bf2ca04c416d/delete-all-data {
      sessionID: '8f35f3fe5369b3caafb0b5da7223485b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A8f35f3fe5369b3caafb0b5da7223485b.h421Wb4PFh4Ru95ifh8uOEZfK%2Bjcwor1wGPsapwwRvw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/affiliates/AFF-df62dfd0-48ed-4f67-a3fd-bf2ca04c416d/delete-all-data [33m403[0m 30.791 ms - 59[0m
PASS tests/integration/affiliate.test.js (11.789 s)
  Affiliate API
    ✓ should register a new affiliate (1998 ms)
    ✓ should get affiliate profile (906 ms)
    ✓ should update affiliate profile (962 ms)
    ✓ should login affiliate (1090 ms)
    ✓ should get affiliate's customers list (1010 ms)
    ✓ should get affiliate's orders (1060 ms)
    ✓ should get affiliate's earnings/transactions (1034 ms)
    ✓ Delete all affiliate data (development only) (1240 ms)
    ✓ Reject delete in production environment (881 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:26.078Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:32.070Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:32.058Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: object

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: {"premiumDetergent":true,"fabricSoftener":false,"stainRemover":false}

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:32.058Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:32.058Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec14a13f8cdf4c72f9bb",
      "orderId": "ORD863862",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:32.255Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68b6ec14a13f8cdf4c72f9bb",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:32.058Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 2,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD863862",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:32.255Z",
      "updatedAt": "2025-09-02T13:07:32.255Z",
      "baseRate": 1.25,
      "estimatedTotal": 42,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:32.058Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec14a13f8cdf4c72f9bb",
      "orderId": "ORD863862",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:32.255Z",
      "updatedAt": "2025-09-02T13:07:32.255Z",
      "baseRate": 1.25,
      "estimatedTotal": 42,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD863862
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $42.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD863862
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 20 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Test with premium detergent
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/orders [32m201[0m 286.190 ms - 237[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:33.539Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:33.537Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      }
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: object

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: {"premiumDetergent":true,"fabricSoftener":true,"stainRemover":true}

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:33.537Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:33.537Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec15a13f8cdf4c72f9ea",
      "orderId": "ORD447624",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:33.718Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68b6ec15a13f8cdf4c72f9ea",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:33.537Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 9,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD447624",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:33.718Z",
      "updatedAt": "2025-09-02T13:07:33.718Z",
      "baseRate": 1.25,
      "estimatedTotal": 61.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:33.537Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 9,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec15a13f8cdf4c72f9ea",
      "orderId": "ORD447624",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:33.718Z",
      "updatedAt": "2025-09-02T13:07:33.718Z",
      "baseRate": 1.25,
      "estimatedTotal": 61.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD447624
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $61.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD447624
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 3
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> All add-ons please
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/orders [32m201[0m 281.704 ms - 237[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:34.912Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:34.910Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:34.910Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:34.910Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec17a13f8cdf4c72fa19",
      "orderId": "ORD606996",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:35.087Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68b6ec17a13f8cdf4c72fa19",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:34.910Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD606996",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:35.087Z",
      "updatedAt": "2025-09-02T13:07:35.087Z",
      "baseRate": 1.25,
      "estimatedTotal": 46.25,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:34.910Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec17a13f8cdf4c72fa19",
      "orderId": "ORD606996",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:35.087Z",
      "updatedAt": "2025-09-02T13:07:35.087Z",
      "baseRate": 1.25,
      "estimatedTotal": 46.25,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD606996
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Evening (5pm - 8pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $46.25
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD606996
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Evening (5pm - 8pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 25 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> No add-ons
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/orders [32m201[0m 272.516 ms - 241[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:36.274Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:36.273Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "numberOfBags": 4,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: object

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: {"premiumDetergent":true,"fabricSoftener":true,"stainRemover":false}

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:36.273Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "numberOfBags": 4,
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:36.273Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "status": "pending",
      "numberOfBags": 4,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec18a13f8cdf4c72fa48",
      "orderId": "ORD586509",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:36.472Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "_id": "68b6ec18a13f8cdf4c72fa48",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:36.273Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "status": "pending",
      "numberOfBags": 4,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 8,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD586509",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:36.472Z",
      "updatedAt": "2025-09-02T13:07:36.472Z",
      "baseRate": 1.25,
      "estimatedTotal": 78,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:36.273Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "status": "pending",
      "numberOfBags": 4,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 8,
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec18a13f8cdf4c72fa48",
      "orderId": "ORD586509",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:36.472Z",
      "updatedAt": "2025-09-02T13:07:36.472Z",
      "baseRate": 1.25,
      "estimatedTotal": 78,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD586509
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $78.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD586509
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 40 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 4
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Test total calculation
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/orders [32m201[0m 296.250 ms - 236[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:37.705Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:37.703Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "numberOfBags": 5,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      }
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: object

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: {"premiumDetergent":true,"fabricSoftener":true,"stainRemover":true}

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:37.703Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "numberOfBags": 5,
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:37.703Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 5,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec19a13f8cdf4c72fa77",
      "orderId": "ORD780335",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:37.875Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "_id": "68b6ec19a13f8cdf4c72fa77",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:37.703Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 5,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 15,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD780335",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:37.875Z",
      "updatedAt": "2025-09-02T13:07:37.875Z",
      "baseRate": 1.25,
      "estimatedTotal": 102.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:37.703Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 5,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 15,
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec19a13f8cdf4c72fa77",
      "orderId": "ORD780335",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:37.875Z",
      "updatedAt": "2025-09-02T13:07:37.875Z",
      "baseRate": 1.25,
      "estimatedTotal": 102.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD780335
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $102.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD780335
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 50 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 5
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Commission test
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/orders [32m201[0m 281.216 ms - 239[0m
[34mdebug[39m: GET /api/orders/ORD333860 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:39.202Z"}
[0mGET /api/orders/ORD333860 [32m200[0m 109.880 ms - 984[0m
[34mdebug[39m: GET /api/orders/ORD524437 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:40.493Z"}
[0mGET /api/orders/ORD524437 [32m200[0m 112.206 ms - 984[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:41.707Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:41.706Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: object

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: {"premiumDetergent":true,"fabricSoftener":true,"stainRemover":false}

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:171:13)

  console.log
    Applying WDF credit of $10 to order for customer CUST_ADDON_001

      at log (server/controllers/orderController.js:201:15)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:41.706Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:41.706Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec1da13f8cdf4c72fafe",
      "orderId": "ORD962930",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:41.878Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68b6ec1da13f8cdf4c72fafe",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:41.706Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 6,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD962930",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:41.878Z",
      "updatedAt": "2025-09-02T13:07:41.878Z",
      "baseRate": 1.25,
      "estimatedTotal": 48.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-09-03T13:07:41.706Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 6,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ec1da13f8cdf4c72fafe",
      "orderId": "ORD962930",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:07:41.878Z",
      "updatedAt": "2025-09-02T13:07:41.878Z",
      "baseRate": 1.25,
      "estimatedTotal": 48.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Reset WDF credit for customer CUST_ADDON_001 after applying to order ORD962930

      at log (server/controllers/orderController.js:267:15)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD962930
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $48.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD962930
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 9/3/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 3
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Test with credit
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/orders [32m201[0m 302.845 ms - 239[0m
PASS tests/integration/orderAddOns.test.js (17.679 s)
  Order API - Add-on Functionality Integration Tests
    POST /api/orders - Create Order with Add-ons
      ✓ should create order with single add-on selected (6799 ms)
      ✓ should create order with multiple add-ons selected (1382 ms)
      ✓ should create order with no add-ons when not specified (1366 ms)
      ✓ should calculate correct total with add-ons and delivery fee (1415 ms)
      ✓ should include add-ons in total but not in commission calculation (1429 ms)
    GET /api/orders/:orderId - Retrieve Order with Add-ons
      ✓ should return order details including add-ons (1298 ms)
      ✓ should include add-ons when admin retrieves order (1242 ms)
    Order with Add-ons and WDF Credit
      ✓ should apply WDF credit after add-on calculation (1494 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:872:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:872:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:872:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:872:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.log
    Missing template: order-confirmation.html

      at Object.log (tests/integration/emailService.integration.test.js:226:19)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:317:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: undefined

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
            <!DOCTYPE html>
            <html>
            <head><title>Test Email</title></head>
            <body>
              <h1>Test Email Template</h1>
              <p></p>
              <p>Reset Link: </p>
              <p>User: </p>
              <p>Email: </p>
            </body>
            </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1113:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

PASS tests/integration/emailService.integration.test.js
  Email Service Integration
    Email Service Configuration
      ✓ should load and configure the email service correctly (9 ms)
      ✓ should have all required email functions (9 ms)
    Console Email Provider
      ✓ should log affiliate welcome emails to console (20 ms)
      ✓ should log customer welcome emails to console (16 ms)
      ✓ should log password reset emails to console (20 ms)
    Email Template Verification
      ✓ should verify email templates directory exists (3 ms)
      ✓ should verify essential email templates exist (2 ms)
    Mailcow SMTP Configuration
      ✓ should handle Mailcow SMTP configuration (11 ms)
      ✓ should handle secure Mailcow SMTP on port 465 (11 ms)
    Error Handling
      ✓ should handle missing required fields gracefully (18 ms)
      ✓ should handle invalid email addresses (19 ms)
    Bulk Email Operations
      ✓ should handle multiple email sends efficiently (23 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:44.471Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:45.476Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:45.483Z","userId":"test-fb-123"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"K8XMCMONUF","facebookUserId":"test-fb-123","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:45.930Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 454.421 ms - 96[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:47.008Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:47.011Z","userId":"test-fb-456"}
[32minfo[39m: Facebook data deleted for affiliate {"action":"facebook_data_deleted","affiliateId":"68b6ec22e5268ca620c64acb","service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:47.416Z"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"BURO309MZE","facebookUserId":"test-fb-456","hasAffiliate":true,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:47.449Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 441.809 ms - 96[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:50.357Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:50.359Z","userId":"test-fb-789"}
[32minfo[39m: Facebook data deleted for affiliate {"action":"facebook_data_deleted","affiliateId":"68b6ec26e5268ca620c64af9","service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:50.510Z"}
[32minfo[39m: Facebook data deleted for customer {"action":"facebook_data_deleted","customerId":"68b6ec26e5268ca620c64afa","service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:50.546Z"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"TB16FJ80FM","facebookUserId":"test-fb-789","hasAffiliate":true,"hasCustomer":true,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:50.579Z","userType":"both"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 221.903 ms - 96[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:51.511Z"}
[31merror[39m: Invalid signed request signature {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:51.513Z"}
[31merror[39m: Invalid signed request received {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:51.513Z"}
[0mPOST /api/v1/auth/facebook/deletion-callback [33m400[0m 1.955 ms - 34[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:52.380Z"}
[0mPOST /api/v1/auth/facebook/deletion-callback [33m400[0m 1.474 ms - 205[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:53.264Z"}
[31merror[39m: Invalid signed request format {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:53.266Z"}
[31merror[39m: Invalid signed request received {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:53.267Z"}
[0mPOST /api/v1/auth/facebook/deletion-callback [33m400[0m 1.989 ms - 34[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/TESTCODE01 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:54.186Z"}
[0mGET /api/v1/auth/facebook/deletion-status/TESTCODE01 [32m200[0m 29.534 ms - 343[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/NOTEXIST99 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:55.086Z"}
[0mGET /api/v1/auth/facebook/deletion-status/NOTEXIST99 [33m404[0m 28.537 ms - 38[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/invalid! {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:55.979Z"}
[0mGET /api/v1/auth/facebook/deletion-status/invalid! [33m400[0m 1.587 ms - 234[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/ {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:56.845Z"}
[0mGET /api/v1/auth/facebook/deletion-status/ [33m404[0m 2.123 ms - 128[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/FAILCODE01 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:57.747Z"}
[0mGET /api/v1/auth/facebook/deletion-status/FAILCODE01 [32m200[0m 28.181 ms - 255[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:58.659Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:58.662Z","userId":"test-fb-lifecycle"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"Y2EU1ZYKXP","facebookUserId":"test-fb-lifecycle","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:58.873Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 213.819 ms - 96[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/Y2EU1ZYKXP {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:07:58.877Z"}
[0mGET /api/v1/auth/facebook/deletion-status/Y2EU1ZYKXP [32m200[0m 35.873 ms - 267[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.839Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.842Z","userId":"test-fb-concurrent-0"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.844Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.850Z","userId":"test-fb-concurrent-1"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.853Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.855Z","userId":"test-fb-concurrent-2"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.857Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.858Z","userId":"test-fb-concurrent-3"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.860Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:02.861Z","userId":"test-fb-concurrent-4"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"PUC4IZQI18","facebookUserId":"test-fb-concurrent-0","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:03.008Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 168.932 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"MVB84C0EUI","facebookUserId":"test-fb-concurrent-1","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:03.012Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 167.721 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"O3ZCRCJW8E","facebookUserId":"test-fb-concurrent-4","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:03.014Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 154.782 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"A5OY6XC4IZ","facebookUserId":"test-fb-concurrent-3","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:03.032Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 175.675 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"ZSC7N21JHZ","facebookUserId":"test-fb-concurrent-2","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:03.036Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 183.602 ms - 96[0m
PASS tests/integration/facebookDataDeletion.test.js (20.067 s)
  Facebook Data Deletion Integration Tests
    POST /api/v1/auth/facebook/deletion-callback
      ✓ should handle valid deletion request (2107 ms)
      ✓ should delete data for existing affiliate (3116 ms)
      ✓ should delete data for both affiliate and customer (1416 ms)
      ✓ should reject request with invalid signature (874 ms)
      ✓ should reject request without signed_request (877 ms)
      ✓ should handle malformed signed request (897 ms)
    GET /api/v1/auth/facebook/deletion-status/:code
      ✓ should return status for valid confirmation code (926 ms)
      ✓ should return 404 for non-existent code (895 ms)
      ✓ should return error for invalid code format (870 ms)
      ✓ should return error for missing code (868 ms)
      ✓ should show failed status with errors (938 ms)
    Data Deletion Process
      ✓ should track deletion request lifecycle (3930 ms)
      ✓ should handle concurrent deletion requests (1613 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:04.932Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/v1/w9/check-auth {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:10.924Z"}
[0mGET /api/v1/w9/check-auth [32m200[0m 282.251 ms - 115[0m
[34mdebug[39m: GET /api/auth/docusign/callback?code=auth_code_from_docusign&state=test_state_123 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:11.213Z"}
[32minfo[39m: OAuth callback - token exchange completed {"hasAccessToken":true,"hasRefreshToken":true,"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:11.215Z"}
[0mGET /api/auth/docusign/callback?code=auth_code_from_docusign&state=test_state_123 [32m200[0m 4.110 ms - -[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:11.301Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

[32minfo[39m: W9 upload attempt via DocuSign {"action":"upload_attempt","details":{"envelopeId":"env_123456","method":"docusign","success":true},"performedBy":{"ipAddress":"::ffff:127.0.0.1","userEmail":"test@example.com","userId":"68b6ec3a4a1e7a2ccc20c911","userName":"Test Affiliate","userType":"affiliate"},"service":"wavemax-affiliate","target":{"affiliateId":"AFF000001","affiliateName":"Test Affiliate"},"timestamp":"2025-09-02T13:08:11.395Z"}
[0mPOST /api/v1/w9/initiate-signing [32m200[0m 93.500 ms - 139[0m
[34mdebug[39m: GET /api/v1/w9/envelope-status/env_123456 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:11.427Z"}
[0mGET /api/v1/w9/envelope-status/env_123456 [32m200[0m 97.398 ms - 48[0m
[34mdebug[39m: POST /api/v1/w9/docusign-webhook {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:11.536Z"}
[32minfo[39m: W9 status updated for affiliate AFF000001: {"details":{"envelopeId":"env_123456","event":"envelope-completed","status":"completed","success":true},"docusignStatus":"completed","envelopeId":"env_123456","performedBy":{"ipAddress":"::ffff:127.0.0.1","userEmail":"system@docusign","userName":"DocuSign System","userType":"system"},"service":"wavemax-affiliate","status":"verified","target":{"affiliateId":"AFF000001","affiliateName":"Test Affiliate"},"timestamp":"2025-09-02T13:08:11.603Z"}
[0mPOST /api/v1/w9/docusign-webhook [32m200[0m 67.979 ms - 70[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:12.762Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

[0mPOST /api/v1/w9/initiate-signing [32m200[0m 63.059 ms - 156[0m
[34mdebug[39m: GET /api/v1/w9/envelope-status/declined_env {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:13.728Z"}
[0mGET /api/v1/w9/envelope-status/declined_env [32m200[0m 94.123 ms - 49[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:14.789Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

[32minfo[39m: W9 upload attempt via DocuSign {"action":"upload_attempt","details":{"envelopeId":"new_env_after_refresh","method":"docusign","success":true},"performedBy":{"ipAddress":"::ffff:127.0.0.1","userEmail":"test@example.com","userId":"68b6ec3e4a1e7a2ccc20c9b0","userName":"Test Affiliate","userType":"affiliate"},"service":"wavemax-affiliate","target":{"affiliateId":"AFF000001","affiliateName":"Test Affiliate"},"timestamp":"2025-09-02T13:08:14.881Z"}
[0mPOST /api/v1/w9/initiate-signing [32m200[0m 92.564 ms - 143[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:15.771Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.error
    Failed to initiate W9 signing: Error: Invalid template ID
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:290:9)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      258 |     });
      259 |   } catch (error) {
    > 260 |     console.error('Failed to initiate W9 signing:', error);
          |             ^
      261 |     logger.error('Failed to initiate W9 signing:', error);
      262 |     res.status(500).json({
      263 |       error: 'Failed to create W9 signing session',

      at error (server/controllers/w9ControllerDocuSign.js:260:13)

[31merror[39m: Failed to initiate W9 signing: Invalid template ID {"service":"wavemax-affiliate","stack":"Error: Invalid template ID\n    at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:290:9)\n    at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-09-02T13:08:15.832Z"}
[0mPOST /api/v1/w9/initiate-signing [31m500[0m 60.968 ms - 79[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:16.714Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.error
    Failed to initiate W9 signing: Error: Network timeout
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:307:9)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      258 |     });
      259 |   } catch (error) {
    > 260 |     console.error('Failed to initiate W9 signing:', error);
          |             ^
      261 |     logger.error('Failed to initiate W9 signing:', error);
      262 |     res.status(500).json({
      263 |       error: 'Failed to create W9 signing session',

      at error (server/controllers/w9ControllerDocuSign.js:260:13)

[31merror[39m: Failed to initiate W9 signing: Network timeout {"service":"wavemax-affiliate","stack":"Error: Network timeout\n    at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:307:9)\n    at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-09-02T13:08:16.773Z"}
[0mPOST /api/v1/w9/initiate-signing [31m500[0m 59.259 ms - 75[0m
[34mdebug[39m: POST /api/v1/w9/docusign-webhook {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:17.653Z"}
[33mwarn[39m: Invalid DocuSign webhook signature {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:17.654Z"}
[0mPOST /api/v1/w9/docusign-webhook [33m401[0m 1.357 ms - 29[0m
[34mdebug[39m: GET /api/v1/w9/envelope-status/other_envelope {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:18.655Z"}
  console.log
    Envelope mismatch: { expected: undefined, received: 'other_envelope' }

      at log (server/controllers/w9ControllerDocuSign.js:291:15)

[0mGET /api/v1/w9/envelope-status/other_envelope [33m403[0m 59.993 ms - 24[0m
[34mdebug[39m: GET /api/v1/w9/authorization-status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:19.861Z"}
[0mGET /api/v1/w9/authorization-status [32m200[0m 31.100 ms - 65[0m
PASS tests/integration/docusignW9.test.js (16.947 s)
  DocuSign W9 Integration Tests
    Complete W9 Signing Flow
      ✓ should complete full W9 signing flow from authorization to completion (2347 ms)
    Resume Existing Signing Session
      ✓ should resume existing envelope instead of creating new one (978 ms)
    Handle Declined Envelope
      ✓ should reset W9 status when envelope is declined (1057 ms)
    Token Refresh Flow
      ✓ should handle expired token and refresh automatically (1011 ms)
    Error Handling
      ✓ should handle DocuSign service errors gracefully (947 ms)
      ✓ should handle network errors during envelope creation (940 ms)
    Security Tests
      ✓ should reject webhook with invalid signature (953 ms)
      ✓ should prevent accessing another affiliates envelope status (1253 ms)
    Authorization Status Check
      ✓ should verify authorization after OAuth callback (904 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/integration/adminCreation.test.js (5.084 s)
  Admin Creation Integration Tests
    Direct Database Admin Creation
      ✓ should create admin with sequential ID when no admins exist (217 ms)
      ✓ should create admin with next sequential ID when admins exist (346 ms)
      ✓ should handle admin creation with all permissions (197 ms)
      ✓ should handle admin creation with partial permissions (202 ms)
    Admin Model Validation
      ✓ should require email field (160 ms)
      ✓ should save admins with different adminIds successfully (287 ms)
      ✓ should save admins with different emails successfully (291 ms)
    Password Handling
      ✓ should hash password before saving (200 ms)
      ✓ should validate password with verifyPassword method (315 ms)
    Admin Query Operations
      ✓ should find admin by adminId (345 ms)
      ✓ should find admin by email (352 ms)
      ✓ should find active admins only (345 ms)
      ✓ should find admins with specific permissions (354 ms)
      ✓ should get last admin for ID generation (398 ms)
    Email Integration
      ✓ should call email service after admin creation (196 ms)
      ✓ should handle email service failures gracefully (217 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:26.667Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/v1/system/config/public {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:28.446Z"}
[0mGET /api/v1/system/config/public [32m200[0m 33.226 ms - 905[0m
[34mdebug[39m: GET /api/v1/system/config/public {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:29.976Z"}
[0mGET /api/v1/system/config/public [32m200[0m 30.044 ms - 905[0m
[34mdebug[39m: GET /api/v1/system/config/public/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:31.364Z"}
[0mGET /api/v1/system/config/public/wdf_base_rate_per_pound [32m200[0m 28.208 ms - 172[0m
[34mdebug[39m: GET /api/v1/system/config/public/non_existent_key {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:32.655Z"}
[0mGET /api/v1/system/config/public/non_existent_key [33m404[0m 29.108 ms - 35[0m
[34mdebug[39m: GET /api/v1/system/config/public/private_key {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:33.978Z"}
[0mGET /api/v1/system/config/public/private_key [33m404[0m 27.729 ms - 35[0m
[34mdebug[39m: GET /api/v1/system/config {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:35.316Z"}
[0mGET /api/v1/system/config [32m200[0m 61.993 ms - -[0m
[34mdebug[39m: GET /api/v1/system/config {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:36.643Z"}
[0mGET /api/v1/system/config [33m401[0m 1.163 ms - 47[0m
[34mdebug[39m: GET /api/v1/system/config {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:37.954Z"}
[0mGET /api/v1/system/config [33m403[0m 29.760 ms - 68[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:39.271Z"}
  console.log
    CSRF token generation: {
      sessionID: '3c04ce902af1a8c6ec0c8b1354be8c6a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JV6X9XpV-P8k66Lbays4s9jTWlGG0GhRUSiU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3c04ce902af1a8c6ec0c8b1354be8c6a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: jZdFLI225Q...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 61.061 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:39.505Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: '3c04ce902af1a8c6ec0c8b1354be8c6a',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A3c04ce902af1a8c6ec0c8b1354be8c6a.orFCJ3AOn9wE0PyfLagiuEgSSie3Ij%2BtOwqxZNL%2FAoo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [32m200[0m 149.431 ms - 149[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:41.046Z"}
  console.log
    CSRF token generation: {
      sessionID: '943c92ab5260548bf675f8427683a8d6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: PYpWBvmK-HQqNGviq8CN165jtAMQb18SHVSA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 943c92ab5260548bf675f8427683a8d6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: zc4TVzsBV6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.656 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:41.174Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: '943c92ab5260548bf675f8427683a8d6',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A943c92ab5260548bf675f8427683a8d6.jj%2BxsSOWWormmfoxF19UYh%2FO7Q8rBs3%2FbUYYOaI2GmA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Error updating config: Error: Value must be a number for key: wdf_base_rate_per_pound
        at model.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/server/models/SystemConfig.js:67:21)
        at callMiddlewareFunction (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:628:27)
        at model.next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:93:7)
        at _next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:146:10)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:653:30
        at processTicksAndRejections (node:internal/process/task_queues:77:11)

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [33m400[0m 90.025 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:42.567Z"}
  console.log
    CSRF token generation: {
      sessionID: '9d42c55f011de4302285d7e49554cd1a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: b3zpljT0-KOBi0FPqdXdzP2feSl1B2dTYK7k

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9d42c55f011de4302285d7e49554cd1a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Rr6DDgpkhY...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.366 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:42.694Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: '9d42c55f011de4302285d7e49554cd1a',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A9d42c55f011de4302285d7e49554cd1a.Me7sVXBg30NJjTHlJrX0D7M%2BynYPlnGXEmstMMuwhmw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Error updating config: Error: Value must be at least 0.5 for key: wdf_base_rate_per_pound
        at model.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/server/models/SystemConfig.js:72:23)
        at callMiddlewareFunction (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:628:27)
        at model.next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:93:7)
        at _next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:146:10)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:653:30
        at processTicksAndRejections (node:internal/process/task_queues:77:11)

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [33m400[0m 88.299 ms - 71[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:44.061Z"}
  console.log
    CSRF token generation: {
      sessionID: '981d24b9c32a4bef7254f024d2bedede',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 25hG5f7p-LMkQTq5asDxxm8Jw3LYyE3bglaI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 981d24b9c32a4bef7254f024d2bedede

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: mKtwjWDgc4...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.900 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/non_editable_config {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:44.220Z"}
  console.log
    CSRF check for: /api/v1/system/config/non_editable_config {
      sessionID: '981d24b9c32a4bef7254f024d2bedede',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A981d24b9c32a4bef7254f024d2bedede.aYh83WJNWn8SfiLEasfuvLq42TQq0gF99ixqkkWSTJs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Error updating config: Error: Configuration is not editable: non_editable_config
        at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (/var/www/wavemax/wavemax-affiliate-program/server/models/SystemConfig.js:140:11)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/server/routes/systemConfigRoutes.js:83:20

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

[0mPUT /api/v1/system/config/non_editable_config [33m400[0m 86.940 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:45.610Z"}
  console.log
    CSRF token generation: {
      sessionID: '880843ccae42e387ccc85df58b8a1740',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: STyvQJ8q-SVBDDSrSF0wp6gCpHwBMCt23uLM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 880843ccae42e387ccc85df58b8a1740

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: AaeDJAL4yj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.598 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:45.823Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e337fd4dc3542b9cc73a0d5b61e551b3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: infyb25B-1MlARGeA9FHIryZiycyyDg20U0Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e337fd4dc3542b9cc73a0d5b61e551b3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: TJn3ao1Nny...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.293 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:45.835Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: 'e337fd4dc3542b9cc73a0d5b61e551b3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ae337fd4dc3542b9cc73a0d5b61e551b3.BHK9deFO3AcHrRKIKzymKszJxalPMF2lyoihrvTQYTA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [33m403[0m 56.976 ms - 78[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:47.227Z"}
  console.log
    CSRF token generation: {
      sessionID: 'caeabb52ab6a4183a8297e257e824b26',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6HpQfApf-BGdY1GWDfzz6fVYEau0IF6Y2mlU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: caeabb52ab6a4183a8297e257e824b26

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yMyaVkqSus...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.460 ms - 67[0m
[34mdebug[39m: POST /api/v1/system/config/initialize {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:47.268Z"}
  console.log
    CSRF check for: /api/v1/system/config/initialize {
      sessionID: 'caeabb52ab6a4183a8297e257e824b26',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Acaeabb52ab6a4183a8297e257e824b26.UZe3p5r8M15oy%2BmS1Zoe652NeQE2MYMLY1bIIvOA5Is',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/system/config/initialize [32m200[0m 415.612 ms - 48[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:48.993Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e1ea7cc0a34350b917d714d6dfc323ae',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 24tQ0Zlj-RgltylM3yiBy2tOT4DSLViKfG_I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e1ea7cc0a34350b917d714d6dfc323ae

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _PD4PdQA1l...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.474 ms - 67[0m
[34mdebug[39m: POST /api/v1/system/config/initialize {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:49.063Z"}
  console.log
    CSRF check for: /api/v1/system/config/initialize {
      sessionID: 'e1ea7cc0a34350b917d714d6dfc323ae',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ae1ea7cc0a34350b917d714d6dfc323ae.LNndh6yGPMQZnmi5abfOCRvCkRqf7C4yq9Adgxi4n3Y',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/system/config/initialize [32m200[0m 418.559 ms - 48[0m
PASS tests/integration/systemConfig.test.js (26.076 s)
  System Config API Tests
    Public Endpoints
      GET /api/v1/system/config/public
        ✓ should return all public configurations (1775 ms)
        ✓ should not return private configurations (1444 ms)
      GET /api/v1/system/config/public/:key
        ✓ should return a specific public configuration (1310 ms)
        ✓ should return 404 for non-existent config (1290 ms)
        ✓ should return 404 for private config accessed via public endpoint (1356 ms)
    Admin Endpoints
      GET /api/v1/system/config
        ✓ should return all configurations for admin (1340 ms)
        ✓ should return 401 without authentication (1252 ms)
        ✓ should return 403 for non-admin users (1350 ms)
      PUT /api/v1/system/config/:key
        ✓ should update a configuration value (1791 ms)
        ✓ should validate value based on data type (1489 ms)
        ✓ should validate value against min/max constraints (1526 ms)
        ✓ should not allow updating non-editable configs (1559 ms)
        ✓ should require system_config permission (1609 ms)
      POST /api/v1/system/config/initialize
        ✓ should initialize default configurations (1762 ms)
        ✓ should not overwrite existing configurations (1839 ms)
    Integration with Order Model
      ✓ should use SystemConfig WDF rate in new orders (1459 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:52.897Z"}
[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:53.401Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:54.689Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NoO8nTSG-WQFyIaqV-kzMyTkt2vzSVpVSlsE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 12.334 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:54.709Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    V2 registration: 2 free bags, no payment required

      at log (server/controllers/customerController.js:124:15)

  console.log
    Creating new customer with email: john.houlihan@test.com username: johnhoulihan

      at log (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at log (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-8e3ddd3c-b5b6-49fc-858d-1d824aabe735

      at log (server/controllers/customerController.js:181:13)

  console.warn
    Welcome email(s) could not be sent: TypeError: emailService.sendCustomerWelcomeEmail is not a function
        at sendCustomerWelcomeEmail (/var/www/wavemax/wavemax-affiliate-program/server/controllers/customerController.js:185:26)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

      193 |       // Email sent successfully - no need to check result
      194 |     } catch (emailError) {
    > 195 |       console.warn('Welcome email(s) could not be sent:', emailError);
          |               ^
      196 |       // Continue with registration process even if email fails
      197 |     }
      198 |

      at warn (server/controllers/customerController.js:195:15)

[0mPOST /api/customers/register [32m201[0m 379.840 ms - 870[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:56.103Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ySNJmEMS-7gCQP8VbccOcw1eEz55OZqaH9eI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.573 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:57.038Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 99qMZ7x2-lRVS7hOqxcvy91dFzcE7YbeYKMA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.349 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:57.894Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kjy4nVr4-8xgdMX1pHnOqHZwURAt34I03AgI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.318 ms - 67[0m
  console.log
    Payment verified for order 68b6ec6997b93063968a675e

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:332:15)

  console.error
    Error sending payment confirmation: CastError: Cast to ObjectId failed for value "CUST-V2-TEST" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
        at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/v2-complete-payment-flow.test.js:278:24) {
      stringValue: '"CUST-V2-TEST"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-V2-TEST',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:390:32)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._findOne (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2674:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at PaymentEmailScanner.sendPaymentConfirmation (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:355:24)
          at PaymentEmailScanner.verifyAndUpdateOrder (/var/www/wavemax/wavemax-affiliate-program/server/services/paymentEmailScanner.js:335:7)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/v2-complete-payment-flow.test.js:278:24),
      valueType: 'string'
    }

      367 |       // await emailService.sendV2PaymentConfirmation(order, customer);
      368 |     } catch (error) {
    > 369 |       console.error('Error sending payment confirmation:', error);
          |               ^
      370 |     }
      371 |   }
      372 |

      at PaymentEmailScanner.error [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:369:15)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:335:7)
      at Object.<anonymous> (tests/integration/v2-complete-payment-flow.test.js:278:24)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:59.053Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1Ycb3ENG-wYII0CjSJR-W_wy7RQYe7dy9J6o

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.277 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:08:59.974Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tnKuA74z-g1ecDyePc-312HwlLgivwHd1G6E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.105 ms - 67[0m
  console.log
    Order not found for pickup test, skipping

      at Object.log (tests/integration/v2-complete-payment-flow.test.js:369:17)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:00.853Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: iXi6yyVA-YT2hhTtqrXgmwU4AyFWh80k_U4E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.834 ms - 67[0m
  console.warn
    Payment insufficient. Expected: $12.5, Received: $10

      294 |       if (payment.amount < expectedAmount) {
      295 |         // Payment is less than required - notify admin but don't verify
    > 296 |         console.warn(`Payment insufficient. Expected: $${expectedAmount}, Received: $${payment.amount}`);
          |                 ^
      297 |         
      298 |         // Notify admin about insufficient payment
      299 |         try {

      at PaymentEmailScanner.warn [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:296:17)
      at Object.<anonymous> (tests/integration/v2-complete-payment-flow.test.js:417:24)

  console.error
    Customer not found for payment issue notification

      482 |       const customer = await Customer.findOne({ customerId: order.customerId });
      483 |       if (!customer) {
    > 484 |         console.error('Customer not found for payment issue notification');
          |                 ^
      485 |         return;
      486 |       }
      487 |

      at PaymentEmailScanner.error [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:484:17)
      at PaymentEmailScanner.verifyAndUpdateOrder (server/services/paymentEmailScanner.js:300:11)
      at Object.<anonymous> (tests/integration/v2-complete-payment-flow.test.js:417:24)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:01.836Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TLoLDPob-_7Kgk3JZGOJng8rIqL6Hcrv2o6s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.027 ms - 67[0m
  console.log
    No matching order found for ID: NOTFOUND

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:180:17)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:02.684Z"}
  console.log
    CSRF token generation: {
      sessionID: 'adeae0590fe91e50f5565a919a8bd992',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kTDT6xGi-Oz4ZLF8Cxz4HmOfGJY0zT0btOa4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: adeae0590fe91e50f5565a919a8bd992

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yNMIZ4iYvw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.557 ms - 67[0m
  console.log
    Not a payment email from known provider: random@example.com

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:120:17)

FAIL tests/integration/v2-complete-payment-flow.test.js (11.197 s)
  V2 Complete Payment Flow
    Step 1: Customer Registration
      ✓ should register V2 customer without payment (1436 ms)
    Step 2: Order Creation
      ✓ should create order with pending payment status (934 ms)
    Step 3: Order Processing and Weight Update
      ✕ should update order with actual weight and trigger payment request (855 ms)
    Step 4: Payment Email Processing
      ✓ should parse Venmo payment confirmation email and verify payment (1159 ms)
    Step 5: Order Completion
      ✕ should mark order as ready for pickup after payment verification (921 ms)
      ✓ should complete order when customer picks up (878 ms)
    Edge Cases
      ✓ should reject payment with incorrect amount (984 ms)
      ✓ should handle order not found scenario (848 ms)
      ✓ should ignore non-payment emails (839 ms)

  ● V2 Complete Payment Flow › Step 3: Order Processing and Weight Update › should update order with actual weight and trigger payment request

    TypeError: Cannot set properties of null (setting 'actualWeight')

      177 |       
      178 |       // Simulate operator weighing the bags
    > 179 |       testOrder.actualWeight = 10; // 10 lbs
          |                             ^
      180 |       testOrder.status = 'processing';
      181 |       testOrder.bagsWeighed = 2;
      182 |       testOrder.bags = [

      at Object.<anonymous> (tests/integration/v2-complete-payment-flow.test.js:179:29)

  ● V2 Complete Payment Flow › Step 5: Order Completion › should mark order as ready for pickup after payment verification

    TypeError: Cannot read properties of null (reading 'bags')

      316 |       // Mark all bags as processed
      317 |       const order = await Order.findById(testOrder._id);
    > 318 |       order.bags.forEach(bag => {
          |             ^
      319 |         bag.status = 'processed';
      320 |       });
      321 |       order.bagsProcessed = 2;

      at Object.bags (tests/integration/v2-complete-payment-flow.test.js:318:13)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:04.662Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:06.298Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-435e9e61-be1f-4a0c-b94a-c25d5fd02be6

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 118.056 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:08.094Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-33803386-e593-4f14-9fa2-1a81c22bc009

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 106.978 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:09.851Z"}
[0mGET /api/v1/quickbooks/vendors [33m404[0m 57.480 ms - 66[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-08-26&endDate=2025-09-02&format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:11.388Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-08-26&endDate=2025-09-02&format=csv [32m200[0m 121.583 ms - 316[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-08-26&endDate=2025-09-02&format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:13.041Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-08-26&endDate=2025-09-02&format=json [32m200[0m 120.939 ms - 961[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:14.678Z"}
[0mGET /api/v1/quickbooks/payment-summary [33m400[0m 83.492 ms - 66[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2026-09-02&endDate=2026-09-02 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:16.259Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2026-09-02&endDate=2026-09-02 [33m404[0m 81.745 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-08-26&endDate=2025-09-02&format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:17.789Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-08-26&endDate=2025-09-02&format=csv [32m200[0m 149.296 ms - 169[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-01-01 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:19.470Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-01-01 [33m400[0m 29.351 ms - 81[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-003&startDate=2025-01-01&endDate=2025-01-31 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:21.006Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-003&startDate=2025-01-01&endDate=2025-01-31 [33m400[0m 57.232 ms - 76[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-NONEXISTENT&startDate=2025-01-01&endDate=2025-01-31 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:22.540Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-NONEXISTENT&startDate=2025-01-01&endDate=2025-01-31 [33m404[0m 58.625 ms - 49[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:24.087Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-7366e0e5-f33c-468c-8aa2-eca3868669a2

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 95.825 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:24.186Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json [33m404[0m 84.229 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/history {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:24.274Z"}
[0mGET /api/v1/quickbooks/history [32m200[0m 112.469 ms - 946[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:25.964Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-b905fd0c-de0b-4018-892c-6eb859a80dcb

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 94.762 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:26.062Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json [33m404[0m 83.804 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/history?type=vendor {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:26.150Z"}
[0mGET /api/v1/quickbooks/history?type=vendor [32m200[0m 88.592 ms - 946[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:27.725Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-a0971769-6f9b-4649-ad93-986c01a5eed3

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 91.203 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:27.819Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json [33m404[0m 82.705 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:27.905Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-57a3406a-8152-4add-92a5-3c626518c091

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 90.053 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:27.998Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-755ab650-994d-414d-94cd-89cad1868633

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 90.584 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:28.091Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-070288e7-e50a-4d19-befc-79e7fe41fc1c

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 89.503 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:28.184Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-92db6b52-0e08-47ab-9fa5-3219a102985f

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 90.212 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:28.276Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-ba11911c-89f1-4d6b-a448-b0174123c8b3

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 89.390 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/history?limit=3 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:28.369Z"}
[0mGET /api/v1/quickbooks/history?limit=3 [32m200[0m 87.419 ms - -[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:29.911Z"}
[0mGET /api/v1/quickbooks/vendors [33m401[0m 1.042 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:29.914Z"}
[0mGET /api/v1/quickbooks/payment-summary [33m401[0m 0.968 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:29.917Z"}
[0mGET /api/v1/quickbooks/commission-detail [33m401[0m 0.882 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/history {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:29.920Z"}
[0mGET /api/v1/quickbooks/history [33m401[0m 0.841 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:31.453Z"}
  console.log
    Authorization failed for path: /vendors - User role: affiliate Allowed roles: [ 'administrator' ]

      at log (server/middleware/auth.js:146:15)

[0mGET /api/v1/quickbooks/vendors [33m403[0m 29.158 ms - 54[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:32.940Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-3a661f47-9f5c-414a-899f-f6af50f1d33f

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 91.373 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-08-26&endDate=2025-09-02&format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:34.472Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-08-26&endDate=2025-09-02&format=csv [32m200[0m 120.179 ms - 316[0m
PASS tests/integration/quickbooks.test.js (31.718 s)
  QuickBooks Export Integration Tests
    Vendor Export
      ✓ should export verified vendors as CSV (2355 ms)
      ✓ should export vendors as JSON (1818 ms)
      ✓ should handle no verified vendors gracefully (1560 ms)
    Payment Summary Export
      ✓ should export payment summary for date range as CSV (1660 ms)
      ✓ should export payment summary as JSON with correct aggregations (1634 ms)
      ✓ should require date parameters (1586 ms)
      ✓ should handle empty date range (1544 ms)
    Commission Detail Export
      ✓ should export commission details for specific affiliate (1654 ms)
      ✓ should require all parameters (1540 ms)
      ✓ should reject unverified affiliate export (1536 ms)
      ✓ should handle non-existent affiliate (1549 ms)
    Export History
      ✓ should retrieve export history (1821 ms)
      ✓ should filter export history by type (1794 ms)
      ✓ should limit export history results (2208 ms)
    Security and Permissions
      ✓ should require admin authentication for all QuickBooks endpoints (1528 ms)
      ✓ should not allow affiliate access to QuickBooks exports (1512 ms)
    CSV Format Validation
      ✓ should generate QuickBooks-compatible vendor CSV (1535 ms)
      ✓ should generate QuickBooks-compatible payment CSV (1571 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:36.334Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:36.769Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f6df0b9f7b49c2d4d8cb102646ca5222',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ap2ncHVK-uXWFPt9JWGDzQhAYfwk-m9IR1lI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f6df0b9f7b49c2d4d8cb102646ca5222

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fMHEEyKAiR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 13.694 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:37.706Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    Creating new customer with email: bob@example.com username: bobjohnson

      at log (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at log (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-e8cee351-c041-4d91-895c-00cf7ce33db6

      at log (server/controllers/customerController.js:181:13)

  console.log
    Language-specific template not found for en/customer-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: bob@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Service

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Service</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #ffffff !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .service-box {
          border: 1px solid #e0e0e0;
          border-radius: 4px;
          padding: 15px;
          margin: 20px 0;
          background-color: #f9f9f9;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .steps {
          padding: 0;
        }
        .step {
          display: flex;
          margin-bottom: 15px;
          align-items: flex-start;
        }
        .step-number {
          background-color: #1e3a8a;
          color: #ffffff !important;
          width: 25px;
          height: 25px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          margin-right: 10px;
          flex-shrink: 0;
        }
        .step-content {
          flex: 1;
        }
        .divider {
          height: 1px;
          background-color: #e0e0e0;
          margin: 20px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to WaveMAX Laundry!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Bob,</h2>
            <p>Welcome to WaveMAX Laundry Service! Your account has been successfully created and you're ready to enjoy premium wash, dry, fold laundry services.</p>
          </div>
          
          <div class="highlight">
            <h3>Your Account Information</h3>
            <p><strong>Customer ID:</strong> CUST-e8cee351-c041-4d91-895c-00cf7ce33db6</p>
            <p><strong>Your Service Provider:</strong> John Doe</p>
          </div>
          
          <div class="service-box" style="background-color: #f0f7ff; border: 1px solid #3b82f6;">
            <h3>Your Laundry Bag Credit</h3>
            <p>We've credited your account with prepaid laundry bags. These bags will be delivered to you by your service provider.</p>
            
            <div style="background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 6px; padding: 15px; margin: 15px 0;">
              <h4 style="margin-top: 0; color: #1e3a8a;">Account Credit Details</h4>
              <table style="width: 100%; border-collapse: collapse;">
                <tr>
                  <td style="padding: 5px 0;">Bags Purchased</td>
                  <td style="text-align: right; font-weight: bold;">1</td>
                </tr>
                <tr>
                  <td style="padding: 5px 0;">Cost per Bag</td>
                  <td style="text-align: right;">$10.00</td>
                </tr>
                <tr style="border-top: 2px solid #e0e0e0;">
                  <td style="padding: 8px 0; font-weight: bold; color: #1e3a8a;">Total Account Credit</td>
                  <td style="text-align: right; font-weight: bold; color: #1e3a8a; font-size: 18px;">$10.00</td>
                </tr>
              </table>
            </div>
            
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
              <strong>Note:</strong> This credit will be automatically applied to your first orders. Each bag holds approximately 20-25 lbs of laundry.
            </p>
          </div>
          
          <div class="service-box">
            <h3>How It Works</h3>
            <div class="steps">
              <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                  <strong>Schedule a Pickup</strong>
                  <p>Login to your dashboard and schedule a convenient pickup time.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                  <strong>Prepare Your Laundry</strong>
                  <p>Place your laundry in the provided bags. Your service provider will pick them up.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                  <strong>We Do the Rest</strong>
                  <p>Your laundry is professionally washed, dried, and folded at our facility.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                  <strong>Delivery to Your Door</strong>
                  <p>Your clean, fresh laundry is delivered back to you, usually within 24-48 hours.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="divider"></div>
          
          <div class="section">
            <h3>Ready to Schedule Your First Pickup?</h3>
            <p>Click the button below to access your dashboard and schedule your first pickup.</p>
            <div style="text-align: center; margin: 20px 0;">
              <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule Pickup</a>
            </div>
            <p style="text-align: center; color: #1e3a8a; font-style: italic;">Remember: Your account has been credited for your prepaid bags!</p>
          </div>
          
          <div class="section">
            <h3>Questions?</h3>
            <p>Your service provider is here to help! Feel free to reach out:</p>
            <p><strong>Name:</strong> John Doe<br>
            <strong>Phone:</strong> 555-123-4567<br>
            <strong>Email:</strong> john@example.com</p>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Access your customer dashboard anytime to manage orders and track deliveries.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="background-color: #3b82f6;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team.</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Customer welcome email sent successfully to: bob@example.com

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1130:13)

  console.log
    Language-specific template not found for en/affiliate-new-customer, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Customer Registration

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Customer Registration</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f4f4f4;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background-color: #1e3a8a;
                color: #ffffff;
                padding: 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 28px;
            }
            .content {
                padding: 40px 30px;
            }
            .content h2 {
                color: #1e3a8a;
                font-size: 24px;
                margin-bottom: 20px;
            }
            .info-box {
                background-color: #f0f7ff;
                border-left: 4px solid #3b82f6;
                padding: 20px;
                margin: 20px 0;
            }
            .customer-details {
                background-color: #f9f9f9;
                padding: 20px;
                border-radius: 8px;
                margin: 20px 0;
            }
            .customer-details h3 {
                color: #1e3a8a;
                margin-top: 0;
            }
            .detail-row {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e0e0e0;
            }
            .detail-row:last-child {
                border-bottom: none;
            }
            .detail-label {
                font-weight: bold;
                color: #555;
            }
            .button {
                display: inline-block;
                background-color: #ffffff !important;
                color: #ffffff !important;
                padding: 12px 30px;
                text-decoration: none !important;
                border-radius: 6px;
                font-weight: bold;
                margin: 20px 0;
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .footer {
                background-color: #f8f9fa;
                padding: 20px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #3b82f6;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Customer Registration!</h1>
            </div>
            
            <div class="content">
                <h2>Congratulations, [BUSINESS_NAME]!</h2>
                
                <p>Great news! A new customer has just registered through your affiliate link.</p>
                
                <div class="info-box">
                    <strong>Action Required:</strong> Please deliver 1 laundry bag(s) to your new customer within 48 hours.
                    <br><small>Note: This customer received their first bag FREE as part of our promotional offer.</small>
                </div>
                
                <div class="customer-details">
                    <h3>Customer Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Customer ID:</span>
                        <span>CUST-e8cee351-c041-4d91-895c-00cf7ce33db6</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span>
                        <span>Bob Johnson</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span>bob@example.com</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span>
                        <span>555-555-5555</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span>
                        <span>789 Pine St, Austin, TX 78703</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Service Frequency:</span>
                        <span>weekly</span>
                    </div>
                </div>
                
                <h3>Next Steps:</h3>
                <ol><li>Contact the customer to arrange bag delivery</li><li>Deliver <strong>1</strong> laundry bag(s) they purchased during registration</li><li>Explain the pickup and delivery process</li><li>Schedule their first pickup if requested</li><li>Remind them that bag fees will be credited on their first order</li></ol>
                
                <center>
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate&customer=CUST-e8cee351-c041-4d91-895c-00cf7ce33db6" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Customer in Dashboard</a>
                </center>
                
                <p>Remember: Providing excellent service from the start helps ensure customer retention and positive reviews!</p>
            </div>
            
            <div class="footer">
                <p>This email was sent by WaveMAX Laundry Affiliate Program</p>
                <p>Questions? Contact us at <a href="mailto:support@wavemax.promo">support@wavemax.promo</a></p>
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/customers/register [32m201[0m 271.335 ms - 774[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:38.997Z"}
  console.log
    CSRF token generation: {
      sessionID: '016404ff5531513646a667bbbd4a8be6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: fjdoKxMh-zAQJCc_7HA5lp5UaxNCtfbzNmgo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 016404ff5531513646a667bbbd4a8be6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _5OZNTykyG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.543 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:39.272Z"}
[0mPOST /api/v1/customers/register [33m400[0m 30.251 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:40.135Z"}
  console.log
    CSRF token generation: {
      sessionID: '947db80e0dafb336e8965a8b7aa37142',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: rBuCYhlB-Mx1S1lOuSG2SPpVlxeEPUaQVKKw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 947db80e0dafb336e8965a8b7aa37142

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: N3rHbWH7PJ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.644 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:40.418Z"}
[0mPOST /api/v1/customers/register [33m400[0m 59.823 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:41.296Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ff6cafd2ce69be05bb9555946be5309e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MkG0y0Ev-yn2TsSApWe8lGkPqZ8COnKDNd2I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ff6cafd2ce69be05bb9555946be5309e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: qhH7NaRJ3C...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.737 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:41.573Z"}
[0mPOST /api/v1/customers/register [33m400[0m 57.816 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:42.465Z"}
  console.log
    CSRF token generation: {
      sessionID: '5890ab4a4744faddbf5d24df7b7e4686',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ctzd0NeQ-uMcASnpiXn73qlQG1qTo7ULQuqM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5890ab4a4744faddbf5d24df7b7e4686

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yfUkAQ9x0D...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.603 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:42.737Z"}
[0mGET /api/v1/customers/CUST123/profile [32m200[0m 87.641 ms - 462[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:43.671Z"}
  console.log
    CSRF token generation: {
      sessionID: '309be456b9c45f3b00360566805cc3af',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HLCDvii7-dUw5fgmt3Ar04Kt1RtF6-J9Ujsg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 309be456b9c45f3b00360566805cc3af

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: BB6cb4b5GM...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.366 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:43.947Z"}
[0mGET /api/v1/customers/CUST123/profile [32m200[0m 85.395 ms - 462[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:44.953Z"}
  console.log
    CSRF token generation: {
      sessionID: '79959281509a5e91dadb7a2ddecdd152',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RxSOH8Ph-kIwia4i0pSJE0HodIoQ1IBKqQls

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 79959281509a5e91dadb7a2ddecdd152

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: MeCY65H5M6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.956 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:45.235Z"}
[0mGET /api/v1/customers/CUST123/profile [33m403[0m 57.180 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:46.143Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fbc1452a583de8fa232e6ef7f630a9fd',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: WeDAE4by-yQiHNSoW69TeL4aoQggNZeu6gjk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fbc1452a583de8fa232e6ef7f630a9fd

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1ymvk04lb8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.638 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:46.413Z"}
[0mGET /api/v1/customers/CUST123/profile [32m200[0m 57.373 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:47.288Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b0dafe03c0b78b49b4df4f88a8f5b48e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: bzgz6YWY-YLMneyIe6BohX-IkVGsCcVygHds

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b0dafe03c0b78b49b4df4f88a8f5b48e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: V0_Lzr540e...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.758 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:47.563Z"}
[0mPUT /api/v1/customers/CUST123/profile [32m200[0m 90.324 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:48.520Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b55fb0941002c3d098b3643babf95b3f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: QhAaWVTY-_Dnpx4tn4DtfW3VlHwCZGQ1UObI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b55fb0941002c3d098b3643babf95b3f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: jhaPckDKXc...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.847 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:48.803Z"}
[0mPUT /api/v1/customers/CUST123/profile [32m200[0m 103.004 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:49.887Z"}
  console.log
    CSRF token generation: {
      sessionID: '3f4e7253f04d564cb70ffa4c19ec7a5f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lF4GIj0j-CnCBXcujh4i5LQYCHYW0AE1uaCw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3f4e7253f04d564cb70ffa4c19ec7a5f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: -hGlijl7uX...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.399 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/orders?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:50.217Z"}
[0mGET /api/v1/customers/CUST123/orders?page=1&limit=10 [32m200[0m 137.129 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:51.217Z"}
  console.log
    CSRF token generation: {
      sessionID: '4fbd2b811df12113f22670fe3db68460',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Woodsx0a-sxJiqxf_hSKmYmmvgm4weqvWs58

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4fbd2b811df12113f22670fe3db68460

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LunbGkQis2...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.407 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/orders?status=complete {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:51.523Z"}
[0mGET /api/v1/customers/CUST123/orders?status=complete [32m200[0m 115.848 ms - 365[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:52.473Z"}
  console.log
    CSRF token generation: {
      sessionID: '50f3f220e0dee7d1610140353af06b01',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: EZ5pRVbk-isUCHkPBRQcEqh56Mh2NlBXbDEk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 50f3f220e0dee7d1610140353af06b01

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: n_jFrTgQbR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.826 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:52.738Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/password {
      sessionID: '50f3f220e0dee7d1610140353af06b01',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A50f3f220e0dee7d1610140353af06b01.S3PAOjGCYEranw%2FWXQ4V4DL7dN3Zllsrt1NLsZwZAjI',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/customers/CUST123/password [32m200[0m 198.313 ms - 58[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:52.939Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 148.387 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:53.924Z"}
  console.log
    CSRF token generation: {
      sessionID: '63fc4d0114a9d206dbed574eb88556ee',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: rwm2u2TQ-oELjBR7MTg7vzB3OCTd5Sl72HpI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 63fc4d0114a9d206dbed574eb88556ee

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fNjpj0Vfkr...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.074 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:54.202Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/password {
      sessionID: '63fc4d0114a9d206dbed574eb88556ee',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A63fc4d0114a9d206dbed574eb88556ee.%2FKIZHpv5DIIzqKfUqExEQOOwnXjmrehd8p%2BIlQM4bOg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/customers/CUST123/password [33m401[0m 113.107 ms - 59[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:55.136Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a99e9184f4bc82a18f8347e4b1c50005',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eqmwxZJi-9X7FpBKtqUcoLOPv1rd6gmWeGWk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a99e9184f4bc82a18f8347e4b1c50005

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _G0jARBSAr...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 10.289 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:55.416Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/password {
      sessionID: 'a99e9184f4bc82a18f8347e4b1c50005',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa99e9184f4bc82a18f8347e4b1c50005.dOFf15oWUWfyOtv9g3MGTFWN7OizcOQVUjG6zH6hXCI',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/customers/CUST123/password [33m400[0m 113.069 ms - 77[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:56.369Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e55761b31b2315e2364b5de0de23f527',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RXOreL4E-1dxvlMxA_mF1O5q9kSwylphNKCg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e55761b31b2315e2364b5de0de23f527

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5mv9GBeRdt...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.846 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/dashboard {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:56.673Z"}
[0mGET /api/v1/customers/CUST123/dashboard [32m200[0m 142.678 ms - 889[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:57.634Z"}
  console.log
    CSRF token generation: {
      sessionID: '9481ba47e284a540d6e5301417c62ca9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Lgdoskzh-6XsgnM73ndj3QBv_E597sxKHmUA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9481ba47e284a540d6e5301417c62ca9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Buh8wH-tlq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.082 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/dashboard?includeMonthlyStats=true {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:57.952Z"}
[0mGET /api/v1/customers/CUST123/dashboard?includeMonthlyStats=true [32m200[0m 141.325 ms - 889[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:58.918Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd216b9691d9ee9c817188a55d4aa55f5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: X1UUpn6t-RKn3Qb1AeoMBoNN8RCmdyvy9N04

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d216b9691d9ee9c817188a55d4aa55f5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: IUnNY1veP6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.800 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/dashboard {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:09:59.221Z"}
[0mGET /api/v1/customers/CUST123/dashboard [32m200[0m 141.132 ms - 889[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:00.212Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f9f105736c73b379ba7ccf90ecb90f23',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DINGFZFs-t9kDwFu77Vf3j69OpfEr6fYPJe4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f9f105736c73b379ba7ccf90ecb90f23

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rrBepNWJGe...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.167 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/customers/CUST123/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:00.573Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/delete-all-data {
      sessionID: 'f9f105736c73b379ba7ccf90ecb90f23',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Af9f105736c73b379ba7ccf90ecb90f23.3lljzVTvCN%2FTUncSA5OgoW%2BuziolIE%2BgU7HUhXmeNp4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/customers/CUST123/delete-all-data [32m200[0m 126.063 ms - 107[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:01.582Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f68fc7bb7c31d342c0c21ba7b9433062',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NshCgxZM-YaBSYrqDkvRkx-QqJyQvdY2Bo_w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f68fc7bb7c31d342c0c21ba7b9433062

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: nmhuXeTthn...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.432 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/customers/CUST123/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:01.897Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/delete-all-data {
      sessionID: 'f68fc7bb7c31d342c0c21ba7b9433062',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Af68fc7bb7c31d342c0c21ba7b9433062.srMi2jrh%2FIZgc0CMuwPV0yiGUkLfWMtgy%2BHG%2BQvrBrE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/customers/CUST123/delete-all-data [33m403[0m 31.948 ms - 59[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:02.753Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f77225d461159e38f81fd81da25fd6b9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6STHYlKY-Hy1KWA4pThkNLo1jxxTYUOVRx3Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f77225d461159e38f81fd81da25fd6b9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fBkx9_ZF7y...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.319 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/customers/CUST123/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:03.160Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/delete-all-data {
      sessionID: 'f77225d461159e38f81fd81da25fd6b9',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Af77225d461159e38f81fd81da25fd6b9.uqnbpcbb4BWDaL4YxJ3sikrXED3osZewq1qpOusQwvU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/customers/CUST123/delete-all-data [33m403[0m 31.203 ms - 63[0m
PASS tests/integration/customer.test.js (28.652 s)
  Customer Integration Tests
    POST /api/v1/customers/register
      ✓ should register a new customer (2248 ms)
      ✓ should fail with invalid affiliate ID (1138 ms)
      ✓ should fail with duplicate email (1161 ms)
      ✓ should fail with duplicate username (1169 ms)
    GET /api/v1/customers/:customerId/profile
      ✓ should return customer profile for authenticated customer (1206 ms)
      ✓ should return customer profile for affiliate (1280 ms)
      ✓ should fail for unauthorized customer (1191 ms)
      ✓ should return limited data without authentication (1144 ms)
    PUT /api/v1/customers/:customerId/profile
      ✓ should update customer profile (1231 ms)
      ✓ should not update protected fields (1367 ms)
    GET /api/v1/customers/:customerId/orders
      ✓ should return customer orders with pagination (1330 ms)
      ✓ should filter orders by status (1256 ms)
    PUT /api/v1/customers/:customerId/password
      ✓ should update customer password (1451 ms)
      ✓ should fail with incorrect current password (1212 ms)
      ✓ should fail with weak new password (1233 ms)
    GET /api/v1/customers/:customerId/dashboard
      ✓ should return customer dashboard statistics (1265 ms)
      ✓ should return monthly statistics (1284 ms)
      ✓ should allow affiliate to view customer dashboard (1294 ms)
    DELETE /api/v1/customers/:customerId/delete-all-data
      ✓ should delete all customer data in development environment (1370 ms)
      ✓ should reject deletion in production environment (1171 ms)
      ✓ should reject unauthorized deletion (1317 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:05.487Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:06.688Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 66DUgacD-ioSvXu4kwePhgVcjJUsMxWz-kgo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 10.544 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:06.704Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    V2 registration: 2 free bags, no payment required

      at log (server/controllers/customerController.js:124:15)

  console.log
    Creating new customer with email: v2customer@test.com username: v2testcustomer

      at log (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at log (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-77dc9206-d7bf-4caa-a44e-9a48b2ae4079

      at log (server/controllers/customerController.js:181:13)

  console.warn
    Welcome email(s) could not be sent: TypeError: emailService.sendCustomerWelcomeEmail is not a function
        at sendCustomerWelcomeEmail (/var/www/wavemax/wavemax-affiliate-program/server/controllers/customerController.js:185:26)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

      193 |       // Email sent successfully - no need to check result
      194 |     } catch (emailError) {
    > 195 |       console.warn('Welcome email(s) could not be sent:', emailError);
          |               ^
      196 |       // Continue with registration process even if email fails
      197 |     }
      198 |

      at warn (server/controllers/customerController.js:195:15)

[0mPOST /api/customers/register [32m201[0m 400.335 ms - 869[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:08.099Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: wiMJAd7t-VMaMMEedWduw-6YQVHQLrg7IdEE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.617 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:08.109Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KaGfZSlN-8akHnN361lGa0g1LDlpDAp3SiZs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 17.943 ms - 67[0m
[34mdebug[39m: POST /api/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:08.129Z"}
[0mPOST /api/auth/customer/login [33m401[0m 28.179 ms - 64[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:08.968Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Xy0xyeFj-A8htJSejptUwIRP6Jl9FCywkuhU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.245 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:08.980Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DwCInlEQ-AIiLBcHGro6NTnpRr2O_eA-Xgrw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.676 ms - 67[0m
[34mdebug[39m: POST /api/orders/create {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:08.990Z"}
  console.log
    CSRF check for: /api/orders/create {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A53c498de96366d2a80e0f22e00728051.8zc831Y%2BXmSkJzj0brp6tSpFxme15wtCdKC3hCcDT20',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/orders/create [33m404[0m 4.161 ms - 129[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:09.779Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: SYyTX4N9-CqdLGkDP8YybZmtk9DSzaopGH-U

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.037 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:09.796Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eoFDC11Y-PZbFOsqeq-cVnpAdWsaB6x3Uqnk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.462 ms - 67[0m
[34mdebug[39m: POST /api/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:09.804Z"}
[0mPOST /api/auth/administrator/login [33m400[0m 1.633 ms - 84[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:10.705Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: UDRddTOE-KVYTAvc2HQTbE3YUFFcwQ-9AAew

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.959 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:11.531Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TnZH5N0R-vahSBr2CozNdLnbYVLa9oHLmTA8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.139 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:11.539Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: IIOXfexO-QTJER5rfY8d3ruw1dPzvQfqGJms

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.000 ms - 67[0m
[34mdebug[39m: POST /api/orders/confirm-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:11.546Z"}
  console.log
    CSRF check for: /api/orders/confirm-payment {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A53c498de96366d2a80e0f22e00728051.8zc831Y%2BXmSkJzj0brp6tSpFxme15wtCdKC3hCcDT20',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Payment confirmation error: TypeError: Cannot read properties of undefined (reading 'length')
        at length (/var/www/wavemax/wavemax-affiliate-program/server/controllers/orderController.js:1247:17)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at middleware (/var/www/wavemax/wavemax-affiliate-program/node_modules/express-validator/lib/middlewares/check.js:16:13)

      1312 |     
      1313 |   } catch (error) {
    > 1314 |     console.error('Payment confirmation error:', error);
           |             ^
      1315 |     res.status(500).json({
      1316 |       success: false,
      1317 |       message: 'An error occurred while processing your payment confirmation'

      at error (server/controllers/orderController.js:1314:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware (node_modules/express-validator/lib/middlewares/check.js:16:13)

[0mPOST /api/orders/confirm-payment [31m500[0m 15.083 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:12.356Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: UCnghGN6-NAvYQE9imi8qrtX4spddveOTFbA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.162 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:13.160Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: EfoEb8kv-NOhG8JrltAc6pHB8rjqyd2CGrvE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.870 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:13.981Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: cqxqKoZp-yMypPP3-kXpCCm2ps9UpDoFXYfU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.670 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:14.774Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: n7ZjCk3q-JgtjFOQWvMbg6qJ11EgLJKqkYXE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.055 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:15.575Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nsmgk3KJ-Da5ue2GlexTejehGDBtTrrTeQz8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.462 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:16.373Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BxpItply-IGqtsdO9tYrf7_S349qJtkqo-yE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.739 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:17.189Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gqmluraB-h5VXsXiFyjFwhqaI1aibGcxPpro

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.026 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:18.005Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: LndDybtu-_o3URgrtzq0xsL7xvaSG6T-Dp4Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.655 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:18.793Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3xvyULDg-vysAWUacqoVO5LPw6i7GcwmoQpE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.178 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:18.803Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: IZV0biML-bFI60i0cbhQRLWpNuI44gVrWZJ8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.814 ms - 67[0m
[34mdebug[39m: POST /api/orders/confirm-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:18.811Z"}
  console.log
    CSRF check for: /api/orders/confirm-payment {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A53c498de96366d2a80e0f22e00728051.8zc831Y%2BXmSkJzj0brp6tSpFxme15wtCdKC3hCcDT20',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Payment confirmation error: TypeError: Cannot read properties of undefined (reading 'length')
        at length (/var/www/wavemax/wavemax-affiliate-program/server/controllers/orderController.js:1247:17)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at middleware (/var/www/wavemax/wavemax-affiliate-program/node_modules/express-validator/lib/middlewares/check.js:16:13)

      1312 |     
      1313 |   } catch (error) {
    > 1314 |     console.error('Payment confirmation error:', error);
           |             ^
      1315 |     res.status(500).json({
      1316 |       success: false,
      1317 |       message: 'An error occurred while processing your payment confirmation'

      at error (server/controllers/orderController.js:1314:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware (node_modules/express-validator/lib/middlewares/check.js:16:13)

[0mPOST /api/orders/confirm-payment [31m500[0m 4.037 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:19.586Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: QTBR7XOX-6TYNEka3e9PEfGo6qv3t4nNuTXQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.106 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:19.595Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: B9dctFca-1XDGdcJT3myH0WalpI-xipnnLyI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.782 ms - 67[0m
[34mdebug[39m: POST /api/orders/confirm-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:19.603Z"}
  console.log
    CSRF check for: /api/orders/confirm-payment {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A53c498de96366d2a80e0f22e00728051.8zc831Y%2BXmSkJzj0brp6tSpFxme15wtCdKC3hCcDT20',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Payment confirmation error: TypeError: Cannot read properties of undefined (reading 'length')
        at length (/var/www/wavemax/wavemax-affiliate-program/server/controllers/orderController.js:1247:17)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at middleware (/var/www/wavemax/wavemax-affiliate-program/node_modules/express-validator/lib/middlewares/check.js:16:13)

      1312 |     
      1313 |   } catch (error) {
    > 1314 |     console.error('Payment confirmation error:', error);
           |             ^
      1315 |     res.status(500).json({
      1316 |       success: false,
      1317 |       message: 'An error occurred while processing your payment confirmation'

      at error (server/controllers/orderController.js:1314:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware (node_modules/express-validator/lib/middlewares/check.js:16:13)

[0mPOST /api/orders/confirm-payment [31m500[0m 3.993 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:20.383Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: muD6zvwA-lJhA-5g46781fReKfpyuNjAEEHM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.741 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:21.195Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: K0q7Ak64-C2G8nm59aM9S3QY2YmhrMIM61W8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.979 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:21.232Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: oaLP4bNJ-zJOKT6lFlp20xVJBK7XG6Ox-r0k

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.780 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:21.241Z"}
[0mPOST /api/customers/register [33m400[0m 2.882 ms - 507[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:22.030Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JTuEPQeW-TIPf1oCzn6zqvxj2PgFouDa1GjA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.575 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:22.066Z"}
  console.log
    CSRF token generation: {
      sessionID: '53c498de96366d2a80e0f22e00728051',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: E1fqzNMt-V_hPzh9DcXbG5yzfRZUDayXO_d8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 53c498de96366d2a80e0f22e00728051

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: idB11nKeQo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.151 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:22.074Z"}
[0mPOST /api/customers/register [33m400[0m 1.726 ms - 507[0m
FAIL tests/integration/v2-payment-flow.test.js (18.932 s)
  V2 Payment Flow Integration Tests
    V2 Customer Registration
      ✓ should register a V2 customer without payment (1429 ms)
      ✓ should allow V2 customer to login (870 ms)
    V2 Pickup Scheduling
      ✕ should create order without prepayment for V2 customer (809 ms)
    Payment Link Generation
      ✕ should generate payment links when order is weighed (926 ms)
      ✕ should send payment request email (825 ms)
    Payment Confirmation Flow
      ✕ should handle customer payment confirmation (824 ms)
      ✕ should verify payment through email scanning (803 ms)
      ✕ should mark order as paid when payment verified (820 ms)
    Payment Reminder System
      ✕ should send reminder after 30 minutes (792 ms)
      ✕ should send hourly reminders after first 30 minutes (801 ms)
      ✕ should escalate to admin after 4 hours (797 ms)
    Manual Payment Verification (Admin)
      ✓ should allow admin to manually verify payment (816 ms)
    Pickup Ready Notification
      ✓ should send pickup ready notification only after payment verified (816 ms)
      ✕ should not send pickup ready if payment not verified (788 ms)
    Error Handling
      ✓ should handle invalid payment amounts (792 ms)
      ✓ should handle missing order ID in payment confirmation (796 ms)
      ✓ should handle duplicate payment confirmations (812 ms)
    Feature Toggle
      ✓ should use V1 flow when payment_version is v1 (835 ms)
      ✓ should use V2 flow when payment_version is v2 (839 ms)

  ● V2 Payment Flow Integration Tests › V2 Pickup Scheduling › should create order without prepayment for V2 customer

    ValidationError: Order validation failed: customerId: Path `customerId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Link Generation › should generate payment links when order is weighed

    ValidationError: Order validation failed: customerId: Path `customerId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Link Generation › should send payment request email

    TypeError: Cannot read properties of null (reading 'customer')

      268 |       const emailSpy = jest.spyOn(emailService, 'sendV2PaymentRequest');
      269 |       
    > 270 |       await emailService.sendV2PaymentRequest(order, order.customer, {
          |                                                            ^
      271 |         amount: 45.00,
      272 |         links: {
      273 |           venmo: 'venmo://paycharge?txn=pay&recipients=@wavemax&amount=45&note=Order%20' + orderId.slice(-8).toUpperCase(),

      at Object.customer (tests/integration/v2-payment-flow.test.js:270:60)

  ● V2 Payment Flow Integration Tests › Payment Confirmation Flow › should handle customer payment confirmation

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [200, 400]

      306 |         return;
      307 |       }
    > 308 |       expect([200, 400]).toContain(response.status);
          |                          ^
      309 |       if (response.status === 200) {
      310 |         expect(response.body.message).toContain('confirmation');
      311 |       }

      at Object.toContain (tests/integration/v2-payment-flow.test.js:308:26)

  ● V2 Payment Flow Integration Tests › Payment Confirmation Flow › should verify payment through email scanning

    TypeError: Cannot read properties of undefined (reading 'slice')

      322 |         from: 'payments@venmo.com',
      323 |         subject: 'Payment received from V2Test Customer',
    > 324 |         text: `You received $45.00 from V2Test Customer. Note: Order ${orderId.slice(-8).toUpperCase()}`,
          |                                                                                ^
      325 |         date: new Date()
      326 |       };
      327 |

      at Object.slice (tests/integration/v2-payment-flow.test.js:324:80)

  ● V2 Payment Flow Integration Tests › Payment Confirmation Flow › should mark order as paid when payment verified

    TypeError: Cannot set properties of null (setting 'v2PaymentStatus')

      339 |       // Simulate payment verification
      340 |       const order = await Order.findById(orderId);
    > 341 |       order.v2PaymentStatus = 'verified';
          |                            ^
      342 |       order.v2PaymentConfirmedAt = new Date();
      343 |       order.v2PaymentMethod = 'venmo';
      344 |       order.v2PaymentAmount = 45.00;

      at Object.<anonymous> (tests/integration/v2-payment-flow.test.js:341:28)

  ● V2 Payment Flow Integration Tests › Payment Reminder System › should send reminder after 30 minutes

    ValidationError: Order validation failed: customerId: Path `customerId` is required., status: `weighed` is not a valid enum value for path `status`.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Reminder System › should send hourly reminders after first 30 minutes

    ValidationError: Order validation failed: customerId: Path `customerId` is required., status: `weighed` is not a valid enum value for path `status`.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Reminder System › should escalate to admin after 4 hours

    ValidationError: Order validation failed: customerId: Path `customerId` is required., status: `weighed` is not a valid enum value for path `status`.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Pickup Ready Notification › should not send pickup ready if payment not verified

    ValidationError: Order validation failed: customerId: Path `customerId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:24.115Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:25.137Z"}
  console.log
    CSRF token generation: {
      sessionID: '5610cb6a432ea40d67198b636d6ebe0e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: D6QClqNW-BVXZ25YkGWb7b1Mu_07_D-9K10E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5610cb6a432ea40d67198b636d6ebe0e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: syJSHoyMuw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.676 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:25.277Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 208.922 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:25.697Z"}
[0mGET /api/v1/administrators [32m200[0m 124.848 ms - 865[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:26.888Z"}
  console.log
    CSRF token generation: {
      sessionID: '6f44bf4efe6a20271c3f3068928de0e8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HXhaEQn4-DxRLSMO_d6oMiN3ris7owpXFrc8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6f44bf4efe6a20271c3f3068928de0e8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 0FmHf1j21T...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.363 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:27.008Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.121 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators?active=true {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:27.248Z"}
[0mGET /api/v1/administrators?active=true [32m200[0m 117.699 ms - 376[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:28.328Z"}
  console.log
    CSRF token generation: {
      sessionID: '0f8767087654b77fdebbd2013201f278',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eK48R92Y-p6Dikfqn1E__jeyWGpxNWvne548

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0f8767087654b77fdebbd2013201f278

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NfGQENDd_7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.640 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:28.438Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.947 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators?page=2&limit=5 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:29.518Z"}
[0mGET /api/v1/administrators?page=2&limit=5 [32m200[0m 113.900 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:30.626Z"}
  console.log
    CSRF token generation: {
      sessionID: '124dcbb8e927ce33d667c996e85e34f4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: cax74lz2-EGgvLVbrVqWuCmqNrctTZlQ0yrw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 124dcbb8e927ce33d667c996e85e34f4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1_0HBkfuXT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.572 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:30.724Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.448 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:30.873Z"}
[0mGET /api/v1/administrators [33m401[0m 1.117 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:31.776Z"}
  console.log
    CSRF token generation: {
      sessionID: '90f600c79666e8f13be760ac91ce6540',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9xHs0rkN-UNVnaYk9dG-KX2iaoOBtvnzlhaQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 90f600c79666e8f13be760ac91ce6540

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 63HReCaAfh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.085 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:31.881Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 168.343 ms - 615[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:32.098Z"}
[0mPOST /api/v1/auth/customer/login [33m401[0m 85.969 ms - 64[0m
  console.log
    Customer login failed: { success: false, message: 'Invalid username/email or password' }

      at Object.log (tests/integration/administrator.test.js:221:17)

[34mdebug[39m: GET /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:32.193Z"}
[0mGET /api/v1/administrators [33m401[0m 1.212 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:33.153Z"}
  console.log
    CSRF token generation: {
      sessionID: '2224fe0b6d70f6cd793ae4ff222fb1b9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: f1x5sbO9-LLaBe_c4w-wMapZmho9eLOc8-as

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2224fe0b6d70f6cd793ae4ff222fb1b9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: UrdVZm1HPw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.446 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:33.254Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.590 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/68b6ecc9313e6679f4f33371 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:33.492Z"}
[0mGET /api/v1/administrators/68b6ecc9313e6679f4f33371 [32m200[0m 84.515 ms - 283[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:34.527Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd877b8e9ca1c196c47df84699e924c08',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: PxaX18LW-vuyMaVP1iGejeSq-K-fltKId_7s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d877b8e9ca1c196c47df84699e924c08

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QKuFH9U_9u...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.426 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:34.630Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 155.432 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/68b6ecca313e6679f4f3339e {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:34.789Z"}
[0mGET /api/v1/administrators/68b6ecca313e6679f4f3339e [33m404[0m 84.833 ms - 53[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:35.809Z"}
  console.log
    CSRF token generation: {
      sessionID: '188265fe21b13e82500e621cde040946',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nOWRHWfS-Pg81cuPlW3a03HPCMmaEJlPYzrE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 188265fe21b13e82500e621cde040946

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5xnj7UPvcj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.062 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:35.902Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.494 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/invalid-id {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:36.057Z"}
[0mGET /api/v1/administrators/invalid-id [33m400[0m 59.986 ms - 54[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:37.067Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c2921879d739e395dc01e4ce53342773',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: O3U8p8AK-tnS7gTrfnNl8R0WsO2Mn58_20jk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c2921879d739e395dc01e4ce53342773

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: MBRDb3UIm7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.884 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:37.162Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 165.097 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:37.330Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'c2921879d739e395dc01e4ce53342773',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac2921879d739e395dc01e4ce53342773.9jGrWU93Jjc6oXVGp3co2ZzIJW2JRzL6uK6%2BLKGnOJQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [32m201[0m 208.296 ms - 329[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:37.543Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 144.238 ms - 677[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:38.635Z"}
  console.log
    CSRF token generation: {
      sessionID: '0a6f5d5e408ae1644df9821743224185',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: XSH8h7HZ-U9gxyynTUntFa5FHPSyUd266nYU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0a6f5d5e408ae1644df9821743224185

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: RkhG2-xagv...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.315 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:38.768Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 164.874 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:38.936Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '0a6f5d5e408ae1644df9821743224185',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A0a6f5d5e408ae1644df9821743224185.SoclpggUQ2YmgYzN2FLYj8OP0VmvKidGHTKRPNo8yq4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 58.798 ms - 309[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:40.207Z"}
  console.log
    CSRF token generation: {
      sessionID: 'af9b08045e37fdb35f6d9611412cdab4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 19bDhbBx--gfytDFWB52Ha-mQ5xPmiy1gOIc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: af9b08045e37fdb35f6d9611412cdab4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: eBAp-MTQoL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.393 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:40.316Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 146.265 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:40.465Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'af9b08045e37fdb35f6d9611412cdab4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaf9b08045e37fdb35f6d9611412cdab4.g%2FsK7yVyL5xq0n3Rb4qLjsjagWP59ct3wad6KZa4bKA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 58.236 ms - 170[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:41.433Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c60f2de7ff5f10cf1e87f31ca5017b9d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: zDocbChI-EfxGO9BL6XiAsUg6WJZmjR1X_4U

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c60f2de7ff5f10cf1e87f31ca5017b9d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 3NcGMlHHSd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.979 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:41.532Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.588 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:41.679Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'c60f2de7ff5f10cf1e87f31ca5017b9d',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac60f2de7ff5f10cf1e87f31ca5017b9d.hCo1ziYqgBkU%2BbYpl9LTVZ54X0u7hhn%2BRAktLB3mGU4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 69.204 ms - 204[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:42.661Z"}
  console.log
    CSRF token generation: {
      sessionID: '196d68f1145b4711b686bf68bd96f3e2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JAixEIW5-dI7A6CObAHdjdfOo8YL6M23ndag

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 196d68f1145b4711b686bf68bd96f3e2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: iwoxA7AW0b...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.656 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:42.766Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.202 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:42.919Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '196d68f1145b4711b686bf68bd96f3e2',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A196d68f1145b4711b686bf68bd96f3e2.UjqpbYAynQ790EYani29oM0QLCtVJXeAKN7iyiNW26g',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m409[0m 84.458 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:43.910Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd21e0cc1a37885278d1ca55a3f4223f8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DP4XGodj-M64CrtY_jnXiOnXKaemLwDOdB-c

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d21e0cc1a37885278d1ca55a3f4223f8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9o11e2mOKW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.481 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:44.026Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 153.604 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:44.270Z"}
  console.log
    CSRF token generation: {
      sessionID: 'bec64af4b9d041abec284f4225791b27',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZhUOds9b-y9MiMy3gEeXkl4OLqG4QKMQ-Qzc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: bec64af4b9d041abec284f4225791b27

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: EPTY3mSnJj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.014 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:44.280Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 144.788 ms - 649[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:44.427Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'bec64af4b9d041abec284f4225791b27',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Abec64af4b9d041abec284f4225791b27.U1N6k3m3BshjXIVH6gHgfVVGAEsx7R6mt%2BOR%2B2aX7iI',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m403[0m 57.255 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:45.410Z"}
  console.log
    CSRF token generation: {
      sessionID: '4fa24be2abac2aeaf563b9a66a989a0e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gHmi0xwZ-NW6S_Q2qBSXiC_DbO6ahVz5QTFM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4fa24be2abac2aeaf563b9a66a989a0e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Zt0THy9oZ-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.421 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:45.524Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 158.336 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecd5313e6679f4f334ff {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:45.775Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecd5313e6679f4f334ff {
      sessionID: '4fa24be2abac2aeaf563b9a66a989a0e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A4fa24be2abac2aeaf563b9a66a989a0e.747C2TyKgAkP%2FDyfvInRR0MpBydb8wqvclDrYgsJCKQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecd5313e6679f4f334ff [32m200[0m 95.270 ms - 337[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:46.778Z"}
  console.log
    CSRF token generation: {
      sessionID: '9762cddf2864920a65af966d7f06d692',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: QUHKZHu8-Il4YVjpzzLA95sR_M6qIeYbBGvs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9762cddf2864920a65af966d7f06d692

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: BL2DPXts9Y...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.439 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:46.876Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.381 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecd7313e6679f4f3352c {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:47.116Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecd7313e6679f4f3352c {
      sessionID: '9762cddf2864920a65af966d7f06d692',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A9762cddf2864920a65af966d7f06d692.EUfKQx%2FsJkoR5Hf3meLwePVfNbTWQqyKIAFO2wUloEA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecd7313e6679f4f3352c [32m200[0m 116.117 ms - 318[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:48.139Z"}
  console.log
    CSRF token generation: {
      sessionID: '3922f87afa8548c6252b9e18b3b08988',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: wxZrbM3c-3La75VvV0YpazZ4DQ1vVFa-lqOw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3922f87afa8548c6252b9e18b3b08988

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: r1juXn93zn...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.677 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:48.232Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.362 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecd8313e6679f4f3355a {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:48.476Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecd8313e6679f4f3355a {
      sessionID: '3922f87afa8548c6252b9e18b3b08988',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A3922f87afa8548c6252b9e18b3b08988.SmWP95qNmg330AJY8M%2FXKScpI1XIco1i2%2FaGOcCjGhM',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecd8313e6679f4f3355a [32m200[0m 143.365 ms - 316[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:48.622Z"}
  console.log
    CSRF token generation: {
      sessionID: '3d8e5bd4156f40d8c23eecf8433eb1db',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: r2hPPrLV-2wovbAqVZjGYcj_yQwJ5dC0MBk0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3d8e5bd4156f40d8c23eecf8433eb1db

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ThsxRHYdQh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.297 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:48.632Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 164.074 ms - 645[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:49.703Z"}
  console.log
    CSRF token generation: {
      sessionID: '2cc1dd2be9fcd0bcca14324efd12e75e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ws1xBReb-uHY3Q4jq7EW7Pz8Zx1ADj_QyK_s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2cc1dd2be9fcd0bcca14324efd12e75e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 6kM3iBl1Ln...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.682 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:49.801Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.917 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecda313e6679f4f3358b {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:50.044Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecda313e6679f4f3358b {
      sessionID: '2cc1dd2be9fcd0bcca14324efd12e75e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A2cc1dd2be9fcd0bcca14324efd12e75e.DKMeK2BtXlFqR86IDKyNdAGlvufmeZD9V6RHB1takZY',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecda313e6679f4f3358b [32m200[0m 88.617 ms - 317[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:50.135Z"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 27.757 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:51.065Z"}
  console.log
    CSRF token generation: {
      sessionID: '46996c16d56a32046348b58cc3ecbd67',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: bUM9CKLH-9fLsq2xf8yLKPVsufRhggrj603Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 46996c16d56a32046348b58cc3ecbd67

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: x6KFZ710Ci...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.621 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:51.166Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.638 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecdb313e6679f4f335b9 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:51.403Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecdb313e6679f4f335b9 {
      sessionID: '46996c16d56a32046348b58cc3ecbd67',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A46996c16d56a32046348b58cc3ecbd67.QtGHsQbiaft7ssYXMNHH%2Bll49y6hZw2FdpoxCKL5c9Y',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecdb313e6679f4f335b9 [32m200[0m 83.652 ms - 316[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:52.383Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b0c13cd094abf4a10c245bcbbd0e1b2b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xjVkXJuv-LCFmshrZU5CmHFJPYglCyMgSSkg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b0c13cd094abf4a10c245bcbbd0e1b2b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 3vM413wIrd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.628 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:52.480Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.076 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecdc313e6679f4f335e6 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:52.722Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecdc313e6679f4f335e6 {
      sessionID: 'b0c13cd094abf4a10c245bcbbd0e1b2b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ab0c13cd094abf4a10c245bcbbd0e1b2b.eJuZV7Q1j9cJUzrXdzBUwsPkxAQTKVcQrnQ31VVYSKc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecdc313e6679f4f335e6 [33m409[0m 85.492 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:53.703Z"}
  console.log
    CSRF token generation: {
      sessionID: '81de237b45505a25bde3b1f2e0d456a3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JBActpeS-ax3aoL-8DxfKZiRe7vw7UxRi_Vs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 81de237b45505a25bde3b1f2e0d456a3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Jq4DPjDOsO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.009 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:53.799Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.218 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecdd313e6679f4f3360d {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:54.046Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecdd313e6679f4f3360d {
      sessionID: '81de237b45505a25bde3b1f2e0d456a3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A81de237b45505a25bde3b1f2e0d456a3.2ekRztkGKiHkjwRwKWO%2Ft1YW48F93cWMZVIBo4EvYpY',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecdd313e6679f4f3360d [33m400[0m 57.760 ms - 64[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:55.027Z"}
  console.log
    CSRF token generation: {
      sessionID: '1fa3e58c43aca55d04397f35b3a83cc4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Hz08NgI0-MaxGgx5ZUo5CtJ_49npAdd8mMlY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1fa3e58c43aca55d04397f35b3a83cc4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: DqG82gsNHC...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.375 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:55.122Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 146.894 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:55.447Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ac23a95fa812cb160e01b02016a474eb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9uskJD5N-dECHPR7a-aoFk2y0wZmyJ1NpypI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ac23a95fa812cb160e01b02016a474eb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: skbkO2Cvg6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.104 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:55.456Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.391 ms - 650[0m
[34mdebug[39m: PATCH /api/v1/administrators/68b6ecdf313e6679f4f3363f {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:55.604Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecdf313e6679f4f3363f {
      sessionID: 'ac23a95fa812cb160e01b02016a474eb',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aac23a95fa812cb160e01b02016a474eb.ImTrAnHNstfcZvgPL374EYXuhwaQBAV2cQNQk4BYPIc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68b6ecdf313e6679f4f3363f [33m403[0m 56.132 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:56.558Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd25dada5f4afb084cdbfd975b25fb38e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tkhfmYQo-NtivEy-VvRY1pnAytrD4t8ka8GI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d25dada5f4afb084cdbfd975b25fb38e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XyWV_QTWRT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.310 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:56.662Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.254 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68b6ece0313e6679f4f33671 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:56.908Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ece0313e6679f4f33671 {
      sessionID: 'd25dada5f4afb084cdbfd975b25fb38e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad25dada5f4afb084cdbfd975b25fb38e.2Ec3eztCv5m6tdgzIEQilQEK7HZ3w8G0aLVT3V0yxCE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68b6ece0313e6679f4f33671 [32m200[0m 116.964 ms - 63[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:57.951Z"}
  console.log
    CSRF token generation: {
      sessionID: '562e0cd641bdfcc5d3daea2f892ac324',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nqmsWb8w-hbfFX_5LYAepBxduRUIpJ3GEUhk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 562e0cd641bdfcc5d3daea2f892ac324

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: hMJFLNLLUu...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.710 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:58.054Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.974 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68b6ece2313e6679f4f3369a {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:58.294Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ece2313e6679f4f3369a {
      sessionID: '562e0cd641bdfcc5d3daea2f892ac324',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A562e0cd641bdfcc5d3daea2f892ac324.Ap2wahnI2nipT%2FVG188cDqbRwUEP125rwP2vuJcnR8o',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68b6ece2313e6679f4f3369a [33m400[0m 57.693 ms - 60[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:59.260Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fd5eb57539a0c3090768b76bf11648c6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3H649T4e-8d2q2ItKDyXine_1MSYQghLDqEQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fd5eb57539a0c3090768b76bf11648c6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Xciy4C025u...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.425 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:59.357Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.513 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68b6ece3313e6679f4f336c6 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:10:59.623Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ece3313e6679f4f336c6 {
      sessionID: 'fd5eb57539a0c3090768b76bf11648c6',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Afd5eb57539a0c3090768b76bf11648c6.MVVSazOEt59QNaIZ7D0OGuPWdJchSgJHlh39%2FL6Eofo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68b6ece3313e6679f4f336c6 [33m400[0m 56.856 ms - 60[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:00.595Z"}
  console.log
    CSRF token generation: {
      sessionID: '292ef177622f371eaff67d8831a1b799',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: GeE2M9k2-NNpkPOhcoVVWc2Wl3xHEZk1ORM4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 292ef177622f371eaff67d8831a1b799

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VzWaDJjexg...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.283 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:00.692Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.836 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:01.031Z"}
  console.log
    CSRF token generation: {
      sessionID: '13118b86b699f8e058189ebb41214dc8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 16opFfiQ-2pcxP35jQUPuQF0CL52ZqILP1w4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 13118b86b699f8e058189ebb41214dc8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 4430HaGB9u...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.662 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:01.040Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.811 ms - 655[0m
[34mdebug[39m: DELETE /api/v1/administrators/68b6ece4313e6679f4f336f9 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:01.187Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ece4313e6679f4f336f9 {
      sessionID: '13118b86b699f8e058189ebb41214dc8',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A13118b86b699f8e058189ebb41214dc8.qvxUVbgvxcjvbotUupUqIuMdGmqi0o4mwNY3heBY5%2Fs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68b6ece4313e6679f4f336f9 [33m403[0m 57.842 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:02.146Z"}
  console.log
    CSRF token generation: {
      sessionID: '200270a13d7976b23fdf7cd1cd3ee7c1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NoxMV2Gd-g3uwHg9uyN19QwxH6GBIFCKpCWY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 200270a13d7976b23fdf7cd1cd3ee7c1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: cHAwEDm2Dj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.768 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:02.247Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.276 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68b6ece6313e6679f4f3372d {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:02.483Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ece6313e6679f4f3372d {
      sessionID: '200270a13d7976b23fdf7cd1cd3ee7c1',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A200270a13d7976b23fdf7cd1cd3ee7c1.AREpEZ0%2FghyBMOVTPwAXTvUJm%2BqL8agE9yG8mCFCaDU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68b6ece6313e6679f4f3372d [33m404[0m 110.630 ms - 53[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:03.549Z"}
  console.log
    CSRF token generation: {
      sessionID: '258ae8859054be4017caa3f7eee880bf',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HyvjsTan-HqUSmhzUPSX7KMzkzFwQqwTuzpc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 258ae8859054be4017caa3f7eee880bf

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lR3AKVb2Au...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.393 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:03.648Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 157.451 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators/68b6ece7313e6679f4f3375a/reset-password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:03.895Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ece7313e6679f4f3375a/reset-password {
      sessionID: '258ae8859054be4017caa3f7eee880bf',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A258ae8859054be4017caa3f7eee880bf.VbvoB6RtvAe88LnBgebkN%2BenxAcW7WbqLvh6Df8m2OQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68b6ece7313e6679f4f3375a/reset-password [32m200[0m 184.354 ms - 56[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:04.083Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e8b8dc286dbb531d15459ecec8cb883a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jhUiXC04-6Ny3NxZpUUg65SUzU396QsZ-5C8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e8b8dc286dbb531d15459ecec8cb883a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: uTA84BmdB9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.306 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:04.096Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 152.957 ms - 644[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:04.252Z"}
  console.log
    CSRF token generation: {
      sessionID: '30759cd6d30782781e1a796546a60781',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: wBOVJ5en-tz8A1UjQb5Tlg7wWp1S1SpgV3M0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 30759cd6d30782781e1a796546a60781

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Vdcy_sgLlb...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.012 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:04.261Z"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 115.160 ms - 55[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:05.279Z"}
  console.log
    CSRF token generation: {
      sessionID: '9036e2f4d91377f24ed27597f0693cfc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: AUlFdgm9-Svb8-rG3BeoNwaYOc2iPYF6_e88

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9036e2f4d91377f24ed27597f0693cfc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bNQAbY3ytn...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.737 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:05.380Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.793 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators/68b6ece9313e6679f4f3378e/reset-password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:05.645Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ece9313e6679f4f3378e/reset-password {
      sessionID: '9036e2f4d91377f24ed27597f0693cfc',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A9036e2f4d91377f24ed27597f0693cfc.xSbgu0uBKYzdi5eNnpj%2B66sKJto0nAKQHlFIYnZgpGw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68b6ece9313e6679f4f3378e/reset-password [32m200[0m 177.348 ms - 56[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:06.797Z"}
  console.log
    CSRF token generation: {
      sessionID: '7f5883f65bf7382aeb11dc7a937d463e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KxbHpZLr-WMwfiP5H5Zk_wpNYaX9BgPefwZw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7f5883f65bf7382aeb11dc7a937d463e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XARYWc_IO2...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.680 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:06.891Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.717 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators/68b6eceb313e6679f4f337be/reset-password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:07.134Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6eceb313e6679f4f337be/reset-password {
      sessionID: '7f5883f65bf7382aeb11dc7a937d463e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7f5883f65bf7382aeb11dc7a937d463e.YZCEXZ8Q5%2Bz3ptBMiSbKDBA53ueCB1446Rwc%2FmdBKUA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68b6eceb313e6679f4f337be/reset-password [33m400[0m 56.832 ms - 313[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:08.099Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f02aa366625cc85c8cab9d5423c2aff3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: s8Cvi4SX-X-CPOYZIPjNmhLLSpqtSlRQs1oQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f02aa366625cc85c8cab9d5423c2aff3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: HKJIRPShfg...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.429 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:08.192Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 158.942 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:08.539Z"}
  console.log
    CSRF token generation: {
      sessionID: '3dda99b9a6e6f5966df1287202db49f7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: djL2kMRk-dYuTsUW9moE2_CSkNjKnFAKn7Q8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3dda99b9a6e6f5966df1287202db49f7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _huwsxD8Rx...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.831 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:08.548Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 175.720 ms - 650[0m
[34mdebug[39m: POST /api/v1/administrators/68b6ecec313e6679f4f337ea/reset-password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:08.726Z"}
  console.log
    CSRF check for: /api/v1/administrators/68b6ecec313e6679f4f337ea/reset-password {
      sessionID: '3dda99b9a6e6f5966df1287202db49f7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A3dda99b9a6e6f5966df1287202db49f7.gGEtmC74QuBG5SoCsE6hSfMpPM2O33BdWx00BYyGbNo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68b6ecec313e6679f4f337ea/reset-password [33m403[0m 55.980 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:09.688Z"}
  console.log
    CSRF token generation: {
      sessionID: '89e5f5d7b3f04ce5a9d09ae7cb017f46',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: pkBqphpo-UZ71oY0jx_vjBJcMkM4J0vNbUes

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 89e5f5d7b3f04ce5a9d09ae7cb017f46

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: RyDMKRHqbO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.092 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:09.790Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 191.297 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/permissions {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:09.984Z"}
[0mGET /api/v1/administrators/permissions [32m200[0m 29.670 ms - 361[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:10.905Z"}
  console.log
    CSRF token generation: {
      sessionID: '5fc78e1b36b4d9414e461264bc662418',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mNrxGKMd-6It-RFId4iaIcvSvbDqTQ-3HESI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5fc78e1b36b4d9414e461264bc662418

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: f1c2AhKfb3...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.700 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:10.998Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.346 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/permissions {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:11.146Z"}
[0mGET /api/v1/administrators/permissions [33m401[0m 0.964 ms - 47[0m
PASS tests/integration/administrator.test.js (48.926 s)
  Administrator Integration Tests
    GET /api/v1/administrators
      ✓ should get all administrators with admin token (2340 ms)
      ✓ should filter by active status (1442 ms)
      ✓ should support pagination (2304 ms)
      ✓ should require admin authentication (1145 ms)
      ✓ should require administrator permissions (1377 ms)
    GET /api/v1/administrators/:id
      ✓ should get administrator by ID (1370 ms)
      ✓ should return 404 for non-existent administrator (1287 ms)
      ✓ should handle invalid ObjectId (1255 ms)
    POST /api/v1/administrators
      ✓ should create new administrator (1572 ms)
      ✓ should validate required fields (1565 ms)
      ✓ should validate email format (1224 ms)
      ✓ should validate password strength (1236 ms)
      ✓ should prevent duplicate emails (1251 ms)
      ✓ should require administrators.create permission (1477 ms)
    PATCH /api/v1/administrators/:id
      ✓ should update administrator details (1391 ms)
      ✓ should update email (1363 ms)
      ✓ should update password (1559 ms)
      ✓ should deactivate administrator (1366 ms)
      ✓ should not allow updating adminId (1314 ms)
      ✓ should validate email uniqueness on update (1320 ms)
      ✓ should prevent self-deactivation (1327 ms)
      ✓ should require administrators.update permission (1527 ms)
    DELETE /api/v1/administrators/:id
      ✓ should delete administrator (1397 ms)
      ✓ should prevent self-deletion (1306 ms)
      ✓ should prevent deleting last administrator with all permissions (1328 ms)
      ✓ should require administrators.delete permission (1560 ms)
      ✓ should handle non-existent administrator (1393 ms)
    POST /api/v1/administrators/:id/reset-password
      ✓ should reset administrator password (1740 ms)
      ✓ should clear login attempts on password reset (1520 ms)
      ✓ should validate password strength (1299 ms)
      ✓ should require administrators.update permission (1587 ms)
    GET /api/v1/administrators/permissions
      ✓ should get available permissions list (1219 ms)
      ✓ should require authentication (1142 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:12.835Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.870Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd82c7819fb78f4143cccfc11e59b6a78',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: s1SnIp29-aQuKnr3gZf0Twi0UwkXlmzc6y0E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d82c7819fb78f4143cccfc11e59b6a78

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dEDeqNSY-P...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.991 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.882Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

[0mPOST /api/v1/affiliates/register [33m400[0m 7.986 ms - 178[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.904Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.558 ms - 190[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.910Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.093 ms - 190[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.915Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.845 ms - 221[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.919Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.931 ms - 193[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.924Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.593 ms - 198[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.929Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.937 ms - 198[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.935Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.047 ms - 182[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:13.939Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.403 ms - 229[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:14.941Z"}
  console.log
    CSRF token generation: {
      sessionID: 'db6e4a3501e1bae939c7d5b7eb01828c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: msXj4QLx-Hjvf3EmR6LEb-CKgVERSLmTu2m8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: db6e4a3501e1bae939c7d5b7eb01828c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: SdQRLexO8f...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.181 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:14.951Z"}
  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test0@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-d020580f-7ff8-4fe6-96e5-09458b8a6318</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-d020580f-7ff8-4fe6-96e5-09458b8a6318">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-d020580f-7ff8-4fe6-96e5-09458b8a6318</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-d020580f-7ff8-4fe6-96e5-09458b8a6318">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-d020580f-7ff8-4fe6-96e5-09458b8a6318</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 129.888 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:15.084Z"}
  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-c5e208df-6867-42b9-a1ad-4dff2057edb3</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-c5e208df-6867-42b9-a1ad-4dff2057edb3">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-c5e208df-6867-42b9-a1ad-4dff2057edb3</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-c5e208df-6867-42b9-a1ad-4dff2057edb3">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-c5e208df-6867-42b9-a1ad-4dff2057edb3</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 126.923 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:15.214Z"}
  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-72c91451-fc08-4d1b-a963-cb6391e11422</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-72c91451-fc08-4d1b-a963-cb6391e11422">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-72c91451-fc08-4d1b-a963-cb6391e11422</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-72c91451-fc08-4d1b-a963-cb6391e11422">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-72c91451-fc08-4d1b-a963-cb6391e11422</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 121.938 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:15.339Z"}
  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test3@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-d027e415-7d5c-46d5-9892-8fec69fd6e73</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-d027e415-7d5c-46d5-9892-8fec69fd6e73">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-d027e415-7d5c-46d5-9892-8fec69fd6e73</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-d027e415-7d5c-46d5-9892-8fec69fd6e73">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-d027e415-7d5c-46d5-9892-8fec69fd6e73</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 117.532 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:15.459Z"}
  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test4@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-6ce56982-c32d-4dba-a6b1-fd43b9ce85fc</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-6ce56982-c32d-4dba-a6b1-fd43b9ce85fc">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-6ce56982-c32d-4dba-a6b1-fd43b9ce85fc</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-6ce56982-c32d-4dba-a6b1-fd43b9ce85fc">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-6ce56982-c32d-4dba-a6b1-fd43b9ce85fc</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 121.937 ms - 120[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:16.477Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd2effbe46a717d13c6f666d33d0a3039',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: WIO1HSnI-4BWp9txgJbejHyNdx3z_YhPa8vg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d2effbe46a717d13c6f666d33d0a3039

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Dc0BGtdTqY...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.084 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:16.486Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.148 ms - 645[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:17.404Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cf44800d85a2db41440ccf24a1efadc6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vz9cZWrX-AXhl5OTyW2kuG3LnUnQ-IXO17Bg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cf44800d85a2db41440ccf24a1efadc6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QM1TM0DiU-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.280 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:17.413Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.004 ms - 646[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:18.330Z"}
  console.log
    CSRF token generation: {
      sessionID: '83f0b48444ac0e2ffc01ba77f219ad5a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Op04z3F8--UpXTVDm6EGAiPzfHg_Ev7dU2T0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 83f0b48444ac0e2ffc01ba77f219ad5a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: hJ_AtWhicL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.311 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:18.339Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.079 ms - 210[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:18.344Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.622 ms - 211[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:18.348Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.145 ms - 212[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:18.355Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.903 ms - 212[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:19.274Z"}
  console.log
    CSRF token generation: {
      sessionID: '08d86a62b84b46fb98c1114a21b6190e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0WEQ7jfu-u1x32NZbJwJTyPBDV8syYaqVQpo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 08d86a62b84b46fb98c1114a21b6190e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pxzTtw023b...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.302 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:19.431Z"}
[0mPOST /api/v1/customers/register [33m400[0m 2.296 ms - 181[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:20.339Z"}
  console.log
    CSRF token generation: {
      sessionID: 'bf088ed201976eaa96e89cdac5627afb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: S8xQgAZb-rkTeIH746Zq5533NXL9naCHgLA0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: bf088ed201976eaa96e89cdac5627afb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ETR00qBUm4...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.732 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:20.490Z"}
  console.log
    Creating new customer with email: customer2@example.com username: customertest2

      at log (server/controllers/customerController.js:138:13)

  console.log
    Saving customer to database...

      at log (server/controllers/customerController.js:179:13)

  console.log
    Customer saved successfully with ID: CUST-1bb739f6-7006-40ca-8f48-4888b70175d9

      at log (server/controllers/customerController.js:181:13)

  console.log
    Language-specific template not found for en/customer-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Service

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Service</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #ffffff !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .service-box {
          border: 1px solid #e0e0e0;
          border-radius: 4px;
          padding: 15px;
          margin: 20px 0;
          background-color: #f9f9f9;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .steps {
          padding: 0;
        }
        .step {
          display: flex;
          margin-bottom: 15px;
          align-items: flex-start;
        }
        .step-number {
          background-color: #1e3a8a;
          color: #ffffff !important;
          width: 25px;
          height: 25px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          margin-right: 10px;
          flex-shrink: 0;
        }
        .step-content {
          flex: 1;
        }
        .divider {
          height: 1px;
          background-color: #e0e0e0;
          margin: 20px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to WaveMAX Laundry!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Customer,</h2>
            <p>Welcome to WaveMAX Laundry Service! Your account has been successfully created and you're ready to enjoy premium wash, dry, fold laundry services.</p>
          </div>
          
          <div class="highlight">
            <h3>Your Account Information</h3>
            <p><strong>Customer ID:</strong> CUST-1bb739f6-7006-40ca-8f48-4888b70175d9</p>
            <p><strong>Your Service Provider:</strong> Test Affiliate</p>
          </div>
          
          <div class="service-box" style="background-color: #f0f7ff; border: 1px solid #3b82f6;">
            <h3>Your Laundry Bag Credit</h3>
            <p>We've credited your account with prepaid laundry bags. These bags will be delivered to you by your service provider.</p>
            
            <div style="background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 6px; padding: 15px; margin: 15px 0;">
              <h4 style="margin-top: 0; color: #1e3a8a;">Account Credit Details</h4>
              <table style="width: 100%; border-collapse: collapse;">
                <tr>
                  <td style="padding: 5px 0;">Bags Purchased</td>
                  <td style="text-align: right; font-weight: bold;">1</td>
                </tr>
                <tr>
                  <td style="padding: 5px 0;">Cost per Bag</td>
                  <td style="text-align: right;">$10.00</td>
                </tr>
                <tr style="border-top: 2px solid #e0e0e0;">
                  <td style="padding: 8px 0; font-weight: bold; color: #1e3a8a;">Total Account Credit</td>
                  <td style="text-align: right; font-weight: bold; color: #1e3a8a; font-size: 18px;">$10.00</td>
                </tr>
              </table>
            </div>
            
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
              <strong>Note:</strong> This credit will be automatically applied to your first orders. Each bag holds approximately 20-25 lbs of laundry.
            </p>
          </div>
          
          <div class="service-box">
            <h3>How It Works</h3>
            <div class="steps">
              <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                  <strong>Schedule a Pickup</strong>
                  <p>Login to your dashboard and schedule a convenient pickup time.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                  <strong>Prepare Your Laundry</strong>
                  <p>Place your laundry in the provided bags. Your service provider will pick them up.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                  <strong>We Do the Rest</strong>
                  <p>Your laundry is professionally washed, dried, and folded at our facility.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                  <strong>Delivery to Your Door</strong>
                  <p>Your clean, fresh laundry is delivered back to you, usually within 24-48 hours.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="divider"></div>
          
          <div class="section">
            <h3>Ready to Schedule Your First Pickup?</h3>
            <p>Click the button below to access your dashboard and schedule your first pickup.</p>
            <div style="text-align: center; margin: 20px 0;">
              <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule Pickup</a>
            </div>
            <p style="text-align: center; color: #1e3a8a; font-style: italic;">Remember: Your account has been credited for your prepaid bags!</p>
          </div>
          
          <div class="section">
            <h3>Questions?</h3>
            <p>Your service provider is here to help! Feel free to reach out:</p>
            <p><strong>Name:</strong> Test Affiliate<br>
            <strong>Phone:</strong> +1234567890<br>
            <strong>Email:</strong> testaffiliate2@example.com</p>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Access your customer dashboard anytime to manage orders and track deliveries.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="background-color: #3b82f6;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team.</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Customer welcome email sent successfully to: customer2@example.com

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1130:13)

  console.log
    Language-specific template not found for en/affiliate-new-customer, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: testaffiliate2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Customer Registration

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Customer Registration</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f4f4f4;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background-color: #1e3a8a;
                color: #ffffff;
                padding: 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 28px;
            }
            .content {
                padding: 40px 30px;
            }
            .content h2 {
                color: #1e3a8a;
                font-size: 24px;
                margin-bottom: 20px;
            }
            .info-box {
                background-color: #f0f7ff;
                border-left: 4px solid #3b82f6;
                padding: 20px;
                margin: 20px 0;
            }
            .customer-details {
                background-color: #f9f9f9;
                padding: 20px;
                border-radius: 8px;
                margin: 20px 0;
            }
            .customer-details h3 {
                color: #1e3a8a;
                margin-top: 0;
            }
            .detail-row {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e0e0e0;
            }
            .detail-row:last-child {
                border-bottom: none;
            }
            .detail-label {
                font-weight: bold;
                color: #555;
            }
            .button {
                display: inline-block;
                background-color: #ffffff !important;
                color: #ffffff !important;
                padding: 12px 30px;
                text-decoration: none !important;
                border-radius: 6px;
                font-weight: bold;
                margin: 20px 0;
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .footer {
                background-color: #f8f9fa;
                padding: 20px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #3b82f6;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Customer Registration!</h1>
            </div>
            
            <div class="content">
                <h2>Congratulations, [BUSINESS_NAME]!</h2>
                
                <p>Great news! A new customer has just registered through your affiliate link.</p>
                
                <div class="info-box">
                    <strong>Action Required:</strong> Please deliver 1 laundry bag(s) to your new customer within 48 hours.
                    <br><small>Note: This customer received their first bag FREE as part of our promotional offer.</small>
                </div>
                
                <div class="customer-details">
                    <h3>Customer Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Customer ID:</span>
                        <span>CUST-1bb739f6-7006-40ca-8f48-4888b70175d9</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span>
                        <span>Customer Test</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span>customer2@example.com</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span>
                        <span>+1234567890</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span>
                        <span>456 Customer St, Austin, TX 78701</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Service Frequency:</span>
                        <span>weekly</span>
                    </div>
                </div>
                
                <h3>Next Steps:</h3>
                <ol><li>Contact the customer to arrange bag delivery</li><li>Deliver <strong>1</strong> laundry bag(s) they purchased during registration</li><li>Explain the pickup and delivery process</li><li>Schedule their first pickup if requested</li><li>Remind them that bag fees will be credited on their first order</li></ol>
                
                <center>
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate&customer=CUST-1bb739f6-7006-40ca-8f48-4888b70175d9" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Customer in Dashboard</a>
                </center>
                
                <p>Remember: Providing excellent service from the start helps ensure customer retention and positive reviews!</p>
            </div>
            
            <div class="footer">
                <p>This email was sent by WaveMAX Laundry Affiliate Program</p>
                <p>Questions? Contact us at <a href="mailto:support@wavemax.promo">support@wavemax.promo</a></p>
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/customers/register [32m201[0m 237.667 ms - 867[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:21.628Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a98969e00f9c69f71d34efd6a750efbe',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: EEci65Ml-Fks64kYN5s004vf5jK9DFc-kszQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a98969e00f9c69f71d34efd6a750efbe

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Xr-PjiHR9H...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.465 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:21.730Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:21.880Z","userType":"administrator","username":"setup@example.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:21.881Z","userId":"68b6ecf9d0e1f81ef7108e31","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 150.849 ms - 656[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:21.884Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'a98969e00f9c69f71d34efd6a750efbe',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa98969e00f9c69f71d34efd6a750efbe.vsU2M8bQ0LEHpWWqnhRMpnzjN8moY7iZU%2BLpKhRtkCg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 58.061 ms - 207[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:22.854Z"}
  console.log
    CSRF token generation: {
      sessionID: '376fa1ed0cd261b5c5529420578793f0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vGqm3Qod-McEp5zrlLcCTYCCJTDv82KCrbiA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 376fa1ed0cd261b5c5529420578793f0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: MsXnQJsYA8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.526 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:22.955Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:23.103Z","userType":"administrator","username":"setup@example.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:23.103Z","userId":"68b6ecfad0e1f81ef7108e5b","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.724 ms - 656[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:23.107Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '376fa1ed0cd261b5c5529420578793f0',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A376fa1ed0cd261b5c5529420578793f0.%2FRKX1ga%2BDc%2BMlZ6gOdh111Cvr8x6tMgNl8smHdRNMp4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"CREATE_ADMINISTRATOR","details":{"adminId":"ADM002","email":"newuser@example.com"},"eventType":"ACCOUNT_CREATED","ip":"::ffff:127.0.0.1","method":"POST","path":"/","targetId":"68b6ecfbd0e1f81ef7108e65","targetType":"administrator","timestamp":"2025-09-02T13:11:23.348Z","userId":"68b6ecfad0e1f81ef7108e5b","userRole":"administrator","userType":"administrator"}
[0mPOST /api/v1/administrators [32m201[0m 241.592 ms - 341[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:24.248Z"}
  console.log
    CSRF token generation: {
      sessionID: '00092dec0cdb7ca9ca63f2ebd47bfdc0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: phwEdhwb-H1XgWsxj2RCcmzSmatkreknq7rE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 00092dec0cdb7ca9ca63f2ebd47bfdc0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fWfDn0uWPh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.134 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:24.356Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:24.507Z","userType":"administrator","username":"opsetup@example.com"}
info: undefined {"adminId":"ADMIN002","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:24.508Z","userId":"68b6ecfcd0e1f81ef7108e89","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.475 ms - 646[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:24.513Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '00092dec0cdb7ca9ca63f2ebd47bfdc0',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A00092dec0cdb7ca9ca63f2ebd47bfdc0.718pNzc8WxAhWQ7SVrC6W4Hrz24BOqsPGa9%2B%2BYz7DVw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 62.270 ms - 207[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:25.500Z"}
  console.log
    CSRF token generation: {
      sessionID: '64c5705403363b8129e30fca87e6a864',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ozr31K6R--94vE2TX8Ph2dUS7oZZqf0D--Zk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 64c5705403363b8129e30fca87e6a864

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: i8jZal5gLL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 13.167 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:25.689Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:25.855Z","userType":"administrator","username":"opsetup@example.com"}
info: undefined {"adminId":"ADMIN002","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:25.855Z","userId":"68b6ecfdd0e1f81ef7108eb3","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 165.971 ms - 646[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:25.858Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '64c5705403363b8129e30fca87e6a864',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A64c5705403363b8129e30fca87e6a864.K31Zkf%2Fz%2FOWHC80gqQXiAvunTV3YbFZtI1tLvBUHw6Q',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/operator-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: newoperator@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Operations Team

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Welcome to WaveMAX Operations Team</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                padding: 40px 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 32px;
                font-weight: 700;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .header p {
                margin: 10px 0 0;
                font-size: 18px;
                opacity: 0.9;
            }
            .content {
                padding: 40px 30px;
            }
            .greeting {
                font-size: 20px;
                color: #27ae60;
                margin-bottom: 20px;
                font-weight: 600;
            }
            .credentials-box {
                background-color: #e8f8f5;
                border: 2px solid #2ecc71;
                border-radius: 8px;
                padding: 25px;
                margin: 30px 0;
                text-align: center;
            }
            .credentials-title {
                font-size: 18px;
                font-weight: 600;
                color: #27ae60;
                margin-bottom: 15px;
            }
            .credential-item {
                margin: 15px 0;
                font-size: 16px;
            }
            .credential-label {
                font-weight: 600;
                color: #333;
            }
            .credential-value {
                display: block;
                font-size: 24px;
                color: #2c3e50;
                font-weight: 700;
                margin-top: 5px;
                letter-spacing: 2px;
            }
            .pin-highlight {
                background-color: #f1c40f;
                padding: 5px 15px;
                border-radius: 6px;
                display: inline-block;
            }
            .info-grid {
                display: table;
                width: 100%;
                margin: 20px 0;
            }
            .info-row {
                display: table-row;
            }
            .info-label {
                display: table-cell;
                padding: 10px 15px;
                font-weight: 600;
                color: #27ae60;
                width: 40%;
                vertical-align: top;
            }
            .info-value {
                display: table-cell;
                padding: 10px 15px;
                color: #333;
            }
            .button-container {
                text-align: center;
                margin: 40px 0;
            }
            .button {
                display: inline-block;
                padding: 16px 40px;
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                text-decoration: none !important;
                border-radius: 8px;
                font-size: 18px;
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .important-notes {
                background-color: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
            }
            .important-notes h3 {
                color: #856404;
                margin-bottom: 10px;
            }
            .important-notes ul {
                margin: 10px 0;
                padding-left: 20px;
            }
            .important-notes li {
                margin: 5px 0;
                color: #856404;
            }
            .footer {
                background-color: #f8f9fa;
                padding: 30px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #2ecc71;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Welcome to WaveMAX Operations</h1>
                <p>Your Operator Account is Ready</p>
            </div>
            
            <div class="content">
                <div class="greeting">
                    Welcome aboard, Worker!
                </div>
                
                <p>We're excited to have you join the WaveMAX operations team. Your operator account has been created and you're ready to start processing orders.</p>
                
                <div class="credentials-box">
                    <div class="credentials-title">Your Login Credentials</div>
                    <div class="credential-item">
                        <span class="credential-label">Employee ID:</span>
                        <span class="credential-value">OPRMF2KHHQCC6F1AD</span>
                    </div>
                    <div class="credential-item">
                        <span class="credential-label">Temporary PIN:</span>
                        <span class="credential-value pin-highlight">SecureM@ster7!9K</span>
                    </div>
                </div>
                
                <div class="info-grid">
                    <div class="info-row">
                        <div class="info-label">Email:</div>
                        <div class="info-value">newoperator@example.com</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Shift Hours:</div>
                        <div class="info-value">Not specified</div>
                    </div>
                </div>
                
                <div class="button-container">
                    <a href="https://wavemax.promo/embed-app-v2.html?login=operator" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to Operator Portal</a>
                </div>
                
                <div class="important-notes">
                    <h3>Important Information:</h3>
                    <ul><li>Change your PIN on first login</li><li>You can only login during your assigned shift hours</li><li>Keep your PIN confidential - never share it with anyone</li><li>Clock in at the start of your shift and clock out when finished</li><li>Contact your supervisor if you have any questions</li></ul>
                </div>
                
                <p>If you need assistance or have questions about your account, please contact your supervisor or the administrator.</p>
            </div>
            
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This email contains confidential login information. Please keep it secure.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

info: undefined {"action":"CREATE_OPERATOR","details":{"email":"newoperator@example.com","operatorId":"OPRMF2KHHQCC6F1AD"},"ip":"::ffff:127.0.0.1","method":"POST","path":"/","targetId":"68b6ecfdd0e1f81ef7108ebc","targetType":"operator","timestamp":"2025-09-02T13:11:26.052Z","userId":"68b6ecfdd0e1f81ef7108eb3","userRole":"administrator","userType":"administrator"}
[0mPOST /api/v1/operators [32m201[0m 194.580 ms - 416[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:26.953Z"}
  console.log
    CSRF token generation: {
      sessionID: '514c76b909fde0e02b06b3f3b796da7d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 5UkHfml7-RnbwtYz-lOHVlERbLjLBs-Lc9fw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 514c76b909fde0e02b06b3f3b796da7d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5kVF0-ZcQG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.338 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/reset-password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:27.087Z"}
[0mPOST /api/v1/auth/reset-password [33m400[0m 2.210 ms - 104[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:28.005Z"}
  console.log
    CSRF token generation: {
      sessionID: 'bd4fa5723f926cb2fc8dcc3f7a57a38a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: OX3DyMMy-1e5jmY9XDc_e__uaNB9MZ_2St9Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: bd4fa5723f926cb2fc8dcc3f7a57a38a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: H8dRYtMTvG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.624 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/reset-password {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:28.140Z"}
[0mPOST /api/v1/auth/reset-password [32m200[0m 113.977 ms - 65[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:29.182Z"}
  console.log
    CSRF token generation: {
      sessionID: '46747b691d695de4bc0b1625bcb7d104',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6uZWFBoU-Ys6D1sAtRHO_CqQ8DLoPlz9XMRY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 46747b691d695de4bc0b1625bcb7d104

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rhbvwlZcV2...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.402 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:29.282Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:29.446Z","userType":"affiliate","username":"logintest"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 164.743 ms - 630[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:30.395Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cd3cf4571df5404f527ea56dfb354ef0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kTgYAG67-jKZGi-_NlFe6BvwJU5RX88nN-ZU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cd3cf4571df5404f527ea56dfb354ef0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VYkKxZ5aNN...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.448 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:30.406Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 3.178 ms - 643[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:31.300Z"}
  console.log
    CSRF token generation: {
      sessionID: '5dfdf73f0b8897b48a29054c9d591255',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: GW4rTJWd-tMZAlBI3C1hZ_Sbn_yPsmlBSIYs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5dfdf73f0b8897b48a29054c9d591255

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dgfWmbnf3Z...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.499 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:31.310Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.933 ms - 664[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:32.210Z"}
  console.log
    CSRF token generation: {
      sessionID: '80766dd44fdc25f4d3bb3892cd8959d8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: PiDwoJFn-X_Fh9q4YjZ_izyQ0I4pu99SKgc8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 80766dd44fdc25f4d3bb3892cd8959d8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: iCCoFS4c-f...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.254 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:32.219Z"}
  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: mixed@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemax.promo/wp-content/themes/wavemax-laundry/assets/img/logo-white.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Mixed,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>⚠️ IMPORTANT: W-9 Form Required</h3>
            <p><strong>Action Required Before Payments Can Be Processed</strong></p>
            <p>To comply with IRS regulations and enable payment processing, you must submit a completed W-9 form:</p>
            <ul>
              <li>Download the official W-9 form from: https://www.irs.gov/pub/irs-pdf/fw9.pdf</li>
              <li>Complete all required fields including your taxpayer identification number</li>
              <li>Log in to your affiliate dashboard</li>
              <li>Navigate to "Tax Information" and upload your completed W-9</li>
            </ul>
            <p>Note: The W-9 form must be obtained directly from the IRS website to ensure you have the current version.</p>
            <p>For technical support with uploading, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-4b7e4b99-5dd1-4896-affb-8c864fa1c406</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-4b7e4b99-5dd1-4896-affb-8c864fa1c406">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-4b7e4b99-5dd1-4896-affb-8c864fa1c406</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-4b7e4b99-5dd1-4896-affb-8c864fa1c406">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-4b7e4b99-5dd1-4896-affb-8c864fa1c406</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 118.584 ms - 120[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:33.253Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e6b02bf2442cc6dd9fa8a7db06678719',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: OgUGPMEZ-ODfvEmGK31la4bJoIbOkOpBmoG0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e6b02bf2442cc6dd9fa8a7db06678719

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5py1_nonY9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.085 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:33.263Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.230 ms - 510[0m
PASS tests/integration/passwordValidation.test.js (22.19 s)
  Password Validation Integration Tests
    Affiliate Registration Password Validation
      ✓ should reject weak passwords during affiliate registration (1664 ms)
      ✓ should accept strong passwords during affiliate registration (1541 ms)
      ✓ should reject passwords containing username (921 ms)
      ✓ should reject passwords containing email (928 ms)
      ✓ should reject passwords with sequential characters (944 ms)
    Customer Registration Password Validation
      ✓ should enforce strong passwords for customer registration (1064 ms)
      ✓ should accept strong passwords for customer registration (1286 ms)
    Administrator Password Validation
      ✓ should enforce strong passwords for administrator creation (1216 ms)
      ✓ should accept strong passwords for administrator creation (1407 ms)
    Operator Password Validation
      ✓ should enforce strong passwords for operator creation (1249 ms)
      ✓ should accept strong passwords for operator creation (1453 ms)
    Password Reset Validation
      ✓ should enforce strong passwords during password reset (1049 ms)
      ✓ should accept strong passwords during password reset (1181 ms)
    Login with Updated Passwords
      ✓ should successfully login with strong password (1212 ms)
      ✓ should handle case-insensitive username/email validation during registration (905 ms)
    Password Strength Edge Cases
      ✓ should reject passwords with only special characters at the end (912 ms)
      ✓ should accept passwords with mixed character distribution (1031 ms)
      ✓ should handle Unicode characters in passwords appropriately (990 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:35.460Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:36.355Z"}
  console.log
    CSRF token generation: {
      sessionID: '8e78d648074d301974a180448eb277af',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HciNDf8s-HnqjSqyPoRyDb-uzKsHAnTwLlHw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8e78d648074d301974a180448eb277af

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YjNCwCeeBj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.157 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:36.463Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:36.722Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:36.723Z","userId":"68b6ed087fb4912df9660bc7","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 260.417 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:36.727Z"}
  console.log
    CSRF token generation: {
      sessionID: '2fd7d9817d59631184f8a73b64cd872d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: aISypzvw-nUmLUdWZ6KwfnRGsogGo_nolyJc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2fd7d9817d59631184f8a73b64cd872d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bRbOS-bKn5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.287 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:36.826Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:36.930Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:36.930Z","userId":"68b6ed087fb4912df9660bdd","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 104.890 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:36.934Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f32f478383bebfde0d3cd6aee71f8153',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: f4LMsHvV-zof61sz7UNkrmPJ8I5-qAVMvHuM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f32f478383bebfde0d3cd6aee71f8153

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Fg_eqRzGPp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.117 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:37.093Z"}
[0mGET /api/v1/operators [32m200[0m 164.210 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:38.250Z"}
  console.log
    CSRF token generation: {
      sessionID: '75bb1b1b4d4120012b3bef271835e724',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ctofxCwD-iB87VykZnDqXp3F1dSvhfokldNA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 75bb1b1b4d4120012b3bef271835e724

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: boqetksP_L...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.272 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:38.357Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:38.510Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:38.510Z","userId":"68b6ed0a7fb4912df9660c17","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 153.194 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:38.513Z"}
  console.log
    CSRF token generation: {
      sessionID: '161b828712178058d630abae7fa7d78b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MG79FQCY-ci5942K2yFa3srPJjsq5hoNrv3I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 161b828712178058d630abae7fa7d78b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: G74K8WAz0f...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.773 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:38.620Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:38.713Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:38.714Z","userId":"68b6ed0a7fb4912df9660c1d","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.344 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:38.716Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e68523ee8a895722c6c0317f116465d7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HoK0sWAt-uplvteJLnN92IXmEmIXDq91gIwM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e68523ee8a895722c6c0317f116465d7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: GFQyiO_bBL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.882 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators?active=true {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:38.815Z"}
[0mGET /api/v1/operators?active=true [32m200[0m 142.981 ms - 724[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:39.869Z"}
  console.log
    CSRF token generation: {
      sessionID: '76afc7de94c4488bbcd10c7f8291442b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ULCxSDpL-RMCdNZ6bWN1kUrwoiTN8yhn5Hn0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 76afc7de94c4488bbcd10c7f8291442b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VeeZciKz2B...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.191 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:39.968Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:40.120Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:40.120Z","userId":"68b6ed0b7fb4912df9660c4b","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 152.982 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:40.125Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a999464b326bf57672c5d902b8eff4c8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: F94DKqfh-EwwRoiLaL_4nKqrCfXvf4rP8d60

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a999464b326bf57672c5d902b8eff4c8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: vb0UcF8fgk...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.373 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:40.223Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:40.315Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:40.316Z","userId":"68b6ed0c7fb4912df9660c51","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.256 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:40.319Z"}
  console.log
    CSRF token generation: {
      sessionID: '9f316a6341866e2974ee8cb6f28f558d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1SKNfXDK-RT-btUwncS08PgnL6crLIi2t2d8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9f316a6341866e2974ee8cb6f28f558d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 4fOEcklGVM...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.767 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators?onShift=true {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:40.425Z"}
[0mGET /api/v1/operators?onShift=true [32m200[0m 113.995 ms - 724[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:41.432Z"}
  console.log
    CSRF token generation: {
      sessionID: '351076c718c852b1294ef806d242454e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: duora2qa-KGVSYUHZN05LvugKBs5sUBauQy4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 351076c718c852b1294ef806d242454e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: eA96NbmJue...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.141 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:41.527Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:41.678Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:41.678Z","userId":"68b6ed0d7fb4912df9660c7e","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.388 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:41.681Z"}
  console.log
    CSRF token generation: {
      sessionID: '786b540e6350b659157356a9591c1b51',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ziYtPP5q-op7hmQNIphuBhODkbvFE2vMjCpM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 786b540e6350b659157356a9591c1b51

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dPobxNITBi...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.532 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:41.777Z"}
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:111:18)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:121:26)","timestamp":"2025-09-02T13:11:41.842Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:41.875Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:41.875Z","userId":"68b6ed0d7fb4912df9660c84","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 97.715 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:41.878Z"}
  console.log
    CSRF token generation: {
      sessionID: '7d7928400a0a5fbbe047f475147dae11',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: c6SzOMwj-RzE7wvoljgVSWFJ96ntiQdUpgwI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7d7928400a0a5fbbe047f475147dae11

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8YjNtz11uo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.593 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators?page=2&limit=5 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:43.087Z"}
[0mGET /api/v1/operators?page=2&limit=5 [32m200[0m 158.763 ms - -[0m
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:111:18)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:121:26)","timestamp":"2025-09-02T13:11:43.532Z"}
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:45.143Z"}
  console.log
    CSRF token generation: {
      sessionID: '63343fa7042468e071a92b7d03be8c8e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4NCbTYY0-M_SHDXaAdQZDtTSdTzDY-YS3eu8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 63343fa7042468e071a92b7d03be8c8e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _4CfGsn6xL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.859 ms - 67[0m
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:111:18)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:121:26)","timestamp":"2025-09-02T13:11:45.213Z"}
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:45.253Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:45.654Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:45.654Z","userId":"68b6ed117fb4912df9660ccf","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 401.511 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:45.657Z"}
  console.log
    CSRF token generation: {
      sessionID: '008ba3a817de524dc4cf2fad71fcdbd0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3QWPzb5t-xPBNyDF_r2NF_uZs_ad-D5dj1RU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 008ba3a817de524dc4cf2fad71fcdbd0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: s1VD38DxzQ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.094 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:45.760Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:46.108Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:46.108Z","userId":"68b6ed117fb4912df9660cd5","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 348.281 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:46.112Z"}
  console.log
    CSRF token generation: {
      sessionID: '46cabe465887cddbbe4030f296ca5ae5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: CibEyDqz-j8HjAX4LGoCyNyLE2YQdHlbElrA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 46cabe465887cddbbe4030f296ca5ae5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2EvHKY4bc6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.876 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:46.121Z"}
[0mGET /api/v1/operators [33m401[0m 0.929 ms - 47[0m
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:111:18)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:121:26)","timestamp":"2025-09-02T13:11:46.912Z"}
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:48.296Z"}
  console.log
    CSRF token generation: {
      sessionID: '4143c2158ac54ec2e159dd9f9c78a5cd',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 5fxgZACA-BU1B6bGw8Rfwt9BG4aHKpxbSAtg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4143c2158ac54ec2e159dd9f9c78a5cd

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ypbIxdhXB4...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.357 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:48.399Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:48.561Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:48.561Z","userId":"68b6ed147fb4912df9660cfc","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 162.023 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:48.564Z"}
  console.log
    CSRF token generation: {
      sessionID: '1dfb683656a2cd4e57e8f1ac59d950dd',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: r3g9Cu35-cnYdDMwGBGN-pOr7RExRnYO09J4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1dfb683656a2cd4e57e8f1ac59d950dd

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _1jwcugMdz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.519 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:48.664Z"}
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:111:18)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:121:26)","timestamp":"2025-09-02T13:11:48.676Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:49.007Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:49.007Z","userId":"68b6ed147fb4912df9660d02","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 342.944 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:49.010Z"}
  console.log
    CSRF token generation: {
      sessionID: '737281fb27b8c55d7349d67cb67f441b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: GFbTHUF6-XRcP5-CMK-fG-Mtl8HVs9e27xVY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 737281fb27b8c55d7349d67cb67f441b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dj3LqY8etB...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.084 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:49.105Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:49.801Z","userType":"administrator","username":"limited@wavemax.com"}
info: undefined {"adminId":"LIMITED001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:49.801Z","userId":"68b6ed157fb4912df9660d08","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 695.686 ms - 649[0m
[34mdebug[39m: GET /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:49.804Z"}
[0mGET /api/v1/operators [33m403[0m 352.150 ms - 79[0m
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:111:18)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:121:26)","timestamp":"2025-09-02T13:11:50.430Z"}
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:53.008Z"}
  console.log
    CSRF token generation: {
      sessionID: '7a541063dc80241cd0b911cfd146cd75',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: yCf7NfI0-uqV7ZmBU7GUMr7VwD7FlRkanQwM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7a541063dc80241cd0b911cfd146cd75

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LaEemIv_88...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.374 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:53.106Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:53.265Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:53.266Z","userId":"68b6ed197fb4912df9660d31","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 159.598 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:53.269Z"}
  console.log
    CSRF token generation: {
      sessionID: 'add76773524c6961d8c0de6c43c2a2c3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RnF6BW4I--n8AqJytuzWv4EgESY_rQe7_GHE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: add76773524c6961d8c0de6c43c2a2c3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1aPe3OREGb...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.769 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:53.367Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:53.462Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:53.463Z","userId":"68b6ed197fb4912df9660d37","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 95.749 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:53.470Z"}
  console.log
    CSRF token generation: {
      sessionID: '812a2cec94a86cffcf94c3796bb2f5a8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BxhnqWYK-pL3llyLBvIn1fKwBNwIImBwAGBM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 812a2cec94a86cffcf94c3796bb2f5a8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: USUojQYEs-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.569 ms - 67[0m
[34mdebug[39m: GET /api/v1/administrators/operators/68b6ed197fb4912df9660d3d {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:53.573Z"}
[0mGET /api/v1/administrators/operators/68b6ed197fb4912df9660d3d [32m200[0m 138.748 ms - 761[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:56.319Z"}
  console.log
    CSRF token generation: {
      sessionID: '8d241c9606c6e20cba46b339e4f84854',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4liJodjc-B6C3ZLPtIApy39lcNVLyZJirmmc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8d241c9606c6e20cba46b339e4f84854

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: OifvDAtvyx...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.858 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:56.415Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:56.806Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:11:56.806Z","userId":"68b6ed1c7fb4912df9660d64","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 391.255 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:56.809Z"}
  console.log
    CSRF token generation: {
      sessionID: '005533da84c4a7ef25af0e89c84024db',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BLdwJ2WT-lz6tV-nPzQmJgh80QVmgliA3LGo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 005533da84c4a7ef25af0e89c84024db

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fl0Oi-jYy0...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.630 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:56.908Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:11:57.004Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:11:57.004Z","userId":"68b6ed1c7fb4912df9660d6a","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 96.162 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:57.007Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fde8afd7205918b0f3ab8972c6a83625',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: swxm1Wxu-HzPmIVLRSxbHikK_yiI2kB-L7jA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fde8afd7205918b0f3ab8972c6a83625

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: v2Y5S1ivZ5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.595 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/68b6ed1c7fb4912df9660d6a {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:57.017Z"}
[0mGET /api/v1/operators/68b6ed1c7fb4912df9660d6a [32m200[0m 100.518 ms - 201[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:11:59.978Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e5e162562fa6764fe2036c2b0171b535',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: H8MRTFbM-fLl-eag-uK0lElAEdZaSK1gyt2E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e5e162562fa6764fe2036c2b0171b535

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: qRZgXvvX9w...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 13.493 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:00.243Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:00.663Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:00.664Z","userId":"68b6ed207fb4912df9660d94","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 421.577 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:00.668Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ee45fef4bb2e73666707f4f048ce4e89',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nbqgaO0W-NQ9uFcP2UMTU60BJmCCm8KKXq30

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ee45fef4bb2e73666707f4f048ce4e89

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: POmRrOHGIS...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 11.502 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:00.774Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:00.869Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:00.870Z","userId":"68b6ed207fb4912df9660d9a","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 96.748 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:00.876Z"}
  console.log
    CSRF token generation: {
      sessionID: '80568e224590d203a64d0d4ea8a55750',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: hGbF3ryT-xUUW90KqrC9I1se-Rm4MCUc4-Cg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 80568e224590d203a64d0d4ea8a55750

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: atmyBcRwlW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 26.756 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/68b6ed207fb4912df9660da0 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:01.040Z"}
[0mGET /api/v1/operators/68b6ed207fb4912df9660da0 [33m403[0m 107.507 ms - 68[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:04.516Z"}
  console.log
    CSRF token generation: {
      sessionID: '5f899b1d18b45dbf97c39a63da7165f1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: fKPZU0gn-xM-Jagu4Qw1p01Dkb16daJTXK20

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5f899b1d18b45dbf97c39a63da7165f1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: e3cxEqWncB...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 16.655 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:04.884Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:05.050Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:05.051Z","userId":"68b6ed247fb4912df9660dc5","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 166.947 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:05.054Z"}
  console.log
    CSRF token generation: {
      sessionID: '383c572a4231b35c00a02f7e167a2189',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BAHmjd4f-SXOTWlP5lwEPTGuUS0A4yP9dTiw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 383c572a4231b35c00a02f7e167a2189

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: gluVt_mZPS...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.300 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:05.165Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:05.506Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:05.507Z","userId":"68b6ed257fb4912df9660dcb","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 342.040 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:05.510Z"}
  console.log
    CSRF token generation: {
      sessionID: '5f051e35d06237e1f0a9f46b07b043f9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZmQfrBR9-DdOOybMcrD5nCXjJJVLAwCMI4PQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5f051e35d06237e1f0a9f46b07b043f9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PLcgtWOhpP...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.598 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/68b6ed257fb4912df9660dd1 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:05.521Z"}
[0mGET /api/v1/operators/68b6ed257fb4912df9660dd1 [33m404[0m 114.366 ms - 48[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:08.254Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ef8794025fca7136614303a492e25208',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kUuMHcg6-lDrEdV_enoI-SWsidfmKC6Qx2Y4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ef8794025fca7136614303a492e25208

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 4nd1s_iK6_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.892 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:08.354Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:08.521Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:08.521Z","userId":"68b6ed287fb4912df9660df7","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 167.332 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:08.526Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a40bb1c15a1f64f5fca174c9517c6fe3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: UQmQkeXQ-QyjYa5Ju1EuBu9RITDIZeZmTKfU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a40bb1c15a1f64f5fca174c9517c6fe3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1h6Z3mnucJ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.392 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:08.632Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:08.990Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:08.990Z","userId":"68b6ed287fb4912df9660dfd","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 358.036 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:08.993Z"}
  console.log
    CSRF token generation: {
      sessionID: '59d415e902bb458f913b0bcaf373c171',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: rmLXBXKJ-D43lZ8vPiEnAB4lHLsjQiOLyd5E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 59d415e902bb458f913b0bcaf373c171

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JQVEojiVXu...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.457 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:09.004Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: 'a40bb1c15a1f64f5fca174c9517c6fe3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa40bb1c15a1f64f5fca174c9517c6fe3.Ipm7c9nas7jTNYK4J5pmnYUzp8qqszdqeY%2BJzZyaVSw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/operator-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: newop@wavemax.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Operations Team

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Welcome to WaveMAX Operations Team</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                padding: 40px 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 32px;
                font-weight: 700;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .header p {
                margin: 10px 0 0;
                font-size: 18px;
                opacity: 0.9;
            }
            .content {
                padding: 40px 30px;
            }
            .greeting {
                font-size: 20px;
                color: #27ae60;
                margin-bottom: 20px;
                font-weight: 600;
            }
            .credentials-box {
                background-color: #e8f8f5;
                border: 2px solid #2ecc71;
                border-radius: 8px;
                padding: 25px;
                margin: 30px 0;
                text-align: center;
            }
            .credentials-title {
                font-size: 18px;
                font-weight: 600;
                color: #27ae60;
                margin-bottom: 15px;
            }
            .credential-item {
                margin: 15px 0;
                font-size: 16px;
            }
            .credential-label {
                font-weight: 600;
                color: #333;
            }
            .credential-value {
                display: block;
                font-size: 24px;
                color: #2c3e50;
                font-weight: 700;
                margin-top: 5px;
                letter-spacing: 2px;
            }
            .pin-highlight {
                background-color: #f1c40f;
                padding: 5px 15px;
                border-radius: 6px;
                display: inline-block;
            }
            .info-grid {
                display: table;
                width: 100%;
                margin: 20px 0;
            }
            .info-row {
                display: table-row;
            }
            .info-label {
                display: table-cell;
                padding: 10px 15px;
                font-weight: 600;
                color: #27ae60;
                width: 40%;
                vertical-align: top;
            }
            .info-value {
                display: table-cell;
                padding: 10px 15px;
                color: #333;
            }
            .button-container {
                text-align: center;
                margin: 40px 0;
            }
            .button {
                display: inline-block;
                padding: 16px 40px;
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                text-decoration: none !important;
                border-radius: 8px;
                font-size: 18px;
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .important-notes {
                background-color: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
            }
            .important-notes h3 {
                color: #856404;
                margin-bottom: 10px;
            }
            .important-notes ul {
                margin: 10px 0;
                padding-left: 20px;
            }
            .important-notes li {
                margin: 5px 0;
                color: #856404;
            }
            .footer {
                background-color: #f8f9fa;
                padding: 30px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #2ecc71;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Welcome to WaveMAX Operations</h1>
                <p>Your Operator Account is Ready</p>
            </div>
            
            <div class="content">
                <div class="greeting">
                    Welcome aboard, New!
                </div>
                
                <p>We're excited to have you join the WaveMAX operations team. Your operator account has been created and you're ready to start processing orders.</p>
                
                <div class="credentials-box">
                    <div class="credentials-title">Your Login Credentials</div>
                    <div class="credential-item">
                        <span class="credential-label">Employee ID:</span>
                        <span class="credential-value">OPRMF2KIF7K616161</span>
                    </div>
                    <div class="credential-item">
                        <span class="credential-label">Temporary PIN:</span>
                        <span class="credential-value pin-highlight">NewPassw0rd!</span>
                    </div>
                </div>
                
                <div class="info-grid">
                    <div class="info-row">
                        <div class="info-label">Email:</div>
                        <div class="info-value">newop@wavemax.com</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Shift Hours:</div>
                        <div class="info-value">00:00 - 23:59</div>
                    </div>
                </div>
                
                <div class="button-container">
                    <a href="https://wavemax.promo/embed-app-v2.html?login=operator" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to Operator Portal</a>
                </div>
                
                <div class="important-notes">
                    <h3>Important Information:</h3>
                    <ul><li>Change your PIN on first login</li><li>You can only login during your assigned shift hours</li><li>Keep your PIN confidential - never share it with anyone</li><li>Clock in at the start of your shift and clock out when finished</li><li>Contact your supervisor if you have any questions</li></ul>
                </div>
                
                <p>If you need assistance or have questions about your account, please contact your supervisor or the administrator.</p>
            </div>
            
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This email contains confidential login information. Please keep it secure.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

info: undefined {"action":"CREATE_OPERATOR","details":{"email":"newop@wavemax.com","operatorId":"OPRMF2KIF7K616161"},"ip":"::ffff:127.0.0.1","method":"POST","path":"/","targetId":"68b6ed297fb4912df9660e06","targetType":"operator","timestamp":"2025-09-02T13:12:09.442Z","userId":"68b6ed287fb4912df9660df7","userRole":"administrator","userType":"administrator"}
[0mPOST /api/v1/operators [32m201[0m 438.766 ms - 449[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:12.404Z"}
  console.log
    CSRF token generation: {
      sessionID: '61eb5506261b50c6cbfa5bfe29179c62',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TZt7xm4S-X_4tRkMZGYz8apt_ONqsPNAXapA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 61eb5506261b50c6cbfa5bfe29179c62

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: GGea5edlUQ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.768 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:12.513Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:12.662Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:12.662Z","userId":"68b6ed2c7fb4912df9660e2a","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.371 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:12.665Z"}
  console.log
    CSRF token generation: {
      sessionID: '9e24bea019f9c997e15a3426ac7d36b4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vgJA9llR-R1KNF01FruSA6yE0lrGchAM8130

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9e24bea019f9c997e15a3426ac7d36b4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 06orozbt9E...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.160 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:13.037Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:13.132Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:13.133Z","userId":"68b6ed2c7fb4912df9660e30","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 95.256 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:13.135Z"}
  console.log
    CSRF token generation: {
      sessionID: '8b5dfc179e275c1ab68b6f9e130040f2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JIocNeVE-aC-2X3hZFwzlS4irRIEOl3vWiRg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8b5dfc179e275c1ab68b6f9e130040f2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: boYaRBaxOq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.303 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:13.146Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '9e24bea019f9c997e15a3426ac7d36b4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A9e24bea019f9c997e15a3426ac7d36b4.n4I0UAEfHz8yV1wAZictQjMGPlXhOzliggEn6jKO81s',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 307.099 ms - 309[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:17.370Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ff4aa8054b3c83c29c4bac282f3750c9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6RFfATcQ-4K5bQev-DIMN4X3qS9MdvdlYVAw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ff4aa8054b3c83c29c4bac282f3750c9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VHWfFqDKCK...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.882 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:17.467Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:17.637Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:17.638Z","userId":"68b6ed317fb4912df9660e59","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 170.294 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:17.641Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa87b49086bcd1fa6c751ebe5d825725',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: QapPSVqi-ZYPduGZ6Htkeg3GHgu4y5XLl8qY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa87b49086bcd1fa6c751ebe5d825725

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: n0wI09p5Wj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.112 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:17.739Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:17.866Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:17.866Z","userId":"68b6ed317fb4912df9660e5f","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 127.046 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:17.869Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a1acbc2e87adb57b6641e7a0f3e77ee3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NTeduCoA-HPTV6rCb9Gr61Ft1m_xZPi5oZEM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a1acbc2e87adb57b6641e7a0f3e77ee3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: OZUe5I7058...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.022 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:17.881Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: 'aa87b49086bcd1fa6c751ebe5d825725',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa87b49086bcd1fa6c751ebe5d825725.2C2iwRnaa9FNDC9kfrNfVhWcvGjbxI58Av%2BdxpekIuY',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 56.859 ms - 170[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:20.789Z"}
  console.log
    CSRF token generation: {
      sessionID: '378b66bc134ba17c98c55ec7ca88d461',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nOM4aW9d-ZApiN93PhON_aXmp6IlNgwmnLsI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 378b66bc134ba17c98c55ec7ca88d461

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YrFAwRt_Pw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.243 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:21.137Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:21.537Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:21.538Z","userId":"68b6ed347fb4912df9660e88","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 401.007 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:21.543Z"}
  console.log
    CSRF token generation: {
      sessionID: '5ab041e7ffdceb735f9f49408a9a5f39',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DTWVIe0z-ONTQqKTSrfZWlfH8FtvMNHDcj2w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5ab041e7ffdceb735f9f49408a9a5f39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Q45yfkQlw-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.815 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:21.640Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:21.739Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:21.739Z","userId":"68b6ed357fb4912df9660e8e","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 99.351 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:21.742Z"}
  console.log
    CSRF token generation: {
      sessionID: '6dc394806a67d60b41a3fb5cf702a70c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9uI3aAhe-lDOncN9KJH1nY5QZDo_W1DK_XIE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6dc394806a67d60b41a3fb5cf702a70c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Ih5woxdi2l...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.120 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:21.750Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '5ab041e7ffdceb735f9f49408a9a5f39',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A5ab041e7ffdceb735f9f49408a9a5f39.vt0Vzg4WTE2ig67fPvjwEaiThsXNA%2BefXVFGe3Rk8GA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 323.835 ms - 80[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:25.885Z"}
  console.log
    CSRF token generation: {
      sessionID: '3031eb4fce473f938aa7a99ba5514633',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gLnjUOry-AOGl6m9vPLWDmNDFAHSStFfdRIM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3031eb4fce473f938aa7a99ba5514633

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: E9_uLzUHPf...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.587 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:26.237Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:26.636Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:26.636Z","userId":"68b6ed397fb4912df9660eb7","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 399.482 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:26.639Z"}
  console.log
    CSRF token generation: {
      sessionID: '693e645559e6f1fad2a184d063834b1e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: F2njMiz5-jUn1ou1gp0lRUaualuoHj5ufzf4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 693e645559e6f1fad2a184d063834b1e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: u5C7DLMRx7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.374 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:26.733Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:26.826Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:26.826Z","userId":"68b6ed3a7fb4912df9660ebd","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.858 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:26.829Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c869846b3892525ccca88eadb8431d34',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gBMyvwFP-JVj4L5knqmtBNapCWr0wUYVHLX8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c869846b3892525ccca88eadb8431d34

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 6Kh_B0ZcJy...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.504 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:26.839Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '693e645559e6f1fad2a184d063834b1e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A693e645559e6f1fad2a184d063834b1e.6S7GXzAllRR%2B5DHc09d5CDQAFEvzmKE1AYE84E%2BbE%2Fw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m409[0m 341.593 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:29.574Z"}
  console.log
    CSRF token generation: {
      sessionID: '7a70e5445334daa401d19238e4770ff4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gGnMTydB-UVaOOv48pktc6yHXKUUPv3yxZas

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7a70e5445334daa401d19238e4770ff4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Pa1C4cJkSz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.344 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:29.671Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:30.852Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:30.853Z","userId":"68b6ed3d7fb4912df9660ee7","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 1181.989 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:30.857Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a9d68559d9fea6e56eaa8755b9f6a1a9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gPnDjEst-_O36ngH_LpM43m8VwRNnBXcPL4E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a9d68559d9fea6e56eaa8755b9f6a1a9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: g0zrt6icME...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.143 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:30.975Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:31.849Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:31.850Z","userId":"68b6ed3e7fb4912df9660eed","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 874.961 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:31.854Z"}
  console.log
    CSRF token generation: {
      sessionID: '44bc81325479b45a2bed3ed746d035c0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: D1TIj4Xv-BsBf9HiR8oQbnGMsUiH5Qb3Fyx4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 44bc81325479b45a2bed3ed746d035c0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9GMZlg6GU_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.043 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:31.954Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:32.366Z","userType":"administrator","username":"limited2@wavemax.com"}
info: undefined {"adminId":"LIMITED002","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:32.366Z","userId":"68b6ed3f7fb4912df9660ef3","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 411.878 ms - 655[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:32.369Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '7a70e5445334daa401d19238e4770ff4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7a70e5445334daa401d19238e4770ff4.2Y3Lu5CAdNC9vhJnlM1LltGVDWofoatuozw6D3bTWy4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m403[0m 63.533 ms - 81[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:34.879Z"}
  console.log
    CSRF token generation: {
      sessionID: '583e752c43ffa9511050210dec1e14a9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mV1VcTwj-Y-Y_PhP6AVkoun3AKRDkx11ZvME

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 583e752c43ffa9511050210dec1e14a9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XgV9Zn6XoH...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.847 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:34.990Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:35.428Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:35.429Z","userId":"68b6ed427fb4912df9660f1c","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 439.247 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:35.432Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ec14087cdbffd1718f43faaa7913a289',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: sIQiWRKB-RB925cQV97isXdy8h517iPQ7UGs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ec14087cdbffd1718f43faaa7913a289

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9dJ8JRP3Jy...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.565 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:35.532Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:35.633Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:35.633Z","userId":"68b6ed437fb4912df9660f22","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 101.622 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:35.636Z"}
  console.log
    CSRF token generation: {
      sessionID: '4f38f432622895bb89a7c63ab30206fb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ALk2fdju-p62n74932y30mEJagDMj2knCg0w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4f38f432622895bb89a7c63ab30206fb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: oeAqC4-In5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.185 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed437fb4912df9660f28 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:35.743Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed437fb4912df9660f28 {
      sessionID: 'ec14087cdbffd1718f43faaa7913a289',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aec14087cdbffd1718f43faaa7913a289.ZHlSQZx109%2BJUTIhRb0K3adT47i0gYaPXd9ORCRBCfk',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{"firstName":"Updated","lastName":"Name","shiftEnd":"18:00","shiftStart":"10:00"}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68b6ed437fb4912df9660f28","targetId":"68b6ed437fb4912df9660f28","targetType":"operator","timestamp":"2025-09-02T13:12:36.146Z","userId":"68b6ed427fb4912df9660f1c","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68b6ed437fb4912df9660f28 [32m200[0m 403.999 ms - 442[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:38.799Z"}
  console.log
    CSRF token generation: {
      sessionID: '26a141cfd35cd653f3678b5815c046e3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jBwL3Nfe-1n1WHMcY7n49OaRO1bsx0AF3okU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 26a141cfd35cd653f3678b5815c046e3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: U5cG1UibkG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.462 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:39.166Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:39.576Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:39.576Z","userId":"68b6ed467fb4912df9660f50","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 410.278 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:39.580Z"}
  console.log
    CSRF token generation: {
      sessionID: '914a319f9a33ebcabd8f4bbc2c413a5f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: AQrM8XIN--1tF6pjMkK3v1QcXAi_RR0bdg04

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 914a319f9a33ebcabd8f4bbc2c413a5f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: kPq2uBjsgZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.871 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:39.683Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:39.778Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:39.778Z","userId":"68b6ed477fb4912df9660f56","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 95.134 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:39.781Z"}
  console.log
    CSRF token generation: {
      sessionID: '3f9a62d965c50633637a0bc01b7d8e73',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: OU8BaRIp-Qm6wCUD0hDz51Sz3LsddqyKZfWU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3f9a62d965c50633637a0bc01b7d8e73

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: MDXHVt9gWA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.443 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed477fb4912df9660f5c {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:39.875Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed477fb4912df9660f5c {
      sessionID: '914a319f9a33ebcabd8f4bbc2c413a5f',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A914a319f9a33ebcabd8f4bbc2c413a5f.g91RNnEgsin0coOU42ir%2BpOHtOv78tmvwW4Pa2Uuas4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68b6ed477fb4912df9660f5c","targetId":"68b6ed477fb4912df9660f5c","targetType":"operator","timestamp":"2025-09-02T13:12:40.402Z","userId":"68b6ed467fb4912df9660f50","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68b6ed477fb4912df9660f5c [32m200[0m 527.822 ms - 445[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:42.536Z"}
  console.log
    CSRF token generation: {
      sessionID: '03240ebf9fa490b417f5ed5dcb2fa857',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RHNlRDZO-NoN7Ox_o4l9YJb3Ce2orty-abng

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 03240ebf9fa490b417f5ed5dcb2fa857

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: srwEEXCZ2c...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.618 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:42.877Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:43.276Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:43.276Z","userId":"68b6ed4a7fb4912df9660f88","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 399.673 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:43.280Z"}
  console.log
    CSRF token generation: {
      sessionID: '38446ab3f8376a3c592674b9e748de14',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jRIyfmob-mcoQBhEzr4WumdbJcCGIoTUuH-k

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 38446ab3f8376a3c592674b9e748de14

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: hFz2xN0MXs...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.237 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:43.392Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:43.501Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:43.501Z","userId":"68b6ed4b7fb4912df9660f8e","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 108.839 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:43.505Z"}
  console.log
    CSRF token generation: {
      sessionID: '87f5dd3c86e2260113530c264203485b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: U9yaSyLN-RHHX11A4t8eL2XXT5OZg6_F2QUE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 87f5dd3c86e2260113530c264203485b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: qssyfQii9f...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.777 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed4b7fb4912df9660f94 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:43.604Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed4b7fb4912df9660f94 {
      sessionID: '38446ab3f8376a3c592674b9e748de14',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A38446ab3f8376a3c592674b9e748de14.%2Bl1xthgLm5NMm2OQbpF8Q2bGhNJiRx06Y52YVpnBngM',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{"isActive":false}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68b6ed4b7fb4912df9660f94","targetId":"68b6ed4b7fb4912df9660f94","targetType":"operator","timestamp":"2025-09-02T13:12:44.255Z","userId":"68b6ed4a7fb4912df9660f88","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68b6ed4b7fb4912df9660f94 [32m200[0m 652.800 ms - 446[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:49.668Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd11c71e4fad7cffd76cc501e90e70ffe',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: j7Egc6YH-yo6TZBcbsRRNSd-r0iD6ZvZYbMo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d11c71e4fad7cffd76cc501e90e70ffe

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: FIsxE13BRT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.385 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:49.772Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:50.416Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:50.416Z","userId":"68b6ed517fb4912df9660fbd","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 644.660 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:50.420Z"}
  console.log
    CSRF token generation: {
      sessionID: '2371c2457cd1bdfd56d704002dfc402a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RQvqpM6b-9vAP-37xJ9c9ZR-ii9xiBjOSNRo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2371c2457cd1bdfd56d704002dfc402a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YZA9Zs8zQA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 12.257 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:50.519Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:51.386Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:51.386Z","userId":"68b6ed527fb4912df9660fc3","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 867.004 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:51.389Z"}
  console.log
    CSRF token generation: {
      sessionID: 'af761ca1bf8380ee5ddbac7bfecd5af0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: T88amKop-enLnXUswW9uLomhM9FjdHDtzAPU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: af761ca1bf8380ee5ddbac7bfecd5af0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 91tPjH6oqI...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.311 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed537fb4912df9660fcb {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:51.582Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed537fb4912df9660fcb {
      sessionID: 'd11c71e4fad7cffd76cc501e90e70ffe',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad11c71e4fad7cffd76cc501e90e70ffe.Zx33fsnJoZItdCQCJsUSs5snU4DEfv1eiu4OiqqEEGo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68b6ed537fb4912df9660fcb [32m200[0m 424.378 ms - 212[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:55.616Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a60c4d05778a5693fb7db28448256665',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0WFctlTD-tufMEgpMf_6O6pLhFIiW5LD4hDg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a60c4d05778a5693fb7db28448256665

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8HaknV8qam...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 13.770 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:55.723Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:56.416Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:56.417Z","userId":"68b6ed577fb4912df9660ff3","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 694.831 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:56.421Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd8c105ca466a7b7b6cced9463a35402d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: XFL6wRLQ-ygA2GftXSxrxmhGy1mx6tvzA0Ps

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d8c105ca466a7b7b6cced9463a35402d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: SYNecoel9p...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.244 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:56.529Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:56.879Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:12:56.879Z","userId":"68b6ed587fb4912df9660ff9","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 350.301 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:56.882Z"}
  console.log
    CSRF token generation: {
      sessionID: '37250fd4a3910b58d6701c7dc9e87001',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HE6dvEv0-yStefinxGDwJEJ9adhOTs31jQtE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 37250fd4a3910b58d6701c7dc9e87001

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fAlAztlZFw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.039 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed587fb4912df9660ff9 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:56.975Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed587fb4912df9660ff9 {
      sessionID: '37250fd4a3910b58d6701c7dc9e87001',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A37250fd4a3910b58d6701c7dc9e87001.DRNXZ2EXteoB3%2FD8VwRpOv4lj%2BxLDI%2FlHG%2FXFpbvfBk',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68b6ed587fb4912df9660ff9 [32m200[0m 140.167 ms - 242[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:59.314Z"}
  console.log
    CSRF token generation: {
      sessionID: '2dfdbc1da4b41390fc7570c4288f2701',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: IHJKd0tn-NIjgm3fJZGmALo5QmaJe3IOoYd8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2dfdbc1da4b41390fc7570c4288f2701

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: s1u9HnWiGh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.678 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:59.413Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:12:59.810Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:12:59.811Z","userId":"68b6ed5b7fb4912df9661027","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 398.077 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:59.814Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd615fba222b5e4c6d8554d2783fafacc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RjGmF7C1-eCyGCgX1LSaml4OsyfDB-90T1Uk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d615fba222b5e4c6d8554d2783fafacc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 4l8kkZ-CSj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.890 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:12:59.938Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:00.079Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:00.079Z","userId":"68b6ed5b7fb4912df966102d","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 141.509 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:00.083Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dd451364ac67c425aa68798bef001031',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: pqAFHzUc-hlSUMWWG4AMGAAdr6DGwuCGrCcs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dd451364ac67c425aa68798bef001031

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: f3-fg6iv2b...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.573 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed5c7fb4912df9661033 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:00.189Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed5c7fb4912df9661033 {
      sessionID: 'd615fba222b5e4c6d8554d2783fafacc',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad615fba222b5e4c6d8554d2783fafacc.cVzflujhRbWrbBIudhk0N3f4GTWId7bYpvdypzk91yQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68b6ed5c7fb4912df9661033","targetId":"68b6ed5c7fb4912df9661033","targetType":"operator","timestamp":"2025-09-02T13:13:00.871Z","userId":"68b6ed5b7fb4912df9661027","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68b6ed5c7fb4912df9661033 [32m200[0m 682.447 ms - 445[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:03.112Z"}
  console.log
    CSRF token generation: {
      sessionID: '2d9c60cb420a74e6c26d685bc83062fa',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ga9PL2RY-Hu33aGiaPMWXTZ0eBOXZVRoxt9s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2d9c60cb420a74e6c26d685bc83062fa

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: qP-5jEpNJl...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.565 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:03.214Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:03.606Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:03.606Z","userId":"68b6ed5f7fb4912df966105b","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 392.748 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:03.610Z"}
  console.log
    CSRF token generation: {
      sessionID: '5bfb111a0e5fd2b6996fa01c69c07c62',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TaCuTogJ-ix7S-H_29_w6YnqjwyL1ce728RQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5bfb111a0e5fd2b6996fa01c69c07c62

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: I-fl89vDPz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.808 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:03.709Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:03.811Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:03.811Z","userId":"68b6ed5f7fb4912df9661061","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 101.832 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:03.814Z"}
  console.log
    CSRF token generation: {
      sessionID: '76b0c7ec3b91c8973fe22a5974394898',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ATV7ZMbR-ADr8AYhgmCryhrSjk1xPwvkUIPI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 76b0c7ec3b91c8973fe22a5974394898

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NhsX9tRIHP...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.925 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed5f7fb4912df9661067 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:03.915Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed5f7fb4912df9661067 {
      sessionID: '5bfb111a0e5fd2b6996fa01c69c07c62',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A5bfb111a0e5fd2b6996fa01c69c07c62.SxBs0%2FnMTKK2x7AkOTy%2FApCgTpDLVSV%2FO%2FtYoEz%2Fr8o',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68b6ed5f7fb4912df9661067 [33m409[0m 410.983 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:08.244Z"}
  console.log
    CSRF token generation: {
      sessionID: '2f971ea64af231b6acc3d2607e9bee80',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: dGnbd91b-OQm0pb_0guzQvH65qlQnmtMmUUw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2f971ea64af231b6acc3d2607e9bee80

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yoJfb8LDUg...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.912 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:08.344Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:08.755Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:08.755Z","userId":"68b6ed647fb4912df966108f","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 410.292 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:08.758Z"}
  console.log
    CSRF token generation: {
      sessionID: '88820bb700a708ff348c4bfe969078c5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1jAWSy7d-089DpWJm1qwlIjtWN97IKVDdDsU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 88820bb700a708ff348c4bfe969078c5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1XQYrY58sm...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.140 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:08.854Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:09.223Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:09.223Z","userId":"68b6ed647fb4912df9661095","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 368.951 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:09.226Z"}
  console.log
    CSRF token generation: {
      sessionID: '8bf2000b18ae02c076426a955e68fc5a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: PwY0tYv2-6GKLZZWLmnM86zYI8BiLn7ib8xI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8bf2000b18ae02c076426a955e68fc5a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: RWnfyIVkNs...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.201 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/operators/68b6ed657fb4912df966109b {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:09.322Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed657fb4912df966109b {
      sessionID: '88820bb700a708ff348c4bfe969078c5',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A88820bb700a708ff348c4bfe969078c5.rQWD%2BuHgpRvaqU3eQcz0tt%2FRfesK2M5hzmnZKuCncKI',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"0":"6","1":"8","10":"b","11":"4","12":"9","13":"1","14":"2","15":"d","16":"f","17":"9","18":"6","19":"6","2":"b","20":"1","21":"0","22":"8","23":"f","3":"6","4":"e","5":"d","6":"6","7":"4","8":"7","9":"f","timestamp":"2025-09-02T13:13:17.641Z"}
[0mDELETE /api/v1/operators/68b6ed657fb4912df966109b [32m200[0m 8319.245 ms - 58[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:20.753Z"}
  console.log
    CSRF token generation: {
      sessionID: '88f923fcb70159f01276f087c0abacf5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: zmKjyFTR-h55w9pyw6uaL3gO0BNi7LOPr4Cg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 88f923fcb70159f01276f087c0abacf5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: xUhLd5ETZX...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.887 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:20.852Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:21.056Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:21.056Z","userId":"68b6ed707fb4912df96610c4","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 203.723 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:21.059Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd972162560db3eecec15f7cd43ba852b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jNLJkF0v-y3tJhVO6HWceaU_8JCKWFxcbksM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d972162560db3eecec15f7cd43ba852b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bG_byzPbqf...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.731 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:21.148Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:21.262Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:21.262Z","userId":"68b6ed717fb4912df96610ca","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 113.670 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:21.265Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b884ca1a85218e3fa9da068dc10b7f6c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1vxPB2DP-m23Zrfwgssr0Z3CzO9-D8Sw1v3Q

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b884ca1a85218e3fa9da068dc10b7f6c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: IZ-hJrTVhB...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.966 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/operators/68b6ed717fb4912df96610d0 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:21.403Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed717fb4912df96610d0 {
      sessionID: 'd972162560db3eecec15f7cd43ba852b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad972162560db3eecec15f7cd43ba852b.hTLS%2BYf3q2P83q04a4FZwyOjp23htgLiReesX7vmgnQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/operators/68b6ed717fb4912df96610d0 [33m400[0m 363.845 ms - 71[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:24.163Z"}
  console.log
    CSRF token generation: {
      sessionID: '1c9b7d3ebe8f8fe1c503392379bb8fbc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ep8OexJT-sOAGVAdhdD0f6pbYNsR-Ni1FktU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1c9b7d3ebe8f8fe1c503392379bb8fbc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: O0JbmIQldV...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.504 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:24.265Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:24.418Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:24.418Z","userId":"68b6ed747fb4912df96610f8","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 152.983 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:24.421Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fad834b145bc440f1cb938e8a253ab43',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TZ3m3VdF-2BV2yE6TbNeqbkU-Im6oE_XjBG0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fad834b145bc440f1cb938e8a253ab43

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: GFHVpKGnyE...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.727 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:24.523Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:24.619Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:24.619Z","userId":"68b6ed747fb4912df96610fe","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 96.228 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:24.622Z"}
  console.log
    CSRF token generation: {
      sessionID: '6551559aa7a21261f6bf0d774e29e462',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3NzmoLJO-EDKe-gwyQpUlO0QRXdiewOqj2LU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6551559aa7a21261f6bf0d774e29e462

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pAg3_Ohc44...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.469 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:24.812Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:24.958Z","userType":"administrator","username":"limited3@wavemax.com"}
info: undefined {"adminId":"LIMITED003","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:24.959Z","userId":"68b6ed747fb4912df9661106","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 146.641 ms - 655[0m
[34mdebug[39m: DELETE /api/v1/operators/68b6ed747fb4912df9661104 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:24.961Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed747fb4912df9661104 {
      sessionID: '1c9b7d3ebe8f8fe1c503392379bb8fbc',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A1c9b7d3ebe8f8fe1c503392379bb8fbc.eXdfQscWDnFcM%2BeSIsDkTT%2FraJ3ODV3AxD4CP0Rv7IY',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/operators/68b6ed747fb4912df9661104 [33m403[0m 301.287 ms - 81[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:27.953Z"}
  console.log
    CSRF token generation: {
      sessionID: '90378616b42d13c88dcc80f45d3cf6e6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6eGTUXfa-duFlyneabK1JjF53R3KdGg_uoUc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 90378616b42d13c88dcc80f45d3cf6e6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pXkFrTjAW5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.924 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:28.057Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:28.446Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:28.446Z","userId":"68b6ed787fb4912df966112f","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 389.343 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:28.449Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a707e4903f234f71520fe13cf4b65f20',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: pfhJx9hC-mMj5GNVh6VJE92plZGlr7L4UoZg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a707e4903f234f71520fe13cf4b65f20

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: MY7bLeWgfV...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.996 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:28.559Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:28.655Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:28.656Z","userId":"68b6ed787fb4912df9661135","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 96.354 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:28.659Z"}
  console.log
    CSRF token generation: {
      sessionID: '6b104d65bda226668137e87dc67c5566',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1i4AAk4e-M2kIHNDfVZtUbHJk-ezM5dlrdro

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6b104d65bda226668137e87dc67c5566

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: K3J-AaMWhG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.117 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/operators/68b6ed797fb4912df966113d {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:29.267Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed797fb4912df966113d {
      sessionID: 'a707e4903f234f71520fe13cf4b65f20',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa707e4903f234f71520fe13cf4b65f20.Tvd71SL0h%2BGPHcVagEqe9mUUHpBV6MtxyemNyChZE%2Bs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/operators/68b6ed797fb4912df966113d [33m404[0m 350.581 ms - 48[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:33.447Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd1959ba43fb7a18f9de4860c764717ea',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: LYhXUrel-_btWhiVpRdsPb9iZXwMQsteMp7U

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d1959ba43fb7a18f9de4860c764717ea

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: vy80x1K-Om...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.394 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:33.555Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:33.956Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:33.956Z","userId":"68b6ed7d7fb4912df9661162","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 401.756 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:33.959Z"}
  console.log
    CSRF token generation: {
      sessionID: '17f9dfa1e946862b9a6e195b7ddfa085',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 2GEu47yH-flJc1d4-h-DxngfJ2TSi2VEuob4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 17f9dfa1e946862b9a6e195b7ddfa085

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yx6y1gW5N-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.964 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:34.061Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:34.171Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:34.171Z","userId":"68b6ed7d7fb4912df9661168","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 109.887 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:34.174Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dc542c9118f34106993f14081e421b11',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vN8ByPqB-Av1admocsttwNb7t_Z92eVpRgEI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dc542c9118f34106993f14081e421b11

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QmXFlkjQtu...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.394 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators/68b6ed7e7fb4912df966116e/reset-pin {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:34.277Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed7e7fb4912df966116e/reset-pin {
      sessionID: '17f9dfa1e946862b9a6e195b7ddfa085',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A17f9dfa1e946862b9a6e195b7ddfa085.PnjHDJcfkPFtN0FR43mXM5Tl5R3XqddC4YnwfTo%2FRu4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"0":"6","1":"8","10":"b","11":"4","12":"9","13":"1","14":"2","15":"d","16":"f","17":"9","18":"6","19":"6","2":"b","20":"1","21":"1","22":"6","23":"2","3":"6","4":"e","5":"d","6":"7","7":"d","8":"7","9":"f","timestamp":"2025-09-02T13:13:34.963Z"}
[0mPOST /api/v1/operators/68b6ed7e7fb4912df966116e/reset-pin [32m200[0m 686.427 ms - 51[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:38.692Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b72750a4553977aa67697a79351697c2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: qBhxaBFn-72la2Hoxni7TteyM9_sw0bMmz8Q

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b72750a4553977aa67697a79351697c2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 51t1cPDaat...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.610 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:38.813Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:39.199Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:39.199Z","userId":"68b6ed827fb4912df9661196","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 386.853 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:39.203Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c60683bd7a5a73577471a71d2be6788c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Wv0ksmu3-xL8y5Na8I4IAt041qqzVHqzfqFs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c60683bd7a5a73577471a71d2be6788c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YpV8cIUo4O...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.453 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:39.304Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:39.641Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:39.642Z","userId":"68b6ed837fb4912df966119c","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 338.024 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:39.645Z"}
  console.log
    CSRF token generation: {
      sessionID: '59d4c66b8928ec8b2ca4ee5a1668be21',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0IMvbysJ-6OujHzdp6a9wIBfcZKAI9EYTrKg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 59d4c66b8928ec8b2ca4ee5a1668be21

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: kVl6ffvx7p...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.613 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators/68b6ed837fb4912df96611a2/reset-pin {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:39.779Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed837fb4912df96611a2/reset-pin {
      sessionID: 'c60683bd7a5a73577471a71d2be6788c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac60683bd7a5a73577471a71d2be6788c.aEntrHsWWh%2BpS82CeQ4EOl2XchXrlahPUQ6gd2igwbM',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"0":"6","1":"8","10":"b","11":"4","12":"9","13":"1","14":"2","15":"d","16":"f","17":"9","18":"6","19":"6","2":"b","20":"1","21":"1","22":"9","23":"6","3":"6","4":"e","5":"d","6":"8","7":"2","8":"7","9":"f","timestamp":"2025-09-02T13:13:39.967Z"}
[0mPOST /api/v1/operators/68b6ed837fb4912df96611a2/reset-pin [32m200[0m 188.881 ms - 51[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:43.090Z"}
  console.log
    CSRF token generation: {
      sessionID: '100c352f3823c2a24f53e1762fd245f9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ad68egka-3Bjniz0zuiWrlchyGH9NA8Md_y0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 100c352f3823c2a24f53e1762fd245f9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 6SJcTMjNQX...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.905 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:43.187Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:43.342Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:43.342Z","userId":"68b6ed877fb4912df96611cd","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 155.075 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:43.345Z"}
  console.log
    CSRF token generation: {
      sessionID: '7a896a2be411fbd22d9c2d2ea0f9b46e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: m34FbCHW-SH8Bci769OyKhkhjigSbY9zv2L8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7a896a2be411fbd22d9c2d2ea0f9b46e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fT9PDGLSb6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.547 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:43.459Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:43.558Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:43.558Z","userId":"68b6ed877fb4912df96611d3","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 99.471 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:43.561Z"}
  console.log
    CSRF token generation: {
      sessionID: '92de700192bac78ec137dc4ce11a3d66',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TWNzegO9-hKpL3HVBMl14zsZDS2DB9E3VTX4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 92de700192bac78ec137dc4ce11a3d66

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XvnLHxxF4y...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.560 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:44.087Z"}
[0mGET /api/v1/operators/available [32m200[0m 330.089 ms - 769[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:46.548Z"}
  console.log
    CSRF token generation: {
      sessionID: 'efcc251becba44b320be66fc4a792572',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DEuhveAr-4xrG3zjzE1a6y8N28XwMm6kodt0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: efcc251becba44b320be66fc4a792572

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: olihsLo6IL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.630 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:46.658Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:46.815Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:46.815Z","userId":"68b6ed8a7fb4912df9661205","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 157.079 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:46.818Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a28eb92f1bebf3192125eba78fefbfd0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: AHQ94LcU-U5uF3x7tL3ySNaf_PIUE1MUYl8o

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a28eb92f1bebf3192125eba78fefbfd0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: uDJqymheJD...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.666 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:46.913Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:47.566Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:47.567Z","userId":"68b6ed8a7fb4912df966120b","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 654.049 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:47.571Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd5f8846088d34fe2e8bf4e9b6e3474bc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: H7DRb1DZ-6Ob6BTwU2TstbYZM9A3xTivBgRE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d5f8846088d34fe2e8bf4e9b6e3474bc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tmV5f41U7V...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 10.250 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available?limit=2 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:48.110Z"}
[0mGET /api/v1/operators/available?limit=2 [32m200[0m 1952.699 ms - 536[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:53.200Z"}
  console.log
    CSRF token generation: {
      sessionID: '80b7b8726baddf6d43b5a95a4b981547',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 5eXJDvXb-1yfPh1JLEpXvmkvuo7X4ps_uAFc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 80b7b8726baddf6d43b5a95a4b981547

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: wd7xDKORzG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 16.444 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:53.324Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:53.735Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:53.735Z","userId":"68b6ed917fb4912df966123d","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 411.282 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:53.741Z"}
  console.log
    CSRF token generation: {
      sessionID: '4d6c9c50062116cc488d0508e935f1a7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: UILciL1P-TRLpp9hSL9j9IaN-p_IIdaB3GBE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4d6c9c50062116cc488d0508e935f1a7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: OUyXn1hUNw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 10.074 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:54.109Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:54.208Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:54.208Z","userId":"68b6ed917fb4912df9661243","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 99.041 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:54.211Z"}
  console.log
    CSRF token generation: {
      sessionID: '203da08c43390961093c888d24774485',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3SpSxcER-NBk9wFkQBlgj2lEsCjAbR6wVCBI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 203da08c43390961093c888d24774485

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pJD0xYcGYK...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.230 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:54.501Z"}
[0mGET /api/v1/operators/available [32m200[0m 84.949 ms - 769[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:55.472Z"}
  console.log
    CSRF token generation: {
      sessionID: '49c014e6b2688d6781a7b3ec56fb983f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HWXzXkLk-Zm5p2uo-5djIOOaNRBs1oAtEZvs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 49c014e6b2688d6781a7b3ec56fb983f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ydpWolE3XZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.016 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:55.573Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:55.721Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:55.721Z","userId":"68b6ed937fb4912df9661275","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.243 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:55.725Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f85afbeb549cbfc686f71a6846c9a63d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Mw2l2XTA-EUh--QtKHJe5Mp0ShEDnYJiK1ts

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f85afbeb549cbfc686f71a6846c9a63d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8q4LB5CTLd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.833 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:55.821Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:55.915Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:55.916Z","userId":"68b6ed937fb4912df966127b","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 94.663 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:55.919Z"}
  console.log
    CSRF token generation: {
      sessionID: '919b5a1436f6a16e9c423a8a65721a63',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TvKNTH3v-bBekgDC6Dr9BYynT3-aqMbB30Ck

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 919b5a1436f6a16e9c423a8a65721a63

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ds3V2mfxeK...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 23.612 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:56.214Z"}
[0mGET /api/v1/operators/available [33m401[0m 1.231 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:57.122Z"}
  console.log
    CSRF token generation: {
      sessionID: '478c8f694dd96c3b0d74197050d754ce',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Fe3rWHP1-TVwkWiRA9_WGmnS2IOz2wTIp1hM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 478c8f694dd96c3b0d74197050d754ce

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 7oOdMrDA-F...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.087 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:57.221Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:57.384Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:57.385Z","userId":"68b6ed957fb4912df96612aa","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 163.574 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:57.389Z"}
  console.log
    CSRF token generation: {
      sessionID: '5239294291c33613d023fd3e15935297',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vCZ65S24-OW3g-3yYRyyBZeXO4I2UN0VZwHc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5239294291c33613d023fd3e15935297

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: IfB7hrvBMp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 10.110 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:57.496Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:57.589Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:57.589Z","userId":"68b6ed957fb4912df96612b0","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.357 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:57.592Z"}
  console.log
    CSRF token generation: {
      sessionID: '424d63515f5127288b11c867f0efee3c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 7kBgaDxy-XUo9vwHIx9GxXgWc64XWVqcWDbg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 424d63515f5127288b11c867f0efee3c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YIgMCc0Ene...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.816 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed957fb4912df96612b6/stats {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:57.697Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed957fb4912df96612b6/stats {
      sessionID: '5239294291c33613d023fd3e15935297',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A5239294291c33613d023fd3e15935297.%2BhgSL%2B1QpYsd8LX%2BaxsYCRrv%2BwbLnVx5zrdx0KvgHvI',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68b6ed957fb4912df96612b6/stats [32m200[0m 130.982 ms - 267[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:58.766Z"}
  console.log
    CSRF token generation: {
      sessionID: '43e71b88049f4759e09634d407df4c3f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0UJzf8CG-nHZZNzCG3aVmrMt-JtV2whBMaHM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 43e71b88049f4759e09634d407df4c3f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JDqicibqfA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 11.802 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:58.869Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:59.019Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:13:59.019Z","userId":"68b6ed967fb4912df96612dd","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 159.344 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:59.033Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ed1936f33647a35d94d4eaa875a2cd99',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nTY7Lo0p-c8ZSDy4ZhoSXDv6J0SAhP-uAXuQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ed1936f33647a35d94d4eaa875a2cd99

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pF0ot0Jya1...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.807 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:59.141Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:13:59.237Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:13:59.238Z","userId":"68b6ed977fb4912df96612e3","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 96.779 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:59.241Z"}
  console.log
    CSRF token generation: {
      sessionID: '49fe0ecf06a52fdca20de6770e8a1a30',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 8GSO2B2b-6G7xKrz5nxeLcU-CZ_OhxotOA_s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 49fe0ecf06a52fdca20de6770e8a1a30

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YGDVOqZ4tB...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.534 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed977fb4912df96612e9/stats {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:13:59.352Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed977fb4912df96612e9/stats {
      sessionID: 'ed1936f33647a35d94d4eaa875a2cd99',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aed1936f33647a35d94d4eaa875a2cd99.RZaEsQjiKs6RP%2BGeadT4qjonod9jZdCJ98HmhOgSzT4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68b6ed977fb4912df96612e9/stats [32m200[0m 118.881 ms - 252[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:00.379Z"}
  console.log
    CSRF token generation: {
      sessionID: '89471fe6a164663bf7d01e76d39a37e0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: E9I5I79Q-4NZ45CJwaqy2tAQVjGgAgzoGLiU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 89471fe6a164663bf7d01e76d39a37e0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: J0B59fvRNL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.508 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:00.480Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:00.633Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:14:00.634Z","userId":"68b6ed987fb4912df9661310","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 153.983 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:00.637Z"}
  console.log
    CSRF token generation: {
      sessionID: '77d2ac8e6b51ca99dec4d93518498c13',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: c5ieq0es-i5FnGU-PhvffFQcjXLlxA4dGovc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 77d2ac8e6b51ca99dec4d93518498c13

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: swlJNIK6af...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.191 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:00.739Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:00.834Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:14:00.835Z","userId":"68b6ed987fb4912df9661316","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 95.628 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:00.838Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd9bb18ff6531ef33c975aaf6451e44d6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tdZFZl36-roARZm3vsuPiGoQz9DdzBXtvImI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d9bb18ff6531ef33c975aaf6451e44d6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rstw3JBu1R...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.743 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed987fb4912df966131c/stats {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:00.943Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed987fb4912df966131c/stats {
      sessionID: '77d2ac8e6b51ca99dec4d93518498c13',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A77d2ac8e6b51ca99dec4d93518498c13.OGwcFFI4JMXUbJfrNFWY0O1VZPk7297ydnGtsai6MhU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68b6ed987fb4912df966131c/stats [32m200[0m 119.959 ms - 268[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:01.979Z"}
  console.log
    CSRF token generation: {
      sessionID: '683ec0a63ae84354da56367bae4818fe',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: amm0vuuF-BT-x1y8gbK6S1RieDsdyQX8hRjo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 683ec0a63ae84354da56367bae4818fe

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Aqq3NjkUS8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.490 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:02.083Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:02.256Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:14:02.256Z","userId":"68b6ed9a7fb4912df9661343","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 173.313 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:02.260Z"}
  console.log
    CSRF token generation: {
      sessionID: '2c3f96657475123fbc0632756afe081a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 31dJm60P-RvZ40UBOanPVA7XhlGoU0bOFlKA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2c3f96657475123fbc0632756afe081a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2RoCYewcDL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.828 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:02.367Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:02.462Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:14:02.462Z","userId":"68b6ed9a7fb4912df9661349","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 95.167 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:02.466Z"}
  console.log
    CSRF token generation: {
      sessionID: '88ab1fa70b5ba0e040484685ee8af04b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: IbMez1s8-hTGMODrqa5LmMpZZcifrF1ttApw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 88ab1fa70b5ba0e040484685ee8af04b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PVByOtrwRF...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 13.275 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68b6ed9a7fb4912df966134f/stats {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:02.573Z"}
  console.log
    CSRF check for: /api/v1/operators/68b6ed9a7fb4912df966134f/stats {
      sessionID: '2c3f96657475123fbc0632756afe081a',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A2c3f96657475123fbc0632756afe081a.jWFPfHBRIu8WKtUfPBizHrVmbjcyxlGN%2BVskTqag1sQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68b6ed9a7fb4912df966134f/stats [33m400[0m 58.828 ms - 62[0m
PASS tests/integration/operator.test.js (149.431 s)
  Operator Integration Tests
    GET /api/v1/operators
      ✓ should get all operators with admin token (2392 ms)
      ✓ should filter by active status (1619 ms)
      ✓ should filter by on-shift status (1565 ms)
      ✓ should support pagination (3696 ms)
      ✓ should require authentication (3136 ms)
      ✓ should require operator management permissions (4733 ms)
    GET /api/v1/operators/:id
      ✓ should get operator by ID (3315 ms)
      ✓ should allow operators to view their own profile (3654 ms)
      ✓ should prevent operators from viewing other operators (4310 ms)
      ✓ should return 404 for non-existent operator (3975 ms)
    POST /api/v1/operators
      ✓ should create new operator (4137 ms)
      ✓ should validate required fields (4750 ms)
      ✓ should validate email format (3408 ms)
      ✓ should validate shift time format (5097 ms)
      ✓ should prevent duplicate emails (3683 ms)
      ✓ should require operators.manage permission (5539 ms)
    PATCH /api/v1/operators/:id
      ✓ should update operator details (3681 ms)
      ✓ should update password (3981 ms)
      ✓ should deactivate operator (6906 ms)
      ✓ should allow operators to update their own profile (limited fields) (5939 ms)
      ✓ should prevent operators from changing their own work station (3701 ms)
      ✓ should not allow updating operatorId (4027 ms)
      ✓ should validate email uniqueness on update (4893 ms)
    DELETE /api/v1/operators/:id
      ✓ should delete operator (12519 ms)
      ✓ should prevent deleting operator with active orders (3408 ms)
      ✓ should require operators.manage permission (4010 ms)
      ✓ should handle non-existent operator (5026 ms)
    POST /api/v1/operators/:id/reset-pin
      ✓ should reset operator PIN/password (5727 ms)
      ✓ should clear login attempts on PIN reset (4165 ms)
    GET /api/v1/operators/available
      ✓ should get available operators sorted by order count (3692 ms)
      ✓ should respect limit parameter (6410 ms)
      ✓ should only include active operators (2510 ms)
      ✓ should require authentication (1650 ms)
    PATCH /api/v1/operators/:id/stats
      ✓ should update processing statistics (1644 ms)
      ✓ should update quality score (1613 ms)
      ✓ should update both stats in one call (1588 ms)
      ✓ should validate processingTime is positive (1563 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:04.844Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:05.291Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c817a481d04c947d3f3a48074ddd7440',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: F1UlXGt2-KL7_fkPJYpsEFrVAhKuCeUCiG-8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c817a481d04c947d3f3a48074ddd7440

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Co4dC_dDe2...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.605 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:06.351Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:06.700Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 349.396 ms - 544[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:07.739Z"}
  console.log
    CSRF token generation: {
      sessionID: '0c9ec7ecbd8c923900edcf8242bc29ba',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: puO2PaD2-M8B8L1CXqA7zzejapEb2L6aOUHw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0c9ec7ecbd8c923900edcf8242bc29ba

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: v86SekXDOf...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.771 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:07.979Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":"Invalid password","success":false,"timestamp":"2025-09-02T13:14:08.068Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [33m401[0m 89.048 ms - 58[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:08.870Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f51dd05ba69107d71adf96389a939ffc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6tCF17g5-Y5Uk3YqGLALu9sC_UYEdhuUawhM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f51dd05ba69107d71adf96389a939ffc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: oTbf4eI-mw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.190 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:09.022Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":"User not found","success":false,"timestamp":"2025-09-02T13:14:09.051Z","userType":"affiliate","username":"nonexistent"}
[0mPOST /api/v1/auth/affiliate/login [33m401[0m 28.910 ms - 58[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:09.857Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a089b7c3358c99e0e0b4edbe80b4eb21',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: e4SwLxj6-nvqPByEdkYPfsDZdV4OOM2ohSqg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a089b7c3358c99e0e0b4edbe80b4eb21

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2PJq3ZBni0...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.326 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:10.140Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 150.218 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:11.102Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fb5f90520093adb54ad54927874729e9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: YXJexKIl-heVDVgDU6Xc6f7kyR_ThaRM96Zw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fb5f90520093adb54ad54927874729e9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fmdGO4b9Ic...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.986 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:11.377Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 147.614 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:12.331Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a031db78cd6a8c666b62f37d76d3e773',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mktK1Vko-VUlhHNtTV8tGSC8CKslxg51xjWA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a031db78cd6a8c666b62f37d76d3e773

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QK7Fusa3g7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.428 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:12.604Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 147.440 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:13.562Z"}
  console.log
    CSRF token generation: {
      sessionID: 'efc46431daf51f9adb8d9cc5d73c6532',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Du2VZmsk-3r2ALEFtmmL6v6PxRer04diyRss

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: efc46431daf51f9adb8d9cc5d73c6532

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YrGjbYmB5J...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 10.895 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:13.835Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 149.755 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:14.795Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c0cfb0ac543ca6bb619f165882d57c9e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: fYnKLOKf-j4q_GQQJvf8_fX9uwkX4aMmu3e0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c0cfb0ac543ca6bb619f165882d57c9e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: K11-SlU9wO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.202 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:14.937Z"}
[0mPOST /api/v1/auth/customer/login [33m401[0m 28.030 ms - 64[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:15.755Z"}
  console.log
    CSRF token generation: {
      sessionID: '314fcf609956522ab01afcf130e0da59',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: fhuY3V7E-G-akihalH3RPKyGUCGuc3wi7izU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 314fcf609956522ab01afcf130e0da59

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: B3rPPyi33O...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.768 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:15.987Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:16.139Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 151.771 ms - 544[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:16.142Z"}
[0mGET /api/v1/auth/verify [32m200[0m 29.170 ms - 129[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:16.972Z"}
  console.log
    CSRF token generation: {
      sessionID: '2fc2cd3276c0a384bab4bfab87e2e04d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: PpNcaQYY-uCJpIv1NOCs9hiIzttUBalYq5I8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2fc2cd3276c0a384bab4bfab87e2e04d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tw9WNtNj6t...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 12.101 ms - 67[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:17.120Z"}
[0mGET /api/v1/auth/verify [33m401[0m 1.699 ms - 43[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:17.925Z"}
  console.log
    CSRF token generation: {
      sessionID: '6fcd37ce8805cdf46d1ee25f5da40f92',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FrGgI5J9-k5xUNdmPFGDDMeiV8FPh-u7FAEw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6fcd37ce8805cdf46d1ee25f5da40f92

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: zr4g2brRS2...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.949 ms - 67[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:18.070Z"}
[0mGET /api/v1/auth/verify [33m401[0m 1.082 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:18.905Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd5d6b82e8dc8fca4ec511cebe9574fd7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1CFXceLk-qHyycEXCzaEGxlQTWrjGu-XmCWk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d5d6b82e8dc8fca4ec511cebe9574fd7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: HJa_US1WCV...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.356 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:19.145Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:19.296Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 151.234 ms - 544[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:19.299Z"}
[0mPOST /api/v1/auth/refresh-token [32m200[0m 126.710 ms - 409[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:20.232Z"}
  console.log
    CSRF token generation: {
      sessionID: '2d55a3e0d794320c705de97728c0d57c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: cSAhgJQv-FoC0g-aL3Wj3i2QL9xJWwLmUZqA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2d55a3e0d794320c705de97728c0d57c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: TBzAsJ3s0V...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.923 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:20.377Z"}
[0mPOST /api/v1/auth/refresh-token [33m400[0m 1.564 ms - 89[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:21.172Z"}
  console.log
    CSRF token generation: {
      sessionID: '990d1d1fd0c2b0c7b2da0325586c51e7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lag6kaoD-RbYJ0OYehAmwzkpkg6_M9akU3i4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 990d1d1fd0c2b0c7b2da0325586c51e7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YOlGD0bFMn...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.168 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:21.436Z"}
[0mPOST /api/v1/auth/refresh-token [33m401[0m 28.750 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:22.292Z"}
  console.log
    CSRF token generation: {
      sessionID: 'de1ba3e09c4822f16c3cd799706aabde',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 7AAaSoBR-poAzH1wQr3qPpfOlls_3Ojwt9bE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: de1ba3e09c4822f16c3cd799706aabde

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: SUYmcSWIW-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.690 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:22.527Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:22.672Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 144.976 ms - 544[0m
[34mdebug[39m: POST /api/v1/auth/logout {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:22.675Z"}
  console.log
    CSRF check for: /api/v1/auth/logout {
      sessionID: 'de1ba3e09c4822f16c3cd799706aabde',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ade1ba3e09c4822f16c3cd799706aabde.MRy8HQrsCqOvW%2F22F%2FbAg7bHAjRez1By7%2F%2BHyErm0Jc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/auth/logout [32m200[0m 97.889 ms - 52[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:22.776Z"}
[0mGET /api/v1/auth/verify [33m401[0m 30.727 ms - 56[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:22.810Z"}
[0mPOST /api/v1/auth/refresh-token [33m401[0m 27.675 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:23.654Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fe1c7c75f199e64c4ac88cdc5d8e60e8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NP69tgcu-_TO2kdaAAIG4tZ9dUxXz15BSMZo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fe1c7c75f199e64c4ac88cdc5d8e60e8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: J7GWNOwDxJ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.646 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:23.886Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:24.058Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 172.118 ms - 544[0m
  console.log
    Got refresh token: 082f62d43797ecf47f4e19bd33daf71da2e17a9cd893354f89ceac1177d6e8ff574348b544e803fb

      at Object.log (tests/integration/auth.test.js:805:15)

  console.log
    Starting concurrent requests...

      at Object.log (tests/integration/auth.test.js:819:15)

[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:24.070Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:24.073Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:24.075Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:24.077Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:24.078Z"}
[0mPOST /api/v1/auth/refresh-token [33m401[0m 33.677 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [33m401[0m 30.896 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [33m401[0m 33.089 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [33m401[0m 30.300 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [32m200[0m 127.234 ms - 409[0m
  console.log
    Responses received: [
      {
        status: 200,
        body: {
          success: true,
          token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4YjZlZGFmZWFkOWRhNDYzNDA2YzNiNCIsImFmZmlsaWF0ZUlkIjoiQUZGMTIzIiwicm9sZSI6ImFmZmlsaWF0ZSIsImlhdCI6MTc1NjgxODg2NCwiZXhwIjoxNzU2ODIyNDY0LCJhdWQiOiJ3YXZlbWF4LWNsaWVudCIsImlzcyI6IndhdmVtYXgtYXBpIn0.4wP1gJCT6_m1lbU7I4le1B-4mI5F1R9dgyrz5LKF0ps',
          refreshToken: '83a3031d500b5b4237df423c89a23872b7cd41bc77fac872bac82776512eae8d21e4bb6d64d597ec'
        }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      }
    ]

      at Object.log (tests/integration/auth.test.js:821:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:25.001Z"}
  console.log
    CSRF token generation: {
      sessionID: '926c59310495f089a65da9679b695fb4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: pxav0qI2-kv-0UAkEDdY6bLO7IPEiWgABqxk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 926c59310495f089a65da9679b695fb4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: FRnLkuSpc8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.827 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:25.329Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:25.498Z","userType":"affiliate","username":"johndoe999"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 168.627 ms - 547[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:26.600Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:26.757Z","userType":"affiliate","username":"johndoe999"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 157.153 ms - 547[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:26.761Z"}
[0mGET /api/v1/auth/verify [32m200[0m 29.825 ms - 129[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:26.794Z"}
[0mGET /api/v1/auth/verify [32m200[0m 29.081 ms - 129[0m
[34mdebug[39m: POST /api/v1/auth/logout {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:26.827Z"}
  console.log
    CSRF check for: /api/v1/auth/logout {
      sessionID: '926c59310495f089a65da9679b695fb4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A926c59310495f089a65da9679b695fb4.e5J6qjinJYUT%2F18SOcksfKYVAjsdhvwBjPN8ZjX4m4c',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/auth/logout [32m200[0m 94.277 ms - 52[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:26.924Z"}
[0mGET /api/v1/auth/verify [33m401[0m 29.064 ms - 56[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:26.963Z"}
[0mGET /api/v1/auth/verify [32m200[0m 29.538 ms - 129[0m
[34mdebug[39m: POST /api/v1/auth/logout {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:26.995Z"}
  console.log
    CSRF check for: /api/v1/auth/logout {
      sessionID: '926c59310495f089a65da9679b695fb4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A926c59310495f089a65da9679b695fb4.e5J6qjinJYUT%2F18SOcksfKYVAjsdhvwBjPN8ZjX4m4c',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/auth/logout [32m200[0m 93.415 ms - 52[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:27.091Z"}
[0mGET /api/v1/auth/verify [33m401[0m 29.348 ms - 56[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:27.924Z"}
  console.log
    CSRF token generation: {
      sessionID: '72575ff48caed26bbba347583c8f46a8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ugH1sdxY-v5zSIR0i9D5jSghKqyOD5GOcW68

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 72575ff48caed26bbba347583c8f46a8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dFxGzMm-sz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.040 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:28.153Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:28.301Z","userType":"administrator","username":"admin@example.com"}
info: undefined {"adminId":"ADM001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-09-02T13:14:28.301Z","userId":"68b6edb4ead9da463406c420","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.088 ms - 684[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:29.105Z"}
  console.log
    CSRF token generation: {
      sessionID: '61f7bea9c0f48a99a32bfb7cc7f3594e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mAIeoP1p--AzEWs0zlucdPnoUm1NXJdMaTAg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 61f7bea9c0f48a99a32bfb7cc7f3594e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yhp1BvCg2-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.296 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:29.353Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":"Invalid password","success":false,"timestamp":"2025-09-02T13:14:29.468Z","userType":"administrator","username":"admin@example.com"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 115.552 ms - 55[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:30.270Z"}
  console.log
    CSRF token generation: {
      sessionID: 'acb88ab9096b9395325265fca1d7aff5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: LEYG1xTE-08N0LfW4b04OewiiTwL7SCkzMEU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: acb88ab9096b9395325265fca1d7aff5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lgSeonI3RT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.232 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:30.502Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":"Account inactive","success":false,"timestamp":"2025-09-02T13:14:30.530Z","userType":"administrator","username":"admin@example.com"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 27.915 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:31.322Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dd08a35444887acc2871569d4ff0d282',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TVSUFtn7-Jd2WTSUcefvV-MCYc8ktHi_Y6-o

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dd08a35444887acc2871569d4ff0d282

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: TlUYFX4R0M...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.529 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:31.669Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-09-02T13:14:31.769Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-09-02T13:14:31.770Z","userId":"68b6edb7ead9da463406c498","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 100.992 ms - 597[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:32.584Z"}
  console.log
    CSRF token generation: {
      sessionID: 'eef33a808c1d0b84d590dc83ae8ba937',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: OWqqZIQA-ST9TO4TN3O4r0ckXglzAZx4VAXk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: eef33a808c1d0b84d590dc83ae8ba937

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: I5zn2udRoy...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.457 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:32.916Z"}
[0mPOST /api/v1/auth/operator/login [33m400[0m 1.364 ms - 115[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:33.723Z"}
  console.log
    CSRF token generation: {
      sessionID: '20ef88d54f0440f22cbd0496de424589',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MkRBEBV4-ZK2nmwG37psuWgtPrR0QcJbQcGU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 20ef88d54f0440f22cbd0496de424589

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _HMMRiiPNf...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.430 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:34.052Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":"Account inactive","success":false,"timestamp":"2025-09-02T13:14:34.080Z","userType":"operator","username":"OPR001"}
[0mPOST /api/v1/auth/operator/login [33m403[0m 29.109 ms - 91[0m
PASS tests/integration/auth.test.js (31.268 s)
  Authentication Integration Tests
    POST /api/v1/auth/affiliate/login
      ✓ should login affiliate with valid credentials (2474 ms)
      ✓ should fail with invalid credentials (1131 ms)
      ✓ should fail with non-existent username (986 ms)
    POST /api/v1/auth/customer/login
      ✓ should login customer with valid credentials (1244 ms)
      ✓ should login customer using emailOrUsername field with email (1229 ms)
      ✓ should login customer using emailOrUsername field with username (1231 ms)
      ✓ should prioritize emailOrUsername over username field (1233 ms)
      ✓ should return error with invalid emailOrUsername (959 ms)
    GET /api/v1/auth/verify
      ✓ should verify valid token (1217 ms)
      ✓ should fail with invalid token (953 ms)
      ✓ should fail with missing token (978 ms)
    POST /api/v1/auth/refresh-token
      ✓ should refresh token successfully (1327 ms)
      ✓ should fail with invalid refresh token (941 ms)
      ✓ should fail with expired refresh token (1119 ms)
    POST /api/v1/auth/logout
      ✓ should logout successfully and blacklist tokens (1362 ms)
    Rate limiting tests
      ○ skipped should rate limit login attempts
      ○ skipped should rate limit refresh token requests
    Concurrent refresh token usage
      ✓ should handle concurrent refresh token requests safely (1347 ms)
    Token blacklisting after logout
      ✓ should blacklist all active tokens on logout (2922 ms)
    POST /api/v1/auth/administrator/login
      ✓ should login administrator with valid credentials (1181 ms)
      ✓ should fail with invalid administrator credentials (1165 ms)
      ✓ should fail when administrator is inactive (1052 ms)
    POST /api/v1/auth/operator/login
      ✓ should login operator with valid credentials (1261 ms)
      ✓ should fail with invalid operator credentials (1139 ms)
      ✓ should fail when operator is inactive (1148 ms)

[32minfo[39m: Test payment form enabled and available at /test-payment {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:35.721Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:36.100Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cfee06e616131df1473136c1f42529b7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: wmU1qmKZ-MrmFy226_GFFrSgUfhhGQYEGRCw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cfee06e616131df1473136c1f42529b7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: FpKWCZnGwh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.309 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:37.009Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'cfee06e616131df1473136c1f42529b7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Acfee06e616131df1473136c1f42529b7.zSudsIiHMw5s7eNv%2FUBnzq2hihNSlaBABXaJpuHHIG0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edbdb4b6b73e184e37c3",
      "orderId": "ORD911797",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:14:37.190Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6edbdb4b6b73e184e37c3",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD911797",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:14:37.190Z",
      "updatedAt": "2025-09-02T13:14:37.190Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edbdb4b6b73e184e37c3",
      "orderId": "ORD911797",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:14:37.190Z",
      "updatedAt": "2025-09-02T13:14:37.190Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD911797
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD911797
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Ring doorbell
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 283.683 ms - 240[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:38.284Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ccb1fa820177ea2e969038696bec223d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lC8HKw0n-nvzcNTzX8rk8QgcePCLPIaCCNr4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ccb1fa820177ea2e969038696bec223d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5G0TCOQQOT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.186 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:38.559Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'ccb1fa820177ea2e969038696bec223d',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Accb1fa820177ea2e969038696bec223d.uO%2BXo6z4XuZRNrLYzyc7o4r2qAblwp2nuKRHoRz8bwE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edbeb4b6b73e184e37fa",
      "orderId": "ORD913916",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:14:38.734Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6edbeb4b6b73e184e37fa",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD913916",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:14:38.734Z",
      "updatedAt": "2025-09-02T13:14:38.734Z",
      "baseRate": 1.25,
      "estimatedTotal": 43.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edbeb4b6b73e184e37fa",
      "orderId": "ORD913916",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:14:38.734Z",
      "updatedAt": "2025-09-02T13:14:38.734Z",
      "baseRate": 1.25,
      "estimatedTotal": 43.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD913916
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $43.75
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD913916
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 15 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 1
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 273.383 ms - 241[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:39.650Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c70925b23df43bf632076d4103458727',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RqepuPwS-HTGAGiCfIY6KC5tWPpl3nXS8K1M

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c70925b23df43bf632076d4103458727

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: CB3EvFLbUa...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.115 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:39.921Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'c70925b23df43bf632076d4103458727',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac70925b23df43bf632076d4103458727.jK87uw%2F0EUVeyzUjbtCZ85ySAIa5zIlu%2Ft%2BR9bWSlVU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "INVALID",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: INVALID

      at log (server/controllers/orderController.js:132:13)

  console.log
    Customer not found with ID: INVALID

      at log (server/controllers/orderController.js:136:15)

[0mPOST /api/v1/orders [33m400[0m 65.907 ms - 49[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:40.799Z"}
  console.log
    CSRF token generation: {
      sessionID: '406b8a8fb348eeb1ce4c02d681da062e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: dbqolwEq-Pk9j3APb0akFpwW-1xjrZiNCsNE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 406b8a8fb348eeb1ce4c02d681da062e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: wALwnoks57...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.393 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:41.077Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '406b8a8fb348eeb1ce4c02d681da062e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A406b8a8fb348eeb1ce4c02d681da062e.EZ8XZgh0tw%2BII%2F5Rfcrsy92wPYKd4FEhjyFGEt1e36w',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "INVALID",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: INVALID

      at log (server/controllers/orderController.js:161:13)

  console.log
    Affiliate not found with ID: INVALID

      at log (server/controllers/orderController.js:165:15)

[0mPOST /api/v1/orders [33m400[0m 118.857 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:42.041Z"}
  console.log
    CSRF token generation: {
      sessionID: '943e2523f1e5149d2f2eb267e4c11833',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FuRKWHIp-5DRuWNeQKH45LbqZ11SucLkKgT0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 943e2523f1e5149d2f2eb267e4c11833

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ctTDDZ2PD1...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.082 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:42.342Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '943e2523f1e5149d2f2eb267e4c11833',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A943e2523f1e5149d2f2eb267e4c11833.8zI9qDBbaKSTJXbt6N50nZvUBsfiE5JXgHQtNrQm20E',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST999",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST999

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Bob Jones

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

[0mPOST /api/v1/orders [33m403[0m 118.659 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:43.281Z"}
  console.log
    CSRF token generation: {
      sessionID: '46c5ccae4e9374f166ed31ff90e3d708',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: IAew8FkL-F9Eu4zSMqdmECtfEgr1Ph4YmP2s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 46c5ccae4e9374f166ed31ff90e3d708

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: m5nrt9-Zcw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.602 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:43.553Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '46c5ccae4e9374f166ed31ff90e3d708',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A46c5ccae4e9374f166ed31ff90e3d708.HfnjYrSaYqg3SSqctDY%2BiVkbL2%2B%2FyW6CKKTtgRJZMGQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Validation errors: [
      {
        type: 'field',
        value: undefined,
        msg: 'Valid pickup date is required',
        path: 'pickupDate',
        location: 'body'
      },
      {
        type: 'field',
        value: undefined,
        msg: 'Invalid pickup time',
        path: 'pickupTime',
        location: 'body'
      },
      {
        type: 'field',
        value: undefined,
        msg: 'Number of bags must be at least 1',
        path: 'numberOfBags',
        location: 'body'
      },
      {
        type: 'field',
        value: undefined,
        msg: 'Estimated weight must be a positive number',
        path: 'estimatedWeight',
        location: 'body'
      }
    ]

      at log (server/controllers/orderController.js:106:15)

[0mPOST /api/v1/orders [33m400[0m 32.580 ms - 444[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:44.397Z"}
  console.log
    CSRF token generation: {
      sessionID: '6486a00d811508e6bce5969b302ac795',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JBs6bN87-y0Z3Wf_9wWGyV_EWrv32WZlvG-4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6486a00d811508e6bce5969b302ac795

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: SVknRgqHeb...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.854 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/ORD123456 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:44.692Z"}
[0mGET /api/v1/orders/ORD123456 [32m200[0m 114.096 ms - 865[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:45.635Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dd02efbbae0ad4d45554a696be58a6ab',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: K3XTeAfA-Mico83nbDOPsy7d9IiF-yRKqihY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dd02efbbae0ad4d45554a696be58a6ab

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: FI7oJsxev3...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.598 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/ORD123456 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:45.941Z"}
[0mGET /api/v1/orders/ORD123456 [32m200[0m 166.342 ms - 865[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:46.928Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b4862c65043731b43154f78742e54e9f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Fdj9TBdO-s06rHNdH-_ZmptzK5rd438J-mVU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b4862c65043731b43154f78742e54e9f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: R21nOPVHEN...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.975 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/ORD123456 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:47.241Z"}
[0mGET /api/v1/orders/ORD123456 [33m403[0m 56.810 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:48.125Z"}
  console.log
    CSRF token generation: {
      sessionID: '3c968fe803416415721f478f32010abe',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TQd1vc1A-hZn_vWbivd_XIHSXFbYxjxLh2Tk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3c968fe803416415721f478f32010abe

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: CGw10NPeN8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.508 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/NONEXISTENT {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:48.429Z"}
[0mGET /api/v1/orders/NONEXISTENT [33m404[0m 56.998 ms - 45[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:49.299Z"}
  console.log
    CSRF token generation: {
      sessionID: '2564d58b2c3b171eeae4044e624557aa',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ioUaKD1u-mwdf0FLdX07T1MA9dZxQPV0Vyjw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2564d58b2c3b171eeae4044e624557aa

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 10SYej2aOf...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.740 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:49.604Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '2564d58b2c3b171eeae4044e624557aa',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A2564d58b2c3b171eeae4044e624557aa.wSTeIbDGOnleOm8YbTomXN3Ecunr7VDlzzVKFWbgdhE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-status, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Update: Laundry Processing

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Status Update</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .status-update { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #2196f3; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Status Update</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>We have an update on your laundry order!</p>
                
                <div class="status-update">
                    <h2 style="color: #1976d2; margin-bottom: 15px;">Status Update</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row" style="font-size: 18px; color: #1976d2;">
                        <span class="detail-label">Status:</span> Your laundry has been received and is being processed
                    </div>
                    
                    
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Order Details</a>
                </p>
                
                <p>Thank you for choosing WaveMAX Laundry!</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPUT /api/v1/orders/ORD123456/status [32m200[0m 154.227 ms - 131[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:50.604Z"}
  console.log
    CSRF token generation: {
      sessionID: '0c64045bb66e1338a7cf8b98ecf53518',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vLGNL0B7-DfNK3LIxJAQfacEPico3sCeRnVU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0c64045bb66e1338a7cf8b98ecf53518

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5w0aVRkX7E...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.841 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:50.949Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '0c64045bb66e1338a7cf8b98ecf53518',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A0c64045bb66e1338a7cf8b98ecf53518.HlptbWh33Qks0Y3y9o%2BHvU30fYKOFTh0aHhRtrmFj9U',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-status, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Update: Ready for Pickup

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Status Update</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .status-update { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #2196f3; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Status Update</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>We have an update on your laundry order!</p>
                
                <div class="status-update">
                    <h2 style="color: #1976d2; margin-bottom: 15px;">Status Update</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row" style="font-size: 18px; color: #1976d2;">
                        <span class="detail-label">Status:</span> Your laundry is ready for pickup by the affiliate
                    </div>
                    <div class="detail-row"><span class="detail-label">Weight:</span> 25.5 lbs</div>
                    <div class="detail-row"><span class="detail-label">Final Total:</span> $48.20</div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Order Details</a>
                </p>
                
                <p>Thank you for choosing WaveMAX Laundry!</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPUT /api/v1/orders/ORD123456/status [32m200[0m 155.439 ms - 172[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:51.953Z"}
  console.log
    CSRF token generation: {
      sessionID: '44c3d6f458f1af4467745a7bf34ea5cc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: SslGm6EK-Ny1i4lCnschafk-KqS0GH778U8k

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 44c3d6f458f1af4467745a7bf34ea5cc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: t_hlDKRelQ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.952 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:52.299Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '44c3d6f458f1af4467745a7bf34ea5cc',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A44c3d6f458f1af4467745a7bf34ea5cc.M2u4noYt5DSJmsv1hTg7QN%2BpWXiZiWgzzlZj5kPJCP0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/status [33m400[0m 58.114 ms - 80[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:53.171Z"}
  console.log
    CSRF token generation: {
      sessionID: '27893983a05307a3e1878865d513e37d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DruRSlxW-cQPxjmAUkKwEiszTqf_SL8_i5kM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 27893983a05307a3e1878865d513e37d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 6Hdwg8h2kj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.078 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:53.484Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '27893983a05307a3e1878865d513e37d',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A27893983a05307a3e1878865d513e37d.EHTz7DUQrGaCcSodAQ%2B4SKxehjaCHbwaLY44qkSayXo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/status [33m403[0m 58.378 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:54.369Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b3cdd4b0fed1c6b23f1aac35c74ae0f0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: wDuulrnd-ex3b8XtFW4V7eK162feKAEAM6J0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b3cdd4b0fed1c6b23f1aac35c74ae0f0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: IYozjGyGlp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.999 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:54.689Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: 'b3cdd4b0fed1c6b23f1aac35c74ae0f0',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ab3cdd4b0fed1c6b23f1aac35c74ae0f0.cWnifrBTUEiEmGiiVB9xlAh%2FdIuS9%2BSnaBC8Gej0%2Bvg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/status [33m403[0m 59.325 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:55.570Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e6e551b8b3b33578130577dda5aaae3a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: YJ5iux40-o252wfzdpOaN9yOTa-iApQ0tGCc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e6e551b8b3b33578130577dda5aaae3a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 04s7b0byrY...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.122 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:55.884Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: 'e6e551b8b3b33578130577dda5aaae3a',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ae6e551b8b3b33578130577dda5aaae3a.mpkjPVwkKykq%2BjwdZ6zp8yun96ZCP%2Fp6e%2BUfn4mhyeM',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Order Has Been Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Order Has Been Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Your laundry pickup order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 1:14:56 PM
                    </div>
                </div>
                
                <p>If you'd like to schedule a new pickup, you can do so at any time:</p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule New Pickup</a>
                </p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" style="color: #3b82f6;">View Your Dashboard</a>
                </p>
                
                <p>We're sorry for any inconvenience. If you have any questions, please contact your affiliate partner.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>We wanted to inform you that an order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 1:14:56 PM
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Dashboard</a>
                </p>
                
                <p>Please do not proceed with this pickup. The customer may reschedule at a later time.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders/ORD123456/cancel [32m200[0m 163.208 ms - 57[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:56.935Z"}
  console.log
    CSRF token generation: {
      sessionID: '6237b2a29d5eabbac719c83980692e90',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: igkvWERv-IegFhq4HxVBfBaR6rOQPH3eqPUU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6237b2a29d5eabbac719c83980692e90

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: CWJVKbaOU9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.530 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:57.243Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: '6237b2a29d5eabbac719c83980692e90',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A6237b2a29d5eabbac719c83980692e90.jyEcByx9ZLKW1aWFcP9VLO1BSetkBOonzlGm%2BWezcxU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Order Has Been Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Order Has Been Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Your laundry pickup order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 1:14:57 PM
                    </div>
                </div>
                
                <p>If you'd like to schedule a new pickup, you can do so at any time:</p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule New Pickup</a>
                </p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" style="color: #3b82f6;">View Your Dashboard</a>
                </p>
                
                <p>We're sorry for any inconvenience. If you have any questions, please contact your affiliate partner.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>We wanted to inform you that an order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 1:14:57 PM
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Dashboard</a>
                </p>
                
                <p>Please do not proceed with this pickup. The customer may reschedule at a later time.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders/ORD123456/cancel [32m200[0m 153.557 ms - 57[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:58.218Z"}
  console.log
    CSRF token generation: {
      sessionID: '1adf3e5b03cb86456b1fe04c4f003ecb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: sNGAsbpC-ecgzLl8fjMofxBRjMnavAUO49yE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1adf3e5b03cb86456b1fe04c4f003ecb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: -x_HgJWlVu...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.326 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:58.553Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: '1adf3e5b03cb86456b1fe04c4f003ecb',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A1adf3e5b03cb86456b1fe04c4f003ecb.YHjt%2B9L8vdvs8SvN%2FKiT0FfbM5u83R4B7aiecwMV6ZU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/orders/ORD123456/cancel [33m400[0m 59.992 ms - 116[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:59.425Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fa8094473fb175044a3b4827c671efe0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KcLOfh4k-yoHhtPQHD7wrbuM0YpSOX2_Lwzs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fa8094473fb175044a3b4827c671efe0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 7WEWNP-BqA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.526 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:14:59.750Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: 'fa8094473fb175044a3b4827c671efe0',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Afa8094473fb175044a3b4827c671efe0.rlS0XnoXcZXbaTn8aZGEecXa2R%2BNifEiCTJgUpCuRJQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/orders/ORD123456/cancel [33m403[0m 58.728 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:00.655Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c2cac486a548abc96248aa3b3e2823d2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vY3nJG6v-whO2b1mm0Y16cKoD56urq71UO2U

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c2cac486a548abc96248aa3b3e2823d2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: UyM2rjpHtL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.309 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/bulk/status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:00.987Z"}
  console.log
    CSRF check for: /api/v1/orders/bulk/status {
      sessionID: 'c2cac486a548abc96248aa3b3e2823d2',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac2cac486a548abc96248aa3b3e2823d2.k14xQahm%2BPnQznZPBFdfi0A7qsbwBajZhLfiW7BkxBg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/bulk/status [32m200[0m 130.034 ms - 201[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:01.971Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a56aab1e43fc11969cb25fcb94832623',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Jbj4oVh4-9DHI-sB87kblmN6cpZEtDQqVguI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a56aab1e43fc11969cb25fcb94832623

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VVtqY0YoBI...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.939 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/bulk/status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:02.382Z"}
  console.log
    CSRF check for: /api/v1/orders/bulk/status {
      sessionID: 'a56aab1e43fc11969cb25fcb94832623',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa56aab1e43fc11969cb25fcb94832623.ROQrd4LMhHttftBVlhscSE5WfMxFYj7AerXUQxCvLUc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/bulk/status [32m200[0m 133.182 ms - 296[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:03.340Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c115e4c92747e3ca2edd1b0bca57947b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jiN7fSCo-Dmk1wYPz-PTlIgEKL2qZVpY0eXk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c115e4c92747e3ca2edd1b0bca57947b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: AERcHxYWGN...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.515 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/bulk/cancel {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:03.663Z"}
  console.log
    CSRF check for: /api/v1/orders/bulk/cancel {
      sessionID: 'c115e4c92747e3ca2edd1b0bca57947b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac115e4c92747e3ca2edd1b0bca57947b.JZAe9W%2FmKj8%2Flh%2BFlAGlZweIV2Ah8RfJPPYNZIvD1uc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/orders/bulk/cancel [32m200[0m 155.331 ms - 161[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:04.712Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b6217488f47a28f702378c50768fc2d8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nhqx0Lim-ecFH4AC7TZapjy3-8GHyLVasNOI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b6217488f47a28f702378c50768fc2d8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2gTPaAyOeU...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.122 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=csv&startDate=2025-05-01&endDate=2025-05-31&affiliateId=AFF123 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:05.043Z"}
[0mGET /api/v1/orders/export?format=csv&startDate=2025-05-01&endDate=2025-05-31&affiliateId=AFF123 [32m200[0m 93.096 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:05.955Z"}
  console.log
    CSRF token generation: {
      sessionID: '16ca6ee9d52c73a2f6018b9a65c20564',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xRwxeEGR-dsBa9mz8RMzKFWYJC9GbBdni4nU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 16ca6ee9d52c73a2f6018b9a65c20564

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NGqOQky6SO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.309 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=json&status=complete&affiliateId=AFF123 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:06.305Z"}
[0mGET /api/v1/orders/export?format=json&status=complete&affiliateId=AFF123 [32m200[0m 89.677 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:07.218Z"}
  console.log
    CSRF token generation: {
      sessionID: '555b3ee6e3a3ffdc1c87a02d3c725d56',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: I9NphOWq-rr1XJw96xxqiflZBFtsVvjw42Rc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 555b3ee6e3a3ffdc1c87a02d3c725d56

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: jUqbgLQJxw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.666 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=excel&customerId=CUST123 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:07.545Z"}
[0mGET /api/v1/orders/export?format=excel&customerId=CUST123 [31m501[0m 88.936 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:08.475Z"}
  console.log
    CSRF token generation: {
      sessionID: '0769246dfb010d21e99150b416ec5fd6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 7fVhZ1dh-gSDrjjreTFsxt4ai_TSG8JyhXII

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0769246dfb010d21e99150b416ec5fd6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 3sPzXM62UG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.490 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=csv {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:08.872Z"}
[0mGET /api/v1/orders/export?format=csv [33m403[0m 33.003 ms - 70[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:09.792Z"}
  console.log
    CSRF token generation: {
      sessionID: '7c89b468facbd9341d257c8cea721358',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Yf4VHccD-zTrwc4PpX5qnNRmM402NSSOLIUg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7c89b468facbd9341d257c8cea721358

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lO-RyQ4Gmm...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.175 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:10.100Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: '7c89b468facbd9341d257c8cea721358',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7c89b468facbd9341d257c8cea721358.Y6o%2BLUxbRrjgxi3caKIK7%2Fv5E8VculPqv60wX%2BvmIWw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [32m200[0m 92.258 ms - 223[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:11.039Z"}
  console.log
    CSRF token generation: {
      sessionID: '285c8136df111f7f3d34e56ddf7e6205',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9fwXXquh-PgAOguqW_tIhnwMobUe7QGaiwUA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 285c8136df111f7f3d34e56ddf7e6205

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: aHxZmS-vrS...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.381 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:11.357Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: '285c8136df111f7f3d34e56ddf7e6205',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A285c8136df111f7f3d34e56ddf7e6205.SB1EJut4FtOLBWsPeCIZWz7zEmXAXf%2B9ie%2BoV6H8dF4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [32m200[0m 90.989 ms - 180[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:12.254Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a5b5d4261bf48f5662763cac5f2c57d3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HN3Jen8h-x2KUZac1q5_raivvB_JHNk_6IRE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a5b5d4261bf48f5662763cac5f2c57d3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: OGAGa-A8LR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.343 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:12.576Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: 'a5b5d4261bf48f5662763cac5f2c57d3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa5b5d4261bf48f5662763cac5f2c57d3.EGk1OsflwPTYaQWJcObwSDoF1RIemRvSMbFbupux4no',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [33m400[0m 60.507 ms - 82[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:13.445Z"}
  console.log
    CSRF token generation: {
      sessionID: '06420d3ba6cbb863f8930b3670ce9025',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 8cAYu7Wr-z7RtiDSIiyOC2150dQTYR1O-8rY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 06420d3ba6cbb863f8930b3670ce9025

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: V_42KIxOoc...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.570 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:13.796Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: '06420d3ba6cbb863f8930b3670ce9025',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A06420d3ba6cbb863f8930b3670ce9025.D5abI3Z0PPMoBon5JTPFj%2FdsmcehtAlGIXfnTjPTLr0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [32m200[0m 101.898 ms - 319[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:14.722Z"}
  console.log
    CSRF token generation: {
      sessionID: '2c84ab0d9aed71c632028d4c23ad78e6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lasjio5t-I3AAa26R83rBNnmXWquaoGjsdS8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2c84ab0d9aed71c632028d4c23ad78e6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 78CeF0WC7N...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.551 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/search?search=alice&affiliateId=AFF123 {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:15.070Z"}
[0mGET /api/v1/orders/search?search=alice&affiliateId=AFF123 [32m200[0m 143.742 ms - 682[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:16.041Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dfc170e6ca09552824cbf2538fa78f7f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: UezxtPOm-Ke2YnfQPzGIwOxYLesQzH-3VZhE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dfc170e6ca09552824cbf2538fa78f7f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: YyCHlGTht-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.847 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF123/orders?status=complete&date=month {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:16.383Z"}
[0mGET /api/v1/affiliates/AFF123/orders?status=complete&date=month [32m200[0m 112.239 ms - 116[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:17.314Z"}
  console.log
    CSRF token generation: {
      sessionID: '8b9ec5a1fd25d13d7ad854677035d7d0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: pEiv3wWr-I9lXiMGyO3AtySMZAmffMhMsmhs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8b9ec5a1fd25d13d7ad854677035d7d0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pC13fQTG43...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.184 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF123/orders?status=all {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:17.670Z"}
[0mGET /api/v1/affiliates/AFF123/orders?status=all [32m200[0m 168.305 ms - 945[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:18.648Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a4b38f8a81c377d0ac11b19bad6ce721',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9NfZLecw-UfK-xeziCUKIaKnkr7MvYOnb-c0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a4b38f8a81c377d0ac11b19bad6ce721

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ecPLhVMEdW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.568 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/statistics?affiliateId=AFF123&includeStats=true {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:19.014Z"}
[0mGET /api/v1/orders/statistics?affiliateId=AFF123&includeStats=true [32m200[0m 60.857 ms - 239[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:19.889Z"}
  console.log
    CSRF token generation: {
      sessionID: '60211cce8919d4a52fb86cb27390f248',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: EvfxdCTT-E2rcsjwBb3JbaS82EKAhwDpw990

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 60211cce8919d4a52fb86cb27390f248

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XDOX74LPMp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.033 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:20.677Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '60211cce8919d4a52fb86cb27390f248',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A60211cce8919d4a52fb86cb27390f248.%2Bth5osJiKIyk87bANzZXFVuQq4CyI%2FSO8zzxzFaCJdg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ede8b4b6b73e184e3ddb",
      "orderId": "ORD266116",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:20.853Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6ede8b4b6b73e184e3ddb",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD266116",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:20.853Z",
      "updatedAt": "2025-09-02T13:15:20.853Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ede8b4b6b73e184e3ddb",
      "orderId": "ORD266116",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:20.853Z",
      "updatedAt": "2025-09-02T13:15:20.853Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD266116
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD266116
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 282.354 ms - 240[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:21.869Z"}
  console.log
    CSRF token generation: {
      sessionID: '865d8e2c3d6999cb0b568de52cda3ba3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 92WQoWG7-HKnycXKMZMjjv6c0pys0NFrx7J4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 865d8e2c3d6999cb0b568de52cda3ba3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: F1aPdN59do...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.083 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:22.736Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '865d8e2c3d6999cb0b568de52cda3ba3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A865d8e2c3d6999cb0b568de52cda3ba3.OKYa4UY3iyjtTl%2B96urf6pt6IGKqnuZQ0l0w3TAL2Z0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "numberOfBags": 3
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edeab4b6b73e184e3e20",
      "orderId": "ORD379110",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:22.927Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6edeab4b6b73e184e3e20",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD379110",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:22.927Z",
      "updatedAt": "2025-09-02T13:15:22.927Z",
      "baseRate": 2,
      "estimatedTotal": 125,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edeab4b6b73e184e3e20",
      "orderId": "ORD379110",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:22.927Z",
      "updatedAt": "2025-09-02T13:15:22.927Z",
      "baseRate": 2,
      "estimatedTotal": 125,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD379110
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $125.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD379110
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 50 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 3
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 288.000 ms - 239[0m
  console.log
    Order baseRate: 2 Expected: 2.00

      at Object.log (tests/integration/order.test.js:1139:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:24.059Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ff3dea07b82c8bc9d3b772684bd9e04c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: sMGWLPxE-ZeJGgBk7CSOmKUTONexp7gYSWns

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ff3dea07b82c8bc9d3b772684bd9e04c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: gQHMnTQJPW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.017 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:24.947Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'ff3dea07b82c8bc9d3b772684bd9e04c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aff3dea07b82c8bc9d3b772684bd9e04c.TM5PDryLG1ETcNkbTj%2Fn%2BSMdZrx9Qds8RxESY5t35Xg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST-COMM-0

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Test0 Customer

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ededb4b6b73e184e3e64",
      "orderId": "ORD540983",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.126Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6ededb4b6b73e184e3e64",
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD540983",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.126Z",
      "updatedAt": "2025-09-02T13:15:25.126Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ededb4b6b73e184e3e64",
      "orderId": "ORD540983",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.126Z",
      "updatedAt": "2025-09-02T13:15:25.126Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test0@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test0,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD540983
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD540983
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test0 Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 123 Test St, Austin, TX 78701
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 317.957 ms - 240[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:25.429Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'ff3dea07b82c8bc9d3b772684bd9e04c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aff3dea07b82c8bc9d3b772684bd9e04c.TM5PDryLG1ETcNkbTj%2Fn%2BSMdZrx9Qds8RxESY5t35Xg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST-COMM-1

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Test1 Customer

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ededb4b6b73e184e3e70",
      "orderId": "ORD389638",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.610Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6ededb4b6b73e184e3e70",
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD389638",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.610Z",
      "updatedAt": "2025-09-02T13:15:25.610Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ededb4b6b73e184e3e70",
      "orderId": "ORD389638",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.610Z",
      "updatedAt": "2025-09-02T13:15:25.610Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test1,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD389638
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD389638
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test1 Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 123 Test St, Austin, TX 78701
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 293.085 ms - 240[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:25.811Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'ff3dea07b82c8bc9d3b772684bd9e04c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aff3dea07b82c8bc9d3b772684bd9e04c.TM5PDryLG1ETcNkbTj%2Fn%2BSMdZrx9Qds8RxESY5t35Xg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST-COMM-2

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Test2 Customer

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ededb4b6b73e184e3e7c",
      "orderId": "ORD865566",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.992Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68b6ededb4b6b73e184e3e7c",
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD865566",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.992Z",
      "updatedAt": "2025-09-02T13:15:25.992Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6ededb4b6b73e184e3e7c",
      "orderId": "ORD865566",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:25.992Z",
      "updatedAt": "2025-09-02T13:15:25.992Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test2,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD865566
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD865566
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test2 Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 123 Test St, Austin, TX 78701
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 287.250 ms - 240[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:27.128Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f9fcd92b06d46e79bb11c3d0170a0201',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: uEDBZivc-AzvcJfOJlD2Na1LBGFW7R2I0evY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f9fcd92b06d46e79bb11c3d0170a0201

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: MusQ5lYDhw...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.375 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-09-02T13:15:27.946Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'f9fcd92b06d46e79bb11c3d0170a0201',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Af9fcd92b06d46e79bb11c3d0170a0201.150xgvow1dpKUg1l45%2FYzKJJsqb1QlkJ6%2B1Xi8dXjyo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1
    }

      at log (server/controllers/orderController.js:114:13)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:127:13)

  console.log
    AddOns type: undefined

      at log (server/controllers/orderController.js:128:13)

  console.log
    AddOns stringified: undefined

      at log (server/controllers/orderController.js:129:13)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:132:13)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:142:13)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:161:13)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:171:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:241:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edf0b4b6b73e184e3ec3",
      "orderId": "ORD834481",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:28.122Z"
    }

      at log (server/controllers/orderController.js:243:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "_id": "68b6edf0b4b6b73e184e3ec3",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "orderId": "ORD834481",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:28.122Z",
      "updatedAt": "2025-09-02T13:15:28.122Z",
      "baseRate": 1.25,
      "estimatedTotal": 68.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:249:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:251:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2ReminderCount": 0,
      "_id": "68b6edf0b4b6b73e184e3ec3",
      "orderId": "ORD834481",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-09-02T13:15:28.122Z",
      "updatedAt": "2025-09-02T13:15:28.122Z",
      "baseRate": 1.25,
      "estimatedTotal": 68.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:252:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1261:18)
      at Object.<anonymous>.exports.createOrder (server/controllers/orderController.js:279:7)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD834481
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $68.75
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD834481
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 15 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 1
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:135:13)

[0mPOST /api/v1/orders [32m201[0m 277.725 ms - 241[0m
PASS tests/integration/order.test.js (54.276 s)
  Order Integration Tests
    POST /api/v1/orders
      ✓ should create order as customer (2202 ms)
      ✓ should create order as affiliate for their customer (1365 ms)
      ✓ should fail with invalid customer ID (1149 ms)
      ✓ should fail with invalid affiliate ID (1241 ms)
      ✓ should fail when customer tries to create order for another customer (1239 ms)
      ✓ should validate required fields (1117 ms)
    GET /api/v1/orders/:orderId
      ✓ should return order details for customer (1237 ms)
      ✓ should return order details for affiliate (1293 ms)
      ✓ should fail for unauthorized customer (1196 ms)
      ✓ should return 404 for non-existent order (1174 ms)
    PUT /api/v1/orders/:orderId/status
      ✓ should update order status as affiliate (1305 ms)
      ✓ should update weight when processing (1349 ms)
      ✓ should prevent invalid status transitions (1217 ms)
      ✓ should fail for unauthorized affiliate (1198 ms)
      ✓ should fail for customers (1201 ms)
    POST /api/v1/orders/:orderId/cancel
      ✓ should cancel order as customer (1365 ms)
      ✓ should cancel order as affiliate (1283 ms)
      ✓ should prevent cancelling non-cancellable orders (1207 ms)
      ✓ should fail for unauthorized user (1229 ms)
    Bulk order operations
      ✓ should update multiple orders status in bulk (1315 ms)
      ✓ should handle partial bulk update failures (1370 ms)
      ✓ should cancel multiple orders in bulk (1358 ms)
    Order export functionality
      ✓ should export orders as CSV (1255 ms)
      ✓ should export orders as JSON (1264 ms)
      ✓ should export orders as Excel (1257 ms)
      ✓ should respect export permissions (1317 ms)
    Payment status updates
      ✓ should update payment status (1246 ms)
      ✓ should handle payment failure (1213 ms)
      ✓ should prevent payment status update on non-complete orders (1192 ms)
      ✓ should record refund (1266 ms)
    Order filtering and search
      ✓ should search orders by customer name (1329 ms)
      ✓ should filter orders by multiple criteria (1273 ms)
      ✓ should filter by pickup time slots (1334 ms)
      ✓ should provide aggregated statistics with filters (1241 ms)
    Commission Calculation Tests
      ✓ should calculate commission correctly when order is completed (1978 ms)
      ✓ should use dynamic WDF rate from SystemConfig (2190 ms)
      ✓ should calculate commission for multiple orders (3069 ms)
      ✓ should handle high delivery fee scenarios (2006 ms)

Summary of all failing tests
FAIL tests/integration/v2-complete-payment-flow.test.js (11.197 s)
  ● V2 Complete Payment Flow › Step 3: Order Processing and Weight Update › should update order with actual weight and trigger payment request

    TypeError: Cannot set properties of null (setting 'actualWeight')

      177 |       
      178 |       // Simulate operator weighing the bags
    > 179 |       testOrder.actualWeight = 10; // 10 lbs
          |                             ^
      180 |       testOrder.status = 'processing';
      181 |       testOrder.bagsWeighed = 2;
      182 |       testOrder.bags = [

      at Object.<anonymous> (tests/integration/v2-complete-payment-flow.test.js:179:29)

  ● V2 Complete Payment Flow › Step 5: Order Completion › should mark order as ready for pickup after payment verification

    TypeError: Cannot read properties of null (reading 'bags')

      316 |       // Mark all bags as processed
      317 |       const order = await Order.findById(testOrder._id);
    > 318 |       order.bags.forEach(bag => {
          |             ^
      319 |         bag.status = 'processed';
      320 |       });
      321 |       order.bagsProcessed = 2;

      at Object.bags (tests/integration/v2-complete-payment-flow.test.js:318:13)

FAIL tests/integration/v2-payment-flow.test.js (18.932 s)
  ● V2 Payment Flow Integration Tests › V2 Pickup Scheduling › should create order without prepayment for V2 customer

    ValidationError: Order validation failed: customerId: Path `customerId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Link Generation › should generate payment links when order is weighed

    ValidationError: Order validation failed: customerId: Path `customerId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Link Generation › should send payment request email

    TypeError: Cannot read properties of null (reading 'customer')

      268 |       const emailSpy = jest.spyOn(emailService, 'sendV2PaymentRequest');
      269 |       
    > 270 |       await emailService.sendV2PaymentRequest(order, order.customer, {
          |                                                            ^
      271 |         amount: 45.00,
      272 |         links: {
      273 |           venmo: 'venmo://paycharge?txn=pay&recipients=@wavemax&amount=45&note=Order%20' + orderId.slice(-8).toUpperCase(),

      at Object.customer (tests/integration/v2-payment-flow.test.js:270:60)

  ● V2 Payment Flow Integration Tests › Payment Confirmation Flow › should handle customer payment confirmation

    expect(received).toContain(expected) // indexOf

    Expected value: 500
    Received array: [200, 400]

      306 |         return;
      307 |       }
    > 308 |       expect([200, 400]).toContain(response.status);
          |                          ^
      309 |       if (response.status === 200) {
      310 |         expect(response.body.message).toContain('confirmation');
      311 |       }

      at Object.toContain (tests/integration/v2-payment-flow.test.js:308:26)

  ● V2 Payment Flow Integration Tests › Payment Confirmation Flow › should verify payment through email scanning

    TypeError: Cannot read properties of undefined (reading 'slice')

      322 |         from: 'payments@venmo.com',
      323 |         subject: 'Payment received from V2Test Customer',
    > 324 |         text: `You received $45.00 from V2Test Customer. Note: Order ${orderId.slice(-8).toUpperCase()}`,
          |                                                                                ^
      325 |         date: new Date()
      326 |       };
      327 |

      at Object.slice (tests/integration/v2-payment-flow.test.js:324:80)

  ● V2 Payment Flow Integration Tests › Payment Confirmation Flow › should mark order as paid when payment verified

    TypeError: Cannot set properties of null (setting 'v2PaymentStatus')

      339 |       // Simulate payment verification
      340 |       const order = await Order.findById(orderId);
    > 341 |       order.v2PaymentStatus = 'verified';
          |                            ^
      342 |       order.v2PaymentConfirmedAt = new Date();
      343 |       order.v2PaymentMethod = 'venmo';
      344 |       order.v2PaymentAmount = 45.00;

      at Object.<anonymous> (tests/integration/v2-payment-flow.test.js:341:28)

  ● V2 Payment Flow Integration Tests › Payment Reminder System › should send reminder after 30 minutes

    ValidationError: Order validation failed: customerId: Path `customerId` is required., status: `weighed` is not a valid enum value for path `status`.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Reminder System › should send hourly reminders after first 30 minutes

    ValidationError: Order validation failed: customerId: Path `customerId` is required., status: `weighed` is not a valid enum value for path `status`.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Payment Reminder System › should escalate to admin after 4 hours

    ValidationError: Order validation failed: customerId: Path `customerId` is required., status: `weighed` is not a valid enum value for path `status`.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9

  ● V2 Payment Flow Integration Tests › Pickup Ready Notification › should not send pickup ready if payment not verified

    ValidationError: Order validation failed: customerId: Path `customerId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3343:32)
      at node_modules/mongoose/lib/document.js:3104:17
      at node_modules/mongoose/lib/schemaType.js:1407:9


Test Suites: 2 failed, 6 skipped, 128 passed, 130 of 136 total
Tests:       12 failed, 67 skipped, 2404 passed, 2483 total
Snapshots:   0 total
Time:        835.188 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
