<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WaveMAX Laundry - Customer Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .wavemax-blue {
            background-color: #1e3a8a;
        }
        .wavemax-light-blue {
            background-color: #3b82f6;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Navigation -->
    <nav class="wavemax-blue text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <a href="index.html" class="text-2xl font-bold">WaveMAX Laundry</a>
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="#" id="logoutBtn" class="hover:text-blue-200">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Dashboard Header -->
    <div class="bg-white border-b">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-2xl font-bold" id="welcomeMessage">Customer Dashboard</h1>
                    <p class="text-gray-600" id="customerId">Loading customer information...</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <a href="#" id="schedulePickupBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Schedule Pickup</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Content -->
    <div class="container mx-auto px-4 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-600 mb-2">Active Orders</h3>
                <p class="text-3xl font-bold" id="activeOrders">0</p>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-600 mb-2">Completed Orders</h3>
                <p class="text-3xl font-bold" id="completedOrders">0</p>
            </div>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-600 mb-2">Total Spent</h3>
                <p class="text-3xl font-bold" id="totalSpent">$0.00</p>
            </div>
        </div>
        
        <!-- Dashboard Tabs -->
        <div class="mb-6 border-b">
            <div class="flex overflow-x-auto">
                <button class="tab-btn px-6 py-3 font-bold border-b-2 border-blue-600 text-blue-600" data-tab="orders">My Orders</button>
                <button class="tab-btn px-6 py-3 font-bold border-b-2 border-transparent hover:text-blue-600" data-tab="schedule">Schedule</button>
                <button class="tab-btn px-6 py-3 font-bold border-b-2 border-transparent hover:text-blue-600" data-tab="profile">My Profile</button>
                <button class="tab-btn px-6 py-3 font-bold border-b-2 border-transparent hover:text-blue-600" data-tab="bags">My Bags</button>
            </div>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content active" id="orders-tab">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">My Orders</h2>
                <div>
                    <select id="orderStatusFilter" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="all">All Orders</option>
                        <option value="active" selected>Active Orders</option>
                        <option value="completed">Completed Orders</option>
                        <option value="cancelled">Cancelled Orders</option>
                    </select>
                </div>
            </div>
            
            <!-- Orders Table -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pickup</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Delivery</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Weight</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody" class="divide-y divide-gray-200">
                            <!-- Orders will be inserted here dynamically -->
                            <tr class="text-center">
                                <td colspan="8" class="px-6 py-4 text-gray-500">Loading orders...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="ordersPagination" class="px-6 py-3 flex justify-between items-center bg-gray-50">
                    <p class="text-sm text-gray-700">Showing <span id="ordersShowing">0</span> of <span id="ordersTotal">0</span> orders</p>
                    <div class="flex space-x-2">
                        <button id="prevOrdersPage" class="px-3 py-1 border rounded text-sm disabled:opacity-50">Previous</button>
                        <button id="nextOrdersPage" class="px-3 py-1 border rounded text-sm disabled:opacity-50">Next</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="schedule-tab">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Schedule Pickup</h2>
            </div>
            
            <!-- Calendar View -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-bold mb-4">Your Schedule</h3>
                
                <div class="mb-6">
                    <p class="mb-2">Select a date to schedule your next laundry pickup:</p>
                    
                    <!-- Simple Calendar Implementation -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <button id="prevMonth" class="px-3 py-1 border rounded-lg hover:bg-gray-100">Previous</button>
                            <h4 id="currentMonth" class="text-lg font-bold">January 2025</h4>
                            <button id="nextMonth" class="px-3 py-1 border rounded-lg hover:bg-gray-100">Next</button>
                        </div>
                        
                        <div class="grid grid-cols-7 gap-2 mb-2 text-center">
                            <div class="text-gray-500 font-medium">Sun</div>
                            <div class="text-gray-500 font-medium">Mon</div>
                            <div class="text-gray-500 font-medium">Tue</div>
                            <div class="text-gray-500 font-medium">Wed</div>
                            <div class="text-gray-500 font-medium">Thu</div>
                            <div class="text-gray-500 font-medium">Fri</div>
                            <div class="text-gray-500 font-medium">Sat</div>
                        </div>
                        
                        <div id="calendarDays" class="grid grid-cols-7 gap-2">
                            <!-- Calendar days will be inserted here dynamically -->
                        </div>
                    </div>
                </div>
                
                <!-- Pickup Form (initially hidden) -->
                <div id="pickupForm" style="display: none;">
                    <h4 class="text-lg font-bold mb-4">Schedule for <span id="selectedDate">January 1, 2025</span></h4>
                    
                    <form id="schedulePickupForm" class="space-y-4">
                        <!-- Hidden CSRF token -->
                        <input type="hidden" name="_csrf" value="{{csrfToken}}">
                        
                        <input type="hidden" id="pickupDate" name="pickupDate">
                        
                        <div>
                            <label for="pickupTime" class="block text-gray-700 mb-2">Preferred Pickup Time *</label>
                            <select id="pickupTime" name="pickupTime" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select a time</option>
                                <option value="morning">Morning (8am - 12pm)</option>
                                <option value="afternoon">Afternoon (12pm - 5pm)</option>
                                <option value="evening">Evening (5pm - 8pm)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="specialPickupInstructions" class="block text-gray-700 mb-2">Special Pickup Instructions (Optional)</label>
                            <textarea id="specialPickupInstructions" name="specialPickupInstructions" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Ring doorbell, leave at front door, etc."></textarea>
                        </div>
                        
                        <div>
                            <label for="estimatedSize" class="block text-gray-700 mb-2">Estimated Laundry Size *</label>
                            <select id="estimatedSize" name="estimatedSize" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select an option</option>
                                <option value="small">Small (1-2 bags, approx. 10-15 lbs)</option>
                                <option value="medium">Medium (3-4 bags, approx. 16-30 lbs)</option>
                                <option value="large">Large (5+ bags, approx. 31+ lbs)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="serviceNotes" class="block text-gray-700 mb-2">Service Notes (Optional)</label>
                            <textarea id="serviceNotes" name="serviceNotes" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Any special handling requests, sorting preferences, etc."></textarea>
                        </div>
                        
                        <div>
                            <label for="deliveryDate" class="block text-gray-700 mb-2">Preferred Delivery Date *</label>
                            <input type="date" id="deliveryDate" name="deliveryDate" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="deliveryTime" class="block text-gray-700 mb-2">Preferred Delivery Time *</label>
                            <select id="deliveryTime" name="deliveryTime" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select a time</option>
                                <option value="morning">Morning (8am - 12pm)</option>
                                <option value="afternoon">Afternoon (12pm - 5pm)</option>
                                <option value="evening">Evening (5pm - 8pm)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="specialDeliveryInstructions" class="block text-gray-700 mb-2">Special Delivery Instructions (Optional)</label>
                            <textarea id="specialDeliveryInstructions" name="specialDeliveryInstructions" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Leave on porch, text upon arrival, etc."></textarea>
                        </div>
                        
                        <div class="border-t pt-4">
                            <button type="submit" class="bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition">Schedule Pickup</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Recurring Schedule (if applicable) -->
            <div class="bg-white rounded-lg shadow-md p-6" id="recurringScheduleSection">
                <h3 class="text-lg font-bold mb-4">Recurring Schedule</h3>
                <div id="recurringScheduleDetails">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="profile-tab">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">My Profile</h2>
            </div>
            
            <!-- Profile Information -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <form id="profileForm" class="space-y-6">
                        <!-- Hidden CSRF token -->
                        <input type="hidden" name="_csrf" value="{{csrfToken}}">
                        
                        <div>
                            <h3 class="text-lg font-bold mb-4">Personal Information</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label for="firstName" class="block text-gray-700 mb-2">First Name</label>
                                    <input type="text" id="firstName" name="firstName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="lastName" class="block text-gray-700 mb-2">Last Name</label>
                                    <input type="text" id="lastName" name="lastName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="email" class="block text-gray-700 mb-2">Email Address</label>
                                    <input type="email" id="email" name="email" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="phone" class="block text-gray-700 mb-2">Phone Number</label>
                                    <input type="tel" id="phone" name="phone" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold mb-4">Address Information</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="md:col-span-2">
                                    <label for="address" class="block text-gray-700 mb-2">Street Address</label>
                                    <input type="text" id="address" name="address" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="city" class="block text-gray-700 mb-2">City</label>
                                    <input type="text" id="city" name="city" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="state" class="block text-gray-700 mb-2">State</label>
                                    <input type="text" id="state" name="state" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="zipCode" class="block text-gray-700 mb-2">ZIP Code</label>
                                    <input type="text" id="zipCode" name="zipCode" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div class="md:col-span-2">
                                    <label for="deliveryInstructions" class="block text-gray-700 mb-2">Delivery Instructions</label>
                                    <textarea id="deliveryInstructions" name="deliveryInstructions" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold mb-4">Service Preferences</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="md:col-span-2">
                                    <label for="serviceFrequency" class="block text-gray-700 mb-2">Preferred Service Frequency</label>
                                    <select id="serviceFrequency" name="serviceFrequency" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="weekly">Weekly</option>
                                        <option value="biweekly">Bi-weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="onDemand">On-demand only</option>
                                    </select>
                                </div>
                                
                                <div id="recurringScheduleContainer" class="md:col-span-2">
                                    <h4 class="font-bold mb-2">Preferred Day and Time</h4>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label for="preferredDay" class="block text-gray-700 mb-2">Preferred Day</label>
                                            <select id="preferredDay" name="preferredDay" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="monday">Monday</option>
                                                <option value="tuesday">Tuesday</option>
                                                <option value="wednesday">Wednesday</option>
                                                <option value="thursday">Thursday</option>
                                                <option value="friday">Friday</option>
                                                <option value="saturday">Saturday</option>
                                                <option value="sunday">Sunday</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label for="preferredTime" class="block text-gray-700 mb-2">Preferred Time</label>
                                            <select id="preferredTime" name="preferredTime" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="morning">Morning (8am - 12pm)</option>
                                                <option value="afternoon">Afternoon (12pm - 5pm)</option>
                                                <option value="evening">Evening (5pm - 8pm)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="md:col-span-2">
                                    <label for="specialInstructions" class="block text-gray-700 mb-2">Special Instructions for Laundry</label>
                                    <textarea id="specialInstructions" name="specialInstructions" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold mb-4">Change Password</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label for="currentPassword" class="block text-gray-700 mb-2">Current Password</label>
                                    <input type="password" id="currentPassword" name="currentPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="newPassword" class="block text-gray-700 mb-2">New Password</label>
                                    <input type="password" id="newPassword" name="newPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="confirmPassword" class="block text-gray-700 mb-2">Confirm New Password</label>
                                    <input type="password" id="confirmPassword" name="confirmPassword" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold mb-4">Payment Information</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="md:col-span-2">
                                    <label for="cardholderName" class="block text-gray-700 mb-2">Cardholder Name</label>
                                    <input type="text" id="cardholderName" name="cardholderName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 mb-2">Card Number</label>
                                    <div class="flex items-center w-full px-4 py-2 border rounded-lg bg-gray-100">
                                        <span id="cardLastFour">•••• •••• •••• ••••</span>
                                    </div>
                                </div>
                                
                                <div>
                                    <a href="#" id="updateCardBtn" class="inline-block mt-8 text-blue-600 hover:underline">Update Card Information</a>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <button type="submit" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="bags-tab">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">My Laundry Bags</h2>
                <a href="#" id="requestNewBagBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">Request New Bag</a>
            </div>
            
            <!-- Laundry Bags -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bag ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Barcode</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Used</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bagsTableBody" class="divide-y divide-gray-200">
                            <!-- Bags will be inserted here dynamically -->
                            <tr class="text-center">
                                <td colspan="6" class="px-6 py-4 text-gray-500">Loading bags...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="mt-6 bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-bold mb-4">Bag Guidelines</h3>
                <ul class="list-disc pl-6 space-y-2">
                    <li>Each bag has a unique barcode for tracking your laundry</li>
                    <li>Always use the provided bags for your laundry pickups</li>
                    <li>If a bag is lost or damaged, request a replacement</li>
                    <li>There may be a small replacement fee for lost bags</li>
                    <li>Keep bags clean and free of damage</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 WaveMAX Laundry. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Extract customer ID from URL query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const customerId = urlParams.get('id');
            
            if (!customerId) {
                alert('No customer ID provided. Redirecting to homepage.');
                window.location.href = 'index.html';
                return;
            }
            
            // Set customer ID in the page
            document.getElementById('customerId').textContent = `Customer ID: ${customerId}`;
            
            // Load customer data
            loadCustomerData(customerId);
            
            // Load dashboard statistics
            loadDashboardStats(customerId);
            
            // Setup tab navigation
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons and tabs
                    tabButtons.forEach(btn => {
                        btn.classList.remove('border-blue-600');
                        btn.classList.remove('text-blue-600');
                        btn.classList.add('border-transparent');
                    });
                    
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Add active class to clicked button and corresponding tab
                    this.classList.add('border-blue-600');
                    this.classList.add('text-blue-600');
                    this.classList.remove('border-transparent');
                    
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Load tab-specific data
                    if (tabId === 'orders') {
                        loadOrders(customerId);
                    } else if (tabId === 'schedule') {
                        initializeCalendar(customerId);
                    } else if (tabId === 'profile') {
                        loadProfile(customerId);
                    } else if (tabId === 'bags') {
                        loadBags(customerId);
                    }
                });
            });
            
            // Setup schedule pickup button
            document.getElementById('schedulePickupBtn').addEventListener('click', function(e) {
                e.preventDefault();
                // Switch to schedule tab
                document.querySelector('.tab-btn[data-tab="schedule"]').click();
            });
            
            // Setup order status filter
            document.getElementById('orderStatusFilter').addEventListener('change', function() {
                loadOrders(customerId);
            });
            
            // Setup profile form submission
            document.getElementById('profileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Collect form data
                const formData = new FormData(this);
                const profileData = {};
                
                formData.forEach((value, key) => {
                    profileData[key] = value;
                });
                
                // Validate password fields if they were filled
                if (profileData.newPassword) {
                    if (!profileData.currentPassword) {
                        alert('Please enter your current password to change your password.');
                        return;
                    }
                    
                    if (profileData.newPassword !== profileData.confirmPassword) {
                        alert('New passwords do not match.');
                        return;
                    }
                }
                
                // In a real implementation, this would be sent to the server
                console.log('Profile Update Data:', profileData);
                
                // Update customer data in localStorage for demo purposes
                const storedCustomers = JSON.parse(localStorage.getItem('wavemax_customers')) || {};
                if (storedCustomers[customerId]) {
                    // Update fields
                    Object.keys(profileData).forEach(key => {
                        if (profileData[key] && key !== 'currentPassword' && key !== 'newPassword' && key !== 'confirmPassword') {
                            storedCustomers[customerId][key] = profileData[key];
                        }
                    });
                    
                    localStorage.setItem('wavemax_customers', JSON.stringify(storedCustomers));
                }
                
                alert('Profile updated successfully!');
            });
            
            // Setup scheduling form
            document.getElementById('schedulePickupForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Collect form data
                const formData = new FormData(this);
                const pickupData = {};
                
                formData.forEach((value, key) => {
                    pickupData[key] = value;
                });
                
                // Add customer ID and affiliate ID
                const storedCustomers = JSON.parse(localStorage.getItem('wavemax_customers')) || {};
                const customer = storedCustomers[customerId];
                
                if (customer) {
                    pickupData.customerId = customerId;
                    pickupData.affiliateId = customer.affiliateId;
                    
                    // Generate order ID
                    const orderId = 'ORD' + Math.floor(100000 + Math.random() * 900000);
                    
                    // Create order object
                    const order = {
                        orderId,
                        customerId,
                        affiliateId: customer.affiliateId,
                        pickupDate: pickupData.pickupDate,
                        pickupTime: pickupData.pickupTime,
                        specialPickupInstructions: pickupData.specialPickupInstructions,
                        estimatedSize: pickupData.estimatedSize,
                        serviceNotes: pickupData.serviceNotes,
                        deliveryDate: pickupData.deliveryDate,
                        deliveryTime: pickupData.deliveryTime,
                        specialDeliveryInstructions: pickupData.specialDeliveryInstructions,
                        status: 'scheduled',
                        createdAt: new Date().toISOString()
                    };
                    
                    // In a real implementation, this would be sent to the server
                    console.log('New Pickup Order:', order);
                    
                    // Store order in localStorage for demo purposes
                    const storedOrders = JSON.parse(localStorage.getItem('wavemax_orders')) || {};
                    storedOrders[orderId] = order;
                    localStorage.setItem('wavemax_orders', JSON.stringify(storedOrders));
                    
                    alert('Pickup scheduled successfully!');
                    
                    // Refresh orders list and return to orders tab
                    document.querySelector('.tab-btn[data-tab="orders"]').click();
                } else {
                    alert('Customer information not found.');
                }
            });
            
            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                // Clear customer session
                localStorage.removeItem('currentCustomer');
                // Redirect to login page
                window.location.href = 'index.html';
            });
            
            // Request new bag button
            document.getElementById('requestNewBagBtn').addEventListener('click', function(e) {
                e.preventDefault();
                
                // In a real implementation, this would send a request to the server
                alert('New bag request sent! Your service provider will contact you soon.');
            });
            
            // Update card button
            document.getElementById('updateCardBtn').addEventListener('click', function(e) {
                e.preventDefault();
                
                // In a real implementation, this would open a secure form to update card details
                alert('This feature is not available in the demo. In a real implementation, this would open a secure form to update your payment information.');
            });
            
            // Load initial data
            loadOrders(customerId);
        });
        
        // Load customer data
        function loadCustomerData(customerId) {
            // In a real implementation, this would make an API call to get customer data
            // For demo purposes, we'll use localStorage
            const storedCustomers = JSON.parse(localStorage.getItem('wavemax_customers')) || {};
            
            if (storedCustomers[customerId]) {
                const customer = storedCustomers[customerId];
                document.getElementById('welcomeMessage').textContent = `Welcome, ${customer.firstName} ${customer.lastName}!`;
                
                // Load affiliate information
                const affiliateId = customer.affiliateId;
                const storedAffiliates = JSON.parse(localStorage.getItem('wavemax_affiliates')) || {};
                
                if (storedAffiliates[affiliateId]) {
                    const affiliate = storedAffiliates[affiliateId];
                    
                    // Set schedule pickup button with affiliate ID
                    document.getElementById('schedulePickupBtn').href = `schedule-pickup.html?affiliate=${affiliateId}&customer=${customerId}`;
                }
            } else {
                // Create mock customer data for demo
                const mockCustomer = {
                    customerId: customerId,
                    firstName: 'Demo',
                    lastName: 'Customer',
                    email: 'demo@example.com',
                    phone: '(555) 123-4567',
                    address: '123 Main St',
                    city: 'Austin',
                    state: 'TX',
                    zipCode: '78701',
                    deliveryInstructions: 'Leave at front door',
                    serviceFrequency: 'weekly',
                    preferredDay: 'monday',
                    preferredTime: 'morning',
                    specialInstructions: 'Separate colors and whites',
                    affiliateId: 'AFF123456'
                };
                
                storedCustomers[customerId] = mockCustomer;
                localStorage.setItem('wavemax_customers', JSON.stringify(storedCustomers));
                
                document.getElementById('welcomeMessage').textContent = `Welcome, ${mockCustomer.firstName} ${mockCustomer.lastName}!`;
                
                // Set schedule pickup button with affiliate ID
                document.getElementById('schedulePickupBtn').href = `schedule-pickup.html?affiliate=${mockCustomer.affiliateId}&customer=${customerId}`;
            }
        }
        
        // Load dashboard statistics
        function loadDashboardStats(customerId) {
            // In a real implementation, this would make an API call to get statistics
            // For demo purposes, we'll create mock data
            
            // Get orders for this customer
            const storedOrders = JSON.parse(localStorage.getItem('wavemax_orders')) || {};
            let activeOrderCount = 0;
            let completedOrderCount = 0;
            let totalSpent = 0;
            
            Object.values(storedOrders).forEach(order => {
                if (order.customerId === customerId) {
                    if (['scheduled', 'picked_up', 'processing', 'ready_for_delivery'].includes(order.status)) {
                        activeOrderCount++;
                    } else if (order.status === 'delivered') {
                        completedOrderCount++;
                        
                        // Add to total spent
                        // In a real implementation, this would use actual order totals
                        let orderTotal = 0;
                        
                        if (order.actualTotal) {
                            orderTotal = order.actualTotal;
                        } else {
                            // Estimate based on size
                            let estimatedWeight = 0;
                            if (order.estimatedSize === 'small') {
                                estimatedWeight = 12.5; // average of 10-15 lbs
                            } else if (order.estimatedSize === 'medium') {
                                estimatedWeight = 23; // average of 16-30 lbs
                            } else if (order.estimatedSize === 'large') {
                                estimatedWeight = 35; // approximate for 31+ lbs
                            }
                            
                            const wdfRate = 1.89; // per pound
                            const deliveryFee = 5.99; // default if not specified
                            orderTotal = (estimatedWeight * wdfRate + deliveryFee);
                        }
                        
                        totalSpent += orderTotal;
                    }
                }
            });
            
            // Update stats in the UI
            document.getElementById('activeOrders').textContent = activeOrderCount;
            document.getElementById('completedOrders').textContent = completedOrderCount;
            document.getElementById('totalSpent').textContent = `$${totalSpent.toFixed(2)}`;
        }
        
        // Load orders for the orders tab
        function loadOrders(customerId) {
            // In a real implementation, this would make an API call to get orders
            // For demo purposes, we'll generate mock data
            
            const ordersTableBody = document.getElementById('ordersTableBody');
            ordersTableBody.innerHTML = '';
            
            // Get stored orders or generate mock data
            const storedOrders = JSON.parse(localStorage.getItem('wavemax_orders')) || {};
            let ordersForCustomer = [];
            
            // If we have stored orders, filter for this customer
            if (Object.keys(storedOrders).length > 0) {
                Object.entries(storedOrders).forEach(([orderId, order]) => {
                    if (order.customerId === customerId) {
                        ordersForCustomer.push({
                            orderId,
                            ...order
                        });
                    }
                });
            }
            
            // If no stored orders for this customer, generate mock data
            if (ordersForCustomer.length === 0) {
                // Generate mock orders
                const orderStatuses = ['scheduled', 'picked_up', 'processing', 'ready_for_delivery', 'delivered'];
                
                for (let i = 0; i < 5; i++) {
                    const orderDate = new Date();
                    orderDate.setDate(orderDate.getDate() - Math.floor(Math.random() * 30));
                    
                    const pickupDate = new Date(orderDate);
                    pickupDate.setDate(pickupDate.getDate() + 1);
                    
                    const deliveryDate = new Date(pickupDate);
                    deliveryDate.setDate(deliveryDate.getDate() + 2);
                    
                    const status = orderStatuses[Math.floor(Math.random() * orderStatuses.length)];
                    
                    // Generate a weight if status is processed or delivered
                    let weight = null;
                    if (['processing', 'ready_for_delivery', 'delivered'].includes(status)) {
                        weight = (Math.random() * 20 + 10).toFixed(2);
                    }
                    
                    const order = {
                        orderId: 'ORD' + Math.floor(100000 + Math.random() * 900000),
                        customerId: customerId,
                        affiliateId: 'AFF123456',
                        pickupDate: pickupDate.toISOString(),
                        pickupTime: ['morning', 'afternoon', 'evening'][Math.floor(Math.random() * 3)],
                        deliveryDate: deliveryDate.toISOString(),
                        deliveryTime: ['morning', 'afternoon', 'evening'][Math.floor(Math.random() * 3)],
                        status: status,
                        estimatedSize: ['small', 'medium', 'large'][Math.floor(Math.random() * 3)],
                        actualWeight: weight,
                        createdAt: orderDate.toISOString()
                    };
                    
                    ordersForCustomer.push(order);
                }
                
                // Store mock orders in localStorage
                const allOrders = {...storedOrders};
                ordersForCustomer.forEach(order => {
                    allOrders[order.orderId] = order;
                });
                localStorage.setItem('wavemax_orders', JSON.stringify(allOrders));
            }
            
            // Filter based on status dropdown
            const statusFilter = document.getElementById('orderStatusFilter').value;
            if (statusFilter === 'active') {
                ordersForCustomer = ordersForCustomer.filter(order => 
                    ['scheduled', 'picked_up', 'processing', 'ready_for_delivery'].includes(order.status)
                );
            } else if (statusFilter === 'completed') {
                ordersForCustomer = ordersForCustomer.filter(order => order.status === 'delivered');
            } else if (statusFilter === 'cancelled') {
                ordersForCustomer = ordersForCustomer.filter(order => order.status === 'cancelled');
            }
            
            // Sort orders by date (newest first)
            ordersForCustomer.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            // Update UI with orders
            if (ordersForCustomer.length === 0) {
                ordersTableBody.innerHTML = '<tr class="text-center"><td colspan="8" class="px-6 py-4 text-gray-500">No orders found.</td></tr>';
            } else {
                ordersForCustomer.forEach(order => {
                    const row = document.createElement('tr');
                    
                    // Format dates for display
                    const orderDate = new Date(order.createdAt);
                    const pickupDate = new Date(order.pickupDate);
                    const deliveryDate = new Date(order.deliveryDate);
                    
                    // Format times
                    const pickupTime = order.pickupTime === 'morning' ? '8am-12pm' : 
                                      order.pickupTime === 'afternoon' ? '12pm-5pm' : 
                                      '5pm-8pm';
                    
                    const deliveryTime = order.deliveryTime === 'morning' ? '8am-12pm' : 
                                        order.deliveryTime === 'afternoon' ? '12pm-5pm' : 
                                        '5pm-8pm';
                    
                    // Calculate total if available
                    let totalText = 'Pending';
                    if (order.actualWeight) {
                        const wdfRate = 1.89; // per pound
                        const deliveryFee = 5.99; // default
                        const total = (parseFloat(order.actualWeight) * wdfRate + deliveryFee).toFixed(2);
                        totalText = `$${total}`;
                    }
                    
                    // Create status badge
                    let statusBadge = '';
                    switch (order.status) {
                        case 'scheduled':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Scheduled</span>';
                            break;
                        case 'picked_up':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Picked Up</span>';
                            break;
                        case 'processing':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">Processing</span>';
                            break;
                        case 'ready_for_delivery':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">Ready for Delivery</span>';
                            break;
                        case 'delivered':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Delivered</span>';
                            break;
                        case 'cancelled':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Cancelled</span>';
                            break;
                    }
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${order.orderId}</div>
                            <div class="text-sm text-gray-500">${orderDate.toLocaleDateString()}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${pickupDate.toLocaleDateString()}</div>
                            <div class="text-sm text-gray-500">${pickupTime}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${deliveryDate.toLocaleDateString()}</div>
                            <div class="text-sm text-gray-500">${deliveryTime}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${order.actualWeight ? `${order.actualWeight} lbs` : order.estimatedSize}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${totalText}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${statusBadge}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <a href="#" class="text-blue-600 hover:text-blue-900 mr-3" data-order-id="${order.orderId}">View</a>
                            ${order.status === 'scheduled' ? `<a href="#" class="text-red-600 hover:text-red-900" data-order-id="${order.orderId}">Cancel</a>` : ''}
                        </td>
                    `;
                    
                    ordersTableBody.appendChild(row);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('a[data-order-id]').forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const orderId = this.getAttribute('data-order-id');
                        
                        if (this.textContent === 'Cancel') {
                            // Handle cancel order
                            if (confirm('Are you sure you want to cancel this order?')) {
                                // In a real implementation, this would make an API call
                                const storedOrders = JSON.parse(localStorage.getItem('wavemax_orders')) || {};
                                if (storedOrders[orderId]) {
                                    storedOrders[orderId].status = 'cancelled';
                                    localStorage.setItem('wavemax_orders', JSON.stringify(storedOrders));
                                    
                                    // Refresh orders
                                    loadOrders(customerId);
                                }
                            }
                        } else {
                            // Handle view order
                            alert(`View order details for ${orderId}. In a real implementation, this would show order details.`);
                        }
                    });
                });
            }
            
            // Update pagination info
            document.getElementById('ordersShowing').textContent = ordersForCustomer.length;
            document.getElementById('ordersTotal').textContent = ordersForCustomer.length;
        }
        
        // Initialize calendar for scheduling
        function initializeCalendar(customerId) {
            const calendarDays = document.getElementById('calendarDays');
            const currentMonthElement = document.getElementById('currentMonth');
            const prevMonthButton = document.getElementById('prevMonth');
            const nextMonthButton = document.getElementById('nextMonth');
            const pickupForm = document.getElementById('pickupForm');
            const selectedDateElement = document.getElementById('selectedDate');
            const pickupDateInput = document.getElementById('pickupDate');
            const deliveryDateInput = document.getElementById('deliveryDate');
            
            let currentDate = new Date();
            let currentYear = currentDate.getFullYear();
            let currentMonth = currentDate.getMonth();
            
            // Load recurring schedule information
            const storedCustomers = JSON.parse(localStorage.getItem('wavemax_customers')) || {};
            const customer = storedCustomers[customerId];
            
            if (customer && customer.serviceFrequency !== 'onDemand') {
                const recurringScheduleDetails = document.getElementById('recurringScheduleDetails');
                
                // Format preferred day and time
                const days = {
                    monday: 'Monday',
                    tuesday: 'Tuesday',
                    wednesday: 'Wednesday',
                    thursday: 'Thursday',
                    friday: 'Friday',
                    saturday: 'Saturday',
                    sunday: 'Sunday'
                };
                
                const times = {
                    morning: 'Morning (8am - 12pm)',
                    afternoon: 'Afternoon (12pm - 5pm)',
                    evening: 'Evening (5pm - 8pm)'
                };
                
                const frequencyText = customer.serviceFrequency === 'weekly' ? 'Weekly' : 
                                     customer.serviceFrequency === 'biweekly' ? 'Bi-weekly' : 
                                     'Monthly';
                
                recurringScheduleDetails.innerHTML = `
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="mb-2"><span class="font-bold">Current Schedule:</span> ${frequencyText}</p>
                        <p class="mb-2"><span class="font-bold">Preferred Day:</span> ${days[customer.preferredDay] || 'Not set'}</p>
                        <p class="mb-2"><span class="font-bold">Preferred Time:</span> ${times[customer.preferredTime] || 'Not set'}</p>
                        <p class="mt-4">Your recurring pickups are automatically scheduled based on your preferences. You can schedule additional pickups as needed.</p>
                    </div>
                `;
            } else {
                document.getElementById('recurringScheduleSection').style.display = 'none';
            }
            
            // Function to render calendar
            function renderCalendar() {
                calendarDays.innerHTML = '';
                
                currentMonthElement.textContent = new Date(currentYear, currentMonth, 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                
                // Create empty cells for days before the first day of the month
                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'h-10';
                    calendarDays.appendChild(emptyCell);
                }
                
                // Create cells for each day of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(currentYear, currentMonth, day);
                    const today = new Date();
                    
                    const dayCell = document.createElement('div');
                    dayCell.className = 'h-10 flex items-center justify-center border rounded-lg cursor-pointer hover:bg-gray-100';
                    
                    // Highlight today
                    if (date.toDateString() === today.toDateString()) {
                        dayCell.classList.add('bg-blue-100', 'border-blue-500');
                    }
                    
                    // Disable past dates
                    if (date < today && date.toDateString() !== today.toDateString()) {
                        dayCell.classList.remove('cursor-pointer', 'hover:bg-gray-100');
                        dayCell.classList.add('bg-gray-100', 'text-gray-400', 'cursor-not-allowed');
                    }
                    
                    dayCell.textContent = day;
                    
                    // Add click event for selectable dates
                    if (date >= today) {
                        dayCell.addEventListener('click', function() {
                            // Highlight selected day
                            document.querySelectorAll('#calendarDays div').forEach(cell => {
                                cell.classList.remove('bg-blue-500', 'text-white');
                            });
                            dayCell.classList.add('bg-blue-500', 'text-white');
                            
                            // Format date for display
                            const selectedDate = new Date(currentYear, currentMonth, day);
                            const formattedDate = selectedDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' });
                            selectedDateElement.textContent = formattedDate;
                            
                            // Set date for form submission
                            const isoDate = selectedDate.toISOString().split('T')[0];
                            pickupDateInput.value = isoDate;
                            
                            // Set minimum delivery date (pickup date + 1 day)
                            const minDeliveryDate = new Date(selectedDate);
                            minDeliveryDate.setDate(minDeliveryDate.getDate() + 1);
                            deliveryDateInput.min = minDeliveryDate.toISOString().split('T')[0];
                            
                            // Set default delivery date (pickup date + 2 days)
                            const defaultDeliveryDate = new Date(selectedDate);
                            defaultDeliveryDate.setDate(defaultDeliveryDate.getDate() + 2);
                            deliveryDateInput.value = defaultDeliveryDate.toISOString().split('T')[0];
                            
                            // Show the pickup form
                            pickupForm.style.display = 'block';
                        });
                    }
                    
                    calendarDays.appendChild(dayCell);
                }
            }
            
            // Initialize calendar
            renderCalendar();
            
            // Previous month button
            prevMonthButton.addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
                
                // Hide pickup form when month changes
                pickupForm.style.display = 'none';
            });
            
            // Next month button
            nextMonthButton.addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
                
                // Hide pickup form when month changes
                pickupForm.style.display = 'none';
            });
        }
        
        // Load profile data
        function loadProfile(customerId) {
            // In a real implementation, this would make an API call to get customer data
            // For demo purposes, we'll use localStorage
            const storedCustomers = JSON.parse(localStorage.getItem('wavemax_customers')) || {};
            
            if (storedCustomers[customerId]) {
                const customer = storedCustomers[customerId];
                
                // Fill form fields with customer data
                document.getElementById('firstName').value = customer.firstName || '';
                document.getElementById('lastName').value = customer.lastName || '';
                document.getElementById('email').value = customer.email || '';
                document.getElementById('phone').value = customer.phone || '';
                document.getElementById('address').value = customer.address || '';
                document.getElementById('city').value = customer.city || '';
                document.getElementById('state').value = customer.state || '';
                document.getElementById('zipCode').value = customer.zipCode || '';
                document.getElementById('deliveryInstructions').value = customer.deliveryInstructions || '';
                
                // Set service preferences
                document.getElementById('serviceFrequency').value = customer.serviceFrequency || 'onDemand';
                document.getElementById('preferredDay').value = customer.preferredDay || 'monday';
                document.getElementById('preferredTime').value = customer.preferredTime || 'morning';
                document.getElementById('specialInstructions').value = customer.specialInstructions || '';
                
                // Show/hide recurring schedule based on frequency
                const recurringScheduleContainer = document.getElementById('recurringScheduleContainer');
                recurringScheduleContainer.style.display = customer.serviceFrequency === 'onDemand' ? 'none' : 'block';
                
                // Payment information
                document.getElementById('cardholderName').value = customer.cardholderName || '';
                document.getElementById('cardLastFour').textContent = customer.lastFourDigits ? `•••• •••• •••• ${customer.lastFourDigits}` : '•••• •••• •••• ••••';
                
                // Add service frequency change event
                document.getElementById('serviceFrequency').addEventListener('change', function() {
                    recurringScheduleContainer.style.display = this.value === 'onDemand' ? 'none' : 'block';
                });
            }
        }
        
        // Load bags data
        function loadBags(customerId) {
            // In a real implementation, this would make an API call to get bags data
            // For demo purposes, we'll generate mock data
            
            const bagsTableBody = document.getElementById('bagsTableBody');
            bagsTableBody.innerHTML = '';
            
            // Generate mock bags
            const mockBags = [
                {
                    bagId: 'BAG123456',
                    barcode: 'WM-A1B2C3D4',
                    issueDate: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000),
                    status: 'active',
                    lastUsed: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000)
                }
            ];
            
            // Update UI with bags
            if (mockBags.length === 0) {
                bagsTableBody.innerHTML = '<tr class="text-center"><td colspan="6" class="px-6 py-4 text-gray-500">No bags found.</td></tr>';
            } else {
                mockBags.forEach(bag => {
                    const row = document.createElement('tr');
                    
                    // Create status badge
                    let statusBadge = '';
                    switch (bag.status) {
                        case 'active':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Active</span>';
                            break;
                        case 'lost':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Lost</span>';
                            break;
                        case 'damaged':
                            statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Damaged</span>';
                            break;
                    }
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${bag.bagId}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${bag.barcode}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${bag.issueDate.toLocaleDateString()}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            ${statusBadge}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${bag.lastUsed.toLocaleDateString()}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <a href="#" class="text-blue-600 hover:text-blue-900 mr-3" data-bag-id="${bag.bagId}">Report Lost</a>
                        </td>
                    `;
                    
                    bagsTableBody.appendChild(row);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('a[data-bag-id]').forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const bagId = this.getAttribute('data-bag-id');
                        
                        // Handle report lost
                        if (confirm('Are you sure you want to report this bag as lost?')) {
                            // In a real implementation, this would make an API call
                            alert(`Bag ${bagId} has been reported as lost. Your affiliate will contact you about a replacement.`);
                            
                            // Update UI
                            this.closest('tr').querySelector('span').outerHTML = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">Lost</span>';
                            this.textContent = 'Reported';
                            this.classList.add('text-gray-400', 'cursor-not-allowed');
                            this.classList.remove('text-blue-600', 'hover:text-blue-900');
                            this.style.pointerEvents = 'none';
                        }
                    });
                });
            }
        }
    </script>
</body>
</html>