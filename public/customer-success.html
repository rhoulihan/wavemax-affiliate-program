<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WaveMAX Laundry - Registration Success</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .wavemax-blue {
            background-color: #1e3a8a;
        }
        .wavemax-light-blue {
            background-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Navigation -->
    <nav class="wavemax-blue text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <a href="index.html" class="text-2xl font-bold">WaveMAX Laundry</a>
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="index.html" class="hover:text-blue-200">Home</a>
                <a href="#" class="hover:text-blue-200">Services</a>
                <a href="#" class="hover:text-blue-200">Locations</a>
                <a href="#" class="hover:text-blue-200">About</a>
                <a href="#" class="hover:text-blue-200">Contact</a>
            </div>
        </div>
    </nav>

    <!-- Success Content -->
    <div class="py-12">
        <div class="container mx-auto px-4">
            <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-md overflow-hidden">
                <div class="wavemax-blue text-white p-6">
                    <h2 class="text-2xl font-bold">Registration Successful!</h2>
                    <p class="mt-2">Thank you for signing up for WaveMAX Laundry pickup and delivery service.</p>
                </div>
                
                <div class="p-6 space-y-6">
                    <div class="bg-green-50 border border-green-200 text-green-800 rounded-lg p-4">
                        <h3 class="font-bold text-lg">Your account has been created!</h3>
                        <p>We're excited to provide you with premium laundry services.</p>
                    </div>
                    
                    <!-- Customer Information -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">Your Account Information</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="mb-2">
                                <span class="font-bold">Customer ID:</span>
                                <span id="customerId">Loading...</span>
                            </div>
                            <div class="mb-2">
                                <span class="font-bold">Name:</span>
                                <span id="customerName">Loading...</span>
                            </div>
                            <div>
                                <span class="font-bold">Email:</span>
                                <span id="customerEmail">Loading...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Service Provider Information -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">Your Service Provider</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="mb-2">
                                <span class="font-bold">Provider:</span>
                                <span id="affiliateName">Loading...</span>
                            </div>
                            <div class="mb-2">
                                <span class="font-bold">Service Area:</span>
                                <span id="serviceArea">Loading...</span>
                            </div>
                            <div>
                                <span class="font-bold">Delivery Fee:</span>
                                <span id="deliveryFee">Loading...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Laundry Bag Information -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">Your Laundry Bag</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="mb-4">Your dedicated laundry bag with a unique barcode will be delivered to you shortly by your service provider.</p>
                            <div class="mb-2">
                                <span class="font-bold">Bag Barcode:</span>
                                <span id="bagBarcode">Will be assigned upon delivery</span>
                            </div>
                            <p class="text-sm text-gray-500">Please use this bag for all your laundry pickup orders.</p>
                        </div>
                    </div>
                    
                    <!-- Next Steps -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">Next Steps</h3>
                        <ol class="list-decimal pl-6 space-y-2">
                            <li>Your service provider will contact you to deliver your laundry bag.</li>
                            <li>Schedule your first laundry pickup using our online system or by contacting your service provider directly.</li>
                            <li>Prepare your laundry in the provided bag on the scheduled pickup date.</li>
                            <li>Your clean laundry will be delivered back to you within 48 hours.</li>
                        </ol>
                    </div>
                    
                    <!-- Actions -->
                    <div class="pt-4 border-t">
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                            <a href="#" id="schedulePickupBtn" class="bg-blue-600 text-white text-center font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition">Schedule Your First Pickup</a>
                            <a href="#" id="customerDashboardBtn" class="border border-blue-600 text-blue-600 text-center font-bold py-3 px-4 rounded-lg hover:bg-blue-50 transition">Go to Customer Dashboard</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 WaveMAX Laundry. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Extract customer ID and barcode from URL query parameters
            const urlParams = new URLSearchParams(window.location.search);
            const customerId = urlParams.get('id');
            const bagBarcode = urlParams.get('barcode');
            
            if (!customerId) {
                alert('No customer ID provided. Redirecting to homepage.');
                window.location.href = 'index.html';
                return;
            }
            
            try {
                // Fetch customer data from the server
                const response = await fetch(`/api/customers/${customerId}/profile`);
                const data = await response.json();
                
                if (data.success && data.customer) {
                    const customer = data.customer;
                    
                    // Set customer information
                    document.getElementById('customerId').textContent = customer.customerId;
                    document.getElementById('customerName').textContent = `${customer.firstName} ${customer.lastName}`;
                    document.getElementById('customerEmail').textContent = customer.email;
                    
                    // Set affiliate information
                    if (customer.affiliate) {
                        document.getElementById('affiliateName').textContent = customer.affiliate.name;
                        document.getElementById('serviceArea').textContent = 'Austin, TX area';
                        document.getElementById('deliveryFee').textContent = `$${parseFloat(customer.affiliate.deliveryFee).toFixed(2)} per pickup/delivery`;
                        
                        // Update button links with customer and affiliate IDs
                        document.getElementById('schedulePickupBtn').href = `schedule-pickup.html?affiliate=${customer.affiliateId}&customer=${customer.customerId}`;
                        document.getElementById('customerDashboardBtn').href = `customer-dashboard.html?id=${customer.customerId}`;
                    } else {
                        document.getElementById('affiliateName').textContent = 'WaveMAX Affiliate Partner';
                        document.getElementById('serviceArea').textContent = 'Austin, TX area';
                        document.getElementById('deliveryFee').textContent = '$5.99 per pickup/delivery';
                        
                        // Generic links
                        document.getElementById('schedulePickupBtn').href = 'schedule-pickup.html';
                        document.getElementById('customerDashboardBtn').href = `customer-dashboard.html?id=${customer.customerId}`;
                    }
                    
                    // Set bag barcode from URL parameter or from bags array
                    if (bagBarcode) {
                        document.getElementById('bagBarcode').textContent = bagBarcode;
                    } else if (customer.bags && customer.bags.length > 0) {
                        document.getElementById('bagBarcode').textContent = customer.bags[0].barcode;
                    }
                } else {
                    // If API call fails or customer not found, show error
                    console.error('Failed to load customer data:', data.message);
                    alert('Unable to load customer information. Please try logging in.');
                    window.location.href = 'customer-login.html';
                }
            } catch (error) {
                console.error('Error fetching customer data:', error);
                alert('An error occurred while loading customer information.');
                window.location.href = 'customer-login.html';
            }
        });
    </script>
</body>
</html>