<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WaveMAX Coverage Analysis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.2s;
        }
        
        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .metric-value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .metric-label {
            color: #666;
            font-size: 1.1em;
        }
        
        .good { color: #22c55e; }
        .warning { color: #f59e0b; }
        .danger { color: #ef4444; }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            color: #1e3a8a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        h3 {
            color: #3b82f6;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        
        .file-analysis {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        
        .file-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .file-name {
            font-weight: bold;
            color: #1e3a8a;
            font-size: 1.1em;
        }
        
        .coverage-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .coverage-badge.good {
            background: #dcfce7;
            color: #166534;
        }
        
        .coverage-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .coverage-badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .uncovered-lines {
            margin-top: 10px;
            padding: 10px;
            background: #fff;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #666;
        }
        
        .recommendation {
            margin-top: 15px;
            padding: 15px;
            background: #eff6ff;
            border-radius: 6px;
            border-left: 3px solid #3b82f6;
        }
        
        .recommendation-title {
            font-weight: bold;
            color: #1e3a8a;
            margin-bottom: 5px;
        }
        
        .category-section {
            margin-bottom: 40px;
        }
        
        .category-header {
            background: #f3f4f6;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-title {
            font-size: 1.3em;
            color: #1e3a8a;
            font-weight: bold;
        }
        
        .category-stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .stat-value {
            font-weight: bold;
            color: #333;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background: #f9fafb;
            font-weight: bold;
            color: #374151;
        }
        
        tr:hover {
            background: #f9fafb;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #1e3a8a 100%);
            transition: width 0.3s ease;
        }
        
        .action-required {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .action-required h4 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .footer {
            text-align: center;
            padding: 30px 0;
            color: #666;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .category-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .category-stats {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>WaveMAX Coverage Analysis Report</h1>
            <p class="subtitle">Generated on December 6, 2024</p>
        </header>
        
        <div class="summary-grid">
            <div class="summary-card">
                <div class="metric-label">Overall Coverage</div>
                <div class="metric-value warning">75.04%</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75.04%"></div>
                </div>
            </div>
            <div class="summary-card">
                <div class="metric-label">Branch Coverage</div>
                <div class="metric-value danger">68.2%</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 68.2%"></div>
                </div>
            </div>
            <div class="summary-card">
                <div class="metric-label">Function Coverage</div>
                <div class="metric-value good">82.05%</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 82.05%"></div>
                </div>
            </div>
            <div class="summary-card">
                <div class="metric-label">Total Tests</div>
                <div class="metric-value good">1051</div>
                <div class="metric-label">48 Test Suites</div>
            </div>
        </div>
        
        <div class="action-required">
            <h4>‚ö†Ô∏è Coverage Thresholds Not Met</h4>
            <p>The project requires 80% coverage across all metrics. Current gaps:</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>Statements: 4.96% below threshold</li>
                <li>Branches: 11.8% below threshold</li>
                <li>Lines: 5.08% below threshold</li>
            </ul>
        </div>
        
        <div class="section">
            <h2>Critical Coverage Gaps</h2>
            
            <div class="category-section">
                <div class="category-header">
                    <div class="category-title">üî¥ Urgent: Files with < 50% Coverage</div>
                    <div class="category-stats">
                        <div class="stat-item">
                            <span class="stat-label">Files:</span>
                            <span class="stat-value">2</span>
                        </div>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/utils/emailService.js</span>
                        <span class="coverage-badge danger">0% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: 4-746 (entire file)
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: HIGH PRIORITY</div>
                        <p><strong>Status:</strong> This file appears to be completely untested. Email service is critical infrastructure.</p>
                        <p><strong>Action Required:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>Create comprehensive unit tests for all email sending functions</li>
                            <li>Mock nodemailer and AWS SES for testing</li>
                            <li>Test email template loading and error handling</li>
                            <li>Ensure all email types (affiliate, customer, operator, admin) are tested</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Estimated effort:</strong> 3-4 hours for complete coverage</p>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/config/passport-config.js</span>
                        <span class="coverage-badge danger">14.54% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: 22-197, 212-260, 275-326, 336, 343-347
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: MEDIUM PRIORITY</div>
                        <p><strong>Status:</strong> OAuth strategies are largely untested. Most of the Google, Facebook, and LinkedIn authentication flows lack coverage.</p>
                        <p><strong>Action Required:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>Test OAuth strategies with mocked passport strategies</li>
                            <li>Cover both affiliate and customer OAuth flows</li>
                            <li>Test error handling and edge cases</li>
                            <li>Consider if all OAuth providers are still needed</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Note:</strong> Facebook and LinkedIn strategies might be deprecated - verify if they're still in use.</p>
                    </div>
                </div>
            </div>
            
            <div class="category-section">
                <div class="category-header">
                    <div class="category-title">üü° Warning: Files with 50-75% Coverage</div>
                    <div class="category-stats">
                        <div class="stat-item">
                            <span class="stat-label">Files:</span>
                            <span class="stat-value">9</span>
                        </div>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/controllers/administratorController.js</span>
                        <span class="coverage-badge warning">68.3% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: Multiple sections including error handlers and edge cases
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: MEDIUM PRIORITY</div>
                        <p><strong>Focus Areas:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>Error handling paths in admin operations</li>
                            <li>Audit logging branches</li>
                            <li>Permission checking edge cases</li>
                            <li>Admin deletion and update error scenarios</li>
                        </ul>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/controllers/authController.js</span>
                        <span class="coverage-badge warning">71.26% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: 1583-1584, 1596-1640, 1661-1724, 1729-1775, 1803, 1839-1877, etc.
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: HIGH PRIORITY</div>
                        <p><strong>Critical Gaps:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>OAuth session handling functions lack coverage</li>
                            <li>Social authentication completion flows untested</li>
                            <li>Customer social registration paths need tests</li>
                            <li>Account conflict resolution logic uncovered</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Note:</strong> These are newly added OAuth features that need immediate test coverage.</p>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/controllers/bagController.js</span>
                        <span class="coverage-badge warning">68.35% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: 426-457, 471-519, 623-624, 638-694
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: LOW PRIORITY</div>
                        <p><strong>Analysis:</strong> Most uncovered code appears to be error handling and edge cases.</p>
                        <p><strong>Consider:</strong> Some bag management features might be deprecated. Verify if all bag tracking functionality is still actively used.</p>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/controllers/operatorController.js</span>
                        <span class="coverage-badge warning">65.61% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: 367-368, 374-404, 416, 421, 431, 436-452
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: MEDIUM PRIORITY</div>
                        <p><strong>Missing Coverage:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>Operator shift management functions</li>
                            <li>PIN reset error scenarios</li>
                            <li>Operator performance tracking</li>
                        </ul>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/routes/socialAuthRoutes.js</span>
                        <span class="coverage-badge warning">56.25% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: 50-57, 79-86, 147-160, 173-174, 184-193, 216-225
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: MEDIUM PRIORITY</div>
                        <p><strong>Status:</strong> Route configuration checks and customer OAuth routes lack coverage.</p>
                        <p><strong>Action:</strong> Test OAuth configuration validation and customer-specific OAuth endpoints.</p>
                    </div>
                </div>
                
                <div class="file-analysis">
                    <div class="file-header">
                        <span class="file-name">server/utils/encryption.js</span>
                        <span class="coverage-badge warning">68.18% Coverage</span>
                    </div>
                    <div class="uncovered-lines">
                        Uncovered Lines: 37-38, 67-68, 96-97, 122-123, 133, 142-145
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">üìã Recommendation: HIGH PRIORITY</div>
                        <p><strong>Critical:</strong> Encryption utility error paths need coverage for security assurance.</p>
                        <p><strong>Action:</strong> Add tests for encryption/decryption failures and edge cases.</p>
                    </div>
                </div>
            </div>
            
            <div class="category-section">
                <div class="category-header">
                    <div class="category-title">üü¢ Good: Files with > 75% Coverage</div>
                    <div class="category-stats">
                        <div class="stat-item">
                            <span class="stat-label">Files:</span>
                            <span class="stat-value">Most files</span>
                        </div>
                    </div>
                </div>
                
                <p>These files have acceptable coverage but could benefit from additional edge case testing:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>File</th>
                            <th>Coverage</th>
                            <th>Minor Gaps</th>
                            <th>Priority</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>server/controllers/affiliateController.js</td>
                            <td><span class="coverage-badge good">89.18%</span></td>
                            <td>Error handlers, edge cases</td>
                            <td>Low</td>
                        </tr>
                        <tr>
                            <td>server/controllers/orderController.js</td>
                            <td><span class="coverage-badge good">85.89%</span></td>
                            <td>Cancellation flows, refunds</td>
                            <td>Low</td>
                        </tr>
                        <tr>
                            <td>server/models/Administrator.js</td>
                            <td><span class="coverage-badge good">97.18%</span></td>
                            <td>Password history edge case</td>
                            <td>Very Low</td>
                        </tr>
                        <tr>
                            <td>server/middleware/rbac.js</td>
                            <td><span class="coverage-badge good">100%</span></td>
                            <td>Branch coverage gaps only</td>
                            <td>Very Low</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>Recommended Action Plan</h2>
            
            <h3>üî• Immediate Priority (This Sprint)</h3>
            <ol style="margin-left: 20px;">
                <li><strong>Email Service Tests:</strong> Create comprehensive test suite for emailService.js (0% ‚Üí 80%+)</li>
                <li><strong>OAuth Coverage:</strong> Test the new OAuth session handling in authController.js</li>
                <li><strong>Encryption Tests:</strong> Add error path coverage for security-critical encryption.js</li>
            </ol>
            
            <h3>üìÖ Next Sprint</h3>
            <ol style="margin-left: 20px;">
                <li><strong>Passport Config:</strong> Mock and test OAuth strategies or remove unused providers</li>
                <li><strong>Admin Controller:</strong> Cover error scenarios and audit logging branches</li>
                <li><strong>Social Auth Routes:</strong> Test configuration validation and customer OAuth paths</li>
            </ol>
            
            <h3>üîç Investigation Required</h3>
            <ul style="margin-left: 20px;">
                <li>Verify if Facebook and LinkedIn OAuth are still in use</li>
                <li>Check if bag management features are fully utilized</li>
                <li>Confirm which operator features are active</li>
            </ul>
        </div>
        
        <div class="section">
            <h2>Coverage Trends & Insights</h2>
            
            <h3>Patterns Identified</h3>
            <ul style="margin-left: 20px;">
                <li><strong>Error Handling:</strong> Most uncovered code is in error handling paths</li>
                <li><strong>OAuth Features:</strong> Recently added OAuth functionality lacks test coverage</li>
                <li><strong>Utility Functions:</strong> Critical utilities (email, encryption) need more thorough testing</li>
                <li><strong>Edge Cases:</strong> Main flows are well-tested, but edge cases need attention</li>
            </ul>
            
            <h3>Positive Observations</h3>
            <ul style="margin-left: 20px;">
                <li>‚úÖ All models have excellent coverage (90%+)</li>
                <li>‚úÖ Middleware is well-tested (96.95% overall)</li>
                <li>‚úÖ Core business logic has good coverage</li>
                <li>‚úÖ 1051 tests provide strong foundation</li>
            </ul>
        </div>
        
        <div class="section">
            <h2>Technical Debt Assessment</h2>
            
            <div class="file-analysis">
                <div class="recommendation">
                    <div class="recommendation-title">üí° Potentially Deprecated Code</div>
                    <p>Based on coverage analysis, these features might be candidates for removal:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Facebook/LinkedIn OAuth:</strong> Low coverage suggests limited use</li>
                        <li><strong>Bag Management:</strong> Complex features with low coverage might be unused</li>
                        <li><strong>Operator Shift Tracking:</strong> Uncovered advanced features</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>Recommendation:</strong> Analyze usage metrics before investing in test coverage for these areas.</p>
                </div>
            </div>
        </div>
        
        <footer class="footer">
            <p>Coverage Analysis Report - WaveMAX Laundry Affiliate Program</p>
            <p>Generated with Jest Coverage Data | Target: 80% Coverage</p>
        </footer>
    </div>
</body>
</html>