// Filmwalk Internationalization
const translations = {
  en: {
    filmwalk: {
      title: 'London On Screen - Self-Guided Film & TV Walking Tour',
      header: {
        title: 'ðŸŽ¬ London On Screen'
      },
      nav: {
        tour: 'The Tour',
        locations: 'Locations',
        bonus: 'Bonus Sites',
        about: 'About'
      },
      hero: {
        title: 'Walk Through Cinema History',
        subtitle: 'Discover London\'s iconic film and TV locations on this self-guided walking tour through the Square Mile',
        button: 'Start Your Journey'
      },
      stats: {
        sites: 'Main + Bonus Sites',
        miles: 'Miles (Main Route)',
        films: 'Films & Shows',
        duration: 'Hours Duration'
      },
      map: {
        title: 'Interactive Walking Route',
        loading: 'Interactive map loading...',
        calculating: 'Calculating route...',
        viewRoute: 'View Full Route',
        getDirections: 'Get Directions',
        downloadGPX: 'Download GPX'
      },
      directions: {
        title: 'Walking Directions',
        distance: 'Total Distance',
        time: 'Walking Time',
        locations: 'Film Locations',
        description: 'For turn-by-turn directions, we recommend using Google Maps or Apple Maps on your phone. Click below to open the route in your preferred app:',
        openGoogle: 'Open in Google Maps',
        openApple: 'Open in Apple Maps'
      },
      route: {
        title: 'Walking Route Overview',
        minute: 'min walk',
        proTip: 'Pro tip:',
        proTipText: 'The route is designed to be walked in order, but you can easily skip locations or add bonus sites. Each location is well-connected by public transport if you need a break.'
      },
      locations: {
        title: 'Featured Locations',
        startJourney: 'Start your journey at',
        featuredIn: 'Featured in:',
        location1: {
          name: 'The Millennium Bridge',
          description: 'Start your journey at the Bankside entrance of this modern architectural marvel that\'s been destroyed on screen more times than we can count!'
        },
        location2: {
          name: 'St Paul\'s Cathedral',
          description: 'This iconic dome has witnessed everything from alien invasions to superhero landings!'
        },
        location3: {
          name: 'The Old Bailey',
          description: 'Justice meets cinema at London\'s most famous criminal court.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'A hidden gem featuring heroic memorials and romantic encounters.'
        },
        location5: {
          name: 'Smithfield Market',
          description: 'Historic meat market hiding secret entrances to MI6!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'London\'s oldest church has hosted weddings, beheadings, and mysteries.'
        },
        location7: {
          name: 'Barbican Centre',
          description: 'Brutalist architecture perfect for spy headquarters and music videos.'
        },
        location8: {
          name: 'Cornhill & Royal Exchange',
          description: 'The heart of the City has seen romance, action, and undead invasions!'
        },
        location9: {
          name: 'Leadenhall Market',
          description: 'Step into the wizarding world at the real-life Diagon Alley!'
        },
        location10: {
          name: 'Tower Bridge',
          description: 'End your tour at London\'s most photographed bridge and superhero battleground!'
        }
      },
      bonus: {
        title: 'ðŸŒŸ Bonus Film Locations Nearby',
        subtitle: 'Extend your tour with these additional cinematic spots from the original film walk!',
        between: 'Between Locations',
        near: 'Near',
        detour: 'min detour',
        minutesFrom: 'minutes from'
      },
      about: {
        title: 'About This Tour',
        description1: 'This self-guided walking tour takes you through the Square Mile, London\'s historic heart, visiting locations that have appeared in blockbuster films and beloved TV shows. From superhero landings to wizard shopping trips, romantic encounters to explosive action sequences, you\'ll see the City through the lens of cinema.',
        description2: 'The main route covers approximately 3.5 miles and takes 2-3 hours at a leisurely pace. Feel free to explore the bonus locations to extend your cinematic adventure!',
        tipsTitle: 'Tips for Your Tour:',
        tips: [
          'Start early to avoid crowds at popular spots',
          'Bring a camera - these locations are incredibly photogenic!',
          'Many locations are free to enter or view from outside',
          'Check opening times for churches and markets',
          'Wear comfortable walking shoes'
        ]
      },
      footer: {
        copyright: 'Â© 2024 London On Screen Walking Tour. Educational use only.',
        credit: 'Based on the City of London\'s film location guide'
      },
      modal: {
        featuredFilms: 'Featured Films & Shows',
        visitorTips: 'Visitor Tips',
        bonusLocation: 'Bonus Location'
      }
    }
  },
  es: {
    filmwalk: {
      title: 'Londres en Pantalla - Tour Autoguiado de Cine y TV',
      header: {
        title: 'ðŸŽ¬ Londres en Pantalla'
      },
      nav: {
        tour: 'El Tour',
        locations: 'Ubicaciones',
        bonus: 'Sitios Extra',
        about: 'Acerca de'
      },
      hero: {
        title: 'Camina a TravÃ©s de la Historia del Cine',
        subtitle: 'Descubre las icÃ³nicas ubicaciones de cine y TV de Londres en este tour autoguiado por la Milla Cuadrada',
        button: 'Comienza Tu Viaje'
      },
      stats: {
        sites: 'Sitios Principales + Extra',
        miles: 'Millas (Ruta Principal)',
        films: 'PelÃ­culas y Series',
        duration: 'Horas de DuraciÃ³n'
      },
      map: {
        title: 'Ruta Interactiva a Pie',
        loading: 'Cargando mapa interactivo...',
        calculating: 'Calculando ruta...',
        viewRoute: 'Ver Ruta Completa',
        getDirections: 'Obtener Direcciones',
        downloadGPX: 'Descargar GPX'
      },
      directions: {
        title: 'Direcciones a Pie',
        distance: 'Distancia Total',
        time: 'Tiempo Caminando',
        locations: 'Ubicaciones de PelÃ­culas',
        description: 'Para direcciones paso a paso, recomendamos usar Google Maps o Apple Maps en tu telÃ©fono. Haz clic abajo para abrir la ruta en tu aplicaciÃ³n preferida:',
        openGoogle: 'Abrir en Google Maps',
        openApple: 'Abrir en Apple Maps'
      },
      route: {
        title: 'Resumen de la Ruta a Pie',
        minute: 'min caminando',
        proTip: 'Consejo:',
        proTipText: 'La ruta estÃ¡ diseÃ±ada para caminar en orden, pero puedes omitir ubicaciones o agregar sitios extra fÃ¡cilmente. Cada ubicaciÃ³n estÃ¡ bien conectada por transporte pÃºblico si necesitas un descanso.'
      },
      locations: {
        title: 'Ubicaciones Destacadas',
        startJourney: 'Comienza tu viaje en',
        featuredIn: 'Aparece en:',
        location1: {
          name: 'El Puente del Milenio',
          description: 'Â¡Comienza tu viaje en la entrada de Bankside de esta maravilla arquitectÃ³nica moderna que ha sido destruida en pantalla mÃ¡s veces de las que podemos contar!'
        },
        location2: {
          name: 'Catedral de San Pablo',
          description: 'Â¡Esta icÃ³nica cÃºpula ha sido testigo de todo, desde invasiones alienÃ­genas hasta aterrizajes de superhÃ©roes!'
        },
        location3: {
          name: 'El Old Bailey',
          description: 'La justicia se encuentra con el cine en el tribunal criminal mÃ¡s famoso de Londres.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'Una joya oculta con monumentos heroicos y encuentros romÃ¡nticos.'
        },
        location5: {
          name: 'Mercado de Smithfield',
          description: 'Â¡HistÃ³rico mercado de carne que esconde entradas secretas al MI6!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'La iglesia mÃ¡s antigua de Londres ha albergado bodas, decapitaciones y misterios.'
        },
        location7: {
          name: 'Centro Barbican',
          description: 'Arquitectura brutalista perfecta para cuarteles de espÃ­as y videos musicales.'
        },
        location8: {
          name: 'Cornhill y Royal Exchange',
          description: 'Â¡El corazÃ³n de la City ha visto romance, acciÃ³n e invasiones de no-muertos!'
        },
        location9: {
          name: 'Mercado de Leadenhall',
          description: 'Â¡Entra al mundo mÃ¡gico en el CallejÃ³n Diagon de la vida real!'
        },
        location10: {
          name: 'Tower Bridge',
          description: 'Â¡Termina tu tour en el puente mÃ¡s fotografiado de Londres y campo de batalla de superhÃ©roes!'
        }
      },
      bonus: {
        title: 'ðŸŒŸ Ubicaciones de PelÃ­culas Extra Cercanas',
        subtitle: 'Â¡Extiende tu tour con estos lugares cinematogrÃ¡ficos adicionales del recorrido original!',
        between: 'Entre Ubicaciones',
        near: 'Cerca de',
        detour: 'min de desvÃ­o',
        minutesFrom: 'minutos desde'
      },
      about: {
        title: 'Acerca de Este Tour',
        description1: 'Este tour autoguiado te lleva a travÃ©s de la Milla Cuadrada, el corazÃ³n histÃ³rico de Londres, visitando ubicaciones que han aparecido en grandes pelÃ­culas y queridas series de TV. Desde aterrizajes de superhÃ©roes hasta compras de magos, encuentros romÃ¡nticos hasta escenas de acciÃ³n explosivas, verÃ¡s la Ciudad a travÃ©s del lente del cine.',
        description2: 'La ruta principal cubre aproximadamente 3.5 millas y toma de 2 a 3 horas a un ritmo tranquilo. Â¡SiÃ©ntete libre de explorar las ubicaciones extra para extender tu aventura cinematogrÃ¡fica!',
        tipsTitle: 'Consejos para Tu Tour:',
        tips: [
          'Comienza temprano para evitar multitudes en los lugares populares',
          'Lleva una cÃ¡mara - Â¡estas ubicaciones son increÃ­blemente fotogÃ©nicas!',
          'Muchas ubicaciones son gratuitas para entrar o ver desde afuera',
          'Verifica los horarios de apertura de iglesias y mercados',
          'Usa zapatos cÃ³modos para caminar'
        ]
      },
      footer: {
        copyright: 'Â© 2024 Londres en Pantalla Tour. Solo uso educativo.',
        credit: 'Basado en la guÃ­a de ubicaciones cinematogrÃ¡ficas de la Ciudad de Londres'
      },
      modal: {
        featuredFilms: 'PelÃ­culas y Series Destacadas',
        visitorTips: 'Consejos para Visitantes',
        bonusLocation: 'UbicaciÃ³n Extra'
      }
    }
  },
  pt: {
    filmwalk: {
      title: 'Londres nas Telas - Tour Autoguiado de Cinema e TV',
      header: {
        title: 'ðŸŽ¬ Londres nas Telas'
      },
      nav: {
        tour: 'O Tour',
        locations: 'LocaÃ§Ãµes',
        bonus: 'Locais BÃ´nus',
        about: 'Sobre'
      },
      hero: {
        title: 'Caminhe pela HistÃ³ria do Cinema',
        subtitle: 'Descubra as icÃ´nicas locaÃ§Ãµes de cinema e TV de Londres neste tour autoguiado pela Milha Quadrada',
        button: 'Comece Sua Jornada'
      },
      stats: {
        sites: 'Locais Principais + BÃ´nus',
        miles: 'Milhas (Rota Principal)',
        films: 'Filmes e SÃ©ries',
        duration: 'Horas de DuraÃ§Ã£o'
      },
      map: {
        title: 'Rota Interativa a PÃ©',
        loading: 'Carregando mapa interativo...',
        calculating: 'Calculando rota...',
        viewRoute: 'Ver Rota Completa',
        getDirections: 'Obter DireÃ§Ãµes',
        downloadGPX: 'Baixar GPX'
      },
      directions: {
        title: 'DireÃ§Ãµes a PÃ©',
        distance: 'DistÃ¢ncia Total',
        time: 'Tempo Caminhando',
        locations: 'LocaÃ§Ãµes de Filmes',
        description: 'Para direÃ§Ãµes passo a passo, recomendamos usar o Google Maps ou Apple Maps no seu telefone. Clique abaixo para abrir a rota no seu aplicativo preferido:',
        openGoogle: 'Abrir no Google Maps',
        openApple: 'Abrir no Apple Maps'
      },
      route: {
        title: 'VisÃ£o Geral da Rota a PÃ©',
        minute: 'min caminhando',
        proTip: 'Dica:',
        proTipText: 'A rota Ã© projetada para ser percorrida em ordem, mas vocÃª pode facilmente pular locaÃ§Ãµes ou adicionar locais bÃ´nus. Cada locaÃ§Ã£o estÃ¡ bem conectada por transporte pÃºblico se vocÃª precisar de uma pausa.'
      },
      locations: {
        title: 'LocaÃ§Ãµes em Destaque',
        startJourney: 'Comece sua jornada em',
        featuredIn: 'Aparece em:',
        location1: {
          name: 'A Ponte do MilÃªnio',
          description: 'Comece sua jornada na entrada de Bankside desta maravilha arquitetÃ´nica moderna que foi destruÃ­da nas telas mais vezes do que podemos contar!'
        },
        location2: {
          name: 'Catedral de SÃ£o Paulo',
          description: 'Esta cÃºpula icÃ´nica testemunhou tudo, desde invasÃµes alienÃ­genas atÃ© pousos de super-herÃ³is!'
        },
        location3: {
          name: 'O Old Bailey',
          description: 'A justiÃ§a encontra o cinema no tribunal criminal mais famoso de Londres.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'Uma joia oculta com memoriais heroicos e encontros romÃ¢nticos.'
        },
        location5: {
          name: 'Mercado de Smithfield',
          description: 'Mercado histÃ³rico de carne que esconde entradas secretas para o MI6!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'A igreja mais antiga de Londres jÃ¡ sediou casamentos, decapitaÃ§Ãµes e mistÃ©rios.'
        },
        location7: {
          name: 'Centro Barbican',
          description: 'Arquitetura brutalista perfeita para quartÃ©is de espiÃµes e videoclipes.'
        },
        location8: {
          name: 'Cornhill e Royal Exchange',
          description: 'O coraÃ§Ã£o da City jÃ¡ viu romance, aÃ§Ã£o e invasÃµes de mortos-vivos!'
        },
        location9: {
          name: 'Mercado de Leadenhall',
          description: 'Entre no mundo mÃ¡gico no Beco Diagonal da vida real!'
        },
        location10: {
          name: 'Tower Bridge',
          description: 'Termine seu tour na ponte mais fotografada de Londres e campo de batalha de super-herÃ³is!'
        }
      },
      bonus: {
        title: 'ðŸŒŸ LocaÃ§Ãµes de Filmes BÃ´nus PrÃ³ximas',
        subtitle: 'Estenda seu tour com estes locais cinematogrÃ¡ficos adicionais do passeio original!',
        between: 'Entre LocaÃ§Ãµes',
        near: 'Perto de',
        detour: 'min de desvio',
        minutesFrom: 'minutos de'
      },
      about: {
        title: 'Sobre Este Tour',
        description1: 'Este tour autoguiado leva vocÃª atravÃ©s da Milha Quadrada, o coraÃ§Ã£o histÃ³rico de Londres, visitando locaÃ§Ãµes que apareceram em filmes blockbuster e sÃ©ries de TV amadas. De pousos de super-herÃ³is a compras de bruxos, encontros romÃ¢nticos a cenas de aÃ§Ã£o explosivas, vocÃª verÃ¡ a Cidade atravÃ©s das lentes do cinema.',
        description2: 'A rota principal cobre aproximadamente 3,5 milhas e leva de 2 a 3 horas em ritmo tranquilo. Sinta-se Ã  vontade para explorar as locaÃ§Ãµes bÃ´nus para estender sua aventura cinematogrÃ¡fica!',
        tipsTitle: 'Dicas para Seu Tour:',
        tips: [
          'Comece cedo para evitar multidÃµes nos pontos populares',
          'Leve uma cÃ¢mera - estas locaÃ§Ãµes sÃ£o incrivelmente fotogÃªnicas!',
          'Muitas locaÃ§Ãµes sÃ£o gratuitas para entrar ou ver do lado de fora',
          'Verifique os horÃ¡rios de funcionamento de igrejas e mercados',
          'Use sapatos confortÃ¡veis para caminhar'
        ]
      },
      footer: {
        copyright: 'Â© 2024 Londres nas Telas Tour. Apenas uso educacional.',
        credit: 'Baseado no guia de locaÃ§Ãµes cinematogrÃ¡ficas da Cidade de Londres'
      },
      modal: {
        featuredFilms: 'Filmes e SÃ©ries em Destaque',
        visitorTips: 'Dicas para Visitantes',
        bonusLocation: 'LocaÃ§Ã£o BÃ´nus'
      }
    }
  },
  de: {
    filmwalk: {
      title: 'London auf der Leinwand - SelbstgefÃ¼hrte Film- und TV-Tour',
      header: {
        title: 'ðŸŽ¬ London auf der Leinwand'
      },
      nav: {
        tour: 'Die Tour',
        locations: 'Drehorte',
        bonus: 'Bonus-Orte',
        about: 'Ãœber'
      },
      hero: {
        title: 'Wandeln Sie durch die Filmgeschichte',
        subtitle: 'Entdecken Sie Londons ikonische Film- und TV-Drehorte auf dieser selbstgefÃ¼hrten Wanderung durch die Square Mile',
        button: 'Starten Sie Ihre Reise'
      },
      stats: {
        sites: 'Haupt- + Bonus-Orte',
        miles: 'Meilen (Hauptroute)',
        films: 'Filme & Serien',
        duration: 'Stunden Dauer'
      },
      map: {
        title: 'Interaktive Wanderroute',
        loading: 'Interaktive Karte wird geladen...',
        calculating: 'Route wird berechnet...',
        viewRoute: 'VollstÃ¤ndige Route ansehen',
        getDirections: 'Wegbeschreibung abrufen',
        downloadGPX: 'GPX herunterladen'
      },
      directions: {
        title: 'Wegbeschreibung zu FuÃŸ',
        distance: 'Gesamtdistanz',
        time: 'Gehzeit',
        locations: 'Filmdrehorte',
        description: 'FÃ¼r eine detaillierte Wegbeschreibung empfehlen wir Google Maps oder Apple Maps auf Ihrem Telefon. Klicken Sie unten, um die Route in Ihrer bevorzugten App zu Ã¶ffnen:',
        openGoogle: 'In Google Maps Ã¶ffnen',
        openApple: 'In Apple Maps Ã¶ffnen'
      },
      route: {
        title: 'Ãœberblick Ã¼ber die Wanderroute',
        minute: 'Min. zu FuÃŸ',
        proTip: 'Profi-Tipp:',
        proTipText: 'Die Route ist so konzipiert, dass sie der Reihe nach begangen wird, aber Sie kÃ¶nnen problemlos Orte Ã¼berspringen oder Bonus-Orte hinzufÃ¼gen. Jeder Ort ist gut mit Ã¶ffentlichen Verkehrsmitteln verbunden, falls Sie eine Pause brauchen.'
      },
      locations: {
        title: 'Besondere Drehorte',
        startJourney: 'Beginnen Sie Ihre Reise bei',
        featuredIn: 'Zu sehen in:',
        location1: {
          name: 'Die Millennium Bridge',
          description: 'Beginnen Sie Ihre Reise am Bankside-Eingang dieses modernen architektonischen Wunderwerks, das auf der Leinwand Ã¶fter zerstÃ¶rt wurde, als wir zÃ¤hlen kÃ¶nnen!'
        },
        location2: {
          name: 'St Paul\'s Cathedral',
          description: 'Diese ikonische Kuppel hat alles miterlebt, von Alien-Invasionen bis zu Superhelden-Landungen!'
        },
        location3: {
          name: 'Das Old Bailey',
          description: 'Gerechtigkeit trifft Kino im berÃ¼hmtesten Strafgericht Londons.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'Ein verborgenes Juwel mit heldenhaften DenkmÃ¤lern und romantischen Begegnungen.'
        },
        location5: {
          name: 'Smithfield Market',
          description: 'Historischer Fleischmarkt, der geheime EingÃ¤nge zum MI6 verbirgt!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'Londons Ã¤lteste Kirche war Schauplatz von Hochzeiten, Enthauptungen und Mysterien.'
        },
        location7: {
          name: 'Barbican Centre',
          description: 'Brutalistische Architektur, perfekt fÃ¼r Spionagezentralen und Musikvideos.'
        },
        location8: {
          name: 'Cornhill & Royal Exchange',
          description: 'Das Herz der City hat Romantik, Action und Untoten-Invasionen erlebt!'
        },
        location9: {
          name: 'Leadenhall Market',
          description: 'Betreten Sie die Zaubererwelt in der echten Winkelgasse!'
        },
        location10: {
          name: 'Tower Bridge',
          description: 'Beenden Sie Ihre Tour an Londons meistfotografierter BrÃ¼cke und Superhelden-Schlachtfeld!'
        }
      },
      bonus: {
        title: 'ðŸŒŸ Bonus-Filmdrehorte in der NÃ¤he',
        subtitle: 'Erweitern Sie Ihre Tour mit diesen zusÃ¤tzlichen Filmorten aus dem ursprÃ¼nglichen Rundgang!',
        between: 'Zwischen Orten',
        near: 'In der NÃ¤he von',
        detour: 'Min. Umweg',
        minutesFrom: 'Minuten von'
      },
      about: {
        title: 'Ãœber diese Tour',
        description1: 'Diese selbstgefÃ¼hrte Wanderung fÃ¼hrt Sie durch die Square Mile, Londons historisches Herz, und besucht Orte, die in Blockbuster-Filmen und beliebten TV-Serien zu sehen waren. Von Superhelden-Landungen bis zu Zauberer-Einkaufstouren, von romantischen Begegnungen bis zu explosiven Action-Szenen - Sie werden die Stadt durch die Linse des Kinos sehen.',
        description2: 'Die Hauptroute umfasst etwa 3,5 Meilen und dauert in gemÃ¤chlichem Tempo 2-3 Stunden. Erkunden Sie gerne die Bonus-Orte, um Ihr filmisches Abenteuer zu verlÃ¤ngern!',
        tipsTitle: 'Tipps fÃ¼r Ihre Tour:',
        tips: [
          'Starten Sie frÃ¼h, um Menschenmassen an beliebten Orten zu vermeiden',
          'Bringen Sie eine Kamera mit - diese Orte sind unglaublich fotogen!',
          'Viele Orte sind kostenlos zu betreten oder von auÃŸen zu besichtigen',
          'PrÃ¼fen Sie die Ã–ffnungszeiten von Kirchen und MÃ¤rkten',
          'Tragen Sie bequeme Wanderschuhe'
        ]
      },
      footer: {
        copyright: 'Â© 2024 London auf der Leinwand Tour. Nur fÃ¼r Bildungszwecke.',
        credit: 'Basierend auf dem Filmdrehort-Guide der City of London'
      },
      modal: {
        featuredFilms: 'Filme & Serien im Fokus',
        visitorTips: 'Besuchertipps',
        bonusLocation: 'Bonus-Ort'
      }
    }
  }
};

// Language management
let currentLanguage = localStorage.getItem('filmwalkLanguage') || 'en';

function translatePage() {
  // Translate elements with data-i18n attributes
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const translation = getTranslation(key);

    if (translation) {
      if (element.tagName === 'TITLE') {
        document.title = translation;
      } else if (Array.isArray(translation)) {
        // Handle arrays (like tips)
        if (element.tagName === 'UL') {
          element.innerHTML = translation.map(tip => `<li>${tip}</li>`).join('');
        }
      } else {
        element.textContent = translation;
      }
    }
  });

  // Translate location cards
  for (let i = 1; i <= 10; i++) {
    const card = document.querySelector(`.location-card[data-location="${i}"]`);
    if (card) {
      const nameElement = card.querySelector('.location-header span:last-child');
      const descElement = card.querySelector('.location-content p');

      if (nameElement) {
        const locationName = getTranslation(`filmwalk.locations.location${i}.name`);
        if (locationName) nameElement.textContent = locationName;
      }

      if (descElement) {
        const locationDesc = getTranslation(`filmwalk.locations.location${i}.description`);
        if (locationDesc) descElement.textContent = locationDesc;
      }
    }
  }

  // Update HTML lang attribute
  document.documentElement.lang = currentLanguage;

  // Notify other scripts that translation has occurred
  window.dispatchEvent(new CustomEvent('languageChanged', { detail: { language: currentLanguage } }));
}

function getTranslation(key) {
  const keys = key.split('.');
  let translation = translations[currentLanguage];

  for (const k of keys) {
    if (translation && translation[k]) {
      translation = translation[k];
    } else {
      // Fallback to English
      translation = translations['en'];
      for (const k2 of keys) {
        if (translation && translation[k2]) {
          translation = translation[k2];
        } else {
          return null;
        }
      }
      break;
    }
  }

  return translation;
}

// Language data
const languages = {
  en: { name: 'English', code: 'EN', flag: 'gb' },
  es: { name: 'EspaÃ±ol', code: 'ES', flag: 'es' },
  pt: { name: 'PortuguÃªs', code: 'PT', flag: 'pt' },
  de: { name: 'Deutsch', code: 'DE', flag: 'de' }
};

// Initialize language selector
document.addEventListener('DOMContentLoaded', function() {
  const dropdown = document.getElementById('languageDropdown');
  const menu = document.getElementById('languageMenu');
  const selectedFlag = document.getElementById('selectedFlag');
  const selectedLang = document.getElementById('selectedLang');

  // Set current language in dropdown
  function updateDropdown() {
    const lang = languages[currentLanguage];
    selectedFlag.src = `https://flagcdn.com/w40/${lang.flag}.png`;
    selectedLang.textContent = lang.code;
  }

  // Toggle dropdown menu
  dropdown.addEventListener('click', function(e) {
    e.stopPropagation();
    menu.classList.toggle('active');
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', function() {
    menu.classList.remove('active');
  });

  // Handle language selection
  document.querySelectorAll('.language-option').forEach(option => {
    option.addEventListener('click', function(e) {
      e.stopPropagation();
      const lang = this.getAttribute('data-lang');
      if (lang !== currentLanguage) {
        currentLanguage = lang;
        localStorage.setItem('filmwalkLanguage', lang);

        // Update dropdown
        updateDropdown();
        menu.classList.remove('active');

        // Translate page
        translatePage();
      }
    });
  });

  // Initial setup
  updateDropdown();
  translatePage();
});

// Export for use in other scripts
window.i18n = {
  getTranslation,
  getCurrentLanguage: () => currentLanguage
};