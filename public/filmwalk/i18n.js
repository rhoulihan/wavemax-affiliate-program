// Filmwalk Internationalization
const translations = {
  en: {
    filmwalk: {
      title: 'London On Screen - Self-Guided Film & TV Walking Tour',
      header: {
        title: 'üé¨ London On Screen'
      },
      nav: {
        tour: 'The Tour',
        locations: 'Locations',
        bonus: 'Bonus Sites',
        about: 'About'
      },
      hero: {
        title: 'Walk Through Cinema History',
        subtitle: 'Discover London\'s iconic film and TV locations on this self-guided walking tour through the Square Mile',
        button: 'Start Your Journey'
      },
      stats: {
        sites: 'Main + Bonus Sites',
        miles: 'Miles (Main Route)',
        films: 'Films & Shows',
        duration: 'Hours Duration'
      },
      map: {
        title: 'Interactive Walking Route',
        loading: 'Interactive map loading...',
        calculating: 'Calculating route...',
        viewRoute: 'View Full Route',
        getDirections: 'Get Directions',
        downloadGPX: 'Download GPX'
      },
      directions: {
        title: 'Walking Directions',
        distance: 'Total Distance',
        time: 'Walking Time',
        locations: 'Film Locations',
        description: 'For turn-by-turn directions, we recommend using Google Maps or Apple Maps on your phone. Click below to open the route in your preferred app:',
        openGoogle: 'Open in Google Maps',
        openApple: 'Open in Apple Maps'
      },
      route: {
        title: 'Walking Route Overview',
        minute: 'min walk',
        proTip: 'Pro tip:',
        proTipText: 'The route is designed to be walked in order, but you can easily skip locations or add bonus sites. Each location is well-connected by public transport if you need a break.'
      },
      locations: {
        title: 'Featured Locations',
        startJourney: 'Start your journey at',
        featuredIn: 'Featured in:',
        location1: {
          name: 'The Millennium Bridge',
          description: 'Start your journey at the Bankside entrance of this modern architectural marvel that\'s been destroyed on screen more times than we can count!'
        },
        location2: {
          name: 'St Paul\'s Cathedral',
          description: 'This iconic dome has witnessed everything from alien invasions to superhero landings!'
        },
        location3: {
          name: 'The Old Bailey',
          description: 'Justice meets cinema at London\'s most famous criminal court.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'A hidden gem featuring heroic memorials and romantic encounters.'
        },
        location5: {
          name: 'Smithfield Market',
          description: 'Historic meat market hiding secret entrances to MI6!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'London\'s oldest church has hosted weddings, beheadings, and mysteries.'
        },
        location7: {
          name: 'Barbican Centre',
          description: 'Brutalist architecture perfect for spy headquarters and music videos.'
        },
        location8: {
          name: 'Cornhill & Royal Exchange',
          description: 'The heart of the City has seen romance, action, and undead invasions!'
        },
        location9: {
          name: 'Leadenhall Market',
          description: 'Step into the wizarding world at the real-life Diagon Alley!'
        },
        location10: {
          name: 'Tower Bridge',
          description: 'End your tour at London\'s most photographed bridge and superhero battleground!'
        }
      },
      bonus: {
        title: 'üåü Bonus Film Locations Nearby',
        subtitle: 'Extend your tour with these additional cinematic spots from the original film walk!',
        between: 'Between Locations',
        near: 'Near',
        detour: 'min detour',
        minutesFrom: 'minutes from'
      },
      about: {
        title: 'About This Tour',
        description1: 'This self-guided walking tour takes you through the Square Mile, London\'s historic heart, visiting locations that have appeared in blockbuster films and beloved TV shows. From superhero landings to wizard shopping trips, romantic encounters to explosive action sequences, you\'ll see the City through the lens of cinema.',
        description2: 'The main route covers approximately 3.5 miles and takes 2-3 hours at a leisurely pace. Feel free to explore the bonus locations to extend your cinematic adventure!',
        tipsTitle: 'Tips for Your Tour:',
        tips: [
          'Start early to avoid crowds at popular spots',
          'Bring a camera - these locations are incredibly photogenic!',
          'Many locations are free to enter or view from outside',
          'Check opening times for churches and markets',
          'Wear comfortable walking shoes'
        ]
      },
      footer: {
        copyright: '¬© 2024 London On Screen Walking Tour. Educational use only.',
        credit: 'Based on the City of London\'s film location guide'
      },
      modal: {
        featuredFilms: 'Featured Films & Shows',
        visitorTips: 'Visitor Tips',
        bonusLocation: 'Bonus Location'
      }
    }
  },
  es: {
    filmwalk: {
      title: 'Londres en Pantalla - Tour Autoguiado de Cine y TV',
      header: {
        title: 'üé¨ Londres en Pantalla'
      },
      nav: {
        tour: 'El Tour',
        locations: 'Ubicaciones',
        bonus: 'Sitios Extra',
        about: 'Acerca de'
      },
      hero: {
        title: 'Camina a Trav√©s de la Historia del Cine',
        subtitle: 'Descubre las ic√≥nicas ubicaciones de cine y TV de Londres en este tour autoguiado por la Milla Cuadrada',
        button: 'Comienza Tu Viaje'
      },
      stats: {
        sites: 'Sitios Principales + Extra',
        miles: 'Millas (Ruta Principal)',
        films: 'Pel√≠culas y Series',
        duration: 'Horas de Duraci√≥n'
      },
      map: {
        title: 'Ruta Interactiva a Pie',
        loading: 'Cargando mapa interactivo...',
        calculating: 'Calculando ruta...',
        viewRoute: 'Ver Ruta Completa',
        getDirections: 'Obtener Direcciones',
        downloadGPX: 'Descargar GPX'
      },
      directions: {
        title: 'Direcciones a Pie',
        distance: 'Distancia Total',
        time: 'Tiempo Caminando',
        locations: 'Ubicaciones de Pel√≠culas',
        description: 'Para direcciones paso a paso, recomendamos usar Google Maps o Apple Maps en tu tel√©fono. Haz clic abajo para abrir la ruta en tu aplicaci√≥n preferida:',
        openGoogle: 'Abrir en Google Maps',
        openApple: 'Abrir en Apple Maps'
      },
      route: {
        title: 'Resumen de la Ruta a Pie',
        minute: 'min caminando',
        proTip: 'Consejo:',
        proTipText: 'La ruta est√° dise√±ada para caminar en orden, pero puedes omitir ubicaciones o agregar sitios extra f√°cilmente. Cada ubicaci√≥n est√° bien conectada por transporte p√∫blico si necesitas un descanso.'
      },
      locations: {
        title: 'Ubicaciones Destacadas',
        startJourney: 'Comienza tu viaje en',
        featuredIn: 'Aparece en:',
        location1: {
          name: 'El Puente del Milenio',
          description: '¬°Comienza tu viaje en la entrada de Bankside de esta maravilla arquitect√≥nica moderna que ha sido destruida en pantalla m√°s veces de las que podemos contar!'
        },
        location2: {
          name: 'Catedral de San Pablo',
          description: '¬°Esta ic√≥nica c√∫pula ha sido testigo de todo, desde invasiones alien√≠genas hasta aterrizajes de superh√©roes!'
        },
        location3: {
          name: 'El Old Bailey',
          description: 'La justicia se encuentra con el cine en el tribunal criminal m√°s famoso de Londres.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'Una joya oculta con monumentos heroicos y encuentros rom√°nticos.'
        },
        location5: {
          name: 'Mercado de Smithfield',
          description: '¬°Hist√≥rico mercado de carne que esconde entradas secretas al MI6!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'La iglesia m√°s antigua de Londres ha albergado bodas, decapitaciones y misterios.'
        },
        location7: {
          name: 'Centro Barbican',
          description: 'Arquitectura brutalista perfecta para cuarteles de esp√≠as y videos musicales.'
        },
        location8: {
          name: 'Cornhill y Royal Exchange',
          description: '¬°El coraz√≥n de la City ha visto romance, acci√≥n e invasiones de no-muertos!'
        },
        location9: {
          name: 'Mercado de Leadenhall',
          description: '¬°Entra al mundo m√°gico en el Callej√≥n Diagon de la vida real!'
        },
        location10: {
          name: 'Tower Bridge',
          description: '¬°Termina tu tour en el puente m√°s fotografiado de Londres y campo de batalla de superh√©roes!'
        }
      },
      bonus: {
        title: 'üåü Ubicaciones de Pel√≠culas Extra Cercanas',
        subtitle: '¬°Extiende tu tour con estos lugares cinematogr√°ficos adicionales del recorrido original!',
        between: 'Entre Ubicaciones',
        near: 'Cerca de',
        detour: 'min de desv√≠o',
        minutesFrom: 'minutos desde'
      },
      about: {
        title: 'Acerca de Este Tour',
        description1: 'Este tour autoguiado te lleva a trav√©s de la Milla Cuadrada, el coraz√≥n hist√≥rico de Londres, visitando ubicaciones que han aparecido en grandes pel√≠culas y queridas series de TV. Desde aterrizajes de superh√©roes hasta compras de magos, encuentros rom√°nticos hasta escenas de acci√≥n explosivas, ver√°s la Ciudad a trav√©s del lente del cine.',
        description2: 'La ruta principal cubre aproximadamente 3.5 millas y toma de 2 a 3 horas a un ritmo tranquilo. ¬°Si√©ntete libre de explorar las ubicaciones extra para extender tu aventura cinematogr√°fica!',
        tipsTitle: 'Consejos para Tu Tour:',
        tips: [
          'Comienza temprano para evitar multitudes en los lugares populares',
          'Lleva una c√°mara - ¬°estas ubicaciones son incre√≠blemente fotog√©nicas!',
          'Muchas ubicaciones son gratuitas para entrar o ver desde afuera',
          'Verifica los horarios de apertura de iglesias y mercados',
          'Usa zapatos c√≥modos para caminar'
        ]
      },
      footer: {
        copyright: '¬© 2024 Londres en Pantalla Tour. Solo uso educativo.',
        credit: 'Basado en la gu√≠a de ubicaciones cinematogr√°ficas de la Ciudad de Londres'
      },
      modal: {
        featuredFilms: 'Pel√≠culas y Series Destacadas',
        visitorTips: 'Consejos para Visitantes',
        bonusLocation: 'Ubicaci√≥n Extra'
      }
    }
  },
  pt: {
    filmwalk: {
      title: 'Londres nas Telas - Tour Autoguiado de Cinema e TV',
      header: {
        title: 'üé¨ Londres nas Telas'
      },
      nav: {
        tour: 'O Tour',
        locations: 'Loca√ß√µes',
        bonus: 'Locais B√¥nus',
        about: 'Sobre'
      },
      hero: {
        title: 'Caminhe pela Hist√≥ria do Cinema',
        subtitle: 'Descubra as ic√¥nicas loca√ß√µes de cinema e TV de Londres neste tour autoguiado pela Milha Quadrada',
        button: 'Comece Sua Jornada'
      },
      stats: {
        sites: 'Locais Principais + B√¥nus',
        miles: 'Milhas (Rota Principal)',
        films: 'Filmes e S√©ries',
        duration: 'Horas de Dura√ß√£o'
      },
      map: {
        title: 'Rota Interativa a P√©',
        loading: 'Carregando mapa interativo...',
        calculating: 'Calculando rota...',
        viewRoute: 'Ver Rota Completa',
        getDirections: 'Obter Dire√ß√µes',
        downloadGPX: 'Baixar GPX'
      },
      directions: {
        title: 'Dire√ß√µes a P√©',
        distance: 'Dist√¢ncia Total',
        time: 'Tempo Caminhando',
        locations: 'Loca√ß√µes de Filmes',
        description: 'Para dire√ß√µes passo a passo, recomendamos usar o Google Maps ou Apple Maps no seu telefone. Clique abaixo para abrir a rota no seu aplicativo preferido:',
        openGoogle: 'Abrir no Google Maps',
        openApple: 'Abrir no Apple Maps'
      },
      route: {
        title: 'Vis√£o Geral da Rota a P√©',
        minute: 'min caminhando',
        proTip: 'Dica:',
        proTipText: 'A rota √© projetada para ser percorrida em ordem, mas voc√™ pode facilmente pular loca√ß√µes ou adicionar locais b√¥nus. Cada loca√ß√£o est√° bem conectada por transporte p√∫blico se voc√™ precisar de uma pausa.'
      },
      locations: {
        title: 'Loca√ß√µes em Destaque',
        startJourney: 'Comece sua jornada em',
        featuredIn: 'Aparece em:',
        location1: {
          name: 'A Ponte do Mil√™nio',
          description: 'Comece sua jornada na entrada de Bankside desta maravilha arquitet√¥nica moderna que foi destru√≠da nas telas mais vezes do que podemos contar!'
        },
        location2: {
          name: 'Catedral de S√£o Paulo',
          description: 'Esta c√∫pula ic√¥nica testemunhou tudo, desde invas√µes alien√≠genas at√© pousos de super-her√≥is!'
        },
        location3: {
          name: 'O Old Bailey',
          description: 'A justi√ßa encontra o cinema no tribunal criminal mais famoso de Londres.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'Uma joia oculta com memoriais heroicos e encontros rom√¢nticos.'
        },
        location5: {
          name: 'Mercado de Smithfield',
          description: 'Mercado hist√≥rico de carne que esconde entradas secretas para o MI6!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'A igreja mais antiga de Londres j√° sediou casamentos, decapita√ß√µes e mist√©rios.'
        },
        location7: {
          name: 'Centro Barbican',
          description: 'Arquitetura brutalista perfeita para quart√©is de espi√µes e videoclipes.'
        },
        location8: {
          name: 'Cornhill e Royal Exchange',
          description: 'O cora√ß√£o da City j√° viu romance, a√ß√£o e invas√µes de mortos-vivos!'
        },
        location9: {
          name: 'Mercado de Leadenhall',
          description: 'Entre no mundo m√°gico no Beco Diagonal da vida real!'
        },
        location10: {
          name: 'Tower Bridge',
          description: 'Termine seu tour na ponte mais fotografada de Londres e campo de batalha de super-her√≥is!'
        }
      },
      bonus: {
        title: 'üåü Loca√ß√µes de Filmes B√¥nus Pr√≥ximas',
        subtitle: 'Estenda seu tour com estes locais cinematogr√°ficos adicionais do passeio original!',
        between: 'Entre Loca√ß√µes',
        near: 'Perto de',
        detour: 'min de desvio',
        minutesFrom: 'minutos de'
      },
      about: {
        title: 'Sobre Este Tour',
        description1: 'Este tour autoguiado leva voc√™ atrav√©s da Milha Quadrada, o cora√ß√£o hist√≥rico de Londres, visitando loca√ß√µes que apareceram em filmes blockbuster e s√©ries de TV amadas. De pousos de super-her√≥is a compras de bruxos, encontros rom√¢nticos a cenas de a√ß√£o explosivas, voc√™ ver√° a Cidade atrav√©s das lentes do cinema.',
        description2: 'A rota principal cobre aproximadamente 3,5 milhas e leva de 2 a 3 horas em ritmo tranquilo. Sinta-se √† vontade para explorar as loca√ß√µes b√¥nus para estender sua aventura cinematogr√°fica!',
        tipsTitle: 'Dicas para Seu Tour:',
        tips: [
          'Comece cedo para evitar multid√µes nos pontos populares',
          'Leve uma c√¢mera - estas loca√ß√µes s√£o incrivelmente fotog√™nicas!',
          'Muitas loca√ß√µes s√£o gratuitas para entrar ou ver do lado de fora',
          'Verifique os hor√°rios de funcionamento de igrejas e mercados',
          'Use sapatos confort√°veis para caminhar'
        ]
      },
      footer: {
        copyright: '¬© 2024 Londres nas Telas Tour. Apenas uso educacional.',
        credit: 'Baseado no guia de loca√ß√µes cinematogr√°ficas da Cidade de Londres'
      },
      modal: {
        featuredFilms: 'Filmes e S√©ries em Destaque',
        visitorTips: 'Dicas para Visitantes',
        bonusLocation: 'Loca√ß√£o B√¥nus'
      }
    }
  },
  de: {
    filmwalk: {
      title: 'London auf der Leinwand - Selbstgef√ºhrte Film- und TV-Tour',
      header: {
        title: 'üé¨ London auf der Leinwand'
      },
      nav: {
        tour: 'Die Tour',
        locations: 'Drehorte',
        bonus: 'Bonus-Orte',
        about: '√úber'
      },
      hero: {
        title: 'Wandeln Sie durch die Filmgeschichte',
        subtitle: 'Entdecken Sie Londons ikonische Film- und TV-Drehorte auf dieser selbstgef√ºhrten Wanderung durch die Square Mile',
        button: 'Starten Sie Ihre Reise'
      },
      stats: {
        sites: 'Haupt- + Bonus-Orte',
        miles: 'Meilen (Hauptroute)',
        films: 'Filme & Serien',
        duration: 'Stunden Dauer'
      },
      map: {
        title: 'Interaktive Wanderroute',
        loading: 'Interaktive Karte wird geladen...',
        calculating: 'Route wird berechnet...',
        viewRoute: 'Vollst√§ndige Route ansehen',
        getDirections: 'Wegbeschreibung abrufen',
        downloadGPX: 'GPX herunterladen'
      },
      directions: {
        title: 'Wegbeschreibung zu Fu√ü',
        distance: 'Gesamtdistanz',
        time: 'Gehzeit',
        locations: 'Filmdrehorte',
        description: 'F√ºr eine detaillierte Wegbeschreibung empfehlen wir Google Maps oder Apple Maps auf Ihrem Telefon. Klicken Sie unten, um die Route in Ihrer bevorzugten App zu √∂ffnen:',
        openGoogle: 'In Google Maps √∂ffnen',
        openApple: 'In Apple Maps √∂ffnen'
      },
      route: {
        title: '√úberblick √ºber die Wanderroute',
        minute: 'Min. zu Fu√ü',
        proTip: 'Profi-Tipp:',
        proTipText: 'Die Route ist so konzipiert, dass sie der Reihe nach begangen wird, aber Sie k√∂nnen problemlos Orte √ºberspringen oder Bonus-Orte hinzuf√ºgen. Jeder Ort ist gut mit √∂ffentlichen Verkehrsmitteln verbunden, falls Sie eine Pause brauchen.'
      },
      locations: {
        title: 'Besondere Drehorte',
        startJourney: 'Beginnen Sie Ihre Reise bei',
        featuredIn: 'Zu sehen in:',
        location1: {
          name: 'Die Millennium Bridge',
          description: 'Beginnen Sie Ihre Reise am Bankside-Eingang dieses modernen architektonischen Wunderwerks, das auf der Leinwand √∂fter zerst√∂rt wurde, als wir z√§hlen k√∂nnen!'
        },
        location2: {
          name: 'St Paul\'s Cathedral',
          description: 'Diese ikonische Kuppel hat alles miterlebt, von Alien-Invasionen bis zu Superhelden-Landungen!'
        },
        location3: {
          name: 'Das Old Bailey',
          description: 'Gerechtigkeit trifft Kino im ber√ºhmtesten Strafgericht Londons.'
        },
        location4: {
          name: 'Postman\'s Park',
          description: 'Ein verborgenes Juwel mit heldenhaften Denkm√§lern und romantischen Begegnungen.'
        },
        location5: {
          name: 'Smithfield Market',
          description: 'Historischer Fleischmarkt, der geheime Eing√§nge zum MI6 verbirgt!'
        },
        location6: {
          name: 'St Bartholomew the Great',
          description: 'Londons √§lteste Kirche war Schauplatz von Hochzeiten, Enthauptungen und Mysterien.'
        },
        location7: {
          name: 'Barbican Centre',
          description: 'Brutalistische Architektur, perfekt f√ºr Spionagezentralen und Musikvideos.'
        },
        location8: {
          name: 'Cornhill & Royal Exchange',
          description: 'Das Herz der City hat Romantik, Action und Untoten-Invasionen erlebt!'
        },
        location9: {
          name: 'Leadenhall Market',
          description: 'Betreten Sie die Zaubererwelt in der echten Winkelgasse!'
        },
        location10: {
          name: 'Tower Bridge',
          description: 'Beenden Sie Ihre Tour an Londons meistfotografierter Br√ºcke und Superhelden-Schlachtfeld!'
        }
      },
      bonus: {
        title: 'üåü Bonus-Filmdrehorte in der N√§he',
        subtitle: 'Erweitern Sie Ihre Tour mit diesen zus√§tzlichen Filmorten aus dem urspr√ºnglichen Rundgang!',
        between: 'Zwischen Orten',
        near: 'In der N√§he von',
        detour: 'Min. Umweg',
        minutesFrom: 'Minuten von'
      },
      about: {
        title: '√úber diese Tour',
        description1: 'Diese selbstgef√ºhrte Wanderung f√ºhrt Sie durch die Square Mile, Londons historisches Herz, und besucht Orte, die in Blockbuster-Filmen und beliebten TV-Serien zu sehen waren. Von Superhelden-Landungen bis zu Zauberer-Einkaufstouren, von romantischen Begegnungen bis zu explosiven Action-Szenen - Sie werden die Stadt durch die Linse des Kinos sehen.',
        description2: 'Die Hauptroute umfasst etwa 3,5 Meilen und dauert in gem√§chlichem Tempo 2-3 Stunden. Erkunden Sie gerne die Bonus-Orte, um Ihr filmisches Abenteuer zu verl√§ngern!',
        tipsTitle: 'Tipps f√ºr Ihre Tour:',
        tips: [
          'Starten Sie fr√ºh, um Menschenmassen an beliebten Orten zu vermeiden',
          'Bringen Sie eine Kamera mit - diese Orte sind unglaublich fotogen!',
          'Viele Orte sind kostenlos zu betreten oder von au√üen zu besichtigen',
          'Pr√ºfen Sie die √ñffnungszeiten von Kirchen und M√§rkten',
          'Tragen Sie bequeme Wanderschuhe'
        ]
      },
      footer: {
        copyright: '¬© 2024 London auf der Leinwand Tour. Nur f√ºr Bildungszwecke.',
        credit: 'Basierend auf dem Filmdrehort-Guide der City of London'
      },
      modal: {
        featuredFilms: 'Filme & Serien im Fokus',
        visitorTips: 'Besuchertipps',
        bonusLocation: 'Bonus-Ort'
      }
    }
  }
};

// Language management
let currentLanguage = localStorage.getItem('filmwalkLanguage') || 'en';

function translatePage() {
  // Translate elements with data-i18n attributes
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const translation = getTranslation(key);

    if (translation) {
      if (element.tagName === 'TITLE') {
        document.title = translation;
      } else if (Array.isArray(translation)) {
        // Handle arrays (like tips)
        if (element.tagName === 'UL') {
          element.innerHTML = translation.map(tip => `<li>${tip}</li>`).join('');
        }
      } else {
        element.textContent = translation;
      }
    }
  });

  // Translate location cards
  for (let i = 1; i <= 10; i++) {
    const card = document.querySelector(`.location-card[data-location="${i}"]`);
    if (card) {
      const nameElement = card.querySelector('.location-header span:last-child');
      const descElement = card.querySelector('.location-content p');

      if (nameElement) {
        const locationName = getTranslation(`filmwalk.locations.location${i}.name`);
        if (locationName) nameElement.textContent = locationName;
      }

      if (descElement) {
        const locationDesc = getTranslation(`filmwalk.locations.location${i}.description`);
        if (locationDesc) descElement.textContent = locationDesc;
      }
    }
  }

  // Update HTML lang attribute
  document.documentElement.lang = currentLanguage;

  // Notify other scripts that translation has occurred
  window.dispatchEvent(new CustomEvent('languageChanged', { detail: { language: currentLanguage } }));
}

function getTranslation(key) {
  const keys = key.split('.');
  let translation = translations[currentLanguage];

  for (const k of keys) {
    if (translation && translation[k]) {
      translation = translation[k];
    } else {
      // Fallback to English
      translation = translations['en'];
      for (const k2 of keys) {
        if (translation && translation[k2]) {
          translation = translation[k2];
        } else {
          return null;
        }
      }
      break;
    }
  }

  return translation;
}

// Language data
const languages = {
  en: { name: 'English', code: 'EN', flag: 'gb' },
  es: { name: 'Espa√±ol', code: 'ES', flag: 'es' },
  pt: { name: 'Portugu√™s', code: 'PT', flag: 'pt' },
  de: { name: 'Deutsch', code: 'DE', flag: 'de' }
};

// Initialize language selector
document.addEventListener('DOMContentLoaded', function() {
  const dropdown = document.getElementById('languageDropdown');
  const menu = document.getElementById('languageMenu');
  const selectedFlag = document.getElementById('selectedFlag');
  const selectedLang = document.getElementById('selectedLang');

  // Set current language in dropdown
  function updateDropdown() {
    const lang = languages[currentLanguage];
    selectedFlag.src = `https://flagcdn.com/w40/${lang.flag}.png`;
    selectedLang.textContent = lang.code;
  }

  // Toggle dropdown menu
  dropdown.addEventListener('click', function(e) {
    e.stopPropagation();
    menu.classList.toggle('active');
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', function() {
    menu.classList.remove('active');
  });

  // Handle language selection
  document.querySelectorAll('.language-option').forEach(option => {
    option.addEventListener('click', function(e) {
      e.stopPropagation();
      const lang = this.getAttribute('data-lang');
      if (lang !== currentLanguage) {
        currentLanguage = lang;
        localStorage.setItem('filmwalkLanguage', lang);

        // Update dropdown
        updateDropdown();
        menu.classList.remove('active');

        // Translate page
        translatePage();
      }
    });
  });

  // Initial setup
  updateDropdown();
  translatePage();
});

// Export for use in other scripts
window.i18n = {
  getTranslation,
  getCurrentLanguage: () => currentLanguage
};