
> wavemax-affiliate-program@1.0.0 test:coverage
> jest --coverage --runInBand --forceExit

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/logger.test.js
  Logger Utility
    ✓ should export logger methods (131 ms)
    ✓ should be a winston logger instance (19 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/routingRoutes.test.js
  Routing Routes
    GET /
      ✓ should serve filmwalk index.html (21 ms)
      ✓ should handle root path without trailing slash (5 ms)
      ✓ should return 404 for non-existent paths (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentModel.test.js
  Payment Model Methods
    Instance Methods
      ✓ should determine if payment can be captured (96 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/encryption.test.js
  Encryption Utility
    ✓ should hash password correctly (64 ms)
    ✓ should verify password correctly (156 ms)
    ✓ should encrypt and decrypt data correctly (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paygistixService.test.js
  Paygistix Service
    getConfig
      ✓ should return client config from paygistixConfig (2 ms)
    isConfigured
      ✓ should return true when properly configured (1 ms)
      ✓ should return false when not configured

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailServiceHelpers.test.js
  EmailService Helper Functions
    formatSize
      ✓ should format small size correctly (1 ms)
      ✓ should format medium size correctly (1 ms)
      ✓ should format large size correctly
      ✓ should return original value for unknown sizes
      ✓ should handle empty string
      ✓ should handle null value
      ✓ should handle undefined value (1 ms)
      ✓ should handle numeric values
      ✓ should handle uppercase input
      ✓ should handle mixed case input (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/qrCodeGenerator.test.js
  QR Code Generator
    generateQRCode
      ✓ should generate a customer QR code with timestamp when no ID provided (1 ms)
      ✓ should generate an order QR code with timestamp when no ID provided (1 ms)
      ✓ should generate a customer QR code with provided ID
      ✓ should generate an order QR code with provided ID
      ✓ should convert type to uppercase (1 ms)
      ✓ should use default type of customer when not specified
      ✓ should generate unique codes on consecutive calls (1 ms)
      ✓ should handle special characters in ID
      ✓ should handle empty string ID as null
      ✓ should handle null ID parameter

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paginationMiddleware.test.js
  Pagination Middleware
    ✓ should set default pagination values when no query params provided (1 ms)
    ✓ should parse page and limit from query params
    ✓ should enforce minimum values (1 ms)
    ✓ should enforce maximum limit
    ✓ should handle non-numeric values (1 ms)
    ✓ should calculate skip correctly for different pages
    ✓ should handle floating point numbers
    ✓ should preserve other query parameters

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/helpers.test.js
  Helpers Utility Functions
    formatCurrency
      ✓ should format a number as USD currency by default (31 ms)
      ✓ should handle null and undefined amounts (1 ms)
      ✓ should handle NaN values
      ✓ should parse string amounts (1 ms)
      ✓ should format with different currencies
      ✓ should handle negative amounts (1 ms)
      ✓ should round to 2 decimal places
    formatDate
      ✓ should format date with short format by default (6 ms)
      ✓ should format date with long format
      ✓ should format date with ISO format (1 ms)
      ✓ should handle string dates
      ✓ should handle null and undefined dates (1 ms)
      ✓ should handle invalid dates
      ✓ should handle different format cases

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportGoogleOnly.test.js
  Google OAuth Passport Configuration - Isolated
    ✓ should handle Google OAuth callback correctly (1 ms)
    ✓ should configure Google strategy with correct parameters (1 ms)
    ✓ should support state parameter for context detection

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/quickbooksRoutesSimple.test.js
  QuickBooks Routes - Simple
    GET /api/quickbooks/vendors/export
      ✓ should export vendors (10 ms)
      ✓ should export vendors as CSV (4 ms)
    GET /api/quickbooks/payments/export
      ✓ should export payment summary (17 ms)
    GET /api/quickbooks/commissions/export
      ✓ should export commission detail (4 ms)
    GET /api/quickbooks/exports
      ✓ should get export history (4 ms)
      ✓ should filter export history by type (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateModel.test.js
  Affiliate Model Methods
    Virtual Properties
      ✓ should calculate full name virtual property (154 ms)
    Payment Methods
      ✓ should determine if affiliate can receive payments (136 ms)
    W9 Status Display
      ✓ should return correct W9 status display text (133 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportLinkedInOnly.test.js
  LinkedIn OAuth Passport Configuration - Isolated
    ✓ should handle LinkedIn OAuth callback correctly
    ✓ should configure LinkedIn strategy with correct scope
    ✓ should configure LinkedIn strategy with correct parameters (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportFacebookOnly.test.js
  Facebook OAuth Passport Configuration - Isolated
    ✓ should handle Facebook OAuth callback correctly (1 ms)
    ✓ should configure Facebook strategy with profile fields (5 ms)
    ✓ should configure Facebook strategy with correct parameters

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administratorAdditional.test.js
  Administrator Model - Additional Coverage
    Permission Methods
      ✓ should check single permission with hasPermission (228 ms)
      ✓ should check all permissions with hasAllPermissions (201 ms)
    Password History
      ✓ should check if password is in history (619 ms)
      ✓ should handle empty password history (168 ms)
    Virtual Properties
      ✓ should calculate isLocked virtual property correctly (142 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [Coverage Route] GET /non-existent-file.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /protected-file.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /file%20with%20spaces.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /../../../etc/passwd

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /styles.css

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /script.js

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] POST /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] PUT /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] DELETE /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /critical-files

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/critical-files.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /test-templates

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/test-templates.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /action-plan

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/action-plan.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

PASS tests/unit/coverageRoutesAdditional.test.js
  Coverage Routes - Additional Coverage
    Error Handler Function
      ✓ should handle file not found errors (12 ms)
      ✓ should handle permission denied errors (4 ms)
    Static File Serving Edge Cases
      ✓ should handle requests with special characters in filename (4 ms)
      ✓ should handle requests with directory traversal attempts (5 ms)
      ✓ should serve CSS files with proper headers (3 ms)
      ✓ should serve JS files with proper headers (2 ms)
    Environment-specific Behavior
      ✓ should handle staging environment (2 ms)
    Request Method Handling
      ✓ should reject POST requests (4 ms)
      ✓ should reject PUT requests (3 ms)
      ✓ should reject DELETE requests (3 ms)
    Concurrent Request Handling
      ✓ should handle multiple simultaneous requests (33 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderRoutesSimple.test.js
  Order Routes - Simple
    POST /api/orders
      ✓ should create order with valid data (17 ms)
    GET /api/orders/export
      ✓ should export orders (5 ms)
    GET /api/orders/search
      ✓ should search orders (3 ms)
    GET /api/orders/statistics
      ✓ should get order statistics (3 ms)
    PUT /api/orders/bulk/status
      ✓ should bulk update order status (4 ms)
    POST /api/orders/bulk/cancel
      ✓ should bulk cancel orders (3 ms)
    GET /api/orders/:orderId
      ✓ should get order details (3 ms)
    PUT /api/orders/:orderId/status
      ✓ should update order status (3 ms)
    POST /api/orders/:orderId/cancel
      ✓ should cancel order (10 ms)
    PUT /api/orders/:orderId/payment-status
      ✓ should update payment status (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderModelSimple.test.js
  Order Model - Line Coverage
    SystemConfig Error Handling (Line 110)
      ✓ should use default base rate when SystemConfig.getValue throws error (196 ms)
    Status Timestamp Updates (Lines 132-148)
      ✓ should set processingStartedAt when status changes to processing (226 ms)
      ✓ should set processedAt when status changes to processed (226 ms)
      ✓ should set completedAt when status changes to complete (229 ms)
      ✓ should set cancelledAt when status changes to cancelled (230 ms)
      ✓ should not overwrite existing timestamps (233 ms)
    Actual Weight and Commission Calculations
      ✓ should calculate actualTotal and commission when actualWeight is set (233 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administratorControllerRateLimits.test.js
  Administrator Controller - Reset Rate Limits
    resetRateLimits
      ✓ should reset all rate limits when no filters provided (715 ms)
      ✓ should reset rate limits with type filter (377 ms)
      ✓ should reset rate limits with IP filter (355 ms)
      ✓ should handle IP filter overwriting type filter (360 ms)
      ✓ should handle database errors gracefully (357 ms)
      ✓ should handle missing database connection (1 ms)
      ✓ should handle collection not found error (373 ms)
      ✓ should report zero deletions correctly (372 ms)
      ✓ should handle special regex characters in IP (359 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-07-14T14:09:26.663Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-07-14T14:09:26.802Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-07-14T15:09:26.836Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-07-14T14:09:26.998Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-07-14T14:09:27.112Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-07-14T14:09:27.723Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-07-14T14:09:27.842Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

PASS tests/unit/docusignToken.test.js
  DocuSignToken Model
    saveToken
      ✓ should save a new token with all fields (140 ms)
      ✓ should update existing token if one exists (189 ms)
      ✓ should calculate expiration time correctly (119 ms)
    getCurrentToken
      ✓ should return the most recent token (143 ms)
      ✓ should return null if no tokens exist (102 ms)
    clearTokens
      ✓ should remove all tokens (228 ms)
    token expiration
      ✓ should identify expired tokens (138 ms)
      ✓ should handle tokens without refresh token (118 ms)
    lastUsed tracking
      ✓ should update lastUsed when token is accessed (246 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'customer_12345' },
      headers: {},
      state: 'customer_12345',
      stateStartsWithCustomer: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_12345',
      isCustomerRequest: true,
      willDelegate: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:986:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_123' },
      headers: {},
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_123' },
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_error' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_error',
      sessionId: null,
      allParams: { state: 'customer_error' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1636:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_123' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_123',
      sessionId: 'oauth_123',
      allParams: { state: 'customer_oauth_123' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1636:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_test_session_456' },
      headers: {},
      state: 'oauth_test_session_456',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test_session_456',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test_session_456',
      sessionId: 'oauth_test_session_456',
      allParams: { state: 'oauth_test_session_456' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: undefined },
      headers: {},
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: { state: undefined } }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

PASS tests/unit/oauthCallbacksSimple.test.js
  OAuth Callback Functions - Simple
    handleSocialCallback
      ✓ should delegate to customer handler for customer requests (348 ms)
      ✓ should handle failed authentication with popup (170 ms)
      ✓ should handle errors gracefully (173 ms)
    handleCustomerSocialCallback
      ✓ should handle missing user (156 ms)
      ✓ should store session data for popup requests (154 ms)
    State Parameter Parsing
      ✓ should extract sessionId from oauth_ prefixed state (153 ms)
      ✓ should handle missing state parameter (157 ms)
      ✓ should detect popup from referer header (158 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/modelsAdditional.test.js
  Models - Additional Coverage
    Administrator Model - Pre-save Hook
      ✓ should add password to history on password change (268 ms)
      ✓ should limit password history to 5 entries (112 ms)
    Payment Model - Helper Methods
      ✓ should have a method to format payment display (127 ms)
      ✓ should validate payment can be refunded (106 ms)
      ✓ should calculate net amount after fees (102 ms)
    Edge Cases and Error Handling
      ✓ should handle missing required fields gracefully (112 ms)
      ✓ should handle invalid enum values (104 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentMethodModel.test.js
  PaymentMethod Model Methods
    Virtual Properties
      ✓ should calculate displayName for card payment method (89 ms)
      ✓ should calculate displayName for bank account payment method (167 ms)
      ✓ should return unknown for unsupported payment type (80 ms)
      ✓ should check if card is expired (97 ms)
    Static Methods
      ✓ should find active payment methods for customer (328 ms)
      ○ skipped should find default payment method for customer

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderRoutes.isolated.test.js
  Order Routes - Isolated V2
    ✓ POST /api/orders - should create a new order (17 ms)
    ✓ GET /api/orders/export - should export orders (3 ms)
    ✓ GET /api/orders/search - should search orders (3 ms)
    ✓ GET /api/orders/statistics - should get statistics (2 ms)
    ✓ PUT /api/orders/bulk/status - should bulk update (2 ms)
    ✓ POST /api/orders/bulk/cancel - should bulk cancel (2 ms)
    ✓ GET /api/orders/:orderId - should get order details (7 ms)
    ✓ PUT /api/orders/:orderId/status - should update status (2 ms)
    ✓ POST /api/orders/:orderId/cancel - should cancel order (3 ms)
    ✓ PUT /api/orders/:orderId/payment-status - should update payment (2 ms)
    ✓ Error handling - should return 404 for unknown routes (4 ms)
    ✓ Error handling - should handle controller errors (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error generating monitoring status: Error: Uptime error
        at process.uptime (/var/www/wavemax/wavemax-affiliate-program/tests/unit/monitoringRoutes.test.js:93:15)
        at uptime (/var/www/wavemax/wavemax-affiliate-program/server/routes/monitoringRoutes.js:23:23)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:284:15
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/server/routes/monitoringRoutes.js:11:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/tests/unit/monitoringRoutes.test.js:26:7)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at expressInit (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/middleware/init.js:40:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at query (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/middleware/query.js:45:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/application.js:181:10)
        at Server.app (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/express.js:39:9)
        at Server.emit (node:events:524:28)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17)

      112 |     res.json(monitoringData);
      113 |   } catch (error) {
    > 114 |     console.error('Error generating monitoring status:', error);
          |             ^
      115 |     res.status(500).json({
      116 |       success: false,
      117 |       message: 'Failed to retrieve monitoring status'

      at error (server/routes/monitoringRoutes.js:114:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (server/routes/monitoringRoutes.js:11:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (tests/unit/monitoringRoutes.test.js:26:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

PASS tests/unit/monitoringRoutes.test.js
  Monitoring Routes
    Security Headers Middleware
      ✓ should add security headers to all monitoring routes (8 ms)
    GET /api/monitoring/status
      ✓ should return monitoring status data (2 ms)
      ✓ should include service history with timestamps and response times (6 ms)
      ✓ should handle errors gracefully (26 ms)
    GET /api/monitoring/
      ✓ should serve monitoring dashboard HTML with CSP nonce (3 ms)
    GET /api/monitoring/dashboard
      ✓ should serve monitoring dashboard HTML with CSP nonce (2 ms)
    404 Handler
      ✓ should return 404 for non-existent monitoring endpoints (2 ms)
    Service Status Data Structure
      ✓ should return critical services with proper structure (3 ms)
      ✓ should return non-critical services with proper structure (2 ms)
      ✓ should generate realistic service metrics (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/authRoutesSimple.test.js
  Auth Routes - Simple
    POST /api/auth/login
      ✓ should login with valid credentials (9 ms)
      ✓ should reject invalid credentials (7 ms)
    POST /api/auth/register
      ✓ should register new user (2 ms)
    POST /api/auth/logout
      ✓ should logout with valid token (2 ms)
      ✓ should reject logout without token (1 ms)
    POST /api/auth/forgot-password
      ✓ should send password reset email (2 ms)
    POST /api/auth/reset-password
      ✓ should reset password with valid token (2 ms)
    GET /api/auth/verify-email/:token
      ✓ should verify email with valid token (3 ms)
    POST /api/auth/refresh-token
      ✓ should refresh token (2 ms)
    GET /api/auth/me
      ✓ should get current user with valid token (2 ms)
      ✓ should reject without token (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateLoginInit.test.js
  Affiliate Login Initialization
    Module Loading
      ✓ should initialize when form is found (5 ms)
      ✓ should handle missing form gracefully
    URL Parameter Handling Logic
      ✓ should correctly parse customer parameter from URL
      ✓ should handle URL without customer parameter (1 ms)
      ✓ should construct redirect URL correctly with customer parameter
      ✓ should construct redirect URL correctly without customer parameter
    URL Validation
      ✓ should validate customer ID format (1 ms)
      ✓ should handle URL encoding correctly
    Integration with Email URLs
      ✓ should parse email-generated URLs correctly (1 ms)
      ✓ should handle both login and customer parameters together
    Parameter Preservation Logic
      ✓ should preserve customer parameter through login flow
      ✓ should handle multiple URL parameters correctly (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.isolated.test.js
  Payment Routes - Isolated
    GET /api/v1/payments/config
      ✓ should return payment configuration (4 ms)
    POST /api/v1/payments/log-submission
      ✓ should log payment submission (9 ms)
    POST /api/v1/payments/create-token
      ✓ should create payment token (3 ms)
    GET /api/v1/payments/check-status/:token
      ✓ should check payment status (2 ms)
    POST /api/v1/payments/cancel-token/:token
      ✓ should cancel payment token (2 ms)
    POST /api/v1/payments/update-status/:token
      ✓ should update payment status (3 ms)
    GET /api/v1/payments/pool-stats
      ✓ should return pool statistics (2 ms)
    Error Handling
      ✓ should handle controller errors gracefully (2 ms)
      ✓ should handle missing routes with 404 (2 ms)
    Request Validation
      ✓ should pass through request headers (2 ms)
      ✓ should handle JSON parsing errors (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Export orders error: Error: Export failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderControllerUncovered.test.js:114:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      827 |     }
      828 |   } catch (error) {
    > 829 |     console.error('Export orders error:', error);
          |             ^
      830 |     res.status(500).json({
      831 |       success: false,
      832 |       message: 'An error occurred while exporting orders'

      at error (server/controllers/orderController.js:829:13)
      at Object.<anonymous> (tests/unit/orderControllerUncovered.test.js:117:7)

  console.error
    Search orders error: Error: Search failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderControllerUncovered.test.js:237:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1037 |     });
      1038 |   } catch (error) {
    > 1039 |     console.error('Search orders error:', error);
           |             ^
      1040 |     res.status(500).json({
      1041 |       success: false,
      1042 |       message: 'An error occurred while searching orders'

      at error (server/controllers/orderController.js:1039:13)
      at Object.<anonymous> (tests/unit/orderControllerUncovered.test.js:240:7)

PASS tests/unit/orderControllerUncovered.test.js
  Order Controller - Uncovered Functions
    exportOrders
      ✓ should export orders as CSV (262 ms)
      ✓ should export orders as Excel (122 ms)
      ✓ should export orders as JSON by default (99 ms)
      ✓ should handle export errors (119 ms)
    searchOrders
      ✓ should search orders by customer name (102 ms)
      ✓ should search orders without search term (103 ms)
      ✓ should handle search with no results (104 ms)
      ✓ should handle search errors (102 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administratorEmailService.test.js
  Administrator Email Service Tests
    sendAdministratorWelcomeEmail
      ✓ should call sendAdministratorWelcomeEmail function (1 ms)
      ✓ should handle admin with different permission sets
      ✓ should handle admin with single permission
      ✓ should handle admin with no permissions
    sendAdministratorPasswordResetEmail
      ✓ should call sendAdministratorPasswordResetEmail function
      ✓ should handle different reset URLs
    Email template data processing
      ✓ should replace uppercase placeholders correctly (1 ms)
      ✓ should handle missing placeholders gracefully
      ✓ should include current year in template data
      ✓ should format permissions correctly as comma-separated string
      ✓ should handle empty permissions array
      ✓ should handle single permission
    Email service integration
      ✓ should be available as a module export
      ✓ should not throw error when sending welcome email (1 ms)
      ✓ should not throw error when sending password reset email
    Admin data validation
      ✓ should handle admin with required fields
      ✓ should handle admin with different adminId formats (2 ms)
      ✓ should handle admin with different email formats

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/createAdminDirectly.test.js
  Create Admin Directly Script Unit Tests
    generateAdminId function
      ✓ should generate ADM001 when no administrators exist (1 ms)
      ✓ should generate next sequential ID when administrators exist (1 ms)
      ✓ should handle double-digit admin IDs correctly
    Permission selection
      ✓ should handle "all" permission selection
      ✓ should handle specific permission selection
      ✓ should filter out invalid permission numbers
    Database operations
      ✓ should connect to MongoDB successfully (1 ms)
      ✓ should create administrator with correct data
      ✓ should handle database save errors
    Email functionality
      ✓ should send welcome email after admin creation
      ✓ should handle email sending errors gracefully
    Input validation
      ✓ should handle empty input fields (1 ms)
      ✓ should handle whitespace in permission input
    Error handling
      ✓ should handle MongoDB connection errors
      ✓ should close database connection in finally block (1 ms)
      ✓ should close readline interface in finally block

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderModel.test.js
  Order Model - Additional Coverage
    Pre-save Hook Coverage
      SystemConfig Error Handling
        ✓ should use default base rate when SystemConfig.getValue throws error (323 ms)
      Status Timestamp Updates
        ✓ should set processingStartedAt timestamp when status changes to processing (203 ms)
        ✓ should not overwrite existing processingStartedAt timestamp (211 ms)
      Actual Weight and Commission Calculations
        ✓ should calculate actual total and commission when actual weight is set (199 ms)
        ✓ should set processedAt timestamp when status changes to processed (197 ms)
        ✓ should set completedAt timestamp when status changes to complete (200 ms)
        ✓ should set cancelledAt timestamp when status changes to cancelled (196 ms)
        ✓ should properly calculate commission with different fee structures (168 ms)
        ✓ should not overwrite existing timestamps (195 ms)
      Edge Cases
        ✓ should handle status change to processing (202 ms)
        ✓ should calculate commission for large orders (170 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/wdfCreditModel.test.js
  WDF Credit Model Tests
    Order Model - WDF Credit Fields
      ✓ should have WDF credit tracking fields (248 ms)
      ✓ should calculate estimated total with positive WDF credit (243 ms)
      ✓ should calculate estimated total with negative WDF credit (debit) (264 ms)
      ✓ should calculate actual total with WDF credit when weight is updated (285 ms)
      ✓ should store weight difference and generated credit (245 ms)
    Customer Model - WDF Credit Fields
      ✓ should have WDF credit tracking fields (253 ms)
      ✓ should store positive WDF credit (239 ms)
      ✓ should store negative WDF credit (debit) (244 ms)
    WDF Credit Calculation Logic
      ✓ should handle precision correctly (241 ms)
      ✓ should handle zero credit correctly (242 ms)
    Order Total Recalculation
      ✓ should recalculate total when weight changes (271 ms)
      ✓ should maintain affiliate commission calculation with WDF credit (285 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/cspHelper.test.js
  CSP Helper Utilities
    injectNonce
      ✓ should return original HTML if nonce is not provided (1 ms)
      ✓ should replace {{CSP_NONCE}} placeholders
      ✓ should add nonce to script tags without nonce
      ✓ should not add nonce to script tags that already have nonce
      ✓ should add nonce to style tags without nonce
      ✓ should not add nonce to style tags that already have nonce
      ✓ should add nonce to stylesheet link tags
      ✓ should not add nonce to non-stylesheet link tags
      ✓ should update meta tag with name="csp-nonce"
      ✓ should handle complex HTML with multiple elements (1 ms)
      ✓ should handle script tags with attributes
      ✓ should handle style tags with attributes
    readHTMLWithNonce
      ✓ should read file and inject nonce (1 ms)
      ✓ should handle file read errors (7 ms)
      ✓ should pass empty nonce through to injectNonce
    serveHTMLWithNonce
      ✓ should serve HTML with nonce successfully (2 ms)
      ✓ should handle errors when serving HTML (1 ms)
      ✓ should handle missing nonce in res.locals
      ✓ should construct correct file path (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailService.test.js
  Email Service Mock
    All Email Functions
      ✓ should have all required email functions mocked (2 ms)
      ✓ should return expected mock response for all functions (3 ms)
      ✓ should track function calls correctly (1 ms)
      ✓ should handle errors when mocked to reject (7 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/controllersAdditional.test.js
  Controllers - Additional Function Coverage
    Order Controller - Additional Functions
      searchOrders - Additional Cases
        ✓ should handle search with affiliate filter (56 ms)
        ✓ should handle empty search query (63 ms)
      exportOrders - Edge Cases
        ✓ should handle export with date filters (59 ms)
      getOrderStatistics - Various Scenarios
        ✓ should get order statistics with time range (57 ms)
        ✓ should handle statistics for affiliate user (52 ms)
    Affiliate Controller - Additional Functions
      getAffiliateDashboardStats - Edge Cases
        ✓ should handle empty statistics (52 ms)
        ✓ should handle date range filters (77 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error creating administrator: Error [ValidationError]: Invalid permission
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:56:31)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      188 |
      189 |   } catch (error) {
    > 190 |     console.error('Error creating administrator:', error);
          |             ^
      191 |
      192 |     // Handle validation errors from model pre-save hooks
      193 |     if (error.name === 'ValidationError') {

      at error (server/controllers/administratorController.js:190:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:62:7)

  console.error
    Error creating administrator: Error: Duplicate key
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:79:30)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34) {
      code: 11000
    }

      188 |
      189 |   } catch (error) {
    > 190 |     console.error('Error creating administrator:', error);
          |             ^
      191 |
      192 |     // Handle validation errors from model pre-save hooks
      193 |     if (error.name === 'ValidationError') {

      at error (server/controllers/administratorController.js:190:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:85:7)

  console.error
    Error deleting administrator: TypeError: Cannot read properties of undefined (reading 'length')
        at length (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:352:27)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:164:7)

      385 |
      386 |   } catch (error) {
    > 387 |     console.error('Error deleting administrator:', error);
          |             ^
      388 |     res.status(500).json({
      389 |       success: false,
      390 |       message: 'Failed to delete administrator'

      at error (server/controllers/administratorController.js:387:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:164:7)

  console.error
    Error fetching dashboard data: Error: Database connection lost
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:225:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1249 |
      1250 |   } catch (error) {
    > 1251 |     console.error('Error fetching dashboard data:', error);
           |             ^
      1252 |     res.status(500).json({
      1253 |       success: false,
      1254 |       message: 'Failed to fetch dashboard data'

      at error (server/controllers/administratorController.js:1251:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:227:7)

PASS tests/unit/administratorControllerAdditional.test.js (5.526 s)
  Administrator Controller - Additional Coverage
    createAdministrator - Error Handling
      ✓ should handle validation errors from pre-save hooks (132 ms)
      ✓ should handle duplicate email errors (113 ms)
    updateAdministrator - Edge Cases
      ✓ should prevent self-deactivation (52 ms)
      ✓ should handle administrator not found (51 ms)
    deleteAdministrator - Error Cases
      ✓ should prevent deleting the last administrator with full permissions (54 ms)
      ✓ should handle deletion errors (69 ms)
    getDashboard - Complex Scenarios
      ✓ should handle empty analytics data (52 ms)
      ✓ should handle database errors gracefully (53 ms)
    getOrderAnalytics - Date Range Handling
      ✓ should handle custom date range (52 ms)
      ✓ should handle invalid date format (51 ms)
    Helper Functions
      ✓ should export updateOperatorStats function (52 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paygistixConfig.test.js
  Paygistix Config
    validateEnvironment
      ✓ should warn when required environment variables are missing (1 ms)
      ✓ should not warn when all required variables are present (2 ms)
    getEnvironment
      ✓ should return configured environment (1 ms)
      ✓ should default to production if not configured
    getMerchantId
      ✓ should return merchant ID when configured (1 ms)
      ✓ should throw error when not configured (8 ms)
    getFormId
      ✓ should return form ID when configured (1 ms)
      ✓ should throw error when not configured
    getFormHash
      ✓ should return form hash when configured
      ✓ should throw error when not configured (1 ms)
    getFormActionUrl
      ✓ should return configured form action URL (1 ms)
      ✓ should return default URL when not configured
    getReturnUrl
      ✓ should return configured return URL (1 ms)
      ✓ should return default URL when not configured (1 ms)
    isConfigured
      ✓ should return true when all required config is present (1 ms)
      ✓ should return false and log error when config is incomplete
    getClientConfig
      ✓ should return complete client config when properly configured (1 ms)
      ✓ should throw and log error when config is missing (1 ms)
      ✓ should set testModeEnabled to false when not configured (1 ms)
    getFullConfig
      ✓ should return complete config including hash (1 ms)
      ✓ should throw and log error when config is missing (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

FAIL tests/unit/affiliateModelAdditional.test.js
  Affiliate Model - Additional Coverage
    Payment Method Default
      ✓ should default payment method to check for social registration (59 ms)
      ✓ should not set default payment method for traditional registration (67 ms)
      ✓ should not set default payment method when registrationMethod is not set (59 ms)
    Pre-save hooks
      ✕ should test password hashing in pre-save hook (57 ms)
      ✕ should not hash password if passwordHash already exists (55 ms)
      ✕ should test account number encryption in pre-save hook (50 ms)
      ✕ should not encrypt non-string values (50 ms)
      ✕ should not encrypt if fields are not modified (53 ms)
    Instance Methods
      ✕ should test getDecryptedAccountNumber method (51 ms)
      ✕ should handle null account number in getDecryptedAccountNumber (50 ms)
      ✕ should test getDecryptedRoutingNumber method (65 ms)
      ✕ should handle null routing number in getDecryptedRoutingNumber (54 ms)
      ✕ should test getDecryptedPaypalEmail method (61 ms)
      ✕ should handle null paypal email in getDecryptedPaypalEmail (52 ms)

  ● Affiliate Model - Additional Coverage › Pre-save hooks › should test password hashing in pre-save hook

    TypeError: Cannot read properties of undefined (reading 'options')

      93 |       const next = jest.fn();
      94 |       
    > 95 |       passwordHashHook.fn.call(mockDoc, next);
         |                           ^
      96 |       
      97 |       expect(mockDoc.isModified).toHaveBeenCalledWith('password');
      98 |       expect(encryptionUtil.hashPassword).toHaveBeenCalledWith('plainTextPassword');

      at Object.validateBeforeSave (node_modules/mongoose/lib/plugins/validateBeforeSave.js:24:39)
      at Object.call (tests/unit/affiliateModelAdditional.test.js:95:27)

  ● Affiliate Model - Additional Coverage › Pre-save hooks › should not hash password if passwordHash already exists

    TypeError: Cannot read properties of undefined (reading 'options')

      117 |       const next = jest.fn();
      118 |       
    > 119 |       passwordHashHook.fn.call(mockDoc, next);
          |                           ^
      120 |       
      121 |       expect(encryptionUtil.hashPassword).not.toHaveBeenCalled();
      122 |       expect(mockDoc.passwordHash).toBe('existing-hash');

      at Object.validateBeforeSave (node_modules/mongoose/lib/plugins/validateBeforeSave.js:24:39)
      at Object.call (tests/unit/affiliateModelAdditional.test.js:119:27)

  ● Affiliate Model - Additional Coverage › Pre-save hooks › should test account number encryption in pre-save hook

    TypeError: this.$getAllSubdocs is not a function

      145 |       const next = jest.fn();
      146 |       
    > 147 |       encryptionHook.fn.call(mockDoc, next);
          |                         ^
      148 |       
      149 |       expect(encryptionUtil.encrypt).toHaveBeenCalledWith('1234567890');
      150 |       expect(encryptionUtil.encrypt).toHaveBeenCalledWith('123456789');

      at Object.saveSubdocsPreSave (node_modules/mongoose/lib/plugins/saveSubdocs.js:18:26)
      at Object.call (tests/unit/affiliateModelAdditional.test.js:147:25)

  ● Affiliate Model - Additional Coverage › Pre-save hooks › should not encrypt non-string values

    TypeError: this.$getAllSubdocs is not a function

      170 |       const next = jest.fn();
      171 |       
    > 172 |       encryptionHook.fn.call(mockDoc, next);
          |                         ^
      173 |       
      174 |       expect(encryptionUtil.encrypt).not.toHaveBeenCalled();
      175 |       expect(next).toHaveBeenCalled();

      at Object.saveSubdocsPreSave (node_modules/mongoose/lib/plugins/saveSubdocs.js:18:26)
      at Object.call (tests/unit/affiliateModelAdditional.test.js:172:25)

  ● Affiliate Model - Additional Coverage › Pre-save hooks › should not encrypt if fields are not modified

    TypeError: this.$getAllSubdocs is not a function

      190 |       const next = jest.fn();
      191 |       
    > 192 |       encryptionHook.fn.call(mockDoc, next);
          |                         ^
      193 |       
      194 |       expect(encryptionUtil.encrypt).not.toHaveBeenCalled();
      195 |       expect(next).toHaveBeenCalled();

      at Object.saveSubdocsPreSave (node_modules/mongoose/lib/plugins/saveSubdocs.js:18:26)
      at Object.call (tests/unit/affiliateModelAdditional.test.js:192:25)

  ● Affiliate Model - Additional Coverage › Instance Methods › should test getDecryptedAccountNumber method

    TypeError: affiliate.getDecryptedAccountNumber is not a function

      205 |       };
      206 |       
    > 207 |       const result = affiliate.getDecryptedAccountNumber();
          |                                ^
      208 |       
      209 |       expect(encryptionUtil.decrypt).toHaveBeenCalledWith('encrypted_1234567890');
      210 |       expect(result).toBe('1234567890');

      at Object.getDecryptedAccountNumber (tests/unit/affiliateModelAdditional.test.js:207:32)

  ● Affiliate Model - Additional Coverage › Instance Methods › should handle null account number in getDecryptedAccountNumber

    TypeError: affiliate.getDecryptedAccountNumber is not a function

      217 |       };
      218 |       
    > 219 |       const result = affiliate.getDecryptedAccountNumber();
          |                                ^
      220 |       
      221 |       expect(result).toBeNull();
      222 |     });

      at Object.getDecryptedAccountNumber (tests/unit/affiliateModelAdditional.test.js:219:32)

  ● Affiliate Model - Additional Coverage › Instance Methods › should test getDecryptedRoutingNumber method

    TypeError: affiliate.getDecryptedRoutingNumber is not a function

      228 |       };
      229 |       
    > 230 |       const result = affiliate.getDecryptedRoutingNumber();
          |                                ^
      231 |       
      232 |       expect(encryptionUtil.decrypt).toHaveBeenCalledWith('encrypted_123456789');
      233 |       expect(result).toBe('123456789');

      at Object.getDecryptedRoutingNumber (tests/unit/affiliateModelAdditional.test.js:230:32)

  ● Affiliate Model - Additional Coverage › Instance Methods › should handle null routing number in getDecryptedRoutingNumber

    TypeError: affiliate.getDecryptedRoutingNumber is not a function

      240 |       };
      241 |       
    > 242 |       const result = affiliate.getDecryptedRoutingNumber();
          |                                ^
      243 |       
      244 |       expect(result).toBeNull();
      245 |     });

      at Object.getDecryptedRoutingNumber (tests/unit/affiliateModelAdditional.test.js:242:32)

  ● Affiliate Model - Additional Coverage › Instance Methods › should test getDecryptedPaypalEmail method

    TypeError: affiliate.getDecryptedPaypalEmail is not a function

      251 |       };
      252 |       
    > 253 |       const result = affiliate.getDecryptedPaypalEmail();
          |                                ^
      254 |       
      255 |       expect(encryptionUtil.decrypt).toHaveBeenCalledWith('encrypted_paypal@example.com');
      256 |       expect(result).toBe('paypal@example.com');

      at Object.getDecryptedPaypalEmail (tests/unit/affiliateModelAdditional.test.js:253:32)

  ● Affiliate Model - Additional Coverage › Instance Methods › should handle null paypal email in getDecryptedPaypalEmail

    TypeError: affiliate.getDecryptedPaypalEmail is not a function

      263 |       };
      264 |       
    > 265 |       const result = affiliate.getDecryptedPaypalEmail();
          |                                ^
      266 |       
      267 |       expect(result).toBeNull();
      268 |     });

      at Object.getDecryptedPaypalEmail (tests/unit/affiliateModelAdditional.test.js:265:32)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateDashboardInit.test.js
  Affiliate Dashboard Customer Filtering
    URL Parameter Detection Logic
      ✓ should detect customer parameter from URL search params (1 ms)
      ✓ should handle URL without customer parameter
      ✓ should parse customer parameter from complex URL
      ✓ should handle regex pattern matching for customer parameter
    Customer Highlighting Logic
      ✓ should identify highlighted customer correctly
      ✓ should generate correct CSS classes for highlighted customer
      ✓ should generate correct HTML content for highlighted customer (1 ms)
      ✓ should not highlight non-matching customers
    Tab Switching Logic
      ✓ should determine correct tab activation based on customer parameter
      ✓ should not switch tabs when no customer parameter
      ✓ should handle empty string customer parameter (1 ms)
    Authentication Check Logic
      ✓ should identify authenticated state correctly
      ✓ should identify unauthenticated state when missing token
      ✓ should identify unauthenticated state when missing affiliate
    Customer Data Processing
      ✓ should handle empty customer list (1 ms)
      ✓ should process customer list without filtering
      ✓ should filter customer list by customer ID
    URL Construction and Validation
      ✓ should construct API URLs correctly (1 ms)
      ✓ should validate customer ID format
    Timing and Delays
      ✓ should calculate correct delay for tab switching
      ✓ should handle immediate execution when no customer parameter (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.test.js
  Payment Routes
    Static Routes
      GET /api/v1/payments/config
        ✓ should return payment configuration (16 ms)
      POST /api/v1/payments/log-submission
        ✓ should log payment submission (9 ms)
      POST /api/v1/payments/create-token
        ✓ should create payment token (7 ms)
      GET /api/v1/payments/check-status/:token
        ✓ should check payment status (3 ms)
      POST /api/v1/payments/cancel-token/:token
        ✓ should cancel payment token (2 ms)
      POST /api/v1/payments/update-status/:token
        ✓ should update payment status (6 ms)
      GET /api/v1/payments/pool-stats
        ✓ should return pool statistics (3 ms)
    Dynamic Callback Routes
      ✓ should handle GET callback routes (2 ms)
      ✓ should handle POST callback routes (6 ms)
      ✓ should handle multiple callback paths (4 ms)
    Error Handling
      ✓ should handle controller errors gracefully (3 ms)
      ✓ should handle missing routes with 404 (9 ms)
      ✓ should handle JSON parsing errors (5 ms)
    Request Validation
      ✓ should pass through request headers (3 ms)
      ✓ should handle empty request bodies (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/fieldFilterWdfCredit.test.js (5.314 s)
  Field Filter WDF Credit Support
    Customer WDF Credit Fields
      ✓ should include WDF credit fields for customer viewing own profile (3 ms)
      ✓ should include WDF credit fields for affiliate viewing customer
      ✓ should include WDF credit fields for admin viewing customer (1 ms)
      ✓ should NOT include WDF credit for public access
      ✓ should NOT include WDF credit for other customers
    Order WDF Credit Fields
      ✓ should include WDF fields for customer viewing own order (1 ms)
      ✓ should include WDF fields for affiliate viewing order
      ✓ should include WDF fields for admin viewing order
    Field Definition Verification
      ✓ should have WDF credit fields defined in customer field definitions (1 ms)
      ✓ should have WDF credit fields defined in order field definitions
    Array Filtering
      ✓ should filter WDF credit fields in customer arrays
      ✓ should filter WDF credit fields in order arrays
    Edge Cases
      ✓ should handle null/undefined WDF credit values (1 ms)
      ✓ should handle zero WDF credit values

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderWithSystemConfig.test.js (10.903 s)
  Order Model with SystemConfig Integration
    Dynamic WDF Pricing
      ✓ should fetch base rate from SystemConfig on order creation (954 ms)
      ✓ should use default rate when SystemConfig is not available (1071 ms)
      ✓ should calculate estimated total using SystemConfig rate (737 ms)
      ✓ should calculate actual total using SystemConfig rate (726 ms)
    Commission Calculations
      ✓ should calculate affiliate commission correctly with custom WDF rate (762 ms)
      ✓ should calculate commission for zero delivery fee (739 ms)
      ✓ should handle commission calculation for large orders (725 ms)
    Edge Cases
      ✓ should handle commission when only estimated size is available (737 ms)
      ✓ should update calculations when base rate changes (880 ms)
      ✓ should validate minimum and maximum base rates (1030 ms)
    Revenue Calculator Scenarios
      ✓ should match revenue calculator example - 10 customers scenario (1301 ms)
      ✓ should match revenue calculator with different parameters (772 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching test customer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:95:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      28 |         res.json(customer);
      29 |     } catch (error) {
    > 30 |         console.error('Error fetching test customer:', error);
         |                 ^
      31 |         res.status(500).json({ error: 'Failed to fetch test customer' });
      32 |     }
      33 | });

      at error (server/routes/testRoutes.js:30:17)

  console.error
    Error creating test customer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:185:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      106 |         res.json(customer);
      107 |     } catch (error) {
    > 108 |         console.error('Error creating test customer:', error);
          |                 ^
      109 |         res.status(500).json({ error: 'Failed to create test customer' });
      110 |     }
      111 | });

      at error (server/routes/testRoutes.js:108:17)

  console.error
    Error creating test order: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:289:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      164 |         res.json(order);
      165 |     } catch (error) {
    > 166 |         console.error('Error creating test order:', error);
          |                 ^
      167 |         res.status(500).json({ error: 'Failed to create test order: ' + error.message });
      168 |     }
      169 | });

      at error (server/routes/testRoutes.js:166:17)

  console.error
    Error cleaning up test data: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:315:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      180 |         res.json({ message: 'Test data cleaned up successfully' });
      181 |     } catch (error) {
    > 182 |         console.error('Error cleaning up test data:', error);
          |                 ^
      183 |         res.status(500).json({ error: 'Failed to cleanup test data' });
      184 |     }
      185 | });

      at error (server/routes/testRoutes.js:182:17)

PASS tests/unit/testRoutes.test.js
  Test Routes
    testOnlyMiddleware
      ✓ should allow access in test environment (6 ms)
      ✓ should block access in production without ENABLE_TEST_ROUTES (3 ms)
      ✓ should allow access in production with ENABLE_TEST_ROUTES (9 ms)
    GET /api/test/customer
      ✓ should return existing test customer (3 ms)
      ✓ should return 404 when test customer not found (2 ms)
      ✓ should handle database errors (23 ms)
    POST /api/test/customer
      ✓ should return existing customer if already exists (6 ms)
      ✓ should create new customer and affiliate if not exists (104 ms)
      ✓ should use existing affiliate if already exists (54 ms)
      ✓ should handle database errors (4 ms)
    POST /api/test/order
      ✓ should create order for specified customer (3 ms)
      ✓ should find test customer by email if customerId not provided (2 ms)
      ✓ should delete existing test orders when recreate is true (2 ms)
      ✓ should return 400 when customer not found (2 ms)
      ✓ should handle database errors (3 ms)
    DELETE /api/test/cleanup
      ✓ should delete all test data (2 ms)
      ✓ should handle database errors during cleanup (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.full.test.js
  Payment Routes - Full Coverage
    Dynamic Route Loading
      ✓ should load dynamic callback routes when not in test environment (23 ms)
      ✓ should handle GET requests on dynamic callback routes (26 ms)
      ✓ should handle POST requests on dynamic callback routes (26 ms)
      ✓ should handle errors when loading config file (19 ms)
      ✓ should handle invalid JSON in config file (29 ms)
      ✓ should skip dynamic route loading in test environment (22 ms)
    Static Routes
      ✓ should handle GET /config (36 ms)
      ✓ should handle POST /log-submission (28 ms)
      ✓ should handle POST /create-token (34 ms)
      ✓ should handle GET /check-status/:token (20 ms)
      ✓ should handle POST /cancel-token/:token (38 ms)
      ✓ should handle POST /update-status/:token (22 ms)
      ✓ should handle GET /pool-stats (26 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/customerDashboardWdfCredit.test.js (6.625 s)
  Customer Dashboard WDF Credit Display
    Dashboard Stats with WDF Credit
      ✓ should include WDF credit information in dashboard response (748 ms)
      ✓ should show zero WDF credit for new customers (594 ms)
      ✓ should show negative WDF credit (debit) correctly (570 ms)
      ✓ should include both bag credit and WDF credit (565 ms)
    Dashboard with Order History
      ✓ should show WDF credit alongside order statistics (641 ms)
    Access Control
      ✓ should allow affiliates to see customer WDF credit (579 ms)
      ✓ should not allow unrelated affiliates to see customer WDF credit (461 ms)
      ✓ should allow admins to see any customer WDF credit (559 ms)
    Edge Cases
      ✓ should handle null WDF credit fields gracefully (577 ms)
      ✓ should handle very small WDF credit amounts (586 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/facebookUtils.test.js
  Facebook Utils
    parseSignedRequest
      ✓ should parse valid signed request (2 ms)
      ✓ should return null for invalid signature
      ✓ should return null for malformed signed request (1 ms)
      ✓ should return null when missing parameters
      ✓ should handle invalid JSON in payload (1 ms)
    base64UrlDecode
      ✓ should decode base64 URL encoded strings
      ✓ should handle strings without padding
      ✓ should handle strings with URL-safe characters (1 ms)
    generateStatusUrl
      ✓ should generate correct status URL
      ✓ should handle base URL with trailing slash (1 ms)
      ✓ should handle base URL with path
    deleteFacebookData
      ✓ should delete all Facebook data from user (1 ms)
      ✓ should handle user without Facebook data
      ✓ should handle user without socialAccounts (1 ms)
      ✓ should only update registration method if it was facebook
    findUsersByFacebookId
      ✓ should find both affiliate and customer (1 ms)
      ✓ should handle when only affiliate exists (1 ms)
      ✓ should handle when no users exist
    anonymizeUserData
      ✓ should anonymize all user data (1 ms)
      ✓ should handle user with partial data
      ✓ should handle user with no personal data

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/tokenBlacklist.test.js
  TokenBlacklist Model
    Schema Validation
      ✓ should create a valid token blacklist entry (125 ms)
      ✓ should use default values for blacklistedAt and reason (122 ms)
      ✓ should require all mandatory fields (81 ms)
      ✓ should enforce unique token constraint (274 ms)
      ✓ should validate userType enum (76 ms)
      ✓ should accept all valid userTypes (216 ms)
    Static Methods
      blacklistToken
        ✓ should successfully blacklist a token (115 ms)
        ✓ should use default reason when not provided (112 ms)
        ✓ should return null when token already blacklisted (248 ms)
        ✓ should handle custom reasons (116 ms)
        ✓ should propagate non-duplicate errors (80 ms)
      isBlacklisted
        ✓ should return true for blacklisted token (140 ms)
        ✓ should return false for non-blacklisted token (103 ms)
        ✓ should handle empty token (103 ms)
        ✓ should handle null token (104 ms)
      cleanupExpired
        ✓ should delete expired tokens (233 ms)
        ✓ should return 0 when no expired tokens (199 ms)
        ✓ should handle empty collection (117 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error resetting rate limits: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/simpleRouteHandlers.test.js:153:40)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      88 |           
      89 |         } catch (error) {
    > 90 |           console.error('Error resetting rate limits:', error);
         |                   ^
      91 |           res.status(500).json({
      92 |             success: false,
      93 |             message: 'Error resetting rate limits'

      at error (tests/unit/simpleRouteHandlers.test.js:90:19)

  console.error
    Error serving documentation with nonce: Error: Processing error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/simpleRouteHandlers.test.js:272:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      42 |     res.type('html').send(html);
      43 |   } catch (error) {
    > 44 |     console.error('Error serving documentation with nonce:', error);
         |             ^
      45 |     next(error);
      46 |   }
      47 | };

      at error (server/routes/docsRoutes.js:44:13)

PASS tests/unit/simpleRouteHandlers.test.js
  Simple Route Handlers
    Administrator Rate Limit Reset
      ✓ should reset all rate limits when no filters provided (9 ms)
      ✓ should reset rate limits by type filter (3 ms)
      ✓ should reset rate limits by IP filter (2 ms)
      ✓ should handle database errors (16 ms)
    Documentation Serving with CSP Nonce
      ✓ should serve HTML files with CSP nonce (6 ms)
      ✓ should default to index.html for root path (2 ms)
      ✓ should skip nonce injection for example files (2 ms)
      ✓ should skip non-HTML files (2 ms)
      ✓ should handle non-existent files (2 ms)
      ✓ should handle errors during file processing (4 ms)
    Basic Auth Route Handlers
      ✓ should handle successful authentication (3 ms)
      ✓ should handle missing credentials (3 ms)
      ✓ should handle invalid credentials (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/validators.test.js
  Validators
    isValidEmail
      ✓ should validate correct email addresses (2 ms)
      ✓ should reject invalid email addresses (1 ms)
    isValidPhone
      ✓ should validate correct US phone numbers (1 ms)
      ✓ should reject invalid phone numbers
    isValidUsername
      ✓ should validate correct usernames (1 ms)
      ✓ should reject invalid usernames (1 ms)
    isValidZipCode
      ✓ should validate correct US zip codes
      ✓ should reject invalid zip codes (1 ms)
    isValidTimeFormat
      ✓ should validate correct time formats
      ✓ should reject invalid time formats (1 ms)
    isValidName
      ✓ should validate correct names
      ✓ should reject invalid names
    mongooseValidators
      ✓ should provide email validator
      ✓ should provide phone validator
      ✓ should provide username validator
      ✓ should provide zipCode validator (1 ms)
      ✓ should provide timeFormat validator
      ✓ should provide name validator
    expressValidators
      ✓ should provide email validator function (1 ms)
      ✓ should provide phone validator function
      ✓ should provide username validator function
      ✓ should provide zipCode validator function
      ✓ should provide timeFormat validator function (1 ms)
      ✓ should provide name validator function
    Client-side validation functions
      validateEmail
        ✓ should return validation result for emails
      validatePhone
        ✓ should return validation result for phones (1 ms)
      validateUsername
        ✓ should return validation result for usernames
      validateZipCode
        ✓ should return validation result for zip codes (1 ms)
      validateTimeFormat
        ✓ should return validation result for time formats
      validateName
        ✓ should return validation result for names (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error creating administrator: Error [ValidationError]: Invalid permission: invalid_permission
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerUncovered.test.js:49:31)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      188 |
      189 |   } catch (error) {
    > 190 |     console.error('Error creating administrator:', error);
          |             ^
      191 |
      192 |     // Handle validation errors from model pre-save hooks
      193 |     if (error.name === 'ValidationError') {

      at Object.error [as createAdministrator] (server/controllers/administratorController.js:190:13)
      at Object.<anonymous> (tests/unit/administratorControllerUncovered.test.js:70:7)

  console.error
    Error creating administrator: Error: E11000 duplicate key error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerUncovered.test.js:88:30)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34) {
      code: 11000
    }

      188 |
      189 |   } catch (error) {
    > 190 |     console.error('Error creating administrator:', error);
          |             ^
      191 |
      192 |     // Handle validation errors from model pre-save hooks
      193 |     if (error.name === 'ValidationError') {

      at Object.error [as createAdministrator] (server/controllers/administratorController.js:190:13)
      at Object.<anonymous> (tests/unit/administratorControllerUncovered.test.js:109:7)

PASS tests/unit/administratorControllerUncovered.test.js
  Administrator Controller - Uncovered Functions
    createAdministrator - Additional Error Cases
      ✓ should handle pre-save validation errors (77 ms)
      ✓ should handle duplicate email error (11000) (60 ms)
    deleteAdministrator - Last Admin Check
      ✓ should prevent deleting the last administrator with full permissions (62 ms)
    getDashboard - All Statistics
      ✓ should return dashboard with all statistics (56 ms)
    getOrderAnalytics - With Date Filters
      ✓ should handle date range in analytics (52 ms)
    exportReport - Different Formats
      ✓ should export orders report (51 ms)
      ✓ should handle invalid report type (56 ms)
    getAffiliatesList - With Filters
      ✓ should get filtered affiliates list (50 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] Google callback: {
      error: null,
      user: 'exists',
      userObject: { id: '12345', email: 'test@example.com', provider: 'google' },
      isExistingAffiliate: undefined,
      info: null
    }

      at log (server/routes/socialAuthRoutes.js:40:13)

PASS tests/unit/socialAuthRoutes.full.test.js
  Social Auth Routes - Full Coverage
    Google OAuth Routes
      ✓ should initiate Google OAuth when configured (54 ms)
      ✓ should return 404 when Google OAuth is not configured (53 ms)
      ✓ should handle Google OAuth callback (56 ms)
      ✓ should pass state parameter through OAuth (46 ms)
    Facebook OAuth Routes
      ✓ should initiate Facebook OAuth when configured (53 ms)
      ✓ should return 404 when Facebook OAuth is not configured (52 ms)
    LinkedIn OAuth Routes
      ○ skipped should initiate LinkedIn OAuth when configured - LinkedIn removed
    Customer OAuth Routes
      ✓ should initiate Google OAuth for customers (45 ms)
      ✓ should redirect customer Google OAuth callback (73 ms)
      ✓ should handle customer Facebook OAuth callback (41 ms)
      ✓ should initiate Facebook OAuth for customers (44 ms)
      ✓ should return 404 when Facebook OAuth is not configured for customers (41 ms)
      ○ skipped should initiate LinkedIn OAuth for customers - LinkedIn removed
      ○ skipped should return 404 when LinkedIn OAuth is not configured for customers - LinkedIn removed
      ○ skipped should handle customer LinkedIn OAuth callback - LinkedIn removed
    Social Registration Completion
      ✓ should complete affiliate social registration (55 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /critical-files

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/critical-files.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /test-templates

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/test-templates.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /action-plan

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/action-plan.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /non-existent-page

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /action-plan.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /critical-files.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /missing

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

PASS tests/unit/coverageRoutes.test.js
  Coverage Routes
    Access Control Middleware
      ✓ should allow access in development environment (18 ms)
      ✓ should allow access in test environment (4 ms)
      ✓ should deny access in production without key
      ✓ should allow access in production with valid key (5 ms)
      ✓ should deny access in production with invalid key (2 ms)
    Embedded Access Prevention
      ✓ should deny access when Sec-Fetch-Dest is iframe (2 ms)
      ✓ should deny access when X-Frame-Options is present (6 ms)
      ✓ should deny access when referer contains /embed (2 ms)
      ✓ should allow access with normal referer (5 ms)
    Route Handlers
      ✓ should serve index.html at root path (5 ms)
      ✓ should serve critical-files page (5 ms)
      ✓ should serve test-templates page (6 ms)
      ✓ should serve action-plan page (7 ms)
      ✓ should return 404 for non-existent pages (4 ms)
    Static File Headers
      ✓ should set no-cache headers for static files (5 ms)
      ✓ should set no-cache headers for HTML files (4 ms)
      ✓ should set no-cache headers for other HTML files (8 ms)
    Environment Variable Handling
      ✓ should handle missing COVERAGE_ACCESS_KEY (3 ms)
      ✓ should handle empty COVERAGE_ACCESS_KEY (5 ms)
    Multiple Middleware Interaction
      ✓ should check embedded access before access control (2 ms)
      ✓ should apply X-Frame-Options even with valid access (6 ms)
    HTML Response Validation
      ✓ should return valid HTML for access denied page (3 ms)
      ✓ should return valid HTML for 404 page (4 ms)
    Query Parameter Handling
      ✓ should ignore extra query parameters (5 ms)
      ✓ should handle URL-encoded keys (6 ms)
    Edge Cases
      ✓ should handle root path without trailing slash (4 ms)
      ✓ should handle specific route handlers (10 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/modelMethods.test.js (5.336 s)
  Model Methods
    Administrator Model
      setPassword method
        ✓ should set password hash and salt for new admin (528 ms)
        ✓ should add previous password to history when changing password (351 ms)
        ✓ should keep only last 5 passwords in history (271 ms)
        ✓ should handle undefined password history (277 ms)
    Operator Model
      isPasswordInHistory method
        ✓ should return false when no password history exists (215 ms)
        ✓ should return false when password history is empty (212 ms)
        ✓ should return true when password exists in history (320 ms)
        ✓ should return false when password does not exist in history (315 ms)
        ✓ should check multiple passwords in history (626 ms)
    Payment Model
      pre-save middleware
        ✓ should prevent modification of paygistixId after creation (217 ms)
        ✓ should prevent modification of orderId after creation (209 ms)
        ✓ should allow modification of other fields (215 ms)
    DataDeletionRequest Model
      markAsFailed method
        ✓ should mark request as failed with errors (213 ms)
        ✓ should mark request as failed without errors (207 ms)
      findStaleRequests static method
        ✓ should find pending requests older than default 24 hours (214 ms)
        ✓ should find pending requests older than specified hours (210 ms)
        ✓ should handle zero hours parameter (209 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailServiceAdditional.test.js
  Email Service - Additional Coverage
    Affiliate Commission Email
      ✓ should send affiliate commission email successfully (5 ms)
      ✓ should handle email sending error (3 ms)
    Customer Password Reset Email
      ✓ should send customer password reset email (3 ms)
    Administrator Emails
      ✓ should send administrator welcome email with language support (3 ms)
      ✓ should send administrator password reset email (3 ms)
    Operator Emails
      ✓ should send operator PIN reset email (2 ms)
      ✓ should send operator shift reminder email (3 ms)
    System Alerts
      ✓ should send service down alert to multiple admins (3 ms)
      ✓ should handle service alert with minimal details (2 ms)
    Template Loading Errors
      ✓ should handle template file read errors (6 ms)
    Console Email Provider
      ✓ should log emails to console when using console provider (10 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/encryptionEnhanced.test.js
  Encryption Utility - Enhanced Coverage
    Encryption Error Paths
      ✓ should return null for falsy inputs (1 ms)
      ✓ should throw error with invalid encryption key length (9 ms)
      ✓ should throw error when encryption key is missing (1 ms)
      ✓ should handle crypto errors gracefully
    Decryption Error Paths
      ✓ should return null for falsy inputs (1 ms)
      ✓ should throw error with invalid encrypted object structure (2 ms)
      ✓ should throw error with tampered data (1 ms)
      ✓ should throw error with wrong encryption key
      ✓ should handle corrupted encrypted data (1 ms)
    Password Hashing Error Paths
      ✓ should handle crypto.randomBytes failure (1 ms)
      ✓ should handle crypto.pbkdf2Sync failure
      ✓ should handle empty password (49 ms)
    Password Verification Error Paths
      ✓ should throw error when pbkdf2Sync fails (1 ms)
      ✓ should handle invalid inputs gracefully (145 ms)
      ✓ should return false for invalid salt format (50 ms)
    Token and Barcode Generation
      ✓ should generate tokens of correct length
      ✓ should generate unique tokens (1 ms)
      ✓ should handle token generation errors (1 ms)
      ✓ should generate barcodes with correct format
      ✓ should generate unique barcodes (1 ms)
      ✓ should handle barcode generation errors (1 ms)
    Edge Cases and Security Tests
      ✓ should handle large data encryption/decryption (6 ms)
      ✓ should handle unicode and special characters (1 ms)
      ✓ should produce different IVs for same input (2 ms)
      ✓ should validate encryption output structure (1 ms)
      ✓ should handle password edge cases (1285 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/models.test.js (6.575 s)
  Model Tests
    Affiliate Model
      ✓ should create a valid affiliate (765 ms)
      ✓ should require required fields (305 ms)
      ✓ should enforce unique constraints (675 ms)
      ✓ should handle payment information correctly (343 ms)
    Customer Model
      ✓ should create a valid customer (340 ms)
    Order Model
      ✓ should create a valid order (373 ms)
      ✓ should calculate estimated total correctly (364 ms)
      ✓ should calculate actual total and commission when weight is set (373 ms)
      ✓ should update timestamps for status changes (461 ms)
    Transaction Model
      ✓ should create a valid transaction (349 ms)
      ✓ should validate transaction type (316 ms)
      ✓ should validate transaction status (302 ms)
    RefreshToken Model
      ✓ should create a valid refresh token (352 ms)
      ✓ should validate user type (307 ms)
      ✓ should check if token is expired (374 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'customer_12345' },
      headers: {},
      state: 'customer_12345',
      stateStartsWithCustomer: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_12345',
      isCustomerRequest: true,
      willDelegate: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:986:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_123' },
      headers: {},
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_456' },
      headers: {},
      state: 'oauth_session_456',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_456',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_456',
      sessionId: 'oauth_session_456',
      allParams: { state: 'oauth_session_456' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: 'oauth_session_456',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1041:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: null },
      headers: {},
      state: null,
      stateStartsWithCustomer: null
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: { state: null, isCustomerRequest: null, willDelegate: null }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: { state: null, sessionId: null, allParams: { state: null } }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: null,
      referer: undefined,
      isPopup: undefined,
      userIsNew: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1041:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_123' },
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-affiliate',
      query: { state: 'customer_oauth_789' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_789',
      sessionId: 'oauth_789',
      allParams: { state: 'customer_oauth_789' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_789',
      referer: undefined,
      isPopup: true,
      userIsNew: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1748:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: true,
      userObject: {
        email: 'affiliate@example.com',
        provider: 'google',
        isExistingAffiliate: true,
        affiliate: {
          _id: 'aff123',
          affiliateId: 'AFF001',
          email: 'affiliate@example.com',
          firstName: 'Jane',
          lastName: 'Doe',
          businessName: "Jane's Business"
        }
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1878:13)

  console.log
    [handleCustomerSocialCallback] User is an existing affiliate, showing conflict message

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1884:15)

  console.log
    [handleCustomerSocialCallback] Using nonce for affiliate conflict: test-nonce

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1910:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_999' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_999',
      sessionId: 'oauth_999',
      allParams: { state: 'customer_oauth_999' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_999',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1748:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'new-user',
      query: { state: 'customer_oauth_100' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_100',
      sessionId: 'oauth_100',
      allParams: { state: 'customer_oauth_100' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_100',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1748:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: undefined,
      userObject: {
        email: 'newcustomer@example.com',
        provider: 'google',
        firstName: 'New',
        lastName: 'Customer',
        socialId: 'google123',
        isNewUser: true
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1878:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_error' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_error',
      sessionId: null,
      allParams: { state: 'customer_error' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1636:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_12345' },
      headers: {},
      state: 'oauth_session_12345',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_12345',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_12345',
      sessionId: 'oauth_session_12345',
      allParams: { state: 'oauth_session_12345' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'popup=true' },
      headers: {},
      state: 'popup=true',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: { state: 'popup=true', isCustomerRequest: false, willDelegate: false }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'popup=true',
      sessionId: null,
      allParams: { state: 'popup=true' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: { referer: 'https://accounts.google.com/oauth/authorize' },
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:965:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:978:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:996:13)

PASS tests/unit/oauthCallbacks.test.js
  OAuth Callback Functions
    handleSocialCallback
      ✓ should handle customer OAuth request by delegating to customer handler (284 ms)
      ✓ should handle popup request with no user (auth failed) (132 ms)
      ✓ should handle existing user login with popup (123 ms)
      ✓ should handle new user registration flow (111 ms)
      ✓ should handle OAuth callback errors (109 ms)
    handleCustomerSocialCallback
      ✓ should handle affiliate conflict when social account is already an affiliate (107 ms)
      ✓ should handle existing customer login (105 ms)
      ✓ should handle new customer registration (128 ms)
      ✓ should handle errors during customer OAuth callback (111 ms)
    OAuth State Parameter Handling
      ✓ should correctly parse sessionId from state parameter (134 ms)
      ✓ should handle state parameter without oauth_ prefix (111 ms)
      ✓ should detect popup from referer headers (105 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching public configs: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:88:55)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      21 |     res.json(formattedConfigs);
      22 |   } catch (error) {
    > 23 |     console.error('Error fetching public configs:', error);
         |             ^
      24 |     res.status(500).json({ error: 'Failed to fetch public configurations' });
      25 |   }
      26 | });

      at error (server/routes/systemConfigRoutes.js:23:13)

  console.error
    Error fetching config: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:141:46)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      47 |     });
      48 |   } catch (error) {
    > 49 |     console.error('Error fetching config:', error);
         |             ^
      50 |     res.status(500).json({ error: 'Failed to fetch configuration' });
      51 |   }
      52 | });

      at error (server/routes/systemConfigRoutes.js:49:13)

  console.error
    Error fetching configs: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:190:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      70 |     res.json(configs);
      71 |   } catch (error) {
    > 72 |     console.error('Error fetching configs:', error);
         |             ^
      73 |     res.status(500).json({ error: 'Failed to fetch configurations' });
      74 |   }
      75 | });

      at error (server/routes/systemConfigRoutes.js:72:13)

  console.error
    Error updating config: Error: Invalid value
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:333:47)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

  console.error
    Error initializing configs: Error: Init failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:359:57)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      103 |     res.json({ message: 'Default configurations initialized' });
      104 |   } catch (error) {
    > 105 |     console.error('Error initializing configs:', error);
          |             ^
      106 |     res.status(500).json({ error: 'Failed to initialize configurations' });
      107 |   }
      108 | });

      at error (server/routes/systemConfigRoutes.js:105:13)

PASS tests/unit/systemConfigRoutes.test.js
  System Config Routes
    GET /api/system-config/public
      ✓ should return public configurations (15 ms)
      ✓ should handle errors when fetching public configs (5 ms)
    GET /api/system-config/public/:key
      ✓ should return specific public configuration (2 ms)
      ✓ should return 404 for non-existent public config (1 ms)
      ✓ should handle errors when fetching specific config (3 ms)
    GET /api/system-config (authenticated)
      ✓ should return all configurations for admin (2 ms)
      ✓ should filter configurations by category (2 ms)
      ✓ should handle errors when fetching all configs (2 ms)
      ✓ should require authentication (1 ms)
      ✓ should require administrator role (53 ms)
    PUT /api/system-config/:key
      ✓ should update configuration value (5 ms)
      ✓ should require system_config permission (51 ms)
      ✓ should handle validation errors (3 ms)
    POST /api/system-config/initialize
      ✓ should initialize default configurations (2 ms)
      ✓ should handle errors during initialization (3 ms)
      ✓ should require authentication and admin role (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.warn
    Email template placeholder [shift_date] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2042:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:79:7)

  console.warn
    Email template placeholder [shift_date] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2042:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:98:7)

  console.warn
    Email template placeholder [content] not found in data

      112 |     } else {
      113 |       // If not found, return empty string for cleaner emails
    > 114 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      115 |       return '';
      116 |     }
      117 |   });

      at warn (server/utils/emailService.js:114:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:100:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2042:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:351:7)

PASS tests/unit/emailServiceUncovered.test.js
  Email Service - Uncovered Functions
    sendOperatorShiftReminderEmail
      ✓ should send shift reminder email successfully (16 ms)
      ✓ should handle email sending error (5 ms)
    sendOperatorPasswordResetEmail
      ✓ should log error since operators use PINs (2 ms)
      ✓ should still log error even with missing reset URL (2 ms)
    sendServiceDownAlert
      ✓ should send service down alert to all admin emails (2 ms)
      ✓ should handle empty admin emails (4 ms)
      ○ skipped should handle email sending errors gracefully
    sendOrderReadyNotification
      ✓ should send order ready notification successfully (2 ms)
      ✓ should handle missing data fields (3 ms)
    sendOrderPickedUpNotification
      ✓ should send order picked up notification successfully (2 ms)
      ○ skipped should handle email error and log it
    Console Email Provider
      ✓ should log emails when using console provider (14 ms)
    Template Loading Errors
      ✓ should handle template file not found (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportCustomerOAuth.test.js
  Passport Customer OAuth Flow
    Facebook Strategy - Customer Context
      ✓ should handle existing customer login with Facebook ID (27 ms)
      ✓ should link Facebook to existing customer by email (20 ms)
      ✓ should detect when affiliate exists with same Facebook account (16 ms)
      ✓ should handle new customer registration (14 ms)
      ✓ should parse display name when structured name not available (20 ms)
      ✓ should handle single name in display name (13 ms)
    Facebook Strategy - Affiliate Context with Customer Check
      ✓ should detect when customer exists during affiliate OAuth (15 ms)
      ✓ should parse display name in affiliate context (24 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/adminIdGeneration.test.js
  Admin ID Generation Logic Tests
    generateAdminId function logic
      ✓ should generate ADM001 when no administrators exist (140 ms)
      ✓ should generate ADM002 when ADM001 exists (231 ms)
      ✓ should generate ADM003 when ADM001 and ADM002 exist (271 ms)
      ✓ should handle non-sequential admin IDs correctly (276 ms)
      ✓ should handle double-digit admin IDs (288 ms)
      ✓ should handle triple-digit admin IDs (221 ms)
      ✓ should handle large admin ID numbers (220 ms)
    Admin ID format validation
      ✓ should maintain three-digit padding for numbers below 100 (104 ms)
      ✓ should handle numbers above 999 without padding issues (111 ms)
    Admin ID parsing logic
      ✓ should correctly parse admin ID numbers (105 ms)
      ✓ should handle edge cases in admin ID parsing (108 ms)
    Admin ID generation with mixed data
      ✓ should work correctly with inactive administrators (268 ms)
      ✓ should work correctly with different creation dates (270 ms)
      ✓ should work correctly with different permissions (276 ms)
    Performance and reliability
      ✓ should handle database query efficiently (225 ms)
      ✓ should handle concurrent admin creation scenario (231 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/csrfConfig.test.js
  CSRF Configuration
    CSRF_CONFIG
      ✓ should define all endpoint categories (1 ms)
      ✓ should have valid endpoint patterns (10 ms)
      ✓ should not have duplicate endpoints across categories
      ✓ should include critical security endpoints
      ✓ should exclude authentication endpoints from CSRF (1 ms)
      ✓ should exclude registration endpoints from CSRF
    shouldEnforceCsrf
      HTTP method checks
        ✓ should not enforce CSRF for GET requests
        ✓ should not enforce CSRF for HEAD requests (1 ms)
        ✓ should not enforce CSRF for OPTIONS requests
        ✓ should consider CSRF for POST requests
        ✓ should consider CSRF for PUT requests
        ✓ should consider CSRF for DELETE requests
        ✓ should consider CSRF for PATCH requests
      Public endpoints
        ✓ should not enforce CSRF for public endpoints
        ✓ should not enforce CSRF for health check endpoints
      Authentication endpoints
        ✓ should not enforce CSRF for login endpoints (1 ms)
        ✓ should not enforce CSRF for forgot password
        ✓ should not enforce CSRF for refresh token
      Registration endpoints
        ✓ should not enforce CSRF for affiliate registration
        ✓ should not enforce CSRF for customer registration
      Critical endpoints
        ✓ should enforce CSRF for logout (1 ms)
        ✓ should enforce CSRF for order creation
        ✓ should enforce CSRF for order cancellation
        ✓ should enforce CSRF for password changes (1 ms)
        ✓ should enforce CSRF for data deletion
        ✓ should enforce CSRF for admin operations
        ✓ should enforce CSRF for operator shift changes (1 ms)
        ✓ should enforce CSRF for order status updates
      High priority endpoints
        ✓ should not enforce CSRF for high priority endpoints when CSRF_PHASE < 2 (1 ms)
        ✓ should enforce CSRF for high priority endpoints when CSRF_PHASE >= 2
        ✓ should handle bag management endpoints based on phase
        ✓ should handle payment updates based on phase
      Read-only endpoints
        ✓ should not enforce CSRF for dashboard endpoints (1 ms)
        ✓ should enforce CSRF for search endpoints with state-changing methods
        ✓ should enforce CSRF for export endpoints with state-changing methods
      Pattern matching
        ✓ should match parameterized routes
        ✓ should match nested parameterized routes (1 ms)
        ✓ should not match partial paths
        ✓ should handle complex IDs in paths
      Default behavior
        ✓ should enforce CSRF for unknown state-changing endpoints
        ✓ should enforce CSRF for unmatched PUT requests
        ✓ should not enforce CSRF for unknown GET endpoints
      Edge cases
        ✓ should handle missing CSRF_PHASE environment variable
        ✓ should handle non-numeric CSRF_PHASE
        ✓ should handle paths with query parameters
        ✓ should handle paths with trailing slashes (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:371:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:371:42)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:390:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:390:42)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:414:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:414:42)

PASS tests/unit/rateLimitingMiddleware.test.js
  Rate Limiting Middleware
    createMongoStore
      ✓ should return undefined in test environment (5 ms)
      ✓ should create MongoStore in non-test environment (2 ms)
      ✓ should handle MongoStore creation errors (1 ms)
    Key Generators
      ✓ should generate key for sensitive operations based on user ID (37 ms)
      ✓ should generate key for sensitive operations based on IP when no user (22 ms)
      ✓ should generate key for email verification based on email (23 ms)
      ✓ should generate key for email verification based on user ID when no email (24 ms)
      ✓ should generate key for email verification based on IP when no email or user (16 ms)
      ✓ should generate key for file upload based on user ID (20 ms)
      ✓ should generate key for admin login based on IP and username (16 ms)
      ✓ should generate key for admin login based on IP and email when no username (22 ms)
    Skip Functions
      ✓ should skip admin operation limiter for non-admin users (15 ms)
      ✓ should not skip admin operation limiter for admin users (15 ms)
      ✓ should skip admin operation limiter when no user (16 ms)
    createCustomLimiter
      ✓ should create limiter with custom options (12 ms)
      ✓ should merge defaults with custom options (15 ms)
      ✓ should use custom windowMs for store creation (16 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/fieldFilter.test.js
  Field Filter Utility
    filterFields
      ✓ should filter object to include only allowed fields (1 ms)
      ✓ should handle empty allowed fields array
      ✓ should handle null or undefined objects
      ✓ should handle non-object inputs (1 ms)
      ✓ should handle missing fields gracefully
      ✓ should not include inherited properties
      ✓ should handle nested objects without deep filtering (1 ms)
    filterArray
      ✓ should filter array of objects
      ✓ should handle empty array
      ✓ should handle non-array inputs (1 ms)
      ✓ should handle arrays with mixed types (2 ms)
    fieldDefinitions
      ✓ should have definitions for all data types
      ✓ should have different field sets for different roles (2 ms)
      ✓ should not expose sensitive fields in public view
      ✓ should include appropriate fields for each role
    getFilteredData
      ✓ should filter data based on admin role
      ✓ should filter data based on public role (1 ms)
      ✓ should handle self context for customers
      ✓ should handle arrays of data (1 ms)
      ✓ should return data as-is for unknown data types
      ✓ should handle null or undefined data
      ✓ should use fallback field definitions
    responseFilter middleware
      ✓ should create filtered json method (1 ms)
      ✓ should filter response data when _filterType is provided
      ✓ should not filter when _filterType is not provided (1 ms)
      ✓ should handle public role when user is not authenticated
      ✓ should extract user ID from different user types
      ✓ should preserve other response properties (1 ms)
      ✓ should handle responses without data property
      ✓ should maintain this context in json method

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/storeIPs.test.js
  storeIPs configuration
    IP whitelist configuration
      ✓ should load single store IP from environment (4 ms)
      ✓ should handle empty store IP
      ✓ should load additional IPs from environment (1 ms)
      ✓ should trim whitespace from IPs
      ✓ should filter out empty IP entries (1 ms)
      ✓ should load IP ranges from environment
      ✓ should handle empty IP ranges (1 ms)
    Session renewal configuration
      ✓ should use default session renewal settings (1 ms)
      ✓ should load custom session renewal settings from environment
      ✓ should handle invalid numeric values (1 ms)
    isWhitelisted function
      ✓ should return true for directly whitelisted IPs
      ✓ should return false for non-whitelisted IPs
      ✓ should check IP ranges (1 ms)
      ✓ should return false for IPs outside ranges (9 ms)
    isInRange function
      ✓ should correctly check IPs in /24 subnet (1 ms)
      ✓ should correctly check IPs in /16 subnet
      ✓ should correctly check IPs in /8 subnet (1 ms)
      ✓ should correctly check IPs in /32 subnet (single host)
      ✓ should correctly check IPs in /0 subnet (all IPs) (1 ms)
      ✓ should handle invalid CIDR notation (1 ms)
      ✓ should handle invalid mask bits
      ✓ should handle invalid IP addresses (1 ms)
      ✓ should handle IP parts out of range
      ✓ should handle edge cases with console error (1 ms)
      ✓ should correctly handle boundary cases (1 ms)
      ✓ should handle various subnet sizes correctly (1 ms)
    Configuration export structure
      ✓ should export all required properties and functions (1 ms)
      ✓ should have correct session renewal properties (1 ms)
    Integration scenarios
      ✓ should handle complex whitelist configuration (1 ms)
      ✓ should work with no configuration

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/callbackPoolManager.test.js
  CallbackPoolManager
    constructor
      ✓ should initialize with correct configuration (1 ms)
    initializePool
      ✓ should create or update callback entries for all paths (1 ms)
      ✓ should start cleanup job after initialization (1 ms)
    acquireCallback
      ✓ should acquire callback successfully
      ✓ should return null when no callbacks available (1 ms)
    releaseCallback
      ✓ should release callback successfully
      ✓ should handle null callback gracefully (1 ms)
    getPoolStatus
      ✓ should return pool status with all handler details (1 ms)
      ✓ should handle empty pool (1 ms)
    startCleanupJob
      ✓ should start cleanup interval (1 ms)
      ✓ should run cleanup task every 5 minutes (1 ms)
      ✓ should handle cleanup errors gracefully (1 ms)
      ✓ should not log when no locks are released
    stopCleanupJob
      ✓ should stop cleanup interval when running (1 ms)
      ✓ should handle stopping when no interval exists
    integration scenarios
      ✓ should handle complete payment flow
      ✓ should handle concurrent acquire attempts (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passwordValidator.test.js
  Password Validator Utility
    validatePasswordStrength
      Basic Requirements
        ✓ should validate minimum length requirement (3 ms)
        ✓ should require uppercase letters (1 ms)
        ✓ should require lowercase letters
        ✓ should require numbers (1 ms)
        ✓ should require special characters
      Security Validations
        ✓ should reject common passwords (2 ms)
        ✓ should reject passwords containing username (1 ms)
        ✓ should reject passwords containing email
        ✓ should reject sequential characters (1 ms)
        ✓ should reject repeated characters
      Valid Passwords
        ✓ should accept strong valid passwords (1 ms)
      Edge Cases
        ✓ should handle empty password
        ✓ should handle null/undefined password
        ✓ should handle case-insensitive username/email checks
    customPasswordValidator
      ✓ should work as express-validator custom validator (15 ms)
      ✓ should include validation errors in thrown message
    passwordValidationMiddleware
      ✓ should create middleware function
      ✓ should validate password and call next on success (1 ms)
      ✓ should return error response on validation failure (1 ms)
    isPasswordInHistory
      ✓ should return false for empty history
      ✓ should return false for password not in history (53 ms)
      ✓ should handle null/undefined history (1 ms)
    getPasswordStrength
      ✓ should return higher scores for stronger passwords
      ✓ should score length appropriately (1 ms)
      ✓ should score character variety
      ✓ should penalize common patterns
    commonPasswords array
      ✓ should contain common passwords
      ✓ should contain domain-specific passwords (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/callbackPool.test.js (6.878 s)
  CallbackPool Model
    Schema and Indexes
      ✓ should have required fields (155 ms)
      ✓ should have default values (152 ms)
      ✓ should have unique constraint on callbackPath (142 ms)
      ✓ should create document with defaults (178 ms)
    Instance Methods
      lock()
        ✓ should lock callback with payment token (209 ms)
        ✓ should increment usage count on each lock (280 ms)
        ✓ should update lastUsedAt timestamp (206 ms)
      release()
        ✓ should release locked callback (255 ms)
        ✓ should handle releasing already unlocked callback (194 ms)
    Static Methods
      acquireCallback()
        ✓ should acquire available unlocked callback (218 ms)
        ✓ should use least recently used callback (259 ms)
        ✓ should acquire expired locked callback (249 ms)
        ✓ should return null when no callbacks available (254 ms)
        ✓ should increment usage count atomically (419 ms)
      releaseCallback()
        ✓ should release callback by payment token (206 ms)
        ✓ should return null if no callback found with token (163 ms)
        ✓ should only release callback locked by specific token (223 ms)
      releaseExpiredLocks()
        ✓ should release callbacks locked longer than timeout (289 ms)
        ✓ should not release recently locked callbacks (257 ms)
        ✓ should handle custom timeout values (255 ms)
        ✓ should return 0 when no expired locks (265 ms)
        ✓ should handle empty collection (240 ms)
    Edge Cases and Error Handling
      ✓ should handle concurrent lock attempts (183 ms)
      ✓ should maintain data integrity with rapid lock/release cycles (897 ms)
      ✓ should handle invalid ObjectId gracefully (287 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/sanitization.test.js
  Sanitization Middleware
    sanitizeInput
      ✓ should sanitize string input (1 ms)
      ✓ should sanitize arrays recursively
      ✓ should sanitize objects recursively
      ✓ should handle null values
      ✓ should handle undefined values
      ✓ should handle numbers
      ✓ should handle booleans (1 ms)
      ✓ should handle deeply nested objects
      ✓ should handle arrays of objects
      ✓ should not modify prototype properties (1 ms)
    sanitizeRequest
      ✓ should sanitize request body
      ✓ should sanitize query parameters
      ✓ should sanitize URL parameters
      ✓ should handle missing request properties
      ✓ should handle all properties in one request (1 ms)
    sanitizeEmail
      ✓ should sanitize and validate email
      ✓ should remove HTML from email
      ✓ should return empty string for invalid email (1 ms)
      ✓ should handle null and undefined
      ✓ should handle non-string inputs
      ✓ should handle empty string
      ✓ should validate complex email formats (1 ms)
    sanitizePhone
      ✓ should keep only allowed characters
      ✓ should remove invalid characters
      ✓ should handle international format (1 ms)
      ✓ should remove HTML and special characters
      ✓ should handle null and undefined
      ✓ should handle non-string inputs
      ✓ should trim whitespace (1 ms)
      ✓ should handle empty string
    sanitizeId
      ✓ should keep alphanumeric characters and hyphens
      ✓ should remove special characters
      ✓ should remove spaces
      ✓ should handle script injection attempts (1 ms)
      ✓ should handle null and undefined
      ✓ should handle non-string inputs
      ✓ should trim whitespace
      ✓ should handle empty string
      ✓ should handle MongoDB ObjectId format (1 ms)
    sanitizePath
      ✓ should allow valid file paths
      ✓ should remove directory traversal attempts
      ✓ should remove multiple directory traversal attempts
      ✓ should allow valid characters in paths
      ✓ should remove invalid characters
      ✓ should handle Windows-style paths
      ✓ should handle null and undefined
      ✓ should handle non-string inputs
      ✓ should handle empty string (1 ms)
      ✓ should handle complex path traversal attempts
      ✓ should preserve forward slashes
    Integration tests
      ✓ should work with express middleware chain (1 ms)
      ✓ should handle complex nested structures

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error checking active orders: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderControllerAdditional.test.js:99:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      86 |     });
      87 |   } catch (error) {
    > 88 |     console.error('Error checking active orders:', error);
         |             ^
      89 |     res.status(500).json({
      90 |       success: false,
      91 |       message: 'Failed to check active orders'

      at Object.error [as checkActiveOrders] (server/controllers/orderController.js:88:13)
      at Object.<anonymous> (tests/unit/orderControllerAdditional.test.js:102:7)

  console.log
    Creating order with data: {
      affiliateId: 'AFF123',
      pickupDate: '2025-05-25',
      pickupTime: 'morning',
      estimatedWeight: 20
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:126:13)

PASS tests/unit/orderControllerAdditional.test.js
  Order Controller - Additional Coverage
    checkActiveOrders
      ✓ should check active orders for authenticated customer (59 ms)
      ✓ should return no active orders when none exist (59 ms)
      ✓ should handle missing customer ID (69 ms)
      ✓ should handle database errors (68 ms)
    createOrder error handling
      ✓ should handle general errors during order creation (106 ms)
    exportOrders
      ✓ should export orders as CSV (54 ms)
      ✓ should export orders as JSON when format=json (53 ms)
      ✓ should handle export errors (52 ms)
      ✓ should handle unauthorized access (53 ms)
    updateOrderStatus edge cases
      ✓ should handle invalid status transitions (53 ms)
    cancelOrder method
      ✓ should handle order not found (58 ms)
      ✓ should handle cancellation of non-cancellable order (54 ms)
    updatePaymentStatus
      ✓ should handle order not found (53 ms)
      ✓ should prevent payment updates on non-complete orders (64 ms)
      ✓ should allow refund on complete orders regardless of payment status (53 ms)
    bulkUpdateOrderStatus
      ✓ should handle invalid order IDs format (53 ms)
      ✓ should handle empty order IDs array (53 ms)
      ✓ should handle unauthorized access (52 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Creating order with data: {
      customerId: 'CUST123',
      affiliateId: 'AFF123',
      pickupDate: '2025-05-25',
      pickupTime: 'morning',
      specialPickupInstructions: 'Ring doorbell',
      estimatedWeight: 30,
      numberOfBags: 2
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:126:13)

  console.log
    Found customer: Jane Smith

      at Object.log [as createOrder] (server/controllers/orderController.js:136:13)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:155:13)

  console.log
    Found affiliate: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:165:13)

  console.log
    Updated customer isActive status to true for customer: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:225:15)

  console.log
    Creating order with data: {
      customerId: 'CUST123',
      affiliateId: 'AFF123',
      pickupDate: '2025-05-25',
      pickupTime: 'morning',
      estimatedWeight: 30,
      numberOfBags: 2
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:126:13)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:136:13)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:155:13)

  console.log
    Found affiliate: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:165:13)

  console.log
    Updated customer isActive status to true for customer: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:225:15)

  console.error
    Failed to send notification emails: Error: Email failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderController.test.js:109:73)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      231 |       await emailService.sendAffiliateNewOrderEmail(affiliate, customer, newOrder);
      232 |     } catch (emailError) {
    > 233 |       console.error('Failed to send notification emails:', emailError);
          |               ^
      234 |       // Continue with the response even if emails fail
      235 |     }
      236 |

      at Object.error [as createOrder] (server/controllers/orderController.js:233:15)
      at Object.<anonymous> (tests/unit/orderController.test.js:112:7)

  console.log
    Creating order with data: { customerId: 'INVALID', affiliateId: 'AFF123' }

      at Object.log [as createOrder] (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:126:13)

  console.log
    Customer not found with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:130:15)

  console.log
    Creating order with data: { customerId: 'CUST123', affiliateId: 'INVALID' }

      at Object.log [as createOrder] (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:126:13)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:136:13)

  console.log
    Looking for affiliate with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:155:13)

  console.log
    Affiliate not found with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:159:15)

  console.log
    Creating order with data: { customerId: 'CUST456', affiliateId: 'AFF123' }

      at Object.log [as createOrder] (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: CUST456

      at Object.log [as createOrder] (server/controllers/orderController.js:126:13)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:136:13)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:155:13)

  console.log
    Found affiliate: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:165:13)

PASS tests/unit/orderController.test.js
  Order Controller
    createOrder
      ✓ should successfully create a new order (145 ms)
      ✓ should handle email sending failures gracefully (129 ms)
      ✓ should return error for invalid customer (54 ms)
      ✓ should return error for invalid affiliate (54 ms)
      ✓ should enforce authorization (55 ms)
    getOrderDetails
      ✓ should return order details for authorized user (52 ms)
      ✓ should return 404 for non-existent order (52 ms)
      ✓ should enforce authorization for customers (55 ms)
    updateOrderStatus
      ✓ should successfully update order status (53 ms)
      ✓ should update actual weight when processing (52 ms)
      ✓ should validate status transitions (53 ms)
      ✓ should send commission email when complete (63 ms)
    cancelOrder
      ✓ should successfully cancel an order (53 ms)
      ✓ should prevent cancelling non-cancellable orders (57 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/errorHandler.test.js
  Error Handler Middleware
    errorHandler
      ✓ should handle generic errors with 500 status (12 ms)
      ✓ should handle custom status codes
      ✓ should handle Mongoose validation errors (1 ms)
      ✓ should handle MongoDB duplicate key errors (1 ms)
      ✓ should handle JWT errors (1 ms)
      ✓ should handle JWT token expiration errors
      ✓ should handle rate limiting errors (1 ms)
      ✓ should handle CastError (invalid MongoDB ObjectId) (1 ms)
      ✓ should include user context when available
      ✓ should handle errors with customer context (1 ms)
      ✓ should hide error details in production
      ✓ should show error details in development (1 ms)
      ✓ should use original message for non-500 errors in production
      ✓ should handle errors without message
      ✓ should handle errors with code property (1 ms)
      ✓ should log all console error sections (1 ms)
    AppError
      ✓ should create custom error with status code
      ✓ should have stack trace
      ✓ should work with error handler
    Edge cases
      ✓ should handle null error (2 ms)
      ✓ should handle undefined error
      ✓ should handle non-error objects
      ✓ should handle string errors (1 ms)
      ✓ should handle errors thrown from within error handler
    MulterError handling
      ✓ should handle LIMIT_FILE_SIZE error (1 ms)
      ✓ should handle LIMIT_FILE_COUNT error (1 ms)
      ✓ should handle LIMIT_FIELD_KEY error
      ✓ should handle LIMIT_FIELD_VALUE error (1 ms)
      ✓ should handle LIMIT_FIELD_COUNT error
      ✓ should handle LIMIT_UNEXPECTED_FILE error (8 ms)
      ✓ should handle generic MulterError (1 ms)
    Custom file filter errors
      ✓ should handle PDF file filter error
      ✓ should handle PDF file filter error with additional text (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/auditLogger.test.js
  Audit Logger
    AuditEvents
      ✓ should define all audit event types (1 ms)
      ✓ should have unique event names
    logAuditEvent
      ✓ should log basic audit event (1 ms)
      ✓ should add request context when provided
      ✓ should handle customer context (1 ms)
      ✓ should use error level for critical events
      ✓ should use info level for non-critical events
      ✓ should handle missing user context
      ✓ should handle connection.remoteAddress fallback
    auditMiddleware
      ✓ should create middleware that logs on response finish
      ✓ should log successful responses (1 ms)
      ✓ should not log failed responses
      ✓ should include request context in logs
    logLoginAttempt
      ✓ should log successful login
      ✓ should log failed login with reason
      ✓ should handle null reason (1 ms)
    logSensitiveDataAccess
      ✓ should log sensitive data access
      ✓ should handle different data types and actions (1 ms)
    logPaymentActivity
      ✓ should log payment info access
      ✓ should log payment info update (1 ms)
      ✓ should handle additional details
    logSuspiciousActivity
      ✓ should log suspicious activity with error level
      ✓ should include request context (1 ms)
      ✓ should merge all details
    Logger configuration
      ✓ should export audit logger with required methods (1 ms)
      ✓ should not add console transport in production (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/facebookDataController.test.js
  Facebook Data Controller
    handleDeletionCallback
      ✓ should handle missing signed_request (1 ms)
      ✓ should handle missing app secret (1 ms)
      ✓ should handle invalid signed request
      ✓ should handle missing user_id in payload (1 ms)
      ✓ should handle case when no users are found
      ✓ should handle customer-only deletion request (1 ms)
      ✓ should handle errors during deletion callback (1 ms)
      ✓ should handle affiliate and customer (both) deletion
    checkDeletionStatus
      ✓ should handle missing confirmation code (1 ms)
      ✓ should handle deletion request not found
      ✓ should return completed deletion request status (1 ms)
      ✓ should handle errors during status check
    processStaleRequests
      ✓ should process stale deletion requests (1 ms)
      ✓ should handle errors during stale request processing
      ✓ should handle empty stale requests
    processDeletion error handling
      ✓ should handle errors during affiliate data deletion (1 ms)
      ✓ should handle errors during customer data deletion
      ✓ should handle general errors during deletion processing (11 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/createAdminScript.test.js (11.187 s)
  Create Admin Script Tests
    Script File Structure
      ✓ should exist and be readable (381 ms)
      ✓ should contain required functionality markers (438 ms)
    Admin ID Generation Logic
      ✓ should generate sequential admin IDs starting from ADM001 (594 ms)
      ✓ should calculate next admin ID correctly (871 ms)
    Password Security Requirements
      ✓ should enforce strong password requirements for admins (459 ms)
      ✓ should accept strong passwords for admins (739 ms)
    Permission System Validation
      ✓ should validate all permission types (495 ms)
      ✓ should handle partial permission sets (455 ms)
    Unique Constraint Validation
      ✓ should prevent duplicate administrator IDs (559 ms)
      ✓ should prevent duplicate emails (536 ms)
    Email Integration
      ✓ should handle admin creation with welcome email sending (480 ms)
    Data Validation and Sanitization
      ✓ should handle special characters in names correctly (468 ms)
      ✓ should normalize email addresses (474 ms)
      ✓ should validate email format (787 ms)
    Administrator Model Integration
      ✓ should integrate with existing administrator model schema (617 ms)
      ✓ should work with password hashing middleware (540 ms)
    Script Error Handling
      ✓ should handle database connection errors gracefully (389 ms)
      ✓ should handle invalid input gracefully (451 ms)
    Security Considerations
      ✓ should not log or expose passwords (499 ms)
      ✓ should generate secure random passwords when needed (411 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Authorization failed for path: /api/test - User role: customer Allowed roles: [ 'admin', 'affiliate' ]

      at log (server/middleware/auth.js:227:15)

  console.log
    Authorization failed for path: /api/test - User role: undefined Allowed roles: [ 'admin' ]

      at log (server/middleware/auth.js:227:15)

  console.log
    Authorization failed - No user object on request for path: /api/test

      at log (server/middleware/auth.js:219:15)

  console.log
    Token renewed for operator OP123 from store IP 127.0.0.1

      at log (server/middleware/auth.js:136:17)

  console.error
    Authentication error: Error: Generic error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authMiddleware.test.js:446:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as verify] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at verify (/var/www/wavemax/wavemax-affiliate-program/server/middleware/auth.js:99:21)
        at Object.authenticate (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authMiddleware.test.js:449:13)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      198 |     }
      199 |
    > 200 |     console.error('Authentication error:', error);
          |             ^
      201 |
      202 |     res.status(500).json({
      203 |       success: false,

      at error (server/middleware/auth.js:200:13)
      at Object.authenticate (tests/unit/authMiddleware.test.js:449:13)

  console.log
    Authorization failed for path: /api/test - User role: customer Allowed roles: [ 'admin', 'affiliate' ]

      at log (server/middleware/auth.js:227:15)

PASS tests/unit/authMiddleware.test.js (6.624 s)
  Auth Middleware
    authenticate
      ✓ should authenticate valid Bearer token (335 ms)
      ✓ should authenticate valid x-auth-token header (241 ms)
      ✓ should reject request with no token (224 ms)
      ✓ should reject request with invalid token (202 ms)
      ✓ should reject request with expired token (214 ms)
      ✓ should handle malformed Authorization header (205 ms)
      ✓ should reject blacklisted token (211 ms)
    authorize
      ✓ should authorize user with correct role (204 ms)
      ✓ should authorize user with one of multiple roles (214 ms)
      ✓ should reject user with incorrect role (217 ms)
      ✓ should reject user with no role (208 ms)
      ✓ should reject when user is not set (214 ms)
    authLimiter
      ✓ should be a function (204 ms)
      ✓ should have rate limit configuration (217 ms)
      ✓ should skip rate limiting in test environment (210 ms)
    validateRequest
      ✓ should pass valid request (210 ms)
      ✓ should reject invalid request (209 ms)
      ✓ should reject request with missing required fields (205 ms)
      ✓ should handle complex validation schemas (213 ms)
    authenticate - additional edge cases
      ✓ should handle requirePasswordChange flag (208 ms)
      ✓ should allow password change endpoint when requirePasswordChange is true (202 ms)
      ✓ should handle operator token renewal from store IP (204 ms)
      ✓ should handle generic authentication errors (220 ms)
      ✓ should handle W9 endpoint logging (213 ms)
    authorize - array syntax
      ✓ should accept array of roles (239 ms)
      ✓ should reject user not in array of roles (209 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/oAuthSession.test.js (7.035 s)
  OAuthSession Model
    Schema Validation
      ✓ should create a valid OAuth session with all required fields (239 ms)
      ✓ should require sessionId field (236 ms)
      ✓ should require result field (236 ms)
      ✓ should automatically set createdAt (270 ms)
      ✓ should automatically set expiresAt to 5 minutes from now (264 ms)
      ✓ should enforce unique sessionId (293 ms)
      ✓ should allow complex result objects (243 ms)
    Static Methods
      createSession
        ✓ should create and save a new OAuth session (299 ms)
        ✓ should throw error for duplicate session IDs (300 ms)
        ✓ should handle database errors (235 ms)
      getSession
        ✓ should retrieve existing session result by sessionId (304 ms)
        ✓ should return null for non-existent session (256 ms)
      consumeSession
        ✓ should retrieve and delete session in one operation (297 ms)
        ✓ should return null when consuming non-existent session (245 ms)
        ✓ should handle race conditions safely (332 ms)
      cleanupExpired
        ✓ should manually delete expired sessions (462 ms)
        ✓ should return zero deletions when no expired sessions exist (302 ms)
    TTL Behavior
      ✓ should have TTL index configured on expiresAt field (239 ms)
      ✓ should respect custom expiresAt when provided (254 ms)
    Data Integrity
      ✓ should preserve all data types in result field (260 ms)
      ✓ should handle empty and minimal result objects (391 ms)
    Error Handling
      ✓ should handle MongoDB connection errors gracefully (225 ms)
      ✓ should handle very large result objects (311 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentMethod.test.js
  PaymentMethod Model Unit Tests
    Schema Validation
      ✓ should create a valid payment method (62 ms)
      ✓ should require customerId (56 ms)
      ✓ should require paygistixId (62 ms)
      ✓ should validate type enum (71 ms)
      ✓ should reject invalid type (57 ms)
      ✓ should default type to card (57 ms)
    Card Validation
      ✓ should require card details when type is card (67 ms)
      ✓ should validate card last4 length (64 ms)
      ✓ should validate card brand enum (56 ms)
      ✓ should reject invalid card brand (54 ms)
      ✓ should validate expiry month range (55 ms)
      ✓ should validate expiry year is not in the past (54 ms)
      ✓ should require card fingerprint (53 ms)
    Bank Account Validation
      ✓ should create valid bank account payment method (57 ms)
      ✓ should require bank account details when type is bank_account (58 ms)
      ✓ should validate bank account last4 length (53 ms)
      ✓ should validate account type enum (53 ms)
      ✓ should reject invalid account type (54 ms)
    Wallet Validation
      ✓ should create valid wallet payment method (53 ms)
      ✓ should require wallet type when type is wallet (53 ms)
      ✓ should validate wallet type enum (53 ms)
    Default Values
      ✓ should default isDefault to false (52 ms)
      ✓ should default isActive to true (53 ms)
      ✓ should default isVerified to false (55 ms)
    Virtual Properties
      displayName
        ✓ should format card display name (53 ms)
        ✓ should format bank account display name (54 ms)
        ✓ should format wallet display name (53 ms)
        ✓ should handle google_pay formatting (58 ms)
        ✓ should return default for unknown type (55 ms)
      isExpired
        ✓ should return false for non-card types (53 ms)
        ✓ should return false for future expiry (53 ms)
        ✓ should return true for past year (59 ms)
        ✓ should return true for current year past month (54 ms)
        ✓ should return false for current year future month (53 ms)
    Instance Methods
      canUse()
        ✓ should allow use of active non-expired card (58 ms)
        ✓ should not allow use of inactive payment method (54 ms)
        ✓ should not allow use of expired card (52 ms)
        ✓ should not allow use of unverified bank account (53 ms)
        ✓ should allow use of verified bank account (57 ms)
      markAsUsed()
        ✓ should update lastUsedAt (53 ms)
    Static Methods
      findDefault()
        ✓ should find default payment method for customer (56 ms)
      findActiveByCustomer()
        ✓ should find active payment methods sorted by default and date (53 ms)
      checkDuplicate()
        ✓ should check for duplicate card fingerprint (52 ms)
        ✓ should return null if no duplicate found (53 ms)
    Middleware
      Pre-save middleware existence
        ✓ should have pre-save middleware defined (54 ms)
    Metadata Field
      ✓ should store metadata as Map (54 ms)
    JSON Transformation
      ✓ should include virtuals and exclude sensitive fields (54 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/payment.test.js
  Payment Model Unit Tests
    Schema Validation
      ✓ should create a valid payment (60 ms)
      ✓ should require orderId (87 ms)
      ✓ should require customerId (78 ms)
      ✓ should require paymentMethodId (226 ms)
      ✓ should require paygistixId (59 ms)
      ✓ should require amount (56 ms)
      ✓ should validate amount is non-negative (52 ms)
      ✓ should default currency to USD (71 ms)
      ✓ should validate currency enum (66 ms)
      ✓ should reject invalid currency (57 ms)
      ✓ should validate status enum (52 ms)
      ✓ should reject invalid status (51 ms)
      ✓ should default status to pending (54 ms)
    Default Values
      ✓ should default capturedAmount to 0 (51 ms)
      ✓ should default refundedAmount to 0 (59 ms)
      ✓ should default hasDispute to false (51 ms)
      ✓ should have empty refunds array (52 ms)
    Virtual Properties
      ✓ should calculate netAmount correctly (59 ms)
      ✓ should handle zero amounts (52 ms)
      ✓ should handle full refund (52 ms)
    Instance Methods
      canRefund()
        ✓ should allow refund when status is captured (52 ms)
        ✓ should allow refund when status is partially_refunded (59 ms)
        ✓ should not allow refund when status is pending (56 ms)
        ✓ should not allow refund when fully refunded (54 ms)
        ✓ should validate refund amount (51 ms)
        ✓ should handle null amount parameter (51 ms)
      canCapture()
        ✓ should allow capture when status is authorized (52 ms)
        ✓ should not allow capture when status is captured (71 ms)
        ✓ should not allow capture when status is pending (56 ms)
      addRefund()
        ✓ should add refund to refunds array (52 ms)
        ✓ should update refundedAmount (51 ms)
        ✓ should update lastRefundAt (52 ms)
        ✓ should set status to partially_refunded for partial refund (51 ms)
        ✓ should set status to refunded for full refund (51 ms)
        ✓ should handle multiple refunds (52 ms)
        ✓ should handle refund that exceeds captured amount (54 ms)
    Static Methods
      findByOrder()
        ✓ should find payments by orderId (52 ms)
      findSuccessfulByCustomer()
        ✓ should find successful payments by customer with default limit (59 ms)
        ✓ should accept custom limit (51 ms)
      calculateRevenue()
        ✓ should calculate revenue for a period (52 ms)
    Middleware
      ✓ should have pre-save middleware defined (55 ms)
    Refund Schema
      ✓ should validate refund subdocument (52 ms)
      ✓ should require refundId in refund (52 ms)
      ✓ should require amount in refund (51 ms)
      ✓ should validate refund amount is non-negative (52 ms)
      ✓ should set default createdAt for refund (57 ms)
    Dispute Tracking
      ✓ should validate dispute status enum (60 ms)
      ✓ should allow dispute fields when hasDispute is true (52 ms)
      ✓ should validate dispute amount is non-negative (58 ms)
    Metadata and Response Fields
      ✓ should store metadata as Map (52 ms)
      ✓ should store response as mixed type (52 ms)
    JSON Transformation
      ✓ should remove __v and response fields from JSON (52 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/socialAuthRoutes.test.js
  Social Auth Routes - Simple Tests
    Google OAuth Routes
      ✓ should initiate Google OAuth when configured (10 ms)
      ✓ should return 404 when Google OAuth is not configured (4 ms)
      ✓ should handle Google OAuth callback (2 ms)
    Facebook OAuth Routes
      ✓ should initiate Facebook OAuth when configured (2 ms)
      ✓ should return 404 when Facebook OAuth is not configured (1 ms)
      ✓ should handle Facebook OAuth callback (2 ms)
    LinkedIn OAuth Routes
      ✓ should initiate LinkedIn OAuth when configured (2 ms)
      ✓ should return 404 when LinkedIn OAuth is not configured (2 ms)
      ✓ should handle LinkedIn OAuth callback (1 ms)
    Social Registration Route
      ✓ should handle social registration with valid data (7 ms)
      ✓ should validate required fields for social registration (3 ms)
      ✓ should validate service radius range (2 ms)
      ✓ should validate payment method (2 ms)
    Social Account Linking Route
      ✓ should handle social account linking (2 ms)
      ✓ should validate provider for account linking (2 ms)
      ✓ should require social token for account linking (1 ms)
    Social Login Callback Route
      ✓ should handle social login callback (2 ms)
      ✓ should validate social login data (2 ms)
    Customer OAuth Routes
      ✓ should initiate Google OAuth for customers (4 ms)
      ✓ should handle customer Google OAuth callback redirect (4 ms)
      ✓ should handle customer Facebook callback (3 ms)
      ✓ should handle customer LinkedIn callback (3 ms)
    Customer Social Registration Route
      ✓ should handle customer social registration (4 ms)
      ✓ should validate customer registration fields (8 ms)
      ✓ should validate service frequency (3 ms)
    Error Handling
      ✓ should handle errors gracefully (20 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentController.test.js
  Payment Controller
    getConfig
      ✓ should return payment configuration when properly configured (53 ms)
      ✓ should return error when Paygistix is not configured (52 ms)
      ✓ should handle errors gracefully (56 ms)
    logSubmission
      ✓ should log payment submission successfully (61 ms)
      ✓ should handle logging errors (52 ms)
    createPaymentToken
      ✓ should create payment token successfully (54 ms)
      ✓ should handle no available callbacks (51 ms)
      ✓ should handle token creation errors (70 ms)
    checkPaymentStatus
      ✓ should return payment status successfully (51 ms)
      ✓ should handle token not found (50 ms)
      ✓ should handle database errors (51 ms)
    cancelPaymentToken
      ✓ should cancel pending payment token (51 ms)
      ✓ should not cancel non-pending tokens (60 ms)
      ✓ should handle token not found (51 ms)
    updatePaymentStatus
      ✓ should update payment status to success (52 ms)
      ✓ should update payment status to failed (53 ms)
    handleFormCallback
      ✓ should process callback successfully (54 ms)
      ✓ should handle no pending payment for callback (54 ms)
      ✓ should handle callback processing errors (52 ms)
    processCallbackResult
      ✓ should process successful payment from query params (59 ms)
      ✓ should process failed payment (54 ms)
      ✓ should handle body parameters (52 ms)
      ✓ should redirect with all parameters (51 ms)
    getPoolStats
      ✓ should return pool statistics (51 ms)
      ✓ should handle stats retrieval errors (51 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentCallbackRoute.test.js
  Payment Callback Route
    GET /payment_callback
      Successful payment
        ✓ should handle approved payment successfully (8 ms)
        ✓ should handle success status as well as approved (2 ms)
        ✓ should update existing payment if found (2 ms)
        ✓ should handle customer not found gracefully (2 ms)
        ✓ should handle email send failure gracefully (2 ms)
        ✓ should not update customer if already active (10 ms)
      Failed payment
        ✓ should handle declined payment (2 ms)
        ✓ should handle failed status (2 ms)
        ✓ should increment payment attempts on failure (2 ms)
        ✓ should use default error message when none provided (1 ms)
      Error handling
        ✓ should handle order not found (2 ms)
        ✓ should handle unknown payment status (1 ms)
        ✓ should handle database errors gracefully (2 ms)
        ✓ should handle payment save error (2 ms)
      Edge cases
        ✓ should handle missing amount parameter (1 ms)
        ✓ should handle malformed maskedCard (2 ms)
        ✓ should log callback parameters (2 ms)
    POST /payment_callback
      ✓ should handle POST callback and return JSON response (6 ms)
      ✓ should handle POST callback errors (3 ms)
      ✓ should handle empty POST body (2 ms)
      ✓ should handle POST with form-urlencoded data (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-001', operatorId: 'op123' }

      at Object.log [as scanProcessed] (server/controllers/operatorController.js:1018:13)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-001', operatorId: 'op123' }

      at Object.log [as scanProcessed] (server/controllers/operatorController.js:1018:13)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-002', operatorId: 'op123' }

      at Object.log [as scanProcessed] (server/controllers/operatorController.js:1018:13)

  console.log
    completePickup called with: {
      bagIds: [ 'bag-001', 'bag-002' ],
      orderId: 'ORD-123456',
      operatorId: 'op123'
    }

      at Object.log [as completePickup] (server/controllers/operatorController.js:1263:13)

  console.log
    Updating bags to completed. Current bag statuses: [
      { bagId: 'bag-001', status: 'processed' },
      { bagId: 'bag-002', status: 'processed' }
    ]

      at Object.log [as completePickup] (server/controllers/operatorController.js:1299:13)

  console.log
    Before save - Order status: complete

      at Object.log [as completePickup] (server/controllers/operatorController.js:1312:13)

  console.log
    Before save - Bag statuses: [
      { bagId: 'bag-001', status: 'completed' },
      { bagId: 'bag-002', status: 'completed' }
    ]

      at Object.log [as completePickup] (server/controllers/operatorController.js:1313:13)

  console.log
    After save - Order status: complete

      at Object.log [as completePickup] (server/controllers/operatorController.js:1318:15)

  console.log
    After save - Bag statuses: [
      { bagId: 'bag-001', status: 'completed' },
      { bagId: 'bag-002', status: 'completed' }
    ]

      at Object.log [as completePickup] (server/controllers/operatorController.js:1319:15)

  console.log
    completePickup called with: { bagIds: [ 'bag-001' ], orderId: 'ORD-123456', operatorId: 'op123' }

      at Object.log [as completePickup] (server/controllers/operatorController.js:1263:13)

  console.log
    completePickup called with: {
      bagIds: [ 'bag-001', 'bag-wrong' ],
      orderId: 'ORD-123456',
      operatorId: 'op123'
    }

      at Object.log [as completePickup] (server/controllers/operatorController.js:1263:13)

PASS tests/unit/bagTracking.test.js
  Bag Tracking System
    scanBag
      ✓ should parse new QR format correctly (1 ms)
      ✓ should handle legacy QR format (1 ms)
    weighBags
      ✓ should add bags to order and update status (1 ms)
      ✓ should prevent duplicate bag IDs
    scanProcessed
      ✓ should update bag status to processed (14 ms)
      ✓ should show warning for already processed bag (2 ms)
      ✓ should trigger completion actions when all bags processed (1 ms)
    completePickup
      ✓ should complete order when all bags scanned (3 ms)
      ✓ should reject if bag count mismatch (1 ms)
      ✓ should reject if wrong bag scanned (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-123

      at Object.log [as exportVendors] (server/controllers/quickbooksController.js:102:13)

  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-123

      at Object.log [as exportVendors] (server/controllers/quickbooksController.js:94:15)

PASS tests/unit/quickbooksController.test.js
  QuickBooks Controller
    exportVendors
      ✓ should export vendors as JSON (9 ms)
      ✓ should export vendors as CSV (2 ms)
      ✓ should return 404 when no verified vendors found
      ✓ should handle errors gracefully (1 ms)
    exportPaymentSummary
      ✓ should export payment summary as JSON (1 ms)
      ✓ should export payment summary as CSV
      ✓ should return 400 when dates are missing (1 ms)
      ✓ should return 404 when no payable commissions found
      ✓ should filter out orders without verified W-9 (1 ms)
    exportCommissionDetail
      ✓ should export commission detail as JSON (1 ms)
      ✓ should return 400 when required parameters are missing (1 ms)
      ✓ should return 404 when affiliate not found
      ✓ should return 400 when affiliate has no verified W-9 (1 ms)
    getExportHistory
      ✓ should get export history
      ✓ should filter by type (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching dashboard data: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:216:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1249 |
      1250 |   } catch (error) {
    > 1251 |     console.error('Error fetching dashboard data:', error);
           |             ^
      1252 |     res.status(500).json({
      1253 |       success: false,
      1254 |       message: 'Failed to fetch dashboard data'

      at Object.error [as getDashboard] (server/controllers/administratorController.js:1251:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:218:7)

  console.error
    Error fetching order analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:276:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1381 |
      1382 |   } catch (error) {
    > 1383 |     console.error('Error fetching order analytics:', error);
           |             ^
      1384 |     res.status(500).json({
      1385 |       success: false,
      1386 |       message: 'Failed to fetch order analytics'

      at Object.error [as getOrderAnalytics] (server/controllers/administratorController.js:1383:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:278:7)

  console.error
    Error fetching operator analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:338:44)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1510 |
      1511 |   } catch (error) {
    > 1512 |     console.error('Error fetching operator analytics:', error);
           |             ^
      1513 |     res.status(500).json({
      1514 |       success: false,
      1515 |       message: 'Failed to fetch operator analytics'

      at Object.error [as getOperatorAnalytics] (server/controllers/administratorController.js:1512:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:340:7)

  console.error
    Error fetching affiliate analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:393:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1612 |
      1613 |   } catch (error) {
    > 1614 |     console.error('Error fetching affiliate analytics:', error);
           |             ^
      1615 |     res.status(500).json({
      1616 |       success: false,
      1617 |       message: 'Failed to fetch affiliate analytics'

      at Object.error [as getAffiliateAnalytics] (server/controllers/administratorController.js:1614:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:395:7)

  console.error
    Error exporting report: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:502:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as find] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at find (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1861:30)
        at Object.generateOrdersReport [as exportReport] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1641:26)
        at Object.exportReport (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:505:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1677 |
      1678 |   } catch (error) {
    > 1679 |     console.error('Error exporting report:', error);
           |             ^
      1680 |     res.status(500).json({
      1681 |       success: false,
      1682 |       message: 'Failed to export report'

      at Object.error [as exportReport] (server/controllers/administratorController.js:1679:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:505:7)

  console.error
    Error fetching affiliates list: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:564:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as find] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at Object.find [as getAffiliatesList] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1713:40)
        at Object.getAffiliatesList (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:567:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1730 |     });
      1731 |   } catch (error) {
    > 1732 |     console.error('Error fetching affiliates list:', error);
           |             ^
      1733 |     res.status(500).json({
      1734 |       success: false,
      1735 |       message: 'Failed to fetch affiliates list',

      at Object.error [as getAffiliatesList] (server/controllers/administratorController.js:1732:13)
      at Object.getAffiliatesList (tests/unit/adminDashboard.test.js:567:37)

PASS tests/unit/adminDashboard.test.js
  Admin Dashboard Functions
    getDashboard
      ✓ should fetch comprehensive dashboard data (2 ms)
      ✓ should handle errors in dashboard data fetching (21 ms)
    getOrderAnalytics
      ✓ should fetch order analytics with timeline and distribution (2 ms)
      ✓ should handle errors (2 ms)
    getOperatorAnalytics
      ✓ should fetch operator performance analytics (1 ms)
      ✓ should handle errors (2 ms)
    getAffiliateAnalytics
      ✓ should fetch affiliate performance analytics (1 ms)
      ✓ should handle errors (3 ms)
    exportReport
      ✓ should export orders report (1 ms)
      ✓ should export comprehensive report (1 ms)
      ✓ should handle invalid report type
      ✓ should handle export errors (30 ms)
    getAffiliatesList
      ✓ should fetch filtered affiliates list (1 ms)
      ✓ should handle errors in affiliates list (3 ms)
    Report Generation Functions
      ✓ should generate orders report (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passwordValidatorEnhanced.test.js
  Enhanced Password Validator
    validatePasswordStrength
      Length Requirements
        ✓ should reject passwords shorter than 8 characters (2 ms)
        ✓ should accept passwords with 8 or more characters (1 ms)
      Character Type Requirements
        ✓ should require at least one uppercase letter (1 ms)
        ✓ should require at least one lowercase letter
        ✓ should require at least one number (1 ms)
        ✓ should require at least one special character
        ✓ should accept passwords with all required character types (1 ms)
      Common Password Detection
        ✓ should reject common passwords (14 ms)
        ✓ should accept non-common passwords
      Sequential Character Detection
        ✓ should reject passwords with sequential numbers
        ✓ should reject passwords with sequential letters
        ✓ should accept passwords without sequential characters
      Repeated Character Detection
        ✓ should reject passwords with too many repeated characters
        ✓ should accept passwords with acceptable repeated characters (1 ms)
      Username/Email Inclusion Check
        ✓ should reject passwords containing username
        ✓ should reject passwords containing email (1 ms)
        ✓ should accept passwords not containing username or email
      Password History Check
        ✓ should reject passwords in history
        ✓ should accept passwords not in history (1 ms)
      Complete Valid Passwords
        ✓ should accept completely valid passwords
    getPasswordStrength
      ✓ should return correct strength scores (1 ms)
      ✓ should return correct strength labels (1 ms)
    isPasswordInHistory
      ✓ should return true for passwords in history
      ✓ should return false for passwords not in history (1 ms)
      ✓ should handle empty history
    customPasswordValidator
      ✓ should return custom validator function
      ✓ should validate passwords correctly in express-validator context
      ✓ should throw for invalid passwords in express-validator context (15 ms)
      ✓ should include admin-specific validation when userType is admin (1 ms)
      ✓ should include admin-specific validation when userType is operator (1 ms)
    passwordValidationMiddleware
      ✓ should call next() for valid passwords
      ✓ should return 400 error for invalid passwords (1 ms)
      ✓ should skip validation if no password in request (1 ms)
      ✓ should include strength assessment in response for invalid passwords
    Edge Cases and Security
      ✓ should handle null and undefined inputs gracefully (1 ms)
      ✓ should handle very long passwords
      ✓ should handle special Unicode characters
      ✓ should be case-sensitive for username/email checks

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

info: undefined {"action":"bags_weighed","eventType":"ORDER_STATUS_CHANGED","ip":"127.0.0.1","method":"GET","newBags":2,"numberOfBags":2,"operatorId":"68750217053f2ab7d5439806","orderId":"ORD-TEST-001","path":"","timestamp":"2025-07-14T13:11:51.282Z","totalWeight":25,"userId":"68750217053f2ab7d5439806"}
info: undefined {"action":"bags_weighed","eventType":"ORDER_STATUS_CHANGED","ip":"127.0.0.1","method":"GET","newBags":2,"numberOfBags":2,"operatorId":"68750218053f2ab7d5439843","orderId":"ORD-TEST-002","path":"","timestamp":"2025-07-14T13:11:53.072Z","totalWeight":25,"userId":"68750218053f2ab7d5439843"}
info: undefined {"action":"bags_weighed","eventType":"ORDER_STATUS_CHANGED","ip":"127.0.0.1","method":"GET","newBags":2,"numberOfBags":2,"operatorId":"6875021a053f2ab7d5439880","orderId":"ORD-TEST-003","path":"","timestamp":"2025-07-14T13:11:54.879Z","totalWeight":20,"userId":"6875021a053f2ab7d5439880"}
  console.log
    Creating order with data: {
      customerId: 'CUST-TEST-001',
      affiliateId: 'AFF-TEST-001',
      pickupDate: '2025-07-14T13:11:56.588Z',
      pickupTime: 'morning',
      estimatedWeight: 25,
      numberOfBags: 2,
      specialPickupInstructions: 'Test instructions'
    }

      at log (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: CUST-TEST-001

      at log (server/controllers/orderController.js:126:13)

  console.log
    Found customer: John Doe

      at log (server/controllers/orderController.js:136:13)

  console.log
    Looking for affiliate with ID: AFF-TEST-001

      at log (server/controllers/orderController.js:155:13)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:165:13)

  console.log
    Applying WDF credit of $10 to order for customer CUST-TEST-001

      at log (server/controllers/orderController.js:188:15)

  console.log
    Reset WDF credit for customer CUST-TEST-001 after applying to order ORD819943

      at log (server/controllers/orderController.js:218:15)

  console.log
    Existing orders before negative credit test: []

      at Object.log (tests/unit/wdfCredit.test.js:334:15)

  console.log
    Creating order with data: {
      customerId: 'CUST-TEST-002',
      affiliateId: 'AFF-TEST-001',
      pickupDate: '2025-07-14T13:11:58.653Z',
      pickupTime: 'morning',
      estimatedWeight: 20,
      numberOfBags: 1,
      specialPickupInstructions: 'Test instructions'
    }

      at log (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: CUST-TEST-002

      at log (server/controllers/orderController.js:126:13)

  console.log
    Found customer: Jane Doe

      at log (server/controllers/orderController.js:136:13)

  console.log
    Looking for affiliate with ID: AFF-TEST-001

      at log (server/controllers/orderController.js:155:13)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:165:13)

  console.log
    Applying WDF credit of $-5 to order for customer CUST-TEST-002

      at log (server/controllers/orderController.js:188:15)

  console.log
    Reset WDF credit for customer CUST-TEST-002 after applying to order ORD478815

      at log (server/controllers/orderController.js:218:15)

  console.log
    Creating order with data: {
      customerId: 'CUST-TEST-003',
      affiliateId: 'AFF-TEST-001',
      pickupDate: '2025-07-14T13:12:00.603Z',
      pickupTime: 'morning',
      estimatedWeight: 20,
      numberOfBags: 1
    }

      at log (server/controllers/orderController.js:113:13)

  console.log
    Looking for customer with ID: CUST-TEST-003

      at log (server/controllers/orderController.js:126:13)

  console.log
    Found customer: Bob Smith

      at log (server/controllers/orderController.js:136:13)

  console.log
    Looking for affiliate with ID: AFF-TEST-001

      at log (server/controllers/orderController.js:155:13)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:165:13)

info: undefined {"action":"bags_weighed","eventType":"ORDER_STATUS_CHANGED","ip":"127.0.0.1","method":"GET","newBags":1,"numberOfBags":1,"operatorId":"68750225053f2ab7d54399dc","orderId":"ORD-TEST-004","path":"","timestamp":"2025-07-14T13:12:05.841Z","totalWeight":24.3,"userId":"68750225053f2ab7d54399dc"}
info: undefined {"action":"bags_weighed","eventType":"ORDER_STATUS_CHANGED","ip":"127.0.0.1","method":"GET","newBags":1,"numberOfBags":1,"operatorId":"68750227053f2ab7d5439a16","orderId":"ORD-TEST-005","path":"","timestamp":"2025-07-14T13:12:07.530Z","totalWeight":20,"userId":"68750227053f2ab7d5439a16"}
info: undefined {"action":"bags_weighed","eventType":"ORDER_STATUS_CHANGED","ip":"127.0.0.1","method":"GET","newBags":1,"numberOfBags":2,"operatorId":"68750227053f2ab7d5439a16","orderId":"ORD-TEST-005","path":"","timestamp":"2025-07-14T13:12:07.651Z","totalWeight":45,"userId":"68750227053f2ab7d5439a16"}
PASS tests/unit/wdfCredit.test.js (18.985 s)
  WDF Credit System
    WDF Credit Calculation
      ✓ should calculate positive WDF credit when actual weight > estimated weight (1715 ms)
      ✓ should calculate negative WDF credit when actual weight < estimated weight (1818 ms)
      ✓ should only calculate credit when all bags are weighed (1776 ms)
    WDF Credit Application
      ✓ should apply positive WDF credit to new order (1989 ms)
      ✓ should apply negative WDF credit (debit) to new order (2003 ms)
      ✓ should not apply credit if customer has zero credit (1893 ms)
    Order Model WDF Credit Calculations
      ✓ should correctly calculate estimated total with positive credit (1623 ms)
      ✓ should correctly calculate actual total with negative credit (1675 ms)
    Edge Cases
      ✓ should handle precision correctly for credit calculations (1748 ms)
      ✓ should handle sequential bag weighing correctly (1797 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-affiliate',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1748:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: true,
      userObject: {
        provider: 'google',
        socialId: 'google123',
        email: 'affiliate@example.com',
        isExistingAffiliate: true,
        affiliate: {
          _id: 'aff123',
          affiliateId: 'AFF001',
          email: 'affiliate@example.com'
        }
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1878:13)

  console.log
    [handleCustomerSocialCallback] User is an existing affiliate, showing conflict message

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1884:15)

  console.log
    [handleCustomerSocialCallback] Using nonce for affiliate conflict: test-nonce

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1910:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1595:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1629:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1748:13)

Killed
