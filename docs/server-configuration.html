<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Configuration - WaveMAX Affiliate Program</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 30px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        header .breadcrumb {
            opacity: 0.9;
        }
        
        header .breadcrumb a {
            color: white;
            text-decoration: none;
        }
        
        .content {
            background: white;
            border-radius: 8px;
            padding: 40px;
            margin-top: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        h2 {
            color: #1e3a8a;
            margin-top: 30px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        h3 {
            color: #333;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .config-section {
            background: #f8f9fa;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .warning strong {
            color: #856404;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info strong {
            color: #0c5460;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1e3a8a;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e0e0e0;
        }
        
        .nav-buttons a {
            display: inline-block;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .nav-buttons a:hover {
            background: #2563eb;
        }
        
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
        }
        
        .toc h3 {
            margin-top: 0;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            padding: 5px 0;
        }
        
        .toc a {
            color: #3b82f6;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html">Documentation</a> → Server Configuration
            </div>
            <h1>Server Configuration Guide</h1>
        </div>
    </header>

    <div class="container">
        <div class="content">
            <div class="toc">
                <h3>Table of Contents</h3>
                <ul>
                    <li><a href="#environment-variables">Environment Variables</a></li>
                    <li><a href="#database-setup">Database Setup</a></li>
                    <li><a href="#email-configuration">Email Service Configuration</a></li>
                    <li><a href="#oauth-configuration">Social Media OAuth Configuration</a></li>
                    <li><a href="#security-settings">Security Settings</a></li>
                    <li><a href="#pm2-configuration">PM2 Configuration</a></li>
                    <li><a href="#nginx-setup">Nginx Setup</a></li>
                    <li><a href="#ssl-configuration">SSL/TLS Configuration</a></li>
                    <li><a href="#logging">Logging Configuration</a></li>
                    <li><a href="#backup-procedures">Backup Procedures</a></li>
                    <li><a href="#monitoring">Monitoring & Health Checks</a></li>
                </ul>
            </div>

            <h2 id="environment-variables">Environment Variables</h2>
            
            <div class="config-section">
                <p>The application uses environment variables for configuration. Create a <code>.env</code> file in the project root:</p>
            </div>

            <h3>Required Variables</h3>
            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Description</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>NODE_ENV</code></td>
                        <td>Environment mode</td>
                        <td>production</td>
                    </tr>
                    <tr>
                        <td><code>PORT</code></td>
                        <td>Server port</td>
                        <td>3000</td>
                    </tr>
                    <tr>
                        <td><code>MONGODB_URI</code></td>
                        <td>MongoDB connection string</td>
                        <td>mongodb://localhost:27017/wavemax</td>
                    </tr>
                    <tr>
                        <td><code>ENCRYPTION_KEY</code></td>
                        <td>32-byte hex key for encryption</td>
                        <td>Generate with: <code>node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"</code></td>
                    </tr>
                    <tr>
                        <td><code>JWT_SECRET</code></td>
                        <td>Secret for JWT signing</td>
                        <td>Generate with: <code>node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"</code></td>
                    </tr>
                    <tr>
                        <td><code>SESSION_SECRET</code></td>
                        <td>Express session secret</td>
                        <td>Generate with: <code>node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"</code></td>
                    </tr>
                    <tr>
                        <td><code>EMAIL_PROVIDER</code></td>
                        <td>Email service provider</td>
                        <td>ses, smtp, exchange, console</td>
                    </tr>
                    <tr>
                        <td><code>CORS_ORIGIN</code></td>
                        <td>Allowed CORS origins</td>
                        <td>https://wavemaxlaundry.com</td>
                    </tr>
                </tbody>
            </table>

            <h3>Optional Variables</h3>
            <table>
                <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Description</th>
                        <th>Default</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>LOG_LEVEL</code></td>
                        <td>Logging level</td>
                        <td>info</td>
                    </tr>
                    <tr>
                        <td><code>LOG_DIR</code></td>
                        <td>Directory for log files</td>
                        <td>logs</td>
                    </tr>
                    <tr>
                        <td><code>ENABLE_DELETE_DATA_FEATURE</code></td>
                        <td>Enable delete all data feature</td>
                        <td>false</td>
                    </tr>
                    <tr>
                        <td><code>SHOW_DOCS</code></td>
                        <td>Enable documentation at /docs</td>
                        <td>false</td>
                    </tr>
                    <tr>
                        <td><code>RATE_LIMIT_WINDOW</code></td>
                        <td>Rate limit window (ms)</td>
                        <td>900000</td>
                    </tr>
                    <tr>
                        <td><code>RATE_LIMIT_MAX</code></td>
                        <td>Max requests per window</td>
                        <td>100</td>
                    </tr>
                </tbody>
            </table>

            <div class="warning">
                <strong>⚠️ Security Warning:</strong> Never commit <code>.env</code> files to version control. Always use <code>.env.example</code> as a template.
            </div>

            <h2 id="database-setup">Database Setup</h2>

            <h3>MongoDB Installation</h3>
            <pre><code># Ubuntu/Debian
wget -qO - https://www.mongodb.org/static/pgp/server-7.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
sudo apt-get update
sudo apt-get install -y mongodb-org

# Start MongoDB
sudo systemctl start mongod
sudo systemctl enable mongod</code></pre>

            <h3>Database Configuration</h3>
            <pre><code># Connect to MongoDB
mongosh

# Create database
use wavemax

# Create admin user
db.createUser({
  user: "wavemaxadmin",
  pwd: "your-secure-password",
  roles: [
    { role: "readWrite", db: "wavemax" },
    { role: "dbAdmin", db: "wavemax" }
  ]
})

# Update connection string in .env
MONGODB_URI=mongodb://wavemaxadmin:your-secure-password@localhost:27017/wavemax?authSource=admin</code></pre>

            <h3>Database Indexes</h3>
            <p>The application automatically creates necessary indexes on startup. To manually create indexes:</p>
            <pre><code>// Affiliates collection
db.affiliates.createIndex({ email: 1 }, { unique: true })
db.affiliates.createIndex({ affiliateId: 1 }, { unique: true })
db.affiliates.createIndex({ isActive: 1 })

// Customers collection
db.customers.createIndex({ email: 1 }, { unique: true })
db.customers.createIndex({ customerId: 1 }, { unique: true })
db.customers.createIndex({ affiliateId: 1 })

// Orders collection
db.orders.createIndex({ orderId: 1 }, { unique: true })
db.orders.createIndex({ customerId: 1 })
db.orders.createIndex({ status: 1 })
db.orders.createIndex({ createdAt: -1 })</code></pre>

            <h2 id="email-configuration">Email Service Configuration</h2>

            <h3>Amazon SES (Recommended for Production)</h3>
            <div class="config-section">
                <p>Configure AWS SES for high-volume, reliable email delivery:</p>
                <pre><code>EMAIL_PROVIDER=ses
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
SES_FROM_EMAIL=noreply@wavemax.promo</code></pre>
            </div>

            <div class="info">
                <strong>ℹ️ Note:</strong> Verify your domain and sender email in AWS SES console before sending emails.
            </div>

            <h3>SMTP Configuration</h3>
            <pre><code>EMAIL_PROVIDER=smtp
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
EMAIL_FROM=WaveMAX <noreply@wavemax.promo></code></pre>

            <h3>Microsoft Exchange</h3>
            <pre><code>EMAIL_PROVIDER=exchange
EXCHANGE_HOST=smtp.office365.com
EXCHANGE_PORT=587
EXCHANGE_USER=your-email@yourdomain.com
EXCHANGE_PASS=your-password
EXCHANGE_FROM_EMAIL=noreply@yourdomain.com</code></pre>

            <h2 id="oauth-configuration">Social Media OAuth Configuration</h2>

            <div class="config-section">
                <p>The WaveMAX Affiliate Program supports social media authentication for affiliates through Google, Facebook, and LinkedIn OAuth 2.0 integration. This provides a seamless registration and login experience while maintaining security.</p>
            </div>

            <div class="info">
                <strong>ℹ️ Note:</strong> OAuth providers are optional. If environment variables are not provided, the application will run with traditional username/password authentication only.
            </div>

            <h3>Google OAuth 2.0 Setup</h3>
            <div class="config-section">
                <div class="warning">
                    <strong>⚠️ Important:</strong> Follow these steps carefully and in order. Missing steps are the most common cause of OAuth setup issues.
                </div>
                
                <h4>Step 1: Create a Google Cloud Project</h4>
                <ol>
                    <li>Navigate to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                    <li>Click "Select a project" dropdown at the top of the page</li>
                    <li>Click "NEW PROJECT" button</li>
                    <li>Enter project details:
                        <ul>
                            <li><strong>Project name:</strong> <code>WaveMAX Affiliate Program</code> (or your preferred name)</li>
                            <li><strong>Organization:</strong> Select your organization if applicable</li>
                            <li><strong>Location:</strong> Choose your organization or "No organization"</li>
                        </ul>
                    </li>
                    <li>Click "CREATE" and wait for project creation</li>
                    <li>Ensure your new project is selected (check the project name in the top bar)</li>
                </ol>

                <h4>Step 2: Enable Required APIs</h4>
                <ol>
                    <li>In the Google Cloud Console, go to "APIs & Services" > "Library"</li>
                    <li>Search for "Identity Platform API" (<strong>NOT</strong> "Google+ API")</li>
                    <li>Click on "Identity Platform API" from the results</li>
                    <li>Click "ENABLE" button</li>
                    <li>Wait for the API to be enabled (you'll see a confirmation message)</li>
                </ol>

                <h4>Step 3: Configure OAuth Consent Screen</h4>
                <ol>
                    <li>Go to "APIs & Services" > "OAuth consent screen"</li>
                    <li>Choose user type:
                        <ul>
                            <li><strong>External:</strong> For production apps available to any Google user</li>
                            <li><strong>Internal:</strong> Only if you have Google Workspace (for organization users only)</li>
                        </ul>
                    </li>
                    <li>Click "CREATE"</li>
                    <li>Fill out the OAuth consent screen form:
                        <br><br>
                        <strong>App Information:</strong>
                        <ul>
                            <li><strong>App name:</strong> <code>WaveMAX Affiliate Program</code></li>
                            <li><strong>User support email:</strong> Your support email address</li>
                            <li><strong>App logo:</strong> Upload your company logo (120x120px PNG recommended)</li>
                            <li><strong>App domain:</strong> Your website domain (e.g., <code>wavemaxlaundry.com</code>)</li>
                            <li><strong>Authorized domains:</strong> Add your domains:
                                <ul>
                                    <li><code>yourdomain.com</code> (your main domain)</li>
                                    <li><code>wavemax.promo</code> (if using the embed service)</li>
                                </ul>
                            </li>
                        </ul>
                        <br>
                        <strong>Developer Contact Information:</strong>
                        <ul>
                            <li><strong>Email addresses:</strong> Add your developer email addresses</li>
                        </ul>
                    </li>
                    <li>Click "SAVE AND CONTINUE"</li>
                    <li><strong>Scopes Configuration:</strong>
                        <ul>
                            <li>Click "ADD OR REMOVE SCOPES"</li>
                            <li>Add these scopes:
                                <ul>
                                    <li><code>../auth/userinfo.email</code> (to access user's email)</li>
                                    <li><code>../auth/userinfo.profile</code> (to access basic profile info)</li>
                                </ul>
                            </li>
                            <li>Click "UPDATE" then "SAVE AND CONTINUE"</li>
                        </ul>
                    </li>
                    <li><strong>Test users</strong> (if External and not published):
                        <ul>
                            <li>Add test email addresses that can access your app during development</li>
                            <li>Click "SAVE AND CONTINUE"</li>
                        </ul>
                    </li>
                    <li><strong>Summary:</strong> Review your settings and click "BACK TO DASHBOARD"</li>
                </ol>

                <h4>Step 4: Create OAuth 2.0 Credentials</h4>
                <ol>
                    <li>Go to "APIs & Services" > "Credentials"</li>
                    <li>Click "CREATE CREDENTIALS" > "OAuth 2.0 Client IDs"</li>
                    <li>If prompted to configure the consent screen, complete Step 3 first</li>
                    <li>Configure the OAuth client:
                        <ul>
                            <li><strong>Application type:</strong> Select "Web application"</li>
                            <li><strong>Name:</strong> <code>WaveMAX Affiliate OAuth Client</code></li>
                        </ul>
                    </li>
                    <li><strong>Authorized JavaScript origins</strong> (add all that apply):
                        <ul>
                            <li><code>https://yourdomain.com</code></li>
                            <li><code>https://www.yourdomain.com</code></li>
                            <li><code>http://localhost:3000</code> (for development)</li>
                            <li><code>http://localhost:3001</code> (if using different port)</li>
                        </ul>
                    </li>
                    <li><strong>Authorized redirect URIs</strong> (add all that apply):
                        <ul>
                            <li><code>https://yourdomain.com/api/auth/google/callback</code></li>
                            <li><code>https://www.yourdomain.com/api/auth/google/callback</code></li>
                            <li><code>https://wavemax.promo/api/auth/google/callback</code> (if using embed service)</li>
                            <li><code>http://localhost:3000/api/auth/google/callback</code> (for development)</li>
                        </ul>
                    </li>
                    <li>Click "CREATE"</li>
                    <li><strong>Important:</strong> Copy the Client ID and Client Secret immediately and store them securely</li>
                </ol>

                <h4>Step 5: Environment Configuration</h4>
                <p>Add these variables to your <code>.env</code> file:</p>
                <pre><code># Google OAuth Configuration
GOOGLE_CLIENT_ID=1234567890-abcdefghijklmnop.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-YourSecretKeyHere</code></pre>

                <h4>Step 6: Domain Verification (Production Only)</h4>
                <ol>
                    <li>Go to <a href="https://search.google.com/search-console" target="_blank">Google Search Console</a></li>
                    <li>Add your domain property</li>
                    <li>Verify ownership using one of the provided methods:
                        <ul>
                            <li>HTML file upload</li>
                            <li>HTML tag in your website header</li>
                            <li>Domain name provider (DNS record)</li>
                            <li>Google Analytics tracking code</li>
                        </ul>
                    </li>
                </ol>

                <h4>Step 7: Publishing Your App (Production)</h4>
                <p>For production use with external users:</p>
                <ol>
                    <li>Return to "APIs & Services" > "OAuth consent screen"</li>
                    <li>Click "PUBLISH APP" if you want to make it available to all Google users</li>
                    <li>If you need sensitive scopes, submit for verification:
                        <ul>
                            <li>Click "Submit for verification"</li>
                            <li>Provide required documentation</li>
                            <li>Wait for Google's review (can take several days)</li>
                        </ul>
                    </li>
                </ol>

                <div class="warning">
                    <h4>Troubleshooting Common Issues:</h4>
                    <ul>
                        <li><strong>"Error 400: redirect_uri_mismatch":</strong> Check that your redirect URI exactly matches what's configured in Google Console</li>
                        <li><strong>"Access blocked":</strong> Your app may need to be published or the user needs to be added as a test user</li>
                        <li><strong>"Invalid client":</strong> Verify your Client ID and Client Secret are correct in your environment variables</li>
                        <li><strong>"API not enabled":</strong> Ensure you've enabled the Identity Platform API, not Google+ API</li>
                    </ul>
                </div>
            </div>

            <h3>Facebook OAuth Setup</h3>
            <div class="config-section">
                <ol>
                    <li><strong>Create a Facebook App:</strong>
                        <ul>
                            <li>Go to <a href="https://developers.facebook.com/" target="_blank">Facebook Developers</a></li>
                            <li>Create a new app of type "Consumer"</li>
                            <li>Add Facebook Login product to your app</li>
                        </ul>
                    </li>
                    <li><strong>Configure Facebook Login:</strong>
                        <ul>
                            <li>Go to Facebook Login > Settings</li>
                            <li>Add Valid OAuth Redirect URIs:
                                <ul>
                                    <li><code>https://yourdomain.com/api/auth/facebook/callback</code></li>
                                    <li><code>http://localhost:3000/api/auth/facebook/callback</code></li>
                                </ul>
                            </li>
                            <li>Enable "Use Strict Mode for Redirect URIs"</li>
                        </ul>
                    </li>
                    <li><strong>App Review (for production):</strong>
                        <ul>
                            <li>Request <code>email</code> permission if not automatically approved</li>
                            <li>Submit app for review if using advanced features</li>
                        </ul>
                    </li>
                </ol>
                <pre><code>FACEBOOK_APP_ID=your_facebook_app_id
FACEBOOK_APP_SECRET=your_facebook_app_secret</code></pre>
            </div>

            <h3>LinkedIn OAuth Setup</h3>
            <div class="config-section">
                <ol>
                    <li><strong>Create a LinkedIn App:</strong>
                        <ul>
                            <li>Go to <a href="https://www.linkedin.com/developers/" target="_blank">LinkedIn Developer Portal</a></li>
                            <li>Create a new app</li>
                            <li>Select your organization or create a new one</li>
                        </ul>
                    </li>
                    <li><strong>Configure OAuth Settings:</strong>
                        <ul>
                            <li>Go to Auth tab</li>
                            <li>Add Authorized redirect URLs:
                                <ul>
                                    <li><code>https://yourdomain.com/api/auth/linkedin/callback</code></li>
                                    <li><code>http://localhost:3000/api/auth/linkedin/callback</code></li>
                                </ul>
                            </li>
                            <li>Request access to <code>r_liteprofile</code> and <code>r_emailaddress</code> scopes</li>
                        </ul>
                    </li>
                </ol>
                <pre><code>LINKEDIN_CLIENT_ID=your_linkedin_client_id
LINKEDIN_CLIENT_SECRET=your_linkedin_client_secret</code></pre>
            </div>

            <h3>Additional OAuth Configuration</h3>
            <div class="config-section">
                <p>The following additional environment variables provide enhanced OAuth functionality:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Description</th>
                            <th>Default</th>
                            <th>Example</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>OAUTH_CALLBACK_URI</code></td>
                            <td>Base URL for OAuth callbacks (useful for embedded deployments)</td>
                            <td>Uses BASE_URL</td>
                            <td>https://wavemax.promo</td>
                        </tr>
                        <tr>
                            <td><code>RELAX_RATE_LIMITING</code></td>
                            <td>Disable rate limiting for development/testing</td>
                            <td>false</td>
                            <td>true</td>
                        </tr>
                    </tbody>
                </table>

                <div class="info">
                    <p><strong>OAUTH_CALLBACK_URI:</strong> This setting is particularly useful when your application is embedded in another domain but OAuth callbacks need to go to the server where your Node.js application is actually running.</p>
                    <p><strong>RELAX_RATE_LIMITING:</strong> Set to 'true' only in development environments to prevent rate limiting from interfering with OAuth testing. Never use in production.</p>
                </div>
            </div>

            <h3>OAuth Security Features</h3>
            <div class="config-section">
                <ul>
                    <li><strong>Secure Token Handling:</strong> OAuth tokens are encrypted and stored securely</li>
                    <li><strong>Account Linking:</strong> Existing users can link social accounts to their profiles</li>
                    <li><strong>Fallback Authentication:</strong> Traditional login always available as backup</li>
                    <li><strong>Session Management:</strong> Proper session handling for both OAuth and traditional auth</li>
                    <li><strong>Audit Logging:</strong> All social authentication events are logged for security</li>
                </ul>
            </div>

            <div class="warning">
                <strong>⚠️ Production Considerations:</strong>
                <ul>
                    <li>Use HTTPS callback URLs only in production</li>
                    <li>Complete app review process for each provider</li>
                    <li>Configure proper consent screens and privacy policies</li>
                    <li>Monitor OAuth usage and rate limits</li>
                </ul>
            </div>

            <h2 id="security-settings">Security Settings</h2>

            <h3>HTTPS Configuration</h3>
            <pre><code># Force HTTPS in production
if (process.env.NODE_ENV === 'production') {
  app.use((req, res, next) => {
    if (req.header('x-forwarded-proto') !== 'https') {
      res.redirect(`https://${req.header('host')}${req.url}`);
    } else {
      next();
    }
  });
}</code></pre>

            <h3>Security Headers</h3>
            <p>The application automatically sets security headers. Additional headers can be configured:</p>
            <pre><code>SECURITY_HSTS_MAX_AGE=31536000
SECURITY_CSP_ENABLED=true
SECURITY_FRAME_OPTIONS=DENY</code></pre>

            <h3>CORS Configuration</h3>
            <pre><code># Single origin
CORS_ORIGIN=https://wavemaxlaundry.com

# Multiple origins
CORS_ORIGIN=https://wavemaxlaundry.com,https://wavemax.promo</code></pre>

            <h2 id="pm2-configuration">PM2 Configuration</h2>

            <h3>Installation</h3>
            <pre><code>npm install -g pm2</code></pre>

            <h3>Ecosystem Configuration</h3>
            <p>The project includes <code>ecosystem.config.js</code> for PM2:</p>
            <pre><code>module.exports = {
  apps: [{
    name: 'wavemax-affiliate',
    script: './server.js',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/pm2-error.log',
    out_file: './logs/pm2-out.log',
    log_file: './logs/pm2-combined.log',
    time: true
  }]
};</code></pre>

            <h3>PM2 Commands</h3>
            <pre><code># Start application
pm2 start ecosystem.config.js

# View status
pm2 status

# View logs
pm2 logs

# Restart with zero downtime
pm2 reload wavemax-affiliate

# Save PM2 configuration
pm2 save
pm2 startup</code></pre>

            <h2 id="nginx-setup">Nginx Setup</h2>

            <h3>Installation</h3>
            <pre><code>sudo apt update
sudo apt install nginx</code></pre>

            <h3>Site Configuration</h3>
            <p>Create <code>/etc/nginx/sites-available/wavemax-affiliate</code>:</p>
            <pre><code>server {
    listen 80;
    server_name wavemax.promo;
    
    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name wavemax.promo;
    
    # SSL Configuration
    ssl_certificate /etc/letsencrypt/live/wavemax.promo/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/wavemax.promo/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # Security Headers
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Proxy Configuration
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Timeouts
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # Static files caching
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}</code></pre>

            <h3>Enable Site</h3>
            <pre><code>sudo ln -s /etc/nginx/sites-available/wavemax-affiliate /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx</code></pre>

            <h2 id="ssl-configuration">SSL/TLS Configuration</h2>

            <h3>Let's Encrypt Setup</h3>
            <pre><code># Install Certbot
sudo apt install certbot python3-certbot-nginx

# Obtain certificate
sudo certbot --nginx -d wavemax.promo -d www.wavemax.promo

# Auto-renewal
sudo certbot renew --dry-run</code></pre>

            <h3>SSL Security Configuration</h3>
            <pre><code># Generate DH parameters
sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048

# Add to Nginx configuration
ssl_dhparam /etc/ssl/certs/dhparam.pem;
ssl_session_timeout 1d;
ssl_session_cache shared:SSL:10m;
ssl_stapling on;
ssl_stapling_verify on;</code></pre>

            <h2 id="logging">Logging Configuration</h2>

            <h3>Application Logs</h3>
            <p>Configure logging levels and directories:</p>
            <pre><code>LOG_LEVEL=info          # error, warn, info, debug
LOG_DIR=./logs
LOG_MAX_SIZE=10m
LOG_MAX_FILES=30d
LOG_COMPRESSION=true</code></pre>

            <h3>Log Rotation</h3>
            <p>Create <code>/etc/logrotate.d/wavemax-affiliate</code>:</p>
            <pre><code>/var/www/wavemax/logs/*.log {
    daily
    rotate 30
    compress
    missingok
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        pm2 reloadLogs
    endscript
}</code></pre>

            <h2 id="backup-procedures">Backup Procedures</h2>

            <h3>Database Backup Script</h3>
            <p>Create <code>/usr/local/bin/backup-wavemax.sh</code>:</p>
            <pre><code>#!/bin/bash
BACKUP_DIR="/var/backups/wavemax"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="wavemax"

# Create backup directory
mkdir -p $BACKUP_DIR

# Backup MongoDB
mongodump --db $DB_NAME --gzip --archive=$BACKUP_DIR/wavemax_$DATE.gz

# Keep only last 30 days of backups
find $BACKUP_DIR -name "wavemax_*.gz" -mtime +30 -delete

# Optional: Upload to S3
aws s3 cp $BACKUP_DIR/wavemax_$DATE.gz s3://your-backup-bucket/mongodb/</code></pre>

            <h3>Automated Backups</h3>
            <pre><code># Add to crontab
0 2 * * * /usr/local/bin/backup-wavemax.sh</code></pre>

            <h2 id="documentation-access">Documentation Access</h2>

            <div class="info">
                <strong>ℹ️ Documentation Hosting:</strong> The application can serve its own documentation when enabled.
            </div>

            <h3>Enabling Documentation</h3>
            <pre><code># In your .env file
SHOW_DOCS=true

# Restart the application
pm2 restart wavemax</code></pre>

            <h3>Accessing Documentation</h3>
            <p>When enabled, documentation is available at:</p>
            <pre><code>https://yourdomain.com/docs</code></pre>

            <div class="warning">
                <strong>⚠️ Production Warning:</strong> For security reasons, it's recommended to disable documentation in production:
                <pre><code>SHOW_DOCS=false</code></pre>
            </div>

            <h2 id="monitoring">Monitoring & Health Checks</h2>

            <h3>Health Check Endpoint</h3>
            <p>The application provides a health check endpoint at <code>/api/health</code>:</p>
            <pre><code>curl https://wavemax.promo/api/health

Response:
{
  "status": "healthy",
  "timestamp": "2025-05-29T10:00:00.000Z",
  "uptime": 3600,
  "database": "connected",
  "memory": {
    "used": "256MB",
    "total": "512MB"
  }
}</code></pre>

            <h3>PM2 Monitoring</h3>
            <pre><code># Real-time monitoring
pm2 monit

# Web dashboard
pm2 install pm2-web
pm2 web</code></pre>

            <h3>System Monitoring</h3>
            <pre><code># Install monitoring tools
sudo apt install htop iotop nethogs

# Monitor resources
htop              # CPU and memory
iotop             # Disk I/O
nethogs           # Network usage
pm2 monit         # Application metrics</code></pre>

            <div class="warning">
                <strong>⚠️ Important:</strong> Always test configuration changes in a staging environment before applying to production.
            </div>

            <div class="nav-buttons">
                <a href="index.html">← Back to Index</a>
                <a href="embedding-guide.html">Next: Embedding Guide →</a>
            </div>
        </div>
    </div>
</body>
</html>