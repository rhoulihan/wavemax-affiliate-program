
> wavemax-affiliate-program@1.0.0 test:coverage
> jest --coverage --runInBand --forceExit

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/logger.test.js
  Logger Utility
    âœ“ should export logger methods (77 ms)
    âœ“ should be a winston logger instance (18 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/routingRoutes.test.js
  Routing Routes
    GET /
      âœ“ should serve filmwalk index.html (20 ms)
      âœ“ should handle root path without trailing slash (4 ms)
      âœ“ should return 404 for non-existent paths (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentModel.test.js
  Payment Model Methods
    Instance Methods
      âœ“ should determine if payment can be captured (98 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/encryption.test.js
  Encryption Utility
    âœ“ should hash password correctly (55 ms)
    âœ“ should verify password correctly (158 ms)
    âœ“ should encrypt and decrypt data correctly (1 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:06:52.991Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paygistixService.test.js
  Paygistix Service
    getConfig
      âœ“ should return client config from paygistixConfig (2 ms)
    isConfigured
      âœ“ should return true when properly configured
      âœ“ should return false when not configured (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailServiceHelpers.test.js
  EmailService Helper Functions
    formatSize
      âœ“ should format small size correctly (1 ms)
      âœ“ should format medium size correctly (1 ms)
      âœ“ should format large size correctly
      âœ“ should return original value for unknown sizes
      âœ“ should handle empty string
      âœ“ should handle null value
      âœ“ should handle undefined value
      âœ“ should handle numeric values
      âœ“ should handle uppercase input (1 ms)
      âœ“ should handle mixed case input

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/qrCodeGenerator.test.js
  QR Code Generator
    generateQRCode
      âœ“ should generate a customer QR code with timestamp when no ID provided (1 ms)
      âœ“ should generate an order QR code with timestamp when no ID provided
      âœ“ should generate a customer QR code with provided ID (1 ms)
      âœ“ should generate an order QR code with provided ID
      âœ“ should convert type to uppercase
      âœ“ should use default type of customer when not specified
      âœ“ should generate unique codes on consecutive calls (1 ms)
      âœ“ should handle special characters in ID
      âœ“ should handle empty string ID as null (1 ms)
      âœ“ should handle null ID parameter

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paginationMiddleware.test.js
  Pagination Middleware
    âœ“ should set default pagination values when no query params provided (2 ms)
    âœ“ should parse page and limit from query params
    âœ“ should enforce minimum values
    âœ“ should enforce maximum limit
    âœ“ should handle non-numeric values
    âœ“ should calculate skip correctly for different pages (1 ms)
    âœ“ should handle floating point numbers
    âœ“ should preserve other query parameters (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/helpers.test.js
  Helpers Utility Functions
    formatCurrency
      âœ“ should format a number as USD currency by default (18 ms)
      âœ“ should handle null and undefined amounts (1 ms)
      âœ“ should handle NaN values
      âœ“ should parse string amounts (1 ms)
      âœ“ should format with different currencies
      âœ“ should handle negative amounts (1 ms)
      âœ“ should round to 2 decimal places
    formatDate
      âœ“ should format date with short format by default (4 ms)
      âœ“ should format date with long format (1 ms)
      âœ“ should format date with ISO format
      âœ“ should handle string dates
      âœ“ should handle null and undefined dates (1 ms)
      âœ“ should handle invalid dates
      âœ“ should handle different format cases (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportGoogleOnly.test.js
  Google OAuth Passport Configuration - Isolated
    âœ“ should handle Google OAuth callback correctly (1 ms)
    âœ“ should configure Google strategy with correct parameters (1 ms)
    âœ“ should support state parameter for context detection

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/quickbooksRoutesSimple.test.js
  QuickBooks Routes - Simple
    GET /api/quickbooks/vendors/export
      âœ“ should export vendors (12 ms)
      âœ“ should export vendors as CSV (4 ms)
    GET /api/quickbooks/payments/export
      âœ“ should export payment summary (5 ms)
    GET /api/quickbooks/commissions/export
      âœ“ should export commission detail (4 ms)
    GET /api/quickbooks/exports
      âœ“ should get export history (4 ms)
      âœ“ should filter export history by type (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateModel.test.js
  Affiliate Model Methods
    Virtual Properties
      âœ“ should calculate full name virtual property (153 ms)
    Payment Methods
      âœ“ should determine if affiliate can receive payments (150 ms)
    W9 Status Display
      âœ“ should return correct W9 status display text (163 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportLinkedInOnly.test.js
  LinkedIn OAuth Passport Configuration - Isolated
    âœ“ should handle LinkedIn OAuth callback correctly
    âœ“ should configure LinkedIn strategy with correct scope
    âœ“ should configure LinkedIn strategy with correct parameters (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportFacebookOnly.test.js
  Facebook OAuth Passport Configuration - Isolated
    âœ“ should handle Facebook OAuth callback correctly (1 ms)
    âœ“ should configure Facebook strategy with profile fields
    âœ“ should configure Facebook strategy with correct parameters (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administratorAdditional.test.js
  Administrator Model - Additional Coverage
    Permission Methods
      âœ“ should check single permission with hasPermission (194 ms)
      âœ“ should check all permissions with hasAllPermissions (187 ms)
    Password History
      âœ“ should check if password is in history (638 ms)
      âœ“ should handle empty password history (164 ms)
    Virtual Properties
      âœ“ should calculate isLocked virtual property correctly (133 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [Coverage Route] GET /non-existent-file.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /protected-file.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /file%20with%20spaces.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /../../../etc/passwd

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /styles.css

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /script.js

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] POST /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] PUT /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] DELETE /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /critical-files

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/critical-files.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /test-templates

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/test-templates.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /action-plan

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/action-plan.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

PASS tests/unit/coverageRoutesAdditional.test.js
  Coverage Routes - Additional Coverage
    Error Handler Function
      âœ“ should handle file not found errors (13 ms)
      âœ“ should handle permission denied errors (5 ms)
    Static File Serving Edge Cases
      âœ“ should handle requests with special characters in filename (17 ms)
      âœ“ should handle requests with directory traversal attempts (3 ms)
      âœ“ should serve CSS files with proper headers (4 ms)
      âœ“ should serve JS files with proper headers (4 ms)
    Environment-specific Behavior
      âœ“ should handle staging environment (2 ms)
    Request Method Handling
      âœ“ should reject POST requests (5 ms)
      âœ“ should reject PUT requests (4 ms)
      âœ“ should reject DELETE requests (4 ms)
    Concurrent Request Handling
      âœ“ should handle multiple simultaneous requests (24 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderRoutesSimple.test.js
  Order Routes - Simple
    POST /api/orders
      âœ“ should create order with valid data (14 ms)
    GET /api/orders/export
      âœ“ should export orders (3 ms)
    GET /api/orders/search
      âœ“ should search orders (3 ms)
    GET /api/orders/statistics
      âœ“ should get order statistics (3 ms)
    PUT /api/orders/bulk/status
      âœ“ should bulk update order status (2 ms)
    POST /api/orders/bulk/cancel
      âœ“ should bulk cancel orders (2 ms)
    GET /api/orders/:orderId
      âœ“ should get order details (3 ms)
    PUT /api/orders/:orderId/status
      âœ“ should update order status (1 ms)
    POST /api/orders/:orderId/cancel
      âœ“ should cancel order (1 ms)
    PUT /api/orders/:orderId/payment-status
      âœ“ should update payment status (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderModelSimple.test.js
  Order Model - Line Coverage
    SystemConfig Error Handling (Line 110)
      âœ“ should use default base rate when SystemConfig.getValue throws error (193 ms)
    Status Timestamp Updates (Lines 132-148)
      âœ“ should set processingStartedAt when status changes to processing (237 ms)
      âœ“ should set processedAt when status changes to processed (240 ms)
      âœ“ should set completedAt when status changes to complete (223 ms)
      âœ“ should set cancelledAt when status changes to cancelled (226 ms)
      âœ“ should not overwrite existing timestamps (225 ms)
    Actual Weight and Commission Calculations
      âœ“ should calculate actualTotal and commission when actualWeight is set (229 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:07:04.488Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:07:04.616Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T04:07:04.648Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:07:04.806Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:07:04.937Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:07:05.609Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:07:05.724Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

PASS tests/unit/docusignToken.test.js
  DocuSignToken Model
    saveToken
      âœ“ should save a new token with all fields (130 ms)
      âœ“ should update existing token if one exists (189 ms)
      âœ“ should calculate expiration time correctly (131 ms)
    getCurrentToken
      âœ“ should return the most recent token (161 ms)
      âœ“ should return null if no tokens exist (136 ms)
    clearTokens
      âœ“ should remove all tokens (230 ms)
    token expiration
      âœ“ should identify expired tokens (143 ms)
      âœ“ should handle tokens without refresh token (116 ms)
    lastUsed tracking
      âœ“ should update lastUsed when token is accessed (251 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-10-17T02:07:06.494Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-10-17T02:07:07.211Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-10-17T02:07:07.648Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-10-17T02:07:08.065Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-10-17T02:07:09.360Z"}
info: undefined {"eventType":"ADMIN_RESET_RATE_LIMITS","id":"admin123","role":"administrator","timestamp":"2025-10-17T02:07:09.787Z"}
PASS tests/unit/administratorControllerRateLimits.test.js
  Administrator Controller - Reset Rate Limits
    resetRateLimits
      âœ“ should reset all rate limits when no filters provided (717 ms)
      âœ“ should reset rate limits with type filter (437 ms)
      âœ“ should reset rate limits with IP filter (418 ms)
      âœ“ should handle IP filter overwriting type filter (413 ms)
      âœ“ should handle database errors gracefully (462 ms)
      âœ“ should handle missing database connection (1 ms)
      âœ“ should handle collection not found error (416 ms)
      âœ“ should report zero deletions correctly (426 ms)
      âœ“ should handle special regex characters in IP (419 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'customer_12345' },
      headers: {},
      state: 'customer_12345',
      stateStartsWithCustomer: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_12345',
      isCustomerRequest: true,
      willDelegate: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:997:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_123' },
      headers: {},
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_123' },
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_error' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_error',
      sessionId: null,
      allParams: { state: 'customer_error' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1647:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_123' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_123',
      sessionId: 'oauth_123',
      allParams: { state: 'customer_oauth_123' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1647:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_test_session_456' },
      headers: {},
      state: 'oauth_test_session_456',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test_session_456',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test_session_456',
      sessionId: 'oauth_test_session_456',
      allParams: { state: 'oauth_test_session_456' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: undefined },
      headers: {},
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: { state: undefined } }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

PASS tests/unit/oauthCallbacksSimple.test.js
  OAuth Callback Functions - Simple
    handleSocialCallback
      âœ“ should delegate to customer handler for customer requests (378 ms)
      âœ“ should handle failed authentication with popup (176 ms)
      âœ“ should handle errors gracefully (157 ms)
    handleCustomerSocialCallback
      âœ“ should handle missing user (155 ms)
      âœ“ should store session data for popup requests (155 ms)
    State Parameter Parsing
      âœ“ should extract sessionId from oauth_ prefixed state (155 ms)
      âœ“ should handle missing state parameter (157 ms)
      âœ“ should detect popup from referer header (158 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/modelsAdditional.test.js
  Models - Additional Coverage
    Administrator Model - Pre-save Hook
      âœ“ should add password to history on password change (301 ms)
      âœ“ should limit password history to 5 entries (119 ms)
    Payment Model - Helper Methods
      âœ“ should have a method to format payment display (110 ms)
      âœ“ should validate payment can be refunded (102 ms)
      âœ“ should calculate net amount after fees (105 ms)
    Edge Cases and Error Handling
      âœ“ should handle missing required fields gracefully (106 ms)
      âœ“ should handle invalid enum values (113 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/securityUtils.test.js
  Security Utils
    escapeRegex
      âœ“ should escape special regex characters (1 ms)
      âœ“ should return empty string for non-string input
      âœ“ should handle strings without special characters (1 ms)
      âœ“ should handle empty string
      âœ“ should escape all regex metacharacters (1 ms)
    validateSortField
      âœ“ should return valid field name from allowed list (2 ms)
      âœ“ should return null for field not in allowed list
      âœ“ should sanitize and validate field with special characters
      âœ“ should return null for non-string input (1 ms)
      âœ“ should return null for empty string
      âœ“ should allow fields with dots, hyphens, and underscores
      âœ“ should prevent NoSQL injection attempts
    sanitizeObjectId
      âœ“ should return valid 24-character hex ObjectId (1 ms)
      âœ“ should return valid uppercase ObjectId
      âœ“ should return valid mixed case ObjectId
      âœ“ should return null for invalid ObjectId (wrong length) (1 ms)
      âœ“ should return null for invalid ObjectId (non-hex characters)
      âœ“ should return null for non-string input
      âœ“ should return null for empty string
      âœ“ should prevent injection attempts (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderRoutes.isolated.test.js
  Order Routes - Isolated V2
    âœ“ POST /api/orders - should create a new order (20 ms)
    âœ“ GET /api/orders/export - should export orders (3 ms)
    âœ“ GET /api/orders/search - should search orders (3 ms)
    âœ“ GET /api/orders/statistics - should get statistics (2 ms)
    âœ“ PUT /api/orders/bulk/status - should bulk update (3 ms)
    âœ“ POST /api/orders/bulk/cancel - should bulk cancel (2 ms)
    âœ“ GET /api/orders/:orderId - should get order details (2 ms)
    âœ“ PUT /api/orders/:orderId/status - should update status (3 ms)
    âœ“ POST /api/orders/:orderId/cancel - should cancel order (2 ms)
    âœ“ PUT /api/orders/:orderId/payment-status - should update payment (3 ms)
    âœ“ Error handling - should return 404 for unknown routes (3 ms)
    âœ“ Error handling - should handle controller errors (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error generating monitoring status: Error: Uptime error
        at process.uptime (/var/www/wavemax/wavemax-affiliate-program/tests/unit/monitoringRoutes.test.js:93:15)
        at uptime (/var/www/wavemax/wavemax-affiliate-program/server/routes/monitoringRoutes.js:23:23)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:284:15
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/server/routes/monitoringRoutes.js:11:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/tests/unit/monitoringRoutes.test.js:26:7)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at expressInit (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/middleware/init.js:40:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at query (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/middleware/query.js:45:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/application.js:181:10)
        at Server.app (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/express.js:39:9)
        at Server.emit (node:events:524:28)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17)

      112 |     res.json(monitoringData);
      113 |   } catch (error) {
    > 114 |     console.error('Error generating monitoring status:', error);
          |             ^
      115 |     res.status(500).json({
      116 |       success: false,
      117 |       message: 'Failed to retrieve monitoring status'

      at error (server/routes/monitoringRoutes.js:114:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (server/routes/monitoringRoutes.js:11:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (tests/unit/monitoringRoutes.test.js:26:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at expressInit (node_modules/express/lib/middleware/init.js:40:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at query (node_modules/express/lib/middleware/query.js:45:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at Function.handle (node_modules/express/lib/application.js:181:10)
      at Server.app (node_modules/express/lib/express.js:39:9)

PASS tests/unit/monitoringRoutes.test.js
  Monitoring Routes
    Security Headers Middleware
      âœ“ should add security headers to all monitoring routes (8 ms)
    GET /api/monitoring/status
      âœ“ should return monitoring status data (3 ms)
      âœ“ should include service history with timestamps and response times (7 ms)
      âœ“ should handle errors gracefully (23 ms)
    GET /api/monitoring/
      âœ“ should serve monitoring dashboard HTML with CSP nonce (2 ms)
    GET /api/monitoring/dashboard
      âœ“ should serve monitoring dashboard HTML with CSP nonce (2 ms)
    404 Handler
      âœ“ should return 404 for non-existent monitoring endpoints (1 ms)
    Service Status Data Structure
      âœ“ should return critical services with proper structure (3 ms)
      âœ“ should return non-critical services with proper structure (3 ms)
      âœ“ should generate realistic service metrics (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/authRoutesSimple.test.js
  Auth Routes - Simple
    POST /api/auth/login
      âœ“ should login with valid credentials (10 ms)
      âœ“ should reject invalid credentials (3 ms)
    POST /api/auth/register
      âœ“ should register new user (2 ms)
    POST /api/auth/logout
      âœ“ should logout with valid token (3 ms)
      âœ“ should reject logout without token (2 ms)
    POST /api/auth/forgot-password
      âœ“ should send password reset email (2 ms)
    POST /api/auth/reset-password
      âœ“ should reset password with valid token (2 ms)
    GET /api/auth/verify-email/:token
      âœ“ should verify email with valid token (2 ms)
    POST /api/auth/refresh-token
      âœ“ should refresh token (2 ms)
    GET /api/auth/me
      âœ“ should get current user with valid token (1 ms)
      âœ“ should reject without token (4 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateLoginInit.test.js
  Affiliate Login Initialization
    Module Loading
      âœ“ should initialize when form is found (3 ms)
      âœ“ should handle missing form gracefully
    URL Parameter Handling Logic
      âœ“ should correctly parse customer parameter from URL (1 ms)
      âœ“ should handle URL without customer parameter
      âœ“ should construct redirect URL correctly with customer parameter
      âœ“ should construct redirect URL correctly without customer parameter (1 ms)
    URL Validation
      âœ“ should validate customer ID format
      âœ“ should handle URL encoding correctly (1 ms)
    Integration with Email URLs
      âœ“ should parse email-generated URLs correctly
      âœ“ should handle both login and customer parameters together (1 ms)
    Parameter Preservation Logic
      âœ“ should preserve customer parameter through login flow
      âœ“ should handle multiple URL parameters correctly (8 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.isolated.test.js
  Payment Routes - Isolated
    GET /api/v1/payments/config
      âœ“ should return payment configuration (7 ms)
    POST /api/v1/payments/log-submission
      âœ“ should log payment submission (7 ms)
    POST /api/v1/payments/create-token
      âœ“ should create payment token (3 ms)
    GET /api/v1/payments/check-status/:token
      âœ“ should check payment status (2 ms)
    POST /api/v1/payments/cancel-token/:token
      âœ“ should cancel payment token (3 ms)
    POST /api/v1/payments/update-status/:token
      âœ“ should update payment status (3 ms)
    GET /api/v1/payments/pool-stats
      âœ“ should return pool statistics (3 ms)
    Error Handling
      âœ“ should handle controller errors gracefully (2 ms)
      âœ“ should handle missing routes with 404 (3 ms)
    Request Validation
      âœ“ should pass through request headers (2 ms)
      âœ“ should handle JSON parsing errors (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administratorEmailService.test.js
  Administrator Email Service Tests
    sendAdministratorWelcomeEmail
      âœ“ should call sendAdministratorWelcomeEmail function (1 ms)
      âœ“ should handle admin with different permission sets
      âœ“ should handle admin with single permission
      âœ“ should handle admin with no permissions (1 ms)
    sendAdministratorPasswordResetEmail
      âœ“ should call sendAdministratorPasswordResetEmail function
      âœ“ should handle different reset URLs
    Email template data processing
      âœ“ should replace uppercase placeholders correctly (1 ms)
      âœ“ should handle missing placeholders gracefully
      âœ“ should include current year in template data
      âœ“ should format permissions correctly as comma-separated string
      âœ“ should handle empty permissions array (1 ms)
      âœ“ should handle single permission
    Email service integration
      âœ“ should be available as a module export
      âœ“ should not throw error when sending welcome email
      âœ“ should not throw error when sending password reset email
    Admin data validation
      âœ“ should handle admin with required fields
      âœ“ should handle admin with different adminId formats (1 ms)
      âœ“ should handle admin with different email formats

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/betaRequest.test.js
  BetaRequest Model
    Model Creation
      âœ“ should create a beta request with required fields (101 ms)
      âœ“ should create a beta request with optional fields (92 ms)
      âœ“ should lowercase email addresses (91 ms)
      âœ“ should uppercase state codes (98 ms)
    Pre-save Middleware
      âœ“ should update updatedAt timestamp on save (131 ms)
    Static Methods
      findAllRequests
        âœ“ should return all beta requests sorted by createdAt descending (127 ms)
        âœ“ should return empty array when no requests exist (144 ms)
      findByEmail
        âœ“ should find beta request by email (124 ms)
        âœ“ should find beta request by email case-insensitively (121 ms)
        âœ“ should return null when email not found (123 ms)
    Welcome Email Tracking
      âœ“ should track welcome email status (89 ms)
    Reminder Email Tracking
      âœ“ should track reminder emails (92 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-affiliate',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at log (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at log (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: undefined
    }

      at log (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: true,
      userObject: {
        provider: 'google',
        socialId: 'google123',
        email: 'affiliate@example.com',
        isExistingAffiliate: true,
        affiliate: {
          _id: 'aff123',
          affiliateId: 'AFF001',
          email: 'affiliate@example.com'
        }
      }
    }

      at log (server/controllers/authController.js:1889:13)

  console.log
    [handleCustomerSocialCallback] User is an existing affiliate, showing conflict message

      at log (server/controllers/authController.js:1895:15)

  console.log
    [handleCustomerSocialCallback] Using nonce for affiliate conflict: test-nonce

      at log (server/controllers/authController.js:1921:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at log (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at log (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at log (server/controllers/authController.js:1759:13)

PASS tests/unit/authControllerCoverage.test.js
  Auth Controller - Additional Coverage Tests Fixed
    handleCustomerSocialCallback - Fixed Tests
      âœ“ should handle existing affiliate trying to register as customer (8 ms)
      âœ“ should handle customer without affiliate (4 ms)
    resetPassword - Fixed Tests
      âœ“ should reset password for administrator (1 ms)
      âœ“ should handle operator password reset attempt (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateModelAdditional.test.js
  Affiliate Model - Additional Coverage
    Payment Method Default
      âœ“ should default payment method to check for social registration (55 ms)
      âœ“ should not set default payment method for traditional registration (57 ms)
      âœ“ should not set default payment method when registrationMethod is not set (56 ms)
    Pre-save hooks
      âœ“ should test password hashing in pre-save hook (106 ms)
      âœ“ should not hash password if passwordHash already exists (84 ms)
      âœ“ should test account number encryption in pre-save hook (99 ms)
      âœ“ should not encrypt non-string values (88 ms)
      âœ“ should not encrypt if fields are not modified (113 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paygistixConfig.test.js
  Paygistix Config
    configuration loading
      âœ“ should load configuration from JSON file when it exists (3 ms)
      âœ“ should handle missing configuration file gracefully
    getEnvironment
      âœ“ should always return production (1 ms)
    getMerchantId
      âœ“ should return merchant ID from config (1 ms)
      âœ“ should return default merchant ID when config is missing (1 ms)
    getFormId
      âœ“ should return form ID from config
      âœ“ should throw error when not configured (10 ms)
    getFormHash
      âœ“ should return form hash from config (1 ms)
      âœ“ should throw error when not configured (1 ms)
    getFormActionUrl
      âœ“ should return configured form action URL from config (1 ms)
      âœ“ should return default URL when not configured (1 ms)
    getReturnUrl
      âœ“ should return default return URL (1 ms)
    isConfigured
      âœ“ should return true when all required config is present (1 ms)
      âœ“ should return false and log error when config is incomplete
    getClientConfig
      âœ“ should return complete client config when properly configured (1 ms)
      âœ“ should throw and log error when config is missing (1 ms)
      âœ“ should set testModeEnabled to false when not configured (1 ms)
    getFullConfig
      âœ“ should return complete config including hash
      âœ“ should throw and log error when config is missing (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/operatorController.test.js
  Operator Controller
    getOrderQueue
      âœ“ should return available orders for operator workstation (2 ms)
      âœ“ should handle order not found in confirmPickup (1 ms)
      âœ“ should handle error in confirmPickup
      âœ“ should handle error in getTodayStats (1 ms)
      âœ“ should handle markOrderReady (deprecated function) (1 ms)
      âœ“ should handle markOrderReady with affiliate notification
      âœ“ should handle errors in markOrderReady (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/createAdminDirectly.test.js
  Create Admin Directly Script Unit Tests
    generateAdminId function
      âœ“ should generate ADM001 when no administrators exist (1 ms)
      âœ“ should generate next sequential ID when administrators exist
      âœ“ should handle double-digit admin IDs correctly (1 ms)
    Permission selection
      âœ“ should handle "all" permission selection
      âœ“ should handle specific permission selection (1 ms)
      âœ“ should filter out invalid permission numbers
    Database operations
      âœ“ should connect to MongoDB successfully
      âœ“ should create administrator with correct data
      âœ“ should handle database save errors
    Email functionality
      âœ“ should send welcome email after admin creation (1 ms)
      âœ“ should handle email sending errors gracefully
    Input validation
      âœ“ should handle empty input fields
      âœ“ should handle whitespace in permission input (1 ms)
    Error handling
      âœ“ should handle MongoDB connection errors
      âœ“ should close database connection in finally block
      âœ“ should close readline interface in finally block

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderModel.test.js
  Order Model - Additional Coverage
    Pre-save Hook Coverage
      SystemConfig Error Handling
        âœ“ should use default base rate when SystemConfig.getValue throws error (305 ms)
      Status Timestamp Updates
        âœ“ should set processingStartedAt timestamp when status changes to processing (221 ms)
        âœ“ should not overwrite existing processingStartedAt timestamp (204 ms)
      Actual Weight and Commission Calculations
        âœ“ should calculate actual total and commission when actual weight is set (204 ms)
        âœ“ should set processedAt timestamp when status changes to processed (211 ms)
        âœ“ should set completedAt timestamp when status changes to complete (206 ms)
        âœ“ should set cancelledAt timestamp when status changes to cancelled (200 ms)
        âœ“ should properly calculate commission with different fee structures (169 ms)
        âœ“ should not overwrite existing timestamps (213 ms)
      Edge Cases
        âœ“ should handle status change to processing (207 ms)
        âœ“ should calculate commission for large orders (171 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Export orders error: Error: Export failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderControllerUncovered.test.js:163:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      871 |     }
      872 |   } catch (error) {
    > 873 |     console.error('Export orders error:', error);
          |             ^
      874 |     res.status(500).json({
      875 |       success: false,
      876 |       message: 'An error occurred while exporting orders'

      at error (server/controllers/orderController.js:873:13)
      at Object.<anonymous> (tests/unit/orderControllerUncovered.test.js:166:7)

PASS tests/unit/orderControllerUncovered.test.js
  Order Controller - Uncovered Functions
    exportOrders
      âœ“ should export orders as CSV (264 ms)
      âœ“ should export orders as Excel (113 ms)
      âœ“ should export orders as JSON by default (105 ms)
      âœ“ should handle export errors (125 ms)
    searchOrders
      âœ“ should search orders by customer name (106 ms)
      âœ“ should search orders without search term (105 ms)
      âœ“ should handle search with no results (105 ms)
      âœ“ should handle search errors (105 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/cspHelper.test.js
  CSP Helper Utilities
    injectNonce
      âœ“ should return original HTML if nonce is not provided (1 ms)
      âœ“ should replace {{CSP_NONCE}} placeholders (1 ms)
      âœ“ should add nonce to script tags without nonce
      âœ“ should not add nonce to script tags that already have nonce
      âœ“ should add nonce to style tags without nonce
      âœ“ should not add nonce to style tags that already have nonce
      âœ“ should add nonce to stylesheet link tags (1 ms)
      âœ“ should not add nonce to non-stylesheet link tags
      âœ“ should update meta tag with name="csp-nonce"
      âœ“ should handle complex HTML with multiple elements (1 ms)
      âœ“ should handle script tags with attributes
      âœ“ should handle style tags with attributes
    readHTMLWithNonce
      âœ“ should read file and inject nonce (1 ms)
      âœ“ should handle file read errors (6 ms)
      âœ“ should pass empty nonce through to injectNonce
    serveHTMLWithNonce
      âœ“ should serve HTML with nonce successfully (1 ms)
      âœ“ should handle errors when serving HTML
      âœ“ should handle missing nonce in res.locals (1 ms)
      âœ“ should construct correct file path

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailService.test.js
  Email Service Mock
    All Email Functions
      âœ“ should have all required email functions mocked (2 ms)
      âœ“ should return expected mock response for all functions (2 ms)
      âœ“ should track function calls correctly
      âœ“ should handle errors when mocked to reject (5 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error creating administrator: Error [ValidationError]: Invalid permission
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:56:31)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      190 |
      191 |   } catch (error) {
    > 192 |     console.error('Error creating administrator:', error);
          |             ^
      193 |
      194 |     // Handle validation errors from model pre-save hooks
      195 |     if (error.name === 'ValidationError') {

      at error (server/controllers/administratorController.js:192:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:62:7)

  console.error
    Error creating administrator: Error: Duplicate key
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:79:30)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34) {
      code: 11000
    }

      190 |
      191 |   } catch (error) {
    > 192 |     console.error('Error creating administrator:', error);
          |             ^
      193 |
      194 |     // Handle validation errors from model pre-save hooks
      195 |     if (error.name === 'ValidationError') {

      at error (server/controllers/administratorController.js:192:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:85:7)

  console.error
    Error deleting administrator: TypeError: Cannot read properties of undefined (reading 'length')
        at length (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:354:27)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:164:7)

      387 |
      388 |   } catch (error) {
    > 389 |     console.error('Error deleting administrator:', error);
          |             ^
      390 |     res.status(500).json({
      391 |       success: false,
      392 |       message: 'Failed to delete administrator'

      at error (server/controllers/administratorController.js:389:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:164:7)

  console.error
    Error fetching dashboard data: Error: Database connection lost
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerAdditional.test.js:225:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1251 |
      1252 |   } catch (error) {
    > 1253 |     console.error('Error fetching dashboard data:', error);
           |             ^
      1254 |     res.status(500).json({
      1255 |       success: false,
      1256 |       message: 'Failed to fetch dashboard data'

      at error (server/controllers/administratorController.js:1253:13)
      at Object.<anonymous> (tests/unit/administratorControllerAdditional.test.js:227:7)

PASS tests/unit/administratorControllerAdditional.test.js
  Administrator Controller - Additional Coverage
    createAdministrator - Error Handling
      âœ“ should handle validation errors from pre-save hooks (358 ms)
      âœ“ should handle duplicate email errors (152 ms)
    updateAdministrator - Edge Cases
      âœ“ should prevent self-deactivation (103 ms)
      âœ“ should handle administrator not found (103 ms)
    deleteAdministrator - Error Cases
      âœ“ should prevent deleting the last administrator with full permissions (118 ms)
      âœ“ should handle deletion errors (124 ms)
    getDashboard - Complex Scenarios
      âœ“ should handle empty analytics data (107 ms)
      âœ“ should handle database errors gracefully (104 ms)
    getOrderAnalytics - Date Range Handling
      âœ“ should handle custom date range (102 ms)
      âœ“ should handle invalid date format (103 ms)
    Helper Functions
      âœ“ should export updateOperatorStats function (105 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/affiliateDashboardInit.test.js (5.417 s)
  Affiliate Dashboard Customer Filtering
    URL Parameter Detection Logic
      âœ“ should detect customer parameter from URL search params (1 ms)
      âœ“ should handle URL without customer parameter
      âœ“ should parse customer parameter from complex URL (1 ms)
      âœ“ should handle regex pattern matching for customer parameter
    Customer Highlighting Logic
      âœ“ should identify highlighted customer correctly
      âœ“ should generate correct CSS classes for highlighted customer (1 ms)
      âœ“ should generate correct HTML content for highlighted customer
      âœ“ should not highlight non-matching customers
    Tab Switching Logic
      âœ“ should determine correct tab activation based on customer parameter
      âœ“ should not switch tabs when no customer parameter (1 ms)
      âœ“ should handle empty string customer parameter
    Authentication Check Logic
      âœ“ should identify authenticated state correctly
      âœ“ should identify unauthenticated state when missing token
      âœ“ should identify unauthenticated state when missing affiliate
    Customer Data Processing
      âœ“ should handle empty customer list (1 ms)
      âœ“ should process customer list without filtering
      âœ“ should filter customer list by customer ID
    URL Construction and Validation
      âœ“ should construct API URLs correctly (1 ms)
      âœ“ should validate customer ID format
    Timing and Delays
      âœ“ should calculate correct delay for tab switching
      âœ“ should handle immediate execution when no customer parameter

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.test.js
  Payment Routes
    Static Routes
      GET /api/v1/payments/config
        âœ“ should return payment configuration (12 ms)
      POST /api/v1/payments/log-submission
        âœ“ should log payment submission (8 ms)
      POST /api/v1/payments/create-token
        âœ“ should create payment token (3 ms)
      GET /api/v1/payments/check-status/:token
        âœ“ should check payment status (2 ms)
      POST /api/v1/payments/cancel-token/:token
        âœ“ should cancel payment token (2 ms)
      POST /api/v1/payments/update-status/:token
        âœ“ should update payment status (3 ms)
      GET /api/v1/payments/pool-stats
        âœ“ should return pool statistics (2 ms)
    Dynamic Callback Routes
      âœ“ should handle GET callback routes (2 ms)
      âœ“ should handle POST callback routes (2 ms)
      âœ“ should handle multiple callback paths (4 ms)
    Error Handling
      âœ“ should handle controller errors gracefully (1 ms)
      âœ“ should handle missing routes with 404 (2 ms)
      âœ“ should handle JSON parsing errors (2 ms)
    Request Validation
      âœ“ should pass through request headers (2 ms)
      âœ“ should handle empty request bodies (13 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/fieldFilterWdfCredit.test.js
  Field Filter WDF Credit Support
    Customer WDF Credit Fields
      âœ“ should include WDF credit fields for customer viewing own profile (3 ms)
      âœ“ should include WDF credit fields for affiliate viewing customer
      âœ“ should include WDF credit fields for admin viewing customer (1 ms)
      âœ“ should NOT include WDF credit for public access (1 ms)
      âœ“ should NOT include WDF credit for other customers (2 ms)
    Order WDF Credit Fields
      âœ“ should include WDF fields for customer viewing own order (1 ms)
      âœ“ should include WDF fields for affiliate viewing order (1 ms)
      âœ“ should include WDF fields for admin viewing order
    Field Definition Verification
      âœ“ should have WDF credit fields defined in customer field definitions (1 ms)
      âœ“ should have WDF credit fields defined in order field definitions (5 ms)
    Array Filtering
      âœ“ should filter WDF credit fields in customer arrays (1 ms)
      âœ“ should filter WDF credit fields in order arrays (1 ms)
    Edge Cases
      âœ“ should handle null/undefined WDF credit values (1 ms)
      âœ“ should handle zero WDF credit values

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/errorHandler.test.js
  Error Handler Middleware
    errorHandler
      âœ“ should handle generic errors with 500 status (10 ms)
      âœ“ should handle custom status codes (1 ms)
      âœ“ should handle Mongoose validation errors (1 ms)
      âœ“ should handle MongoDB duplicate key errors
      âœ“ should handle JWT errors (1 ms)
      âœ“ should handle JWT token expiration errors
      âœ“ should handle rate limiting errors (1 ms)
      âœ“ should handle CastError (invalid MongoDB ObjectId)
      âœ“ should include user context when available
      âœ“ should handle errors with customer context (1 ms)
      âœ“ should hide error details in production
      âœ“ should show error details in development
      âœ“ should use original message for non-500 errors in production (1 ms)
      âœ“ should handle errors without message (1 ms)
      âœ“ should handle errors with code property
      âœ“ should log all console error sections (1 ms)
    AppError
      âœ“ should create custom error with status code (1 ms)
      âœ“ should have stack trace
      âœ“ should work with error handler (1 ms)
    Edge cases
      âœ“ should handle null error (2 ms)
      âœ“ should handle undefined error (1 ms)
      âœ“ should handle non-error objects
      âœ“ should handle errors thrown from within error handler (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderWithSystemConfig.test.js (11.225 s)
  Order Model with SystemConfig Integration
    Dynamic WDF Pricing
      âœ“ should fetch base rate from SystemConfig on order creation (926 ms)
      âœ“ should use default rate when SystemConfig is not available (1126 ms)
      âœ“ should calculate estimated total using SystemConfig rate (780 ms)
      âœ“ should calculate actual total using SystemConfig rate (756 ms)
    Commission Calculations
      âœ“ should calculate affiliate commission correctly with custom WDF rate (772 ms)
      âœ“ should calculate commission for zero delivery fee (762 ms)
      âœ“ should handle commission calculation for large orders (756 ms)
    Edge Cases
      âœ“ should handle commission when only estimated size is available (762 ms)
      âœ“ should update calculations when base rate changes (900 ms)
      âœ“ should validate minimum and maximum base rates (1064 ms)
    Revenue Calculator Scenarios
      âœ“ should match revenue calculator example - 10 customers scenario (1312 ms)
      âœ“ should match revenue calculator with different parameters (773 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentLinkService.test.js (7.672 s)
  PaymentLinkService
    generatePaymentLinks
      âœ“ should generate payment links for all providers (1874 ms)
      âœ“ should handle decimal amounts correctly (1634 ms)
      âœ“ should handle short order IDs (1656 ms)
    generateVenmoLink
      âœ“ should generate correct Venmo deep link (200 ms)
      âœ“ should handle @ symbol in handle (118 ms)
    generatePayPalLink
      âœ“ should generate correct PayPal.me link (195 ms)
    generateCashAppLink
      âœ“ should generate correct CashApp link (201 ms)
      âœ“ should add $ symbol if missing (119 ms)
    translations
      âœ“ should provide translations for all supported languages (126 ms)
      âœ“ should default to English for unsupported languages (123 ms)
      âœ“ should generate Spanish payment buttons HTML (120 ms)
      âœ“ should generate Portuguese QR codes HTML (117 ms)
      âœ“ should generate German payment buttons HTML (123 ms)
    HTML generation
      âœ“ should generate valid payment buttons HTML (124 ms)
      âœ“ should generate valid QR codes HTML (115 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/facebookUtils.test.js
  Facebook Utils
    parseSignedRequest
      âœ“ should parse valid signed request (1 ms)
      âœ“ should return null for invalid signature
      âœ“ should return null for malformed signed request (1 ms)
      âœ“ should return null when missing parameters
      âœ“ should handle invalid JSON in payload
    base64UrlDecode
      âœ“ should decode base64 URL encoded strings
      âœ“ should handle strings without padding
      âœ“ should handle strings with URL-safe characters
    generateStatusUrl
      âœ“ should generate correct status URL
      âœ“ should handle base URL with trailing slash
      âœ“ should handle base URL with path
    deleteFacebookData
      âœ“ should delete all Facebook data from user (1 ms)
      âœ“ should handle user without Facebook data
      âœ“ should handle user without socialAccounts (1 ms)
      âœ“ should only update registration method if it was facebook
    findUsersByFacebookId
      âœ“ should find both affiliate and customer (1 ms)
      âœ“ should handle when only affiliate exists
      âœ“ should handle when no users exist
    anonymizeUserData
      âœ“ should anonymize all user data (1 ms)
      âœ“ should handle user with partial data
      âœ“ should handle user with no personal data (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentRoutes.full.test.js
  Payment Routes - Full Coverage
    Dynamic Route Loading
      âœ“ should load dynamic callback routes when not in test environment (21 ms)
      âœ“ should handle GET requests on dynamic callback routes (32 ms)
      âœ“ should handle POST requests on dynamic callback routes (24 ms)
      âœ“ should handle errors when loading config file (20 ms)
      âœ“ should handle invalid JSON in config file (33 ms)
      âœ“ should skip dynamic route loading in test environment (19 ms)
    Static Routes
      âœ“ should handle GET /config (31 ms)
      âœ“ should handle POST /log-submission (23 ms)
      âœ“ should handle POST /create-token (31 ms)
      âœ“ should handle GET /check-status/:token (24 ms)
      âœ“ should handle POST /cancel-token/:token (36 ms)
      âœ“ should handle POST /update-status/:token (26 ms)
      âœ“ should handle GET /pool-stats (32 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] Google callback: {
      error: null,
      user: 'exists',
      userObject: { id: '12345', email: 'test@example.com', provider: 'google' },
      isExistingAffiliate: undefined,
      info: null
    }

      at log (server/routes/socialAuthRoutes.js:40:13)

PASS tests/unit/socialAuthRoutes.full.test.js
  Social Auth Routes - Full Coverage
    Google OAuth Routes
      âœ“ should initiate Google OAuth when configured (64 ms)
      âœ“ should return 404 when Google OAuth is not configured (53 ms)
      âœ“ should handle Google OAuth callback (65 ms)
      âœ“ should pass state parameter through OAuth (58 ms)
    Facebook OAuth Routes
      âœ“ should initiate Facebook OAuth when configured (68 ms)
      âœ“ should return 404 when Facebook OAuth is not configured (65 ms)
    LinkedIn OAuth Routes
      âœ“ should return 404 as LinkedIn OAuth is not implemented (125 ms)
    Customer OAuth Routes
      âœ“ should initiate Google OAuth for customers (43 ms)
      âœ“ should redirect customer Google OAuth callback (48 ms)
      âœ“ should handle customer Facebook OAuth callback (39 ms)
      âœ“ should initiate Facebook OAuth for customers (45 ms)
      âœ“ should return 404 when Facebook OAuth is not configured for customers (37 ms)
      âœ“ should return 404 as LinkedIn OAuth is not implemented for customers (41 ms)
      âœ“ should return 404 for LinkedIn OAuth regardless of configuration (62 ms)
      âœ“ should return 404 for customer LinkedIn OAuth callback (42 ms)
    Social Registration Completion
      âœ“ should complete affiliate social registration (54 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/tokenBlacklist.test.js
  TokenBlacklist Model
    Schema Validation
      âœ“ should create a valid token blacklist entry (126 ms)
      âœ“ should use default values for blacklistedAt and reason (120 ms)
      âœ“ should require all mandatory fields (77 ms)
      âœ“ should enforce unique token constraint (271 ms)
      âœ“ should validate userType enum (76 ms)
      âœ“ should accept all valid userTypes (207 ms)
    Static Methods
      blacklistToken
        âœ“ should successfully blacklist a token (112 ms)
        âœ“ should use default reason when not provided (115 ms)
        âœ“ should return null when token already blacklisted (407 ms)
        âœ“ should handle custom reasons (117 ms)
        âœ“ should propagate non-duplicate errors (85 ms)
      isBlacklisted
        âœ“ should return true for blacklisted token (144 ms)
        âœ“ should return false for non-blacklisted token (119 ms)
        âœ“ should handle empty token (136 ms)
        âœ“ should handle null token (104 ms)
      cleanupExpired
        âœ“ should delete expired tokens (239 ms)
        âœ“ should return 0 when no expired tokens (199 ms)
        âœ“ should handle empty collection (101 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error resetting rate limits: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/simpleRouteHandlers.test.js:153:40)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      88 |           
      89 |         } catch (error) {
    > 90 |           console.error('Error resetting rate limits:', error);
         |                   ^
      91 |           res.status(500).json({
      92 |             success: false,
      93 |             message: 'Error resetting rate limits'

      at error (tests/unit/simpleRouteHandlers.test.js:90:19)

  console.error
    Error serving documentation with nonce: Error: Processing error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/simpleRouteHandlers.test.js:272:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      42 |     res.type('html').send(html);
      43 |   } catch (error) {
    > 44 |     console.error('Error serving documentation with nonce:', error);
         |             ^
      45 |     next(error);
      46 |   }
      47 | };

      at error (server/routes/docsRoutes.js:44:13)

PASS tests/unit/simpleRouteHandlers.test.js
  Simple Route Handlers
    Administrator Rate Limit Reset
      âœ“ should reset all rate limits when no filters provided (10 ms)
      âœ“ should reset rate limits by type filter (4 ms)
      âœ“ should reset rate limits by IP filter (3 ms)
      âœ“ should handle database errors (18 ms)
    Documentation Serving with CSP Nonce
      âœ“ should serve HTML files with CSP nonce (7 ms)
      âœ“ should default to index.html for root path (2 ms)
      âœ“ should skip nonce injection for example files (3 ms)
      âœ“ should skip non-HTML files (3 ms)
      âœ“ should handle non-existent files (2 ms)
      âœ“ should handle errors during file processing (3 ms)
    Basic Auth Route Handlers
      âœ“ should handle successful authentication (2 ms)
      âœ“ should handle missing credentials (3 ms)
      âœ“ should handle invalid credentials (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/orderAddOns.test.js
  Order Model - Add-on Functionality
    Add-on Total Calculations
      âœ“ should calculate add-on total correctly with one add-on selected (309 ms)
      âœ“ should calculate add-on total correctly with multiple add-ons selected (142 ms)
      âœ“ should calculate zero add-on total when no add-ons selected (144 ms)
      âœ“ should handle missing add-ons object gracefully (149 ms)
      âœ“ should recalculate add-on total when weight changes (185 ms)
      âœ“ should use actual weight for add-on calculation when available (142 ms)
    Add-on Impact on Totals and Commission
      âœ“ should include add-ons in estimated total but not in commission (156 ms)
      âœ“ should correctly calculate totals with add-ons and WDF credit (160 ms)
      âœ“ should handle all edge cases for add-on calculations (198 ms)
    Add-on Default Values
      âœ“ should have default false values for all add-ons when not specified (159 ms)
    Add-on Updates
      âœ“ should recalculate totals when add-ons are modified (305 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/validators.test.js
  Validators
    isValidEmail
      âœ“ should validate correct email addresses (2 ms)
      âœ“ should reject invalid email addresses (1 ms)
    isValidPhone
      âœ“ should validate correct US phone numbers (1 ms)
      âœ“ should reject invalid phone numbers
    isValidUsername
      âœ“ should validate correct usernames (1 ms)
      âœ“ should reject invalid usernames
    isValidZipCode
      âœ“ should validate correct US zip codes (1 ms)
      âœ“ should reject invalid zip codes
    isValidTimeFormat
      âœ“ should validate correct time formats (1 ms)
      âœ“ should reject invalid time formats (1 ms)
    isValidName
      âœ“ should validate correct names
      âœ“ should reject invalid names (1 ms)
    mongooseValidators
      âœ“ should provide email validator
      âœ“ should provide phone validator (1 ms)
      âœ“ should provide username validator
      âœ“ should provide zipCode validator
      âœ“ should provide timeFormat validator
      âœ“ should provide name validator
    expressValidators
      âœ“ should provide email validator function
      âœ“ should provide phone validator function
      âœ“ should provide username validator function
      âœ“ should provide zipCode validator function
      âœ“ should provide timeFormat validator function
      âœ“ should provide name validator function
    Client-side validation functions
      validateEmail
        âœ“ should return validation result for emails (1 ms)
      validatePhone
        âœ“ should return validation result for phones
      validateUsername
        âœ“ should return validation result for usernames
      validateZipCode
        âœ“ should return validation result for zip codes (1 ms)
      validateTimeFormat
        âœ“ should return validation result for time formats
      validateName
        âœ“ should return validation result for names (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /critical-files

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/critical-files.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /test-templates

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/test-templates.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /action-plan

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/action-plan.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /non-existent-page

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /index.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /action-plan.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /critical-files.html

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /missing

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

  console.log
    [Coverage Route] GET /

      at log (server/routes/coverageRoutes.js:86:11)

  console.log
    [CSP] Serving HTML with nonce: coverage-analysis/index.html, nonce: undefined

      at log (server/utils/cspHelper.js:70:15)

PASS tests/unit/coverageRoutes.test.js
  Coverage Routes
    Access Control Middleware
      âœ“ should allow access in development environment (22 ms)
      âœ“ should allow access in test environment (7 ms)
      âœ“ should deny access in production without key (1 ms)
      âœ“ should allow access in production with valid key (6 ms)
      âœ“ should deny access in production with invalid key (3 ms)
    Embedded Access Prevention
      âœ“ should deny access when Sec-Fetch-Dest is iframe (2 ms)
      âœ“ should deny access when X-Frame-Options is present (2 ms)
      âœ“ should deny access when referer contains /embed (2 ms)
      âœ“ should allow access with normal referer (11 ms)
    Route Handlers
      âœ“ should serve index.html at root path (5 ms)
      âœ“ should serve critical-files page (5 ms)
      âœ“ should serve test-templates page (6 ms)
      âœ“ should serve action-plan page (5 ms)
      âœ“ should return 404 for non-existent pages (5 ms)
    Static File Headers
      âœ“ should set no-cache headers for static files (6 ms)
      âœ“ should set no-cache headers for HTML files (4 ms)
      âœ“ should set no-cache headers for other HTML files (5 ms)
    Environment Variable Handling
      âœ“ should handle missing COVERAGE_ACCESS_KEY (2 ms)
      âœ“ should handle empty COVERAGE_ACCESS_KEY (11 ms)
    Multiple Middleware Interaction
      âœ“ should check embedded access before access control (2 ms)
      âœ“ should apply X-Frame-Options even with valid access (5 ms)
    HTML Response Validation
      âœ“ should return valid HTML for access denied page (2 ms)
      âœ“ should return valid HTML for 404 page (5 ms)
    Query Parameter Handling
      âœ“ should ignore extra query parameters (5 ms)
      âœ“ should handle URL-encoded keys (7 ms)
    Edge Cases
      âœ“ should handle root path without trailing slash (6 ms)
      âœ“ should handle specific route handlers (8 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error creating administrator: Error [ValidationError]: Invalid permission: invalid_permission
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerUncovered.test.js:50:31)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      190 |
      191 |   } catch (error) {
    > 192 |     console.error('Error creating administrator:', error);
          |             ^
      193 |
      194 |     // Handle validation errors from model pre-save hooks
      195 |     if (error.name === 'ValidationError') {

      at Object.error [as createAdministrator] (server/controllers/administratorController.js:192:13)
      at Object.<anonymous> (tests/unit/administratorControllerUncovered.test.js:71:7)

  console.error
    Error creating administrator: Error: E11000 duplicate key error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerUncovered.test.js:89:30)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34) {
      code: 11000
    }

      190 |
      191 |   } catch (error) {
    > 192 |     console.error('Error creating administrator:', error);
          |             ^
      193 |
      194 |     // Handle validation errors from model pre-save hooks
      195 |     if (error.name === 'ValidationError') {

      at Object.error [as createAdministrator] (server/controllers/administratorController.js:192:13)
      at Object.<anonymous> (tests/unit/administratorControllerUncovered.test.js:110:7)

PASS tests/unit/administratorControllerUncovered.test.js
  Administrator Controller - Uncovered Functions
    createAdministrator - Additional Error Cases
      âœ“ should handle pre-save validation errors (266 ms)
      âœ“ should handle duplicate email error (11000) (116 ms)
    deleteAdministrator - Last Admin Check
      âœ“ should prevent deleting the last administrator with full permissions (106 ms)
    getDashboard - All Statistics
      âœ“ should return dashboard with all statistics (105 ms)
    getOrderAnalytics - With Date Filters
      âœ“ should handle date range in analytics (104 ms)
    exportReport - Different Formats
      âœ“ should export orders report (101 ms)
      âœ“ should handle invalid report type (101 ms)
    getAffiliatesList - With Filters
      âœ“ should get filtered affiliates list (102 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/modelMethods.test.js (5.195 s)
  Model Methods
    Administrator Model
      setPassword method
        âœ“ should set password hash and salt for new admin (499 ms)
        âœ“ should add previous password to history when changing password (329 ms)
        âœ“ should keep only last 5 passwords in history (263 ms)
        âœ“ should handle undefined password history (267 ms)
    Operator Model
      isPasswordInHistory method
        âœ“ should return false when no password history exists (210 ms)
        âœ“ should return false when password history is empty (203 ms)
        âœ“ should return true when password exists in history (300 ms)
        âœ“ should return false when password does not exist in history (319 ms)
        âœ“ should check multiple passwords in history (595 ms)
    Payment Model
      pre-save middleware
        âœ“ should prevent modification of paygistixId after creation (207 ms)
        âœ“ should prevent modification of orderId after creation (203 ms)
        âœ“ should allow modification of other fields (204 ms)
    DataDeletionRequest Model
      markAsFailed method
        âœ“ should mark request as failed with errors (205 ms)
        âœ“ should mark request as failed without errors (208 ms)
      findStaleRequests static method
        âœ“ should find pending requests older than default 24 hours (203 ms)
        âœ“ should find pending requests older than specified hours (205 ms)
        âœ“ should handle zero hours parameter (205 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [AddressValidationService] Validating address: { city: 'Austin', state: 'TX', zipCode: '78701' }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Validating address: { address: '123 Main Street', state: 'TX', zipCode: '78701' }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Validating address: { address: '123 Main Street', city: 'Austin', zipCode: '78701' }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Validating address: { address: '123 Main Street', city: 'Austin', state: 'TX' }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '1234'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: 'ABCDE'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78701'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78701, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78701'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78701, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.log
    [AddressValidationService] Trying simplified query: 123 Main Street 78701

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:76:17)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78701'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78701, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.log
    [AddressValidationService] Trying simplified query: 123 Main Street 78701

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:76:17)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78701'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78701, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.log
    [AddressValidationService] ZIP code mismatch: expected 78701, got 78702

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:106:17)

  console.log
    [AddressValidationService] ZIP codes are in same area (787xxx), allowing validation

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:121:17)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78705'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78705, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.log
    [AddressValidationService] ZIP code mismatch: expected 78705, got 78702

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:106:17)

  console.log
    [AddressValidationService] ZIP codes are in same area (787xxx), allowing validation

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:121:17)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78701'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78701, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.log
    [AddressValidationService] House number mismatch: expected 123, got 456

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:128:17)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78701'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78701, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.error
    [AddressValidationService] Geocoding error: { response: { status: 429 } }

      143 |
      144 |     } catch (error) {
    > 145 |       console.error('[AddressValidationService] Geocoding error:', error);
          |               ^
      146 |       
      147 |       // Check if it's a rate limit error
      148 |       if (error.response && error.response.status === 429) {

      at AddressValidationService.error [as validateAddress] (server/services/addressValidationService.js:145:15)
      at Object.<anonymous> (tests/unit/addressValidationService.test.js:210:22)

  console.log
    [AddressValidationService] Validating address: {
      address: '123 Main Street',
      city: 'Austin',
      state: 'TX',
      zipCode: '78701'
    }

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:24:13)

  console.log
    [AddressValidationService] Trying full geocoding query: 123 Main Street, Austin, TX 78701, USA

      at AddressValidationService.log [as validateAddress] (server/services/addressValidationService.js:55:15)

  console.error
    [AddressValidationService] Geocoding error: Error: Network error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/addressValidationService.test.js:217:35)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      143 |
      144 |     } catch (error) {
    > 145 |       console.error('[AddressValidationService] Geocoding error:', error);
          |               ^
      146 |       
      147 |       // Check if it's a rate limit error
      148 |       if (error.response && error.response.status === 429) {

      at AddressValidationService.error [as validateAddress] (server/services/addressValidationService.js:145:15)
      at Object.<anonymous> (tests/unit/addressValidationService.test.js:219:22)

FAIL tests/unit/addressValidationService.test.js
  AddressValidationService
    validateAddress
      âœ“ should return invalid if address is missing (10 ms)
      âœ“ should return invalid if city is missing (1 ms)
      âœ“ should return invalid if state is missing (1 ms)
      âœ“ should return invalid if zipCode is missing (1 ms)
      âœ“ should return invalid for invalid ZIP code format (1 ms)
      âœ“ should return invalid for non-numeric ZIP code (1 ms)
      âœ“ should successfully validate a complete address (9 ms)
      âœ“ should try simplified query if full query returns no results (2 ms)
      âœ“ should return invalid when no geocoding results found (2 ms)
      âœ• should return invalid for ZIP code mismatch (3 ms)
      âœ“ should allow ZIP codes in the same general area (same prefix) (3 ms)
      âœ“ should return invalid for house number mismatch (2 ms)
      âœ“ should handle rate limit errors (2 ms)
      âœ“ should handle general geocoding errors (3 ms)
    validateAddressFormat
      âœ“ should reject empty address
      âœ“ should reject very short address
      âœ“ should reject address without house number
      âœ“ should accept valid address with house number
      âœ“ should accept address with letter suffix on house number
      âœ“ should reject house number zero
      âœ“ should reject house number too large
      âœ“ should reject address with too short street name (1 ms)
      âœ“ should reject incomplete address (just street type)
      âœ“ should reject incomplete address (just "Ave")
    formatAddress
      âœ“ should format address correctly
    isWithinServiceArea
      âœ“ should return true if location is within service area (1 ms)
      âœ“ should return false if location is outside service area
    calculateDistance
      âœ• should calculate distance between two points (1 ms)
      âœ“ should return 0 for same location
    toRad
      âœ“ should convert degrees to radians (1 ms)
      âœ“ should convert 0 degrees to 0 radians
      âœ“ should convert 90 degrees to Ï€/2 radians

  â— AddressValidationService â€º validateAddress â€º should return invalid for ZIP code mismatch

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      155 |       const result = await addressValidationService.validateAddress(validAddressData);
      156 |
    > 157 |       expect(result.valid).toBe(false);
          |                            ^
      158 |       expect(result.message).toContain('does not match the provided zip code');
      159 |     });
      160 |

      at Object.toBe (tests/unit/addressValidationService.test.js:157:28)

  â— AddressValidationService â€º calculateDistance â€º should calculate distance between two points

    expect(received).toBeGreaterThan(expected)

    Expected: > 190
    Received:   182.13206606439326

      342 |       );
      343 |
    > 344 |       expect(distance).toBeGreaterThan(190);
          |                        ^
      345 |       expect(distance).toBeLessThan(200);
      346 |     });
      347 |

      at Object.toBeGreaterThan (tests/unit/addressValidationService.test.js:344:24)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/emailServiceAdditional.test.js
  Email Service - Additional Coverage
    Affiliate Commission Email
      âœ“ should send affiliate commission email successfully (6 ms)
      âœ“ should handle email sending error (4 ms)
    Customer Password Reset Email
      âœ“ should send customer password reset email (4 ms)
    Administrator Emails
      âœ“ should send administrator welcome email with language support (4 ms)
      âœ“ should send administrator password reset email (4 ms)
    Operator Emails
      âœ“ should send operator PIN reset email (4 ms)
      âœ“ should send operator shift reminder email (4 ms)
    System Alerts
      âœ“ should send service down alert to multiple admins (4 ms)
      âœ“ should handle service alert with minimal details (6 ms)
    Template Loading Errors
      âœ“ should handle template file read errors (6 ms)
    Console Email Provider
      âœ“ should log emails to console when using console provider (7 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/controllersAdditional.test.js
  Controllers - Additional Function Coverage
    Order Controller - Additional Functions
      searchOrders - Additional Cases
        â—‹ skipped should handle search with affiliate filter
        â—‹ skipped should handle empty search query
      exportOrders - Edge Cases
        âœ“ should handle export with date filters (256 ms)
      getOrderStatistics - Various Scenarios
        âœ“ should get order statistics with time range (114 ms)
        âœ“ should handle statistics for affiliate user (105 ms)
    Affiliate Controller - Additional Functions
      getAffiliateDashboardStats - Edge Cases
        âœ“ should handle empty statistics (105 ms)
        âœ“ should handle date range filters (104 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/encryptionEnhanced.test.js
  Encryption Utility - Enhanced Coverage
    Encryption Error Paths
      âœ“ should return null for falsy inputs (1 ms)
      âœ“ should throw error with invalid encryption key length (14 ms)
      âœ“ should throw error when encryption key is missing (1 ms)
      âœ“ should handle crypto errors gracefully
    Decryption Error Paths
      âœ“ should return null for falsy inputs (1 ms)
      âœ“ should throw error with invalid encrypted object structure (1 ms)
      âœ“ should throw error with tampered data (1 ms)
      âœ“ should throw error with wrong encryption key (1 ms)
      âœ“ should handle corrupted encrypted data
    Password Hashing Error Paths
      âœ“ should handle crypto.randomBytes failure (1 ms)
      âœ“ should handle crypto.pbkdf2Sync failure (1 ms)
      âœ“ should handle empty password (48 ms)
    Password Verification Error Paths
      âœ“ should throw error when pbkdf2Sync fails (1 ms)
      âœ“ should handle invalid inputs gracefully (151 ms)
      âœ“ should return false for invalid salt format (48 ms)
    Token and Barcode Generation
      âœ“ should generate tokens of correct length
      âœ“ should generate unique tokens (1 ms)
      âœ“ should handle token generation errors (1 ms)
      âœ“ should generate barcodes with correct format (1 ms)
      âœ“ should generate unique barcodes
      âœ“ should handle barcode generation errors (1 ms)
    Edge Cases and Security Tests
      âœ“ should handle large data encryption/decryption (4 ms)
      âœ“ should handle unicode and special characters (1 ms)
      âœ“ should produce different IVs for same input (2 ms)
      âœ“ should validate encryption output structure (6 ms)
      âœ“ should handle password edge cases (1162 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Get new customers count error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/operatorController.bagLabels.test.js:74:49)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1767 |     });
      1768 |   } catch (error) {
    > 1769 |     console.error('Get new customers count error:', error);
           |             ^
      1770 |     res.status(500).json({ 
      1771 |       success: false,
      1772 |       message: 'Error fetching new customers count' 

      at error (server/controllers/operatorController.js:1769:13)
      at Object.<anonymous> (tests/unit/operatorController.bagLabels.test.js:77:7)

PASS tests/unit/operatorController.bagLabels.test.js
  Operator Controller - Bag Label Printing
    getNewCustomersCount
      âœ“ should return count of customers without bag labels (465 ms)
      âœ“ should return zero when no new customers (218 ms)
      âœ“ should handle database error (240 ms)
    printNewCustomerLabels
      âœ“ should generate labels for all new customers (205 ms)
      âœ“ should handle no new customers (204 ms)
      âœ“ should handle customer with zero bags (221 ms)
      âœ“ should handle database error during find (215 ms)
      âœ“ should handle customers with missing names (203 ms)
      âœ“ should generate correct number of labels for each customer (203 ms)
      âœ“ should handle undefined numberOfBags (203 ms)
    Customer Model bagLabels fields
      âœ“ should have correct schema fields (208 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching public configs: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:88:55)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      21 |     res.json(formattedConfigs);
      22 |   } catch (error) {
    > 23 |     console.error('Error fetching public configs:', error);
         |             ^
      24 |     res.status(500).json({ error: 'Failed to fetch public configurations' });
      25 |   }
      26 | });

      at error (server/routes/systemConfigRoutes.js:23:13)

  console.error
    Error fetching config: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:141:46)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      47 |     });
      48 |   } catch (error) {
    > 49 |     console.error('Error fetching config:', error);
         |             ^
      50 |     res.status(500).json({ error: 'Failed to fetch configuration' });
      51 |   }
      52 | });

      at error (server/routes/systemConfigRoutes.js:49:13)

  console.error
    Error fetching configs: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:190:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      70 |     res.json(configs);
      71 |   } catch (error) {
    > 72 |     console.error('Error fetching configs:', error);
         |             ^
      73 |     res.status(500).json({ error: 'Failed to fetch configurations' });
      74 |   }
      75 | });

      at error (server/routes/systemConfigRoutes.js:72:13)

  console.error
    Error updating config: Error: Invalid value
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:333:47)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

  console.error
    Error initializing configs: Error: Init failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/systemConfigRoutes.test.js:359:57)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      103 |     res.json({ message: 'Default configurations initialized' });
      104 |   } catch (error) {
    > 105 |     console.error('Error initializing configs:', error);
          |             ^
      106 |     res.status(500).json({ error: 'Failed to initialize configurations' });
      107 |   }
      108 | });

      at error (server/routes/systemConfigRoutes.js:105:13)

PASS tests/unit/systemConfigRoutes.test.js
  System Config Routes
    GET /api/system-config/public
      âœ“ should return public configurations (14 ms)
      âœ“ should handle errors when fetching public configs (4 ms)
    GET /api/system-config/public/:key
      âœ“ should return specific public configuration (2 ms)
      âœ“ should return 404 for non-existent public config (2 ms)
      âœ“ should handle errors when fetching specific config (2 ms)
    GET /api/system-config (authenticated)
      âœ“ should return all configurations for admin (2 ms)
      âœ“ should filter configurations by category (2 ms)
      âœ“ should handle errors when fetching all configs (2 ms)
      âœ“ should require authentication (2 ms)
      âœ“ should require administrator role (51 ms)
    PUT /api/system-config/:key
      âœ“ should update configuration value (11 ms)
      âœ“ should require system_config permission (53 ms)
      âœ“ should handle validation errors (4 ms)
    POST /api/system-config/initialize
      âœ“ should initialize default configurations (4 ms)
      âœ“ should handle errors during initialization (12 ms)
      âœ“ should require authentication and admin role (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching test customer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:107:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      70 |         res.json(customer);
      71 |     } catch (error) {
    > 72 |         console.error('Error fetching test customer:', error);
         |                 ^
      73 |         res.status(500).json({ error: 'Failed to fetch test customer' });
      74 |     }
      75 | });

      at error (server/routes/testRoutes.js:72:17)

  console.error
    Error creating test customer: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:212:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      175 |         res.json(customer);
      176 |     } catch (error) {
    > 177 |         console.error('Error creating test customer:', error);
          |                 ^
      178 |         res.status(500).json({ error: 'Failed to create test customer' });
      179 |     }
      180 | });

      at error (server/routes/testRoutes.js:177:17)

  console.error
    Error creating test order: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:322:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      276 |         res.json(order);
      277 |     } catch (error) {
    > 278 |         console.error('Error creating test order:', error);
          |                 ^
      279 |         res.status(500).json({ error: 'Failed to create test order: ' + error.message });
      280 |     }
      281 | });

      at error (server/routes/testRoutes.js:278:17)

  console.error
    Error cleaning up test data: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/testRoutes.test.js:352:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      507 |         res.json({ message: 'Test data cleaned up successfully' });
      508 |     } catch (error) {
    > 509 |         console.error('Error cleaning up test data:', error);
          |                 ^
      510 |         res.status(500).json({ error: 'Failed to cleanup test data' });
      511 |     }
      512 | });

      at error (server/routes/testRoutes.js:509:17)

PASS tests/unit/testRoutes.test.js
  Test Routes
    testOnlyMiddleware
      âœ“ should allow access in test environment (7 ms)
      âœ“ should block access in production without ENABLE_TEST_ROUTES (2 ms)
      âœ“ should allow access in production with ENABLE_TEST_ROUTES (2 ms)
    GET /api/test/customer
      âœ“ should return existing test customer (2 ms)
      âœ“ should return 404 when test customer not found (1 ms)
      âœ“ should handle database errors (12 ms)
    POST /api/test/customer
      âœ“ should return existing customer if already exists (54 ms)
      âœ“ should create new customer and affiliate if not exists (98 ms)
      âœ“ should use existing affiliate if already exists (98 ms)
      âœ“ should handle database errors (3 ms)
    POST /api/test/order
      âœ“ should create order for specified customer (2 ms)
      âœ“ should find test customer by email if customerId not provided (2 ms)
      âœ“ should delete existing test orders when recreate is true (2 ms)
      âœ“ should return 400 when customer not found (1 ms)
      âœ“ should handle database errors (3 ms)
    DELETE /api/test/cleanup
      âœ“ should delete all test data (9 ms)
      âœ“ should handle database errors during cleanup (4 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:08:27.113Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/customerDashboardWdfCredit.test.js (6.689 s)
  Customer Dashboard WDF Credit Display
    Dashboard Stats with WDF Credit
      âœ“ should include WDF credit information in dashboard response (968 ms)
      âœ“ should show zero WDF credit for new customers (580 ms)
      âœ“ should show negative WDF credit (debit) correctly (607 ms)
      âœ“ should include both bag credit and WDF credit (633 ms)
    Dashboard with Order History
      âœ“ should show WDF credit alongside order statistics (688 ms)
    Access Control
      âœ“ should allow affiliates to see customer WDF credit (628 ms)
      âœ“ should allow admins to see any customer WDF credit (632 ms)
      â—‹ skipped should not allow unrelated affiliates to see customer WDF credit
    Edge Cases
      âœ“ should handle null WDF credit fields gracefully (598 ms)
      âœ“ should handle very small WDF credit amounts (601 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'customer_12345' },
      headers: {},
      state: 'customer_12345',
      stateStartsWithCustomer: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_12345',
      isCustomerRequest: true,
      willDelegate: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:997:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_123' },
      headers: {},
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_456' },
      headers: {},
      state: 'oauth_session_456',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_456',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_456',
      sessionId: 'oauth_session_456',
      allParams: { state: 'oauth_session_456' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: 'oauth_session_456',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: null },
      headers: {},
      state: null,
      stateStartsWithCustomer: null
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: null, isCustomerRequest: null, willDelegate: null }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: null, sessionId: null, allParams: { state: null } }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: null,
      referer: undefined,
      isPopup: undefined,
      userIsNew: true
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_session_123' },
      headers: { referer: 'https://accounts.google.com/signin/oauth' },
      state: 'oauth_session_123',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_123',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_123',
      sessionId: 'oauth_session_123',
      allParams: { state: 'oauth_session_123' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-affiliate',
      query: { state: 'customer_oauth_789' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_789',
      sessionId: 'oauth_789',
      allParams: { state: 'customer_oauth_789' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_789',
      referer: undefined,
      isPopup: true,
      userIsNew: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: true,
      userObject: {
        email: 'affiliate@example.com',
        provider: 'google',
        isExistingAffiliate: true,
        affiliate: {
          _id: 'aff123',
          affiliateId: 'AFF001',
          email: 'affiliate@example.com',
          firstName: 'Jane',
          lastName: 'Doe',
          businessName: "Jane's Business",
          save: [Function]
        }
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1889:13)

  console.log
    [handleCustomerSocialCallback] User is an existing affiliate, showing conflict message

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1895:15)

  console.log
    [handleCustomerSocialCallback] Using nonce for affiliate conflict: test-nonce

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1921:15)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_999' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_999',
      sessionId: 'oauth_999',
      allParams: { state: 'customer_oauth_999' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_999',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'new-user',
      query: { state: 'customer_oauth_100' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_100',
      sessionId: 'oauth_100',
      allParams: { state: 'customer_oauth_100' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_100',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: undefined,
      userObject: {
        email: 'newcustomer@example.com',
        provider: 'google',
        firstName: 'New',
        lastName: 'Customer',
        socialId: 'google123',
        isNewUser: true
      }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1889:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'null',
      userType: 'existing-customer',
      query: { state: 'customer_error' },
      url: undefined,
      originalUrl: undefined
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_error',
      sessionId: null,
      allParams: { state: 'customer_error' }
    }

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1640:13)

  console.log
    [handleCustomerSocialCallback] User is null, handling error case

      at Object.log [as handleCustomerSocialCallback] (server/controllers/authController.js:1647:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'oauth_session_12345' },
      headers: {},
      state: 'oauth_session_12345',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_session_12345',
      isCustomerRequest: false,
      willDelegate: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_session_12345',
      sessionId: 'oauth_session_12345',
      allParams: { state: 'oauth_session_12345' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'popup=true' },
      headers: {},
      state: 'popup=true',
      stateStartsWithCustomer: false
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'popup=true', isCustomerRequest: false, willDelegate: false }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'popup=true',
      sessionId: null,
      allParams: { state: 'popup=true' }
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: { referer: 'https://accounts.google.com/oauth/authorize' },
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at Object.log [as handleSocialCallback] (server/controllers/authController.js:1007:13)

PASS tests/unit/oauthCallbacks.test.js
  OAuth Callback Functions
    handleSocialCallback
      âœ“ should handle customer OAuth request by delegating to customer handler (270 ms)
      âœ“ should handle popup request with no user (auth failed) (125 ms)
      âœ“ should handle existing user login with popup (120 ms)
      âœ“ should handle new user registration flow (119 ms)
      âœ“ should handle OAuth callback errors (105 ms)
    handleCustomerSocialCallback
      âœ“ should handle affiliate conflict when social account is already an affiliate (108 ms)
      âœ“ should handle existing customer login (105 ms)
      âœ“ should handle new customer registration (106 ms)
      âœ“ should handle errors during customer OAuth callback (105 ms)
    OAuth State Parameter Handling
      âœ“ should correctly parse sessionId from state parameter (104 ms)
      âœ“ should handle state parameter without oauth_ prefix (112 ms)
      âœ“ should detect popup from referer headers (111 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/v2-payment-core.test.js (5.826 s)
  V2 Payment Core Functionality
    Payment Link Generation
      âœ“ should generate correct payment links (1810 ms)
      âœ“ should generate QR codes for payment links (1779 ms)
      â—‹ skipped should include translations in payment data (feature not implemented)
    Payment Email Parsing
      âœ“ should parse Venmo payment email correctly (159 ms)
      âœ“ should parse PayPal payment email correctly (156 ms)
      âœ“ should parse CashApp payment email correctly (156 ms)
      âœ“ should handle various order ID formats (154 ms)
    Payment Verification Job Logic
      âœ“ should not send reminder before 30 minutes (160 ms)
      â—‹ skipped should determine when to send first reminder (30 minutes)
      â—‹ skipped should send hourly reminders after first reminder
      â—‹ skipped should determine urgency correctly
      â—‹ skipped should determine when to escalate to admin (4 hours)
    Order State Transitions
      âœ“ should transition from pending to awaiting when weighed (157 ms)
      âœ“ should transition from awaiting to confirming on customer confirmation (153 ms)
      âœ“ should transition from confirming to verified when payment detected (154 ms)
    Amount Tolerance
      âœ“ should accept payment within tolerance (156 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/adminIdGeneration.test.js
  Admin ID Generation Logic Tests
    generateAdminId function logic
      âœ“ should generate ADM001 when no administrators exist (140 ms)
      âœ“ should generate ADM002 when ADM001 exists (248 ms)
      âœ“ should generate ADM003 when ADM001 and ADM002 exist (277 ms)
      âœ“ should handle non-sequential admin IDs correctly (271 ms)
      âœ“ should handle double-digit admin IDs (214 ms)
      âœ“ should handle triple-digit admin IDs (215 ms)
      âœ“ should handle large admin ID numbers (212 ms)
    Admin ID format validation
      âœ“ should maintain three-digit padding for numbers below 100 (111 ms)
      âœ“ should handle numbers above 999 without padding issues (103 ms)
    Admin ID parsing logic
      âœ“ should correctly parse admin ID numbers (103 ms)
      âœ“ should handle edge cases in admin ID parsing (105 ms)
    Admin ID generation with mixed data
      âœ“ should work correctly with inactive administrators (264 ms)
      âœ“ should work correctly with different creation dates (268 ms)
      âœ“ should work correctly with different permissions (268 ms)
    Performance and reliability
      âœ“ should handle database query efficiently (227 ms)
      âœ“ should handle concurrent admin creation scenario (227 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/csrfConfig.test.js
  CSRF Configuration
    CSRF_CONFIG
      âœ“ should define all endpoint categories (1 ms)
      âœ“ should have valid endpoint patterns (5 ms)
      âœ“ should not have duplicate endpoints across categories
      âœ“ should include critical security endpoints
      âœ“ should exclude authentication endpoints from CSRF (5 ms)
      âœ“ should exclude registration endpoints from CSRF (1 ms)
    shouldEnforceCsrf
      HTTP method checks
        âœ“ should not enforce CSRF for GET requests
        âœ“ should not enforce CSRF for HEAD requests
        âœ“ should not enforce CSRF for OPTIONS requests (1 ms)
        âœ“ should consider CSRF for POST requests
        âœ“ should consider CSRF for PUT requests
        âœ“ should consider CSRF for DELETE requests (1 ms)
        âœ“ should consider CSRF for PATCH requests
      Public endpoints
        âœ“ should not enforce CSRF for public endpoints
        âœ“ should not enforce CSRF for health check endpoints
      Authentication endpoints
        âœ“ should not enforce CSRF for login endpoints
        âœ“ should not enforce CSRF for forgot password
        âœ“ should not enforce CSRF for refresh token
      Registration endpoints
        âœ“ should not enforce CSRF for affiliate registration
        âœ“ should not enforce CSRF for customer registration
      Critical endpoints
        âœ“ should enforce CSRF for logout (1 ms)
        âœ“ should enforce CSRF for order creation
        âœ“ should enforce CSRF for order cancellation
        âœ“ should enforce CSRF for password changes
        âœ“ should enforce CSRF for data deletion (1 ms)
        âœ“ should enforce CSRF for admin operations
        âœ“ should enforce CSRF for operator shift changes
        âœ“ should enforce CSRF for order status updates (1 ms)
      High priority endpoints
        âœ“ should not enforce CSRF for high priority endpoints when CSRF_PHASE < 2
        âœ“ should enforce CSRF for high priority endpoints when CSRF_PHASE >= 2
        âœ“ should handle bag management endpoints based on phase (1 ms)
        âœ“ should handle payment updates based on phase
      Read-only endpoints
        âœ“ should not enforce CSRF for dashboard endpoints
        âœ“ should enforce CSRF for search endpoints with state-changing methods
        âœ“ should enforce CSRF for export endpoints with state-changing methods (1 ms)
      Pattern matching
        âœ“ should match parameterized routes
        âœ“ should match nested parameterized routes
        âœ“ should not match partial paths
        âœ“ should handle complex IDs in paths
      Default behavior
        âœ“ should enforce CSRF for unknown state-changing endpoints
        âœ“ should enforce CSRF for unmatched PUT requests
        âœ“ should not enforce CSRF for unknown GET endpoints
      Edge cases
        âœ“ should handle missing CSRF_PHASE environment variable
        âœ“ should handle non-numeric CSRF_PHASE (1 ms)
        âœ“ should handle paths with query parameters
        âœ“ should handle paths with trailing slashes

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.warn
    Email template placeholder [shift_date] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2140:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:79:7)

  console.warn
    Email template placeholder [shift_date] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2140:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:98:7)

  console.warn
    Email template placeholder [content] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendOperatorShiftReminderEmail] (server/utils/emailService.js:2140:18)
      at Object.<anonymous> (tests/unit/emailServiceUncovered.test.js:353:7)

PASS tests/unit/emailServiceUncovered.test.js
  Email Service - Uncovered Functions
    sendOperatorShiftReminderEmail
      âœ“ should send shift reminder email successfully (26 ms)
      âœ“ should handle email sending error (6 ms)
    sendOperatorPasswordResetEmail
      âœ“ should log error since operators use PINs (6 ms)
      âœ“ should still log error even with missing reset URL (5 ms)
    sendServiceDownAlert
      âœ“ should send service down alert to all admin emails (5 ms)
      âœ“ should handle empty admin emails (10 ms)
      â—‹ skipped should handle email sending errors gracefully
    sendOrderReadyNotification
      âœ“ should send order ready notification successfully (9 ms)
      âœ“ should handle missing data fields (3 ms)
    sendOrderPickedUpNotification
      âœ“ should send order picked up notification successfully (4 ms)
      â—‹ skipped should handle email error and log it
    Console Email Provider
      âœ“ should log emails when using console provider (8 ms)
    Template Loading Errors
      âœ“ should handle template file not found (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Starting payment verification job - checking every 5 minutes

      at PaymentVerificationJob.log [as start] (server/jobs/paymentVerificationJob.js:43:15)

  console.log
    [2025-10-17T02:08:48.548Z] Starting payment verification check

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:84:15)

  console.error
    Error in payment verification job: TypeError: Cannot read properties of undefined (reading 'length')
        at PaymentVerificationJob.length [as runVerification] (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:89:27)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at PaymentVerificationJob.start (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:51:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:106:7)

       98 |       
       99 |     } catch (error) {
    > 100 |       console.error('Error in payment verification job:', error);
          |               ^
      101 |     } finally {
      102 |       this.running = false;
      103 |     }

      at PaymentVerificationJob.error [as runVerification] (server/jobs/paymentVerificationJob.js:100:15)
      at PaymentVerificationJob.start (server/jobs/paymentVerificationJob.js:51:7)
      at Object.<anonymous> (tests/unit/paymentVerificationJob.test.js:106:7)

  console.log
    Payment verification job started successfully

      at PaymentVerificationJob.log [as start] (server/jobs/paymentVerificationJob.js:53:15)

  console.log
    Payment verification job stopped

      at PaymentVerificationJob.log [as stop] (server/jobs/paymentVerificationJob.js:66:15)

  console.log
    Payment verification job not started - V1 payment system active

      at PaymentVerificationJob.log [as start] (server/jobs/paymentVerificationJob.js:31:17)

  console.log
    [2025-10-17T02:08:49.566Z] Starting payment verification check

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:84:15)

  console.log
    Verified 1 payments from email scan

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:90:17)

  console.error
    Error checking pending payments: CastError: Cast to ObjectId failed for value "CUST-90967ff4-5e11-4b6e-a7b7-1c0ad8b75770" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
        at Array.map (<anonymous>)
        at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async Promise.all (index 0)
        at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
        at async Promise.all (index 0)
        at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
        at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
        at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:140:7) {
      stringValue: '"CUST-90967ff4-5e11-4b6e-a7b7-1c0ad8b75770"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-90967ff4-5e11-4b6e-a7b7-1c0ad8b75770',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
          at Array.map (<anonymous>)
          at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at async Promise.all (index 0)
          at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
          at async Promise.all (index 0)
          at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
          at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
          at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:140:7),
      valueType: 'string'
    }

      130 |       }
      131 |     } catch (error) {
    > 132 |       console.error('Error checking pending payments:', error);
          |               ^
      133 |     }
      134 |   }
      135 |

      at PaymentVerificationJob.error [as checkPendingPayments] (server/jobs/paymentVerificationJob.js:132:15)
      at PaymentVerificationJob.runVerification (server/jobs/paymentVerificationJob.js:94:7)
      at Object.<anonymous> (tests/unit/paymentVerificationJob.test.js:140:7)

  console.log
    Payment verification completed in 78ms

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:97:15)

  console.log
    Payment timeout for order 68f1a532fe93278dc81b1c1c - escalating to admin

      at PaymentVerificationJob.log [as processOrder] (server/jobs/paymentVerificationJob.js:171:17)

  console.log
    Escalating payment timeout for order 68f1a532fe93278dc81b1c1c to admin

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:340:15)

  console.log
    Admin escalation details: {
      orderId: 'ORD-f10cd125-3571-4195-a61c-a51cef3966e9',
      orderMongoId: new ObjectId('68f1a532fe93278dc81b1c1c'),
      customerName: 'Unknown',
      customerEmail: 'Unknown',
      customerPhone: 'Unknown',
      affiliateName: 'Test Affiliate',
      affiliateEmail: 'affiliate@test.com',
      paymentAmount: 27.5,
      hoursSinceRequest: 0,
      paymentRequestedAt: 2025-10-17T02:08:50.517Z,
      attemptsMade: 48
    }

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:369:15)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68f1a532fe93278dc81b1c1c

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:375:15)

  console.log
    Sending payment reminder to customer@test.com for order 68f1a534fe93278dc81b1c6a (0 hours elapsed, 4 hours remaining)

      at PaymentVerificationJob.log [as sendPaymentReminder] (server/jobs/paymentVerificationJob.js:226:15)

  console.log
    [sendEmail] Sending email to: customer@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Payment Reminder - Order #-53b69be4-485f-42c9-945e-017772752f74 - $27.50

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Payment Reminder - WaveMAX Laundry</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .email-container {
                background-color: #ffffff;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            .header {
                background: linear-gradient(135deg, #f56565 0%, #ed8936 100%);
                color: white;
                padding: 30px;
                text-align: center;
            }
            .header.urgent {
                background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            }
            .header h1 {
                margin: 0;
                font-size: 28px;
            }
            .content {
                padding: 30px;
            }
            .urgency-banner {
                background-color: #fef2e8;
                border: 2px solid #fed7aa;
                border-radius: 8px;
                padding: 15px;
                margin: 20px 0;
                text-align: center;
            }
            .urgency-banner.critical {
                background-color: #fee2e2;
                border-color: #fca5a5;
                color: #991b1b;
            }
            .time-indicator {
                font-size: 24px;
                font-weight: bold;
                color: #e53e3e;
                text-align: center;
                margin: 20px 0;
            }
            .order-info {
                background-color: #f8f9fa;
                border-left: 4px solid #ed8936;
                padding: 15px;
                margin: 20px 0;
            }
            .amount-due {
                font-size: 32px;
                color: #2d3748;
                font-weight: bold;
                text-align: center;
                margin: 20px 0;
            }
            .already-paid-section {
                background: linear-gradient(135deg, #f0f4ff 0%, #e9ecff 100%);
                border: 2px solid #667eea;
                border-radius: 8px;
                padding: 20px;
                margin: 30px 0;
                text-align: center;
            }
            .already-paid-btn {
                display: inline-block;
                padding: 12px 30px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                text-decoration: none;
                border-radius: 6px;
                font-weight: bold;
                font-size: 16px;
                margin-top: 10px;
            }
            .payment-methods {
                margin: 30px 0;
            }
            .payment-method {
                display: block;
                background-color: #ffffff;
                border: 2px solid #e2e8f0;
                border-radius: 8px;
                padding: 15px;
                margin: 10px 0;
                text-decoration: none;
                color: #333;
            }
            .payment-method:hover {
                border-color: #ed8936;
                box-shadow: 0 4px 12px rgba(237, 137, 54, 0.2);
            }
            .btn {
                display: inline-block;
                padding: 12px 24px;
                background-color: #ed8936;
                color: white;
                text-decoration: none;
                border-radius: 6px;
                font-weight: bold;
                margin: 10px 5px;
            }
            .btn-venmo { background-color: #3D95CE; }
            .btn-paypal { background-color: #0070BA; }
            .btn-cashapp { background-color: #00D632; }
            .footer {
                background-color: #f8f9fa;
                padding: 20px;
                text-align: center;
                color: #718096;
                font-size: 14px;
            }
            .warning-icon {
                font-size: 48px;
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <div class="email-container">
            <div class="header ">
                <h1>Payment Reminder</h1>
                <p>Your payment is still pending</p>
            </div>
            
            <div class="content">
                <p>Hi Test Customer,</p>
                
                
                
                <div class="time-indicator">
                    {{hoursElapsed}} hours since payment requested
                </div>
                
                <div class="order-info">
                    <strong>Order Details:</strong><br>
                    Order ID: #ORD-53b69be4-485f-42c9-945e-017772752f74<br>
                    Weight: 22 lbs<br>
                    Status: Ready for payment<br>
                    Payment Requested: 10/17/2025, 2:08:52 AM<br>
                </div>
                
                <div class="amount-due">
                    Amount Due: $27.50
                </div>
                
                <!-- Already Paid Section -->
                <div class="already-paid-section">
                    <h3 style="margin-top: 0;">Already sent payment?</h3>
                    <p>If you've already paid through Venmo, PayPal, or CashApp, please let us know so we can verify it immediately.</p>
                    <a href="{{confirmationLink}}" class="already-paid-btn">I've Already Paid â†’</a>
                </div>
                
                <p style="text-align: center; font-weight: bold; color: #e53e3e;">
                    If you haven't paid yet, please use one of these methods:
                </p>
                
                <div class="payment-methods">
                    <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-eb0237dd-b26c-44ba-8e2c-daf6fd5c343a" class="payment-method" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                        <div style="text-align: center;">
                            <span class="btn" style="background: white; color: #667eea;">ðŸ’³ Login to Pay</span>
                            <p style="margin: 10px 0 0 0; color: white;">Log in to pay with credit card</p>
                        </div>
                    </a>
                    
                    <a href="venmo://test" class="payment-method">
                        <div style="text-align: center;">
                            <span class="btn btn-venmo">Pay with Venmo</span>
                            <p style="margin: 10px 0 0 0; color: #718096;">@wavemax</p>
                        </div>
                    </a>
                </div>
                
                <p style="background-color: #fef2e8; padding: 15px; border-radius: 6px;">
                    <strong>â° Time Remaining:</strong> {{hoursRemaining}} hour(s)<br>
                    
                </p>
                
                <p><strong>Remember:</strong> Include <strong>Order #-53b69be4-485f-42c9-945e-017772752f74</strong> in your payment note/memo.</p>
                
                <p>If you're having trouble with payment or have any questions, please contact us immediately.</p>
                
                <p>Thank you for your prompt attention to this matter.</p>
            </div>
            
            <div class="footer">
                <p>WaveMAX Laundry<br>
                Premium Pickup & Delivery Service<br>
                <a href="https://wavemax.promo" style="color: #667eea;">wavemax.promo</a></p>
                <p style="font-size: 12px;">
                    This is reminder 1 of 3.<br>
                    Payment reminders are sent hourly until payment is received.
                </p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    V2 payment reminder sent to customer@test.com for order ORD-53b69be4-485f-42c9-945e-017772752f74

      at Object.log [as sendV2PaymentReminder] (server/utils/emailService.js:2529:13)

  console.log
    Payment reminder #0 sent to customer@test.com for order ORD-53b69be4-485f-42c9-945e-017772752f74

      at PaymentVerificationJob.log [as sendReminderEmail] (server/jobs/paymentVerificationJob.js:292:15)

  console.log
    Escalating payment timeout for order 68f1a535fe93278dc81b1c96 to admin

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation details: {
      orderId: 'ORD-9bf13948-3bf8-4629-a49d-b52be198d4ad',
      orderMongoId: new ObjectId('68f1a535fe93278dc81b1c96'),
      customerName: 'Unknown',
      customerEmail: 'Unknown',
      customerPhone: 'Unknown',
      affiliateName: 'Test Affiliate',
      affiliateEmail: 'affiliate@test.com',
      paymentAmount: 27.5,
      hoursSinceRequest: 4,
      paymentRequestedAt: 2025-10-16T22:08:53.532Z,
      attemptsMade: 48
    }

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68f1a535fe93278dc81b1c96

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Escalating payment timeout for order 68f1a536fe93278dc81b1cac to admin

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation details: {
      orderId: 'ORD-f7ef5db9-342e-4a21-9636-f8e5156d9afc',
      orderMongoId: new ObjectId('68f1a536fe93278dc81b1cac'),
      customerName: 'Unknown',
      customerEmail: 'Unknown',
      customerPhone: 'Unknown',
      affiliateName: 'Test Affiliate',
      affiliateEmail: 'affiliate@test.com',
      paymentAmount: 27.5,
      hoursSinceRequest: 0,
      paymentRequestedAt: 2025-10-17T02:08:54.028Z,
      attemptsMade: 0
    }

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68f1a536fe93278dc81b1cac

      at console.<anonymous> (node_modules/jest-mock/build/index.js:794:25)

  console.log
    Manual payment verification triggered

      at PaymentVerificationJob.log [as triggerManual] (server/jobs/paymentVerificationJob.js:398:13)

  console.log
    [2025-10-17T02:08:56.093Z] Starting payment verification check

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:84:15)

  console.error
    Error checking pending payments: CastError: Cast to ObjectId failed for value "CUST-84da9519-6546-4060-93ad-12d607973276" (type string) at path "_id" for model "Customer"
        at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:251:11)
        at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
        at Array.map (<anonymous>)
        at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
        at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
        at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
        at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
        at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async Promise.all (index 0)
        at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
        at async Promise.all (index 0)
        at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
        at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
        at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
        at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
        at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
        at PaymentVerificationJob.triggerManual (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:399:5)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:368:7) {
      stringValue: '"CUST-84da9519-6546-4060-93ad-12d607973276"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'CUST-84da9519-6546-4060-93ad-12d607973276',
      path: '_id',
      reason: BSONError: input must be a 24 character hex string, 12 byte Uint8Array, or an integer
          at new ObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/bson/src/objectid.ts:120:15)
          at castObjectId (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at SchemaObjectId.Object.<anonymous>.SchemaObjectId.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schema/objectId.js:249:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.applySetters (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1255:12)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1673:17)
          at /var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1634:18
          at Array.map (<anonymous>)
          at SchemaObjectId.handle$in (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1630:14)
          at SchemaObjectId.Object.<anonymous>.SchemaType.castForQuery (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/schemaType.js:1669:20)
          at cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/cast.js:367:39)
          at model.Query.Object.<anonymous>.Query.cast (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:5055:12)
          at model.Query.Object.<anonymous>.Query._castConditions (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2351:10)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2378:8)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at async Promise.all (index 0)
          at _populatePath (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4542:5)
          at async Promise.all (index 0)
          at Function.populate (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/model.js:4408:5)
          at model.Query._find (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:2433:3)
          at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:63)
          at PaymentVerificationJob.checkPendingPayments (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:112:29)
          at PaymentVerificationJob.runVerification (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:94:7)
          at PaymentVerificationJob.triggerManual (/var/www/wavemax/wavemax-affiliate-program/server/jobs/paymentVerificationJob.js:399:5)
          at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentVerificationJob.test.js:368:7),
      valueType: 'string'
    }

      130 |       }
      131 |     } catch (error) {
    > 132 |       console.error('Error checking pending payments:', error);
          |               ^
      133 |     }
      134 |   }
      135 |

      at PaymentVerificationJob.error [as checkPendingPayments] (server/jobs/paymentVerificationJob.js:132:15)
      at PaymentVerificationJob.runVerification (server/jobs/paymentVerificationJob.js:94:7)
      at PaymentVerificationJob.triggerManual (server/jobs/paymentVerificationJob.js:399:5)
      at Object.<anonymous> (tests/unit/paymentVerificationJob.test.js:368:7)

  console.log
    Payment verification completed in 33ms

      at PaymentVerificationJob.log [as runVerification] (server/jobs/paymentVerificationJob.js:97:15)

PASS tests/unit/paymentVerificationJob.test.js (9.239 s)
  PaymentVerificationJob
    Job initialization
      âœ“ should start when V2 payment system is enabled (802 ms)
      âœ“ should not start when V1 payment system is active (513 ms)
    Payment verification
      âœ“ should check for payments via email scanner (512 ms)
      âœ“ should increment check attempts for unverified payments (494 ms)
      âœ“ should mark order as failed after max attempts (608 ms)
    Payment reminders
      âœ“ should send first reminder after 30 minutes (6 attempts) (424 ms)
      âœ“ should send hourly reminders after first 30 minutes (432 ms)
      âœ“ should not send reminders between hourly intervals (436 ms)
      âœ“ should generate fresh payment links when sending reminder (530 ms)
      âœ“ should include urgency information in reminders (527 ms)
    Admin escalation
      âœ“ should escalate to admin after 4 hours (556 ms)
      âœ“ should include detailed order information in escalation (525 ms)
    Order processing
      âœ“ should skip non-V2 customers (558 ms)
      âœ“ should handle orders already verified (489 ms)
    Job status
      âœ“ should return correct status information (429 ms)
      âœ“ should allow manual triggering (466 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/v2PaymentModels.test.js (5.314 s)
  V2 Payment System Model Updates
    Customer Model V2 Fields
      âœ“ should create customer with V1 registration by default (570 ms)
      âœ“ should create V2 customer with custom bag count (289 ms)
      âœ“ should validate registrationVersion enum values (251 ms)
      âœ“ should validate initialBagsRequested range (261 ms)
    Order Model V2 Payment Fields
      âœ“ should create order with V2 payment fields defaults (385 ms)
      âœ“ should update V2 payment status correctly (424 ms)
      âœ“ should store payment links and QR codes (354 ms)
      âœ“ should track payment check attempts (407 ms)
      âœ“ should validate V2 payment status enum (290 ms)
      âœ“ should validate V2 payment method enum (290 ms)
      âœ“ should store payment notes (351 ms)
    V1 Compatibility
      âœ“ should not affect existing V1 customers (289 ms)
      âœ“ should not affect existing V1 orders (354 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/controllerHelpers.test.js
  ControllerHelpers
    asyncWrapper
      âœ“ should handle successful async functions (1 ms)
      âœ“ should catch and pass errors to next
      âœ“ should handle synchronous functions that return (1 ms)
    sendSuccess
      âœ“ should send success response with data spread
      âœ“ should send success response with empty data (1 ms)
      âœ“ should send success response with custom message
      âœ“ should send success response with custom status
    sendError
      âœ“ should send error response with message (1 ms)
      âœ“ should send error response with custom status
      âœ“ should send error response with errors (1 ms)
      âœ“ should send error response without errors parameter
    sendPaginated
      âœ“ should send paginated response with default items key (9 ms)
      âœ“ should send paginated response with custom items key (1 ms)
      âœ“ should handle missing pagination fields with defaults
    parsePagination
      âœ“ should return default values when no query params
      âœ“ should parse page and limit from query (1 ms)
      âœ“ should parse sortBy from query
      âœ“ should enforce maximum limit
      âœ“ should handle invalid values gracefully (1 ms)
      âœ“ should calculate correct skip value
      âœ“ should use custom defaults
    validateRequiredFields
      âœ“ should return null when all required fields present
      âœ“ should return object with missingFields for missing fields
      âœ“ should return object with emptyFields for empty strings
      âœ“ should return object with both missingFields and emptyFields (3 ms)
      âœ“ should handle null and undefined as empty
      âœ“ should handle 0 and false as valid values (1 ms)
    sanitizeInput
      âœ“ should escape HTML characters in strings
      âœ“ should sanitize object properties
      âœ“ should handle nested objects
      âœ“ should not modify non-string values
      âœ“ should handle null and undefined
      âœ“ should escape all dangerous characters

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:138:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:138:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:301:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:301:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:371:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:371:42)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:390:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:390:42)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:53:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:53:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:69:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:69:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:84:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:84:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:101:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:101:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:119:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:119:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:137:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:137:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:150:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:150:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:168:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:168:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:185:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:185:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:206:10)
        at Runtime._execModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1439:24)
        at Runtime._loadModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1022:12)
        at Runtime.requireModule (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:882:12)
        at Runtime.requireModuleOrMock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runtime/build/index.js:1048:21)
        at Object.require (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:361:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusHook (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:281:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:246:5)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore (server/middleware/rateLimiting.js:206:10)
      at Object.require (tests/unit/rateLimitingMiddleware.test.js:361:28)

  console.error
    Failed to create MongoDB rate limit store: Error: Invalid MongoDB URI
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:111:17)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:387:43
        at mockConstructor.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at new mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at createMongoStore (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:25:12)
        at Object.createMongoStore [as createCustomLimiter] (/var/www/wavemax/wavemax-affiliate-program/server/middleware/rateLimiting.js:214:12)
        at Object.createCustomLimiter (/var/www/wavemax/wavemax-affiliate-program/tests/unit/rateLimitingMiddleware.test.js:414:42)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      30 |     });
      31 |   } catch (error) {
    > 32 |     console.error('Failed to create MongoDB rate limit store:', error);
         |             ^
      33 |     return undefined; // Fall back to memory store
      34 |   }
      35 | };

      at error (server/middleware/rateLimiting.js:32:13)
      at Object.createMongoStore [as createCustomLimiter] (server/middleware/rateLimiting.js:214:12)
      at Object.createCustomLimiter (tests/unit/rateLimitingMiddleware.test.js:414:42)

PASS tests/unit/rateLimitingMiddleware.test.js
  Rate Limiting Middleware
    createMongoStore
      âœ“ should return undefined in test environment (4 ms)
      âœ“ should create MongoStore in non-test environment (1 ms)
      âœ“ should handle MongoStore creation errors (1 ms)
    Key Generators
      âœ“ should generate key for sensitive operations based on user ID (39 ms)
      âœ“ should generate key for sensitive operations based on IP when no user (15 ms)
      âœ“ should generate key for email verification based on email (26 ms)
      âœ“ should generate key for email verification based on user ID when no email (15 ms)
      âœ“ should generate key for email verification based on IP when no email or user (19 ms)
      âœ“ should generate key for file upload based on user ID (15 ms)
      âœ“ should generate key for admin login based on IP and username (23 ms)
      âœ“ should generate key for admin login based on IP and email when no username (16 ms)
    Skip Functions
      âœ“ should skip admin operation limiter for non-admin users (17 ms)
      âœ“ should not skip admin operation limiter for admin users (14 ms)
      âœ“ should skip admin operation limiter when no user (16 ms)
    createCustomLimiter
      âœ“ should create limiter with custom options (14 ms)
      âœ“ should merge defaults with custom options (12 ms)
      âœ“ should use custom windowMs for store creation (13 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportCustomerOAuth.test.js
  Passport Customer OAuth Flow
    Facebook Strategy - Customer Context
      âœ“ should handle existing customer login with Facebook ID (15 ms)
      âœ“ should link Facebook to existing customer by email (4 ms)
      âœ“ should detect when affiliate exists with same Facebook account (5 ms)
      âœ“ should handle new customer registration (3 ms)
      âœ“ should parse display name when structured name not available (4 ms)
      âœ“ should handle single name in display name (3 ms)
    Facebook Strategy - Affiliate Context with Customer Check
      âœ“ should detect when customer exists during affiliate OAuth (3 ms)
      âœ“ should parse display name in affiliate context (3 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/fieldFilter.test.js
  Field Filter Utility
    filterFields
      âœ“ should filter object to include only allowed fields (1 ms)
      âœ“ should handle empty allowed fields array
      âœ“ should handle null or undefined objects
      âœ“ should handle non-object inputs (1 ms)
      âœ“ should handle missing fields gracefully
      âœ“ should not include inherited properties
      âœ“ should handle nested objects without deep filtering (1 ms)
    filterArray
      âœ“ should filter array of objects
      âœ“ should handle empty array
      âœ“ should handle non-array inputs (1 ms)
      âœ“ should handle arrays with mixed types
    fieldDefinitions
      âœ“ should have definitions for all data types (1 ms)
      âœ“ should have different field sets for different roles
      âœ“ should not expose sensitive fields in public view (1 ms)
      âœ“ should include appropriate fields for each role
    getFilteredData
      âœ“ should filter data based on admin role (1 ms)
      âœ“ should filter data based on public role
      âœ“ should handle self context for customers (1 ms)
      âœ“ should handle arrays of data
      âœ“ should return data as-is for unknown data types (1 ms)
      âœ“ should handle null or undefined data
      âœ“ should use fallback field definitions
    responseFilter middleware
      âœ“ should create filtered json method (1 ms)
      âœ“ should filter response data when _filterType is provided
      âœ“ should not filter when _filterType is not provided (1 ms)
      âœ“ should handle public role when user is not authenticated
      âœ“ should extract user ID from different user types
      âœ“ should preserve other response properties
      âœ“ should handle responses without data property
      âœ“ should maintain this context in json method

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/storeIPs.test.js
  storeIPs configuration
    IP whitelist configuration
      âœ“ should load single store IP from environment (4 ms)
      âœ“ should handle empty store IP (1 ms)
      âœ“ should load additional IPs from environment (1 ms)
      âœ“ should trim whitespace from IPs (1 ms)
      âœ“ should filter out empty IP entries (1 ms)
      âœ“ should load IP ranges from environment (1 ms)
      âœ“ should handle empty IP ranges (1 ms)
    Session renewal configuration
      âœ“ should use default session renewal settings (1 ms)
      âœ“ should load custom session renewal settings from environment (1 ms)
      âœ“ should handle invalid numeric values (1 ms)
    isWhitelisted function
      âœ“ should return true for directly whitelisted IPs (1 ms)
      âœ“ should return false for non-whitelisted IPs (1 ms)
      âœ“ should check IP ranges (9 ms)
      âœ“ should return false for IPs outside ranges (1 ms)
    isInRange function
      âœ“ should correctly check IPs in /24 subnet (1 ms)
      âœ“ should correctly check IPs in /16 subnet (1 ms)
      âœ“ should correctly check IPs in /8 subnet (1 ms)
      âœ“ should correctly check IPs in /32 subnet (single host)
      âœ“ should correctly check IPs in /0 subnet (all IPs) (1 ms)
      âœ“ should handle invalid CIDR notation (1 ms)
      âœ“ should handle invalid mask bits (1 ms)
      âœ“ should handle invalid IP addresses (1 ms)
      âœ“ should handle IP parts out of range (1 ms)
      âœ“ should handle edge cases with console error (2 ms)
      âœ“ should correctly handle boundary cases (1 ms)
      âœ“ should handle various subnet sizes correctly (5 ms)
    Configuration export structure
      âœ“ should export all required properties and functions (2 ms)
      âœ“ should have correct session renewal properties (1 ms)
    Integration scenarios
      âœ“ should handle complex whitelist configuration (1 ms)
      âœ“ should work with no configuration (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/models.test.js (7.125 s)
  Model Tests
    Affiliate Model
      âœ“ should create a valid affiliate (755 ms)
      âœ“ should require required fields (322 ms)
      âœ“ should enforce unique constraints (625 ms)
      âœ“ should handle payment information correctly (350 ms)
      âœ“ should save affiliate with venmo payment method (371 ms)
    Customer Model
      âœ“ should create a valid customer (361 ms)
    Order Model
      âœ“ should create a valid order (384 ms)
      âœ“ should calculate estimated total correctly (400 ms)
      âœ“ should calculate actual total and commission when weight is set (389 ms)
      âœ“ should update timestamps for status changes (478 ms)
    Transaction Model
      âœ“ should create a valid transaction (355 ms)
      âœ“ should validate transaction type (321 ms)
      âœ“ should validate transaction status (320 ms)
    RefreshToken Model
      âœ“ should create a valid refresh token (348 ms)
      âœ“ should validate user type (315 ms)
      âœ“ should check if token is expired (385 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passwordValidator.test.js
  Password Validator Utility
    validatePasswordStrength
      Basic Requirements
        âœ“ should validate minimum length requirement (1 ms)
        âœ“ should require uppercase letters
        âœ“ should require lowercase letters
        âœ“ should require numbers (1 ms)
        âœ“ should require special characters
      Security Validations
        âœ“ should reject common passwords (1 ms)
        âœ“ should reject passwords containing username (1 ms)
        âœ“ should reject passwords containing email
        âœ“ should reject sequential characters (1 ms)
        âœ“ should reject repeated characters
      Valid Passwords
        âœ“ should accept strong valid passwords (1 ms)
      Edge Cases
        âœ“ should handle empty password
        âœ“ should handle null/undefined password (1 ms)
        âœ“ should handle case-insensitive username/email checks
    customPasswordValidator
      âœ“ should work as express-validator custom validator (14 ms)
      âœ“ should include validation errors in thrown message
    passwordValidationMiddleware
      âœ“ should create middleware function
      âœ“ should validate password and call next on success
      âœ“ should return error response on validation failure (1 ms)
    isPasswordInHistory
      âœ“ should return false for empty history
      âœ“ should return false for password not in history (52 ms)
      âœ“ should handle null/undefined history
    getPasswordStrength
      âœ“ should return higher scores for stronger passwords (1 ms)
      âœ“ should score length appropriately
      âœ“ should score character variety
      âœ“ should penalize common patterns (1 ms)
    commonPasswords array
      âœ“ should contain common passwords (4 ms)
      âœ“ should contain domain-specific passwords (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/callbackPool.test.js (6.528 s)
  CallbackPool Model
    Schema and Indexes
      âœ“ should have required fields (150 ms)
      âœ“ should have default values (143 ms)
      âœ“ should have unique constraint on callbackPath (156 ms)
      âœ“ should create document with defaults (171 ms)
    Instance Methods
      lock()
        âœ“ should lock callback with payment token (207 ms)
        âœ“ should increment usage count on each lock (289 ms)
        âœ“ should update lastUsedAt timestamp (207 ms)
      release()
        âœ“ should release locked callback (255 ms)
        âœ“ should handle releasing already unlocked callback (196 ms)
    Static Methods
      acquireCallback()
        âœ“ should acquire available unlocked callback (211 ms)
        âœ“ should use least recently used callback (247 ms)
        âœ“ should acquire expired locked callback (283 ms)
        âœ“ should return null when no callbacks available (271 ms)
        âœ“ should increment usage count atomically (208 ms)
      releaseCallback()
        âœ“ should release callback by payment token (205 ms)
        âœ“ should return null if no callback found with token (162 ms)
        âœ“ should only release callback locked by specific token (221 ms)
      releaseExpiredLocks()
        âœ“ should release callbacks locked longer than timeout (290 ms)
        âœ“ should not release recently locked callbacks (243 ms)
        âœ“ should handle custom timeout values (300 ms)
        âœ“ should return 0 when no expired locks (276 ms)
        âœ“ should handle empty collection (238 ms)
    Edge Cases and Error Handling
      âœ“ should handle concurrent lock attempts (179 ms)
      âœ“ should maintain data integrity with rapid lock/release cycles (812 ms)
      âœ“ should handle invalid ObjectId gracefully (176 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/callbackPoolManager.test.js
  CallbackPoolManager
    constructor
      âœ“ should initialize with correct configuration (1 ms)
    initializePool
      âœ“ should create or update callback entries for all paths (1 ms)
      âœ“ should start cleanup job after initialization (1 ms)
    acquireCallback
      âœ“ should acquire callback successfully (3 ms)
      âœ“ should return null when no callbacks available (1 ms)
    releaseCallback
      âœ“ should release callback successfully (1 ms)
      âœ“ should handle null callback gracefully
    getPoolStatus
      âœ“ should return pool status with all handler details (1 ms)
      âœ“ should handle empty pool (1 ms)
    startCleanupJob
      âœ“ should start cleanup interval (2 ms)
      âœ“ should run cleanup task every 5 minutes (1 ms)
      âœ“ should handle cleanup errors gracefully (1 ms)
      âœ“ should not log when no locks are released
    stopCleanupJob
      âœ“ should stop cleanup interval when running (1 ms)
      âœ“ should handle stopping when no interval exists
    integration scenarios
      âœ“ should handle complete payment flow
      âœ“ should handle concurrent acquire attempts

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/sanitization.test.js
  Sanitization Middleware
    sanitizeInput
      âœ“ should sanitize string input (1 ms)
      âœ“ should sanitize arrays recursively
      âœ“ should sanitize objects recursively (1 ms)
      âœ“ should handle null values
      âœ“ should handle undefined values
      âœ“ should handle numbers
      âœ“ should handle booleans (1 ms)
      âœ“ should handle deeply nested objects
      âœ“ should handle arrays of objects
      âœ“ should not modify prototype properties (1 ms)
    sanitizeRequest
      âœ“ should sanitize request body
      âœ“ should sanitize query parameters (1 ms)
      âœ“ should sanitize URL parameters
      âœ“ should handle missing request properties (1 ms)
      âœ“ should handle all properties in one request (1 ms)
    sanitizeEmail
      âœ“ should sanitize and validate email
      âœ“ should remove HTML from email (1 ms)
      âœ“ should return empty string for invalid email
      âœ“ should handle null and undefined
      âœ“ should handle non-string inputs (10 ms)
      âœ“ should handle empty string (1 ms)
      âœ“ should validate complex email formats
    sanitizePhone
      âœ“ should keep only allowed characters (1 ms)
      âœ“ should remove invalid characters
      âœ“ should handle international format
      âœ“ should remove HTML and special characters
      âœ“ should handle null and undefined
      âœ“ should handle non-string inputs
      âœ“ should trim whitespace
      âœ“ should handle empty string
    sanitizeId
      âœ“ should keep alphanumeric characters and hyphens (1 ms)
      âœ“ should remove special characters
      âœ“ should remove spaces
      âœ“ should handle script injection attempts
      âœ“ should handle null and undefined
      âœ“ should handle non-string inputs (1 ms)
      âœ“ should trim whitespace
      âœ“ should handle empty string
      âœ“ should handle MongoDB ObjectId format
    sanitizePath
      âœ“ should allow valid file paths (1 ms)
      âœ“ should remove directory traversal attempts
      âœ“ should remove multiple directory traversal attempts
      âœ“ should allow valid characters in paths
      âœ“ should remove invalid characters
      âœ“ should handle Windows-style paths
      âœ“ should handle null and undefined (1 ms)
      âœ“ should handle non-string inputs
      âœ“ should handle empty string
      âœ“ should handle complex path traversal attempts
      âœ“ should preserve forward slashes
    Integration tests
      âœ“ should work with express middleware chain (1 ms)
      âœ“ should handle complex nested structures

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

FAIL tests/unit/imapEmailScanner.test.js (12.388 s)
  IMAPEmailScanner
    connect
      âœ• should connect to IMAP server successfully (833 ms)
      âœ• should return false if password is not configured (639 ms)
      âœ• should handle connection errors (655 ms)
      âœ• should handle end event (620 ms)
    getUnreadEmails
      âœ• should fetch unread emails successfully (734 ms)
      âœ• should return empty array if not connected and connection fails (624 ms)
      âœ• should return empty array when no unread emails (615 ms)
      âœ• should handle errors opening inbox (708 ms)
      âœ• should handle errors searching emails (641 ms)
    markAsRead
      âœ• should mark email as read successfully (637 ms)
      âœ“ should return false if not connected (594 ms)
      âœ• should handle errors marking as read (697 ms)
    moveToFolder
      âœ• should move email to folder successfully (645 ms)
      âœ“ should return false if not connected (616 ms)
      âœ• should handle copy errors (647 ms)
      âœ• should handle delete errors after successful copy (615 ms)
    disconnect
      âœ• should disconnect from IMAP server (645 ms)
      âœ“ should handle disconnect when not connected (631 ms)

  â— IMAPEmailScanner â€º connect â€º should connect to IMAP server successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:47:7)

  â— IMAPEmailScanner â€º connect â€º should return false if password is not configured

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:77:7)

  â— IMAPEmailScanner â€º connect â€º should handle connection errors

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:87:7)

  â— IMAPEmailScanner â€º connect â€º should handle end event

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:105:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should fetch unread emails successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:137:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should return empty array if not connected and connection fails

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:195:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should return empty array when no unread emails

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:204:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should handle errors opening inbox

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:231:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should handle errors searching emails

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:253:7)

  â— IMAPEmailScanner â€º markAsRead â€º should mark email as read successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:280:7)

  â— IMAPEmailScanner â€º markAsRead â€º should handle errors marking as read

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:310:7)

  â— IMAPEmailScanner â€º moveToFolder â€º should move email to folder successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:336:7)

  â— IMAPEmailScanner â€º moveToFolder â€º should handle copy errors

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:373:7)

  â— IMAPEmailScanner â€º moveToFolder â€º should handle delete errors after successful copy

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:397:7)

  â— IMAPEmailScanner â€º disconnect â€º should disconnect from IMAP server

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:426:7)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/auditLogger.test.js
  Audit Logger
    AuditEvents
      âœ“ should define all audit event types (1 ms)
      âœ“ should have unique event names
    logAuditEvent
      âœ“ should log basic audit event (1 ms)
      âœ“ should add request context when provided (1 ms)
      âœ“ should handle customer context
      âœ“ should use error level for critical events (1 ms)
      âœ“ should use info level for non-critical events
      âœ“ should handle missing user context (1 ms)
      âœ“ should handle connection.remoteAddress fallback
    auditMiddleware
      âœ“ should create middleware that logs on response finish (2 ms)
      âœ“ should log successful responses (1 ms)
      âœ“ should not log failed responses
      âœ“ should include request context in logs
    logLoginAttempt
      âœ“ should log successful login
      âœ“ should log failed login with reason
      âœ“ should handle null reason
    logSensitiveDataAccess
      âœ“ should log sensitive data access (1 ms)
      âœ“ should handle different data types and actions
    logPaymentActivity
      âœ“ should log payment info access (1 ms)
      âœ“ should log payment info update
      âœ“ should handle additional details
    logSuspiciousActivity
      âœ“ should log suspicious activity with error level (1 ms)
      âœ“ should include request context
      âœ“ should merge all details (1 ms)
    Logger configuration
      âœ“ should export audit logger with required methods
      âœ“ should not add console transport in production (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    No order ID found in payment note

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:169:17)

  console.log
    No order ID found in payment note

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:169:17)

  console.log
    [sendEmail] Sending email to: admin@wavemaxlaundry.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order ORD-1e729432-d9c3-4c72-b5f9-18a00675079b

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.00</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68f1a5628331e56d2d041bc6</li>
              <li><strong>Short Order ID:</strong> 2D041BC6</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.50</li>
              <li><strong>Difference:</strong> $28.00</li>
              <li><strong>Payment Method:</strong> venmo</li>
              <li><strong>Transaction ID:</strong> VENMO123</li>
              <li><strong>Sender:</strong> John Doe</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Admin notification sent: Overpayment Received - Order ORD-1e729432-d9c3-4c72-b5f9-18a00675079b

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2772:13)

  console.log
    Admin notified about overpayment for order 68f1a5628331e56d2d041bc6

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:577:15)

  console.log
    Payment verified for order ORD-1e729432-d9c3-4c72-b5f9-18a00675079b

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:363:15)

  console.log
    Sending payment confirmation to customer@test.com

      at PaymentEmailScanner.log [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:395:15)

  console.log
    Sending pickup notification for order 68f1a5628331e56d2d041bc6

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:410:15)

  console.log
    [sendEmail] Sending email to: admin@wavemaxlaundry.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order ORD-6e5a9615-2899-41aa-8b33-e9c66ddb5b50

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.25</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68f1a5628331e56d2d041bde</li>
              <li><strong>Short Order ID:</strong> 2D041BDE</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.75</li>
              <li><strong>Difference:</strong> $28.25</li>
              <li><strong>Payment Method:</strong> paypal</li>
              <li><strong>Transaction ID:</strong> PP123</li>
              <li><strong>Sender:</strong> Jane Doe</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Admin notification sent: Overpayment Received - Order ORD-6e5a9615-2899-41aa-8b33-e9c66ddb5b50

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2772:13)

  console.log
    Admin notified about overpayment for order 68f1a5628331e56d2d041bde

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:577:15)

  console.log
    Payment verified for order ORD-6e5a9615-2899-41aa-8b33-e9c66ddb5b50

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:363:15)

  console.log
    Sending payment confirmation to customer@test.com

      at PaymentEmailScanner.log [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:395:15)

  console.log
    Sending pickup notification for order 68f1a5628331e56d2d041bde

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:410:15)

  console.warn
    Payment insufficient. Expected: $55, Received: $45

      325 |       if (payment.amount < expectedAmount) {
      326 |         // Payment is less than required - notify admin but don't verify
    > 327 |         console.warn(`Payment insufficient. Expected: $${expectedAmount}, Received: $${payment.amount}`);
          |                 ^
      328 |         
      329 |         // Notify admin about insufficient payment
      330 |         try {

      at PaymentEmailScanner.warn [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:327:17)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:266:22)

  console.log
    [sendEmail] Sending email to: admin@wavemaxlaundry.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Underpayment Received - Order ORD-deb94be3-b79a-44c9-bc08-6e3c6b382e8b

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Underpayment Alert</h2>
            
            <p>Customer has underpaid by $10.00</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68f1a5638331e56d2d041bf9</li>
              <li><strong>Short Order ID:</strong> 2D041BF9</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $55.00</li>
              <li><strong>Received Amount:</strong> $45.00</li>
              <li><strong>Difference:</strong> $10.00</li>
              <li><strong>Payment Method:</strong> cashapp</li>
              <li><strong>Transaction ID:</strong> CA123</li>
              <li><strong>Sender:</strong> Bob Smith</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Payment verification was blocked. Please follow up with the customer for the remaining amount.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Admin notification sent: Underpayment Received - Order ORD-deb94be3-b79a-44c9-bc08-6e3c6b382e8b

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2772:13)

  console.log
    Admin notified about underpayment for order 68f1a5638331e56d2d041bf9

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:577:15)

  console.log
    Order already verified - duplicate payment detected: ORD-d4c9452f-16fb-4762-aa44-ee85edc43d1c

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:309:17)

  console.log
    [sendEmail] Sending email to: admin@wavemaxlaundry.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Duplicate Payment Received - Order ORD-d4c9452f-16fb-4762-aa44-ee85edc43d1c

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Duplicate Payment Alert</h2>
            
            <p>Customer has made a duplicate payment of $55.50 for an already paid order</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68f1a5648331e56d2d041c0f</li>
              <li><strong>Short Order ID:</strong> 2D041C0F</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.50</li>
              <li><strong>Difference:</strong> $28.00</li>
              <li><strong>Payment Method:</strong> venmo</li>
              <li><strong>Transaction ID:</strong> VENMO456</li>
              <li><strong>Sender:</strong> undefined</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>This order was already paid. Please refund this duplicate payment to the customer immediately.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Admin notification sent: Duplicate Payment Received - Order ORD-d4c9452f-16fb-4762-aa44-ee85edc43d1c

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2772:13)

  console.log
    Admin notified about duplicate for order 68f1a5648331e56d2d041c0f

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:577:15)

  console.log
    Found 2 unread payment emails

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:74:15)

  console.log
    Processing email: From: payment@venmo.com, Subject: Payment received

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:80:19)

  console.log
    Parsed payment: Order ORD-9639d277-7ce8-4443-a925-27a668f12e4b, Amount: $55.5, Provider: venmo

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:84:21)

  console.log
    [sendEmail] Sending email to: admin@wavemaxlaundry.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order ORD-9639d277-7ce8-4443-a925-27a668f12e4b

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.00</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68f1a5648331e56d2d041c26</li>
              <li><strong>Short Order ID:</strong> 2D041C26</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.50</li>
              <li><strong>Difference:</strong> $28.00</li>
              <li><strong>Payment Method:</strong> venmo</li>
              <li><strong>Transaction ID:</strong> venmo-1760666980811</li>
              <li><strong>Sender:</strong> Unknown</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Admin notification sent: Overpayment Received - Order ORD-9639d277-7ce8-4443-a925-27a668f12e4b

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2772:13)

  console.log
    Admin notified about overpayment for order 68f1a5648331e56d2d041c26

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:577:15)

  console.log
    Payment verified for order ORD-9639d277-7ce8-4443-a925-27a668f12e4b

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:363:15)

  console.log
    Sending payment confirmation to customer@test.com

      at PaymentEmailScanner.log [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:395:15)

  console.log
    Sending pickup notification for order 68f1a5648331e56d2d041c26

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:410:15)

  console.log
    Payment verified for order ORD-9639d277-7ce8-4443-a925-27a668f12e4b

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:89:23)

  console.log
    Processing email: From: random@gmail.com, Subject: Hello

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:80:19)

  console.log
    Not a payment email from known provider: random@gmail.com (subject: Hello)

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:152:17)

  console.log
    Email was not parsed as a valid payment

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:99:21)

  console.log
    Verified 1 payments

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:106:15)

  console.log
    No new payment emails found

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:69:17)

  console.log
    Found 1 unread payment emails

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:74:15)

  console.log
    Processing email: From: payment@venmo.com, Subject: undefined

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:80:19)

  console.log
    No order ID found in payment note

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:169:17)

  console.log
    Email was not parsed as a valid payment

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:99:21)

  console.log
    Verified 0 payments

      at PaymentEmailScanner.log [as scanForPayments] (server/services/paymentEmailScanner.js:106:15)

  console.log
    [sendEmail] Sending email to: admin@wavemaxlaundry.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Overpayment Received - Order ORD-ca40c284-36b7-4edb-ad95-0ef50574979c

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Overpayment Alert</h2>
            
            <p>Customer has overpaid by $28.00</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68f1a5668331e56d2d041c62</li>
              <li><strong>Short Order ID:</strong> 2D041C62</li>
              <li><strong>Customer:</strong> Test Customer</li>
              <li><strong>Customer Email:</strong> customer@test.com</li>
              <li><strong>Customer Phone:</strong> 555-2222</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $27.50</li>
              <li><strong>Received Amount:</strong> $55.50</li>
              <li><strong>Difference:</strong> $28.00</li>
              <li><strong>Payment Method:</strong> paypal</li>
              <li><strong>Transaction ID:</strong> PP123</li>
              <li><strong>Sender:</strong> Customer</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Consider refunding the overpayment amount or applying it as credit to future orders.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Admin notification sent: Overpayment Received - Order ORD-ca40c284-36b7-4edb-ad95-0ef50574979c

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2772:13)

  console.log
    Admin notified about overpayment for order 68f1a5668331e56d2d041c62

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:577:15)

  console.log
    Payment verified for order ORD-ca40c284-36b7-4edb-ad95-0ef50574979c

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:363:15)

  console.log
    Sending payment confirmation to customer@test.com

      at PaymentEmailScanner.log [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:395:15)

  console.log
    Sending pickup notification for order 68f1a5668331e56d2d041c62

      at PaymentEmailScanner.log [as sendPickupNotification] (server/services/paymentEmailScanner.js:410:15)

  console.log
    Processing 2 pending orders

      at PaymentEmailScanner.log [as processAllPendingPayments] (server/services/paymentEmailScanner.js:473:15)

  console.log
    Processing 1 pending orders

      at PaymentEmailScanner.log [as processAllPendingPayments] (server/services/paymentEmailScanner.js:473:15)

  console.error
    Error checking order payment: Error: API error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/paymentEmailScanner.test.js:426:53)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      448 |       return false;
      449 |     } catch (error) {
    > 450 |       console.error('Error checking order payment:', error);
          |               ^
      451 |       return false;
      452 |     }
      453 |   }

      at PaymentEmailScanner.error [as checkOrderPayment] (server/services/paymentEmailScanner.js:450:15)
      at PaymentEmailScanner.processAllPendingPayments (server/services/paymentEmailScanner.js:477:28)
      at Object.<anonymous> (tests/unit/paymentEmailScanner.test.js:428:23)

PASS tests/unit/paymentEmailScanner.test.js (11.829 s)
  PaymentEmailScanner
    Email parsing
      âœ“ should identify Venmo payments (762 ms)
      âœ“ should identify PayPal payments (430 ms)
      âœ“ should identify CashApp payments (449 ms)
      âœ“ should return null for unknown providers (466 ms)
      âœ“ should strip HTML tags correctly (442 ms)
    Payment email parsing
      âœ“ should parse Venmo payment email (464 ms)
      âœ“ should parse PayPal payment email (465 ms)
      âœ“ should parse CashApp payment email (462 ms)
      âœ“ should return null if order ID not found in email (470 ms)
      âœ“ should return null if order not found in database (483 ms)
    Order verification
      âœ“ should verify and update order on successful payment match (610 ms)
      âœ“ should allow small amount variance (621 ms)
      âœ“ should reject large amount variance (630 ms)
      âœ“ should skip already verified orders (586 ms)
    Batch payment scanning
      âœ“ should process multiple payment emails (622 ms)
      âœ“ should handle empty email list (438 ms)
      âœ“ should handle email parsing errors gracefully (461 ms)
    Order payment checking
      âœ“ should check specific order for payment (636 ms)
      âœ“ should return false if no payment found (500 ms)
    Process all pending payments
      âœ“ should process all orders awaiting payment (591 ms)
      âœ“ should handle verification errors (494 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/facebookDataController.test.js
  Facebook Data Controller
    handleDeletionCallback
      âœ“ should handle missing signed_request (2 ms)
      âœ“ should handle missing app secret
      âœ“ should handle invalid signed request (1 ms)
      âœ“ should handle missing user_id in payload
      âœ“ should handle case when no users are found (1 ms)
      âœ“ should handle customer-only deletion request (1 ms)
      âœ“ should handle errors during deletion callback (1 ms)
      âœ“ should handle affiliate and customer (both) deletion
    checkDeletionStatus
      âœ“ should handle missing confirmation code (1 ms)
      âœ“ should handle deletion request not found
      âœ“ should return completed deletion request status (1 ms)
      âœ“ should handle errors during status check (1 ms)
    processStaleRequests
      âœ“ should process stale deletion requests
      âœ“ should handle errors during stale request processing (1 ms)
      âœ“ should handle empty stale requests
    processDeletion error handling
      âœ“ should handle errors during affiliate data deletion
      âœ“ should handle errors during customer data deletion
      âœ“ should handle general errors during deletion processing (11 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/createAdminScript.test.js (10.455 s)
  Create Admin Script Tests
    Script File Structure
      âœ“ should exist and be readable (424 ms)
      âœ“ should contain required functionality markers (373 ms)
    Admin ID Generation Logic
      âœ“ should generate sequential admin IDs starting from ADM001 (603 ms)
      âœ“ should calculate next admin ID correctly (648 ms)
    Password Security Requirements
      âœ“ should enforce strong password requirements for admins (372 ms)
      âœ“ should accept strong passwords for admins (728 ms)
    Permission System Validation
      âœ“ should validate all permission types (462 ms)
      âœ“ should handle partial permission sets (462 ms)
    Unique Constraint Validation
      âœ“ should prevent duplicate administrator IDs (599 ms)
      âœ“ should prevent duplicate emails (537 ms)
    Email Integration
      âœ“ should handle admin creation with welcome email sending (486 ms)
    Data Validation and Sanitization
      âœ“ should handle special characters in names correctly (458 ms)
      âœ“ should normalize email addresses (479 ms)
      âœ“ should validate email format (707 ms)
    Administrator Model Integration
      âœ“ should integrate with existing administrator model schema (446 ms)
      âœ“ should work with password hashing middleware (504 ms)
    Script Error Handling
      âœ“ should handle database connection errors gracefully (363 ms)
      âœ“ should handle invalid input gracefully (382 ms)
    Security Considerations
      âœ“ should not log or expose passwords (385 ms)
      âœ“ should generate secure random passwords when needed (368 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 20
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:125:11)

PASS tests/unit/orderControllerAdditional.test.js
  Order Controller - Additional Coverage
    checkActiveOrders
      âœ“ should check active orders for authenticated customer (55 ms)
      âœ“ should return no active orders when none exist (58 ms)
      âœ“ should handle missing customer ID (63 ms)
      âœ“ should handle database errors (73 ms)
    createOrder error handling
      âœ“ should handle general errors during order creation (89 ms)
    exportOrders
      âœ“ should export orders as CSV (55 ms)
      âœ“ should export orders as JSON when format=json (52 ms)
      âœ“ should handle export errors (52 ms)
      âœ“ should handle unauthorized access (55 ms)
    updateOrderStatus edge cases
      âœ“ should handle invalid status transitions (54 ms)
    cancelOrder method
      âœ“ should handle order not found (52 ms)
      âœ“ should handle cancellation of non-cancellable order (51 ms)
    updatePaymentStatus
      âœ“ should handle order not found (52 ms)
      âœ“ should prevent payment updates on non-complete orders (52 ms)
      âœ“ should allow refund on complete orders regardless of payment status (52 ms)
    bulkUpdateOrderStatus
      âœ“ should handle invalid order IDs format (51 ms)
      âœ“ should handle empty order IDs array (51 ms)
      âœ“ should handle unauthorized access (51 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

FAIL tests/unit/mailcowService.test.js (20.972 s)
  MailcowService
    initialize
      âœ• should initialize service successfully (668 ms)
      âœ• should skip initialization if already initialized (841 ms)
      âœ• should not initialize if API key is not configured (671 ms)
      âœ• should handle initialization errors (683 ms)
    getUnreadPaymentEmails
      âœ• should fetch unread payment emails successfully (678 ms)
      âœ• should return empty array if service not initialized (764 ms)
      âœ• should try alternative method on 404 error (651 ms)
      âœ• should return empty array on other errors (629 ms)
    getUnreadEmailsAlternative
      âœ• should fetch emails using alternative endpoint (677 ms)
      âœ• should return empty array on error (659 ms)
    markEmailAsProcessed
      âœ• should mark email as processed successfully (618 ms)
      âœ• should return false if service not initialized (613 ms)
      âœ• should try alternative method on error (628 ms)
    markEmailAsProcessedAlternative
      âœ• should mark email as processed using alternative method (708 ms)
      âœ• should return false on error (651 ms)
    searchEmails
      âœ• should search emails successfully (695 ms)
      âœ• should return empty array if service not initialized (664 ms)
      âœ• should return empty array on error (635 ms)
    getEmailById
      âœ• should fetch email by ID successfully (615 ms)
      âœ• should return null if service not initialized (624 ms)
      âœ• should return null on error (652 ms)
    moveEmail
      âœ• should move email successfully (614 ms)
      âœ• should return false if service not initialized (625 ms)
      âœ• should return false on error (675 ms)
    createFolder
      âœ• should create folder successfully (621 ms)
      âœ• should return true if folder already exists (409) (652 ms)
      âœ• should return false if service not initialized (619 ms)
      âœ• should return false on other errors (645 ms)
    testConnection
      âœ• should return true if connection successful (621 ms)
      âœ• should return false if service not initialized (618 ms)
      âœ• should return false on connection error (612 ms)

  â— MailcowService â€º initialize â€º should initialize service successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:33:7)

  â— MailcowService â€º initialize â€º should skip initialization if already initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:56:7)

  â— MailcowService â€º initialize â€º should not initialize if API key is not configured

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:69:7)

  â— MailcowService â€º initialize â€º should handle initialization errors

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:79:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should fetch unread payment emails successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should return empty array if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should try alternative method on 404 error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should return empty array on other errors

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadEmailsAlternative â€º should fetch emails using alternative endpoint

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:160:7)

  â— MailcowService â€º getUnreadEmailsAlternative â€º should return empty array on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:160:7)

  â— MailcowService â€º markEmailAsProcessed â€º should mark email as processed successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:203:7)

  â— MailcowService â€º markEmailAsProcessed â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:203:7)

  â— MailcowService â€º markEmailAsProcessed â€º should try alternative method on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:203:7)

  â— MailcowService â€º markEmailAsProcessedAlternative â€º should mark email as processed using alternative method

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:251:7)

  â— MailcowService â€º markEmailAsProcessedAlternative â€º should return false on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:251:7)

  â— MailcowService â€º searchEmails â€º should search emails successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:282:7)

  â— MailcowService â€º searchEmails â€º should return empty array if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:282:7)

  â— MailcowService â€º searchEmails â€º should return empty array on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:282:7)

  â— MailcowService â€º getEmailById â€º should fetch email by ID successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:329:7)

  â— MailcowService â€º getEmailById â€º should return null if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:329:7)

  â— MailcowService â€º getEmailById â€º should return null on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:329:7)

  â— MailcowService â€º moveEmail â€º should move email successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:369:7)

  â— MailcowService â€º moveEmail â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:369:7)

  â— MailcowService â€º moveEmail â€º should return false on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:369:7)

  â— MailcowService â€º createFolder â€º should create folder successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º createFolder â€º should return true if folder already exists (409)

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º createFolder â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º createFolder â€º should return false on other errors

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º testConnection â€º should return true if connection successful

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:465:7)

  â— MailcowService â€º testConnection â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:465:7)

  â— MailcowService â€º testConnection â€º should return false on connection error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:465:7)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Authorization failed for path: /api/test - User role: customer Allowed roles: [ 'admin', 'affiliate' ]

      at log (server/middleware/auth.js:146:15)

  console.log
    Authorization failed for path: /api/test - User role: undefined Allowed roles: [ 'admin' ]

      at log (server/middleware/auth.js:146:15)

  console.log
    Authorization failed - No user object on request for path: /api/test

      at log (server/middleware/auth.js:138:15)

  console.error
    Authentication error: Error: Generic error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authMiddleware.test.js:447:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as verify] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at verify (/var/www/wavemax/wavemax-affiliate-program/server/middleware/auth.js:52:21)
        at Object.authenticate (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authMiddleware.test.js:450:13)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      117 |     }
      118 |
    > 119 |     console.error('Authentication error:', error);
          |             ^
      120 |
      121 |     res.status(500).json({
      122 |       success: false,

      at error (server/middleware/auth.js:119:13)
      at Object.authenticate (tests/unit/authMiddleware.test.js:450:13)

  console.log
    Authorization failed for path: /api/test - User role: customer Allowed roles: [ 'admin', 'affiliate' ]

      at log (server/middleware/auth.js:146:15)

PASS tests/unit/authMiddleware.test.js (6.383 s)
  Auth Middleware
    authenticate
      âœ“ should authenticate valid Bearer token (327 ms)
      âœ“ should authenticate valid x-auth-token header (225 ms)
      âœ“ should reject request with no token (232 ms)
      âœ“ should reject request with invalid token (205 ms)
      âœ“ should reject request with expired token (204 ms)
      âœ“ should handle malformed Authorization header (209 ms)
      âœ“ should reject blacklisted token (206 ms)
    authorize
      âœ“ should authorize user with correct role (207 ms)
      âœ“ should authorize user with one of multiple roles (210 ms)
      âœ“ should reject user with incorrect role (211 ms)
      âœ“ should reject user with no role (220 ms)
      âœ“ should reject when user is not set (210 ms)
    authLimiter
      âœ“ should be a function (205 ms)
      âœ“ should have rate limit configuration (208 ms)
      âœ“ should skip rate limiting in test environment (208 ms)
    validateRequest
      âœ“ should pass valid request (207 ms)
      âœ“ should reject invalid request (204 ms)
      âœ“ should reject request with missing required fields (204 ms)
      âœ“ should handle complex validation schemas (206 ms)
    authenticate - additional edge cases
      âœ“ should handle requirePasswordChange flag (205 ms)
      âœ“ should allow password change endpoint when requirePasswordChange is true (204 ms)
      âœ“ should NOT renew operator tokens from store IP (security fix) (202 ms)
      âœ“ should handle generic authentication errors (219 ms)
      âœ“ should handle W9 endpoint logging (205 ms)
    authorize - array syntax
      âœ“ should accept array of roles (204 ms)
      âœ“ should reject user not in array of roles (209 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/oAuthSession.test.js (6.737 s)
  OAuthSession Model
    Schema Validation
      âœ“ should create a valid OAuth session with all required fields (260 ms)
      âœ“ should require sessionId field (220 ms)
      âœ“ should require result field (215 ms)
      âœ“ should automatically set createdAt (250 ms)
      âœ“ should automatically set expiresAt to 5 minutes from now (252 ms)
      âœ“ should enforce unique sessionId (288 ms)
      âœ“ should allow complex result objects (266 ms)
    Static Methods
      createSession
        âœ“ should create and save a new OAuth session (274 ms)
        âœ“ should throw error for duplicate session IDs (282 ms)
        âœ“ should handle database errors (213 ms)
      getSession
        âœ“ should retrieve existing session result by sessionId (276 ms)
        âœ“ should return null for non-existent session (239 ms)
      consumeSession
        âœ“ should retrieve and delete session in one operation (313 ms)
        âœ“ should return null when consuming non-existent session (236 ms)
        âœ“ should handle race conditions safely (305 ms)
      cleanupExpired
        âœ“ should manually delete expired sessions (460 ms)
        âœ“ should return zero deletions when no expired sessions exist (292 ms)
    TTL Behavior
      âœ“ should have TTL index configured on expiresAt field (233 ms)
      âœ“ should respect custom expiresAt when provided (245 ms)
    Data Integrity
      âœ“ should preserve all data types in result field (239 ms)
      âœ“ should handle empty and minimal result objects (365 ms)
    Error Handling
      âœ“ should handle MongoDB connection errors gracefully (207 ms)
      âœ“ should handle very large result objects (316 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/payment.test.js
  Payment Model Unit Tests
    Schema Validation
      âœ“ should create a valid payment (55 ms)
      âœ“ should require orderId (57 ms)
      âœ“ should require customerId (63 ms)
      âœ“ should require paygistixId (60 ms)
      âœ“ should require amount (56 ms)
      âœ“ should validate amount is non-negative (60 ms)
      âœ“ should default currency to USD (65 ms)
      âœ“ should validate currency enum (63 ms)
      âœ“ should reject invalid currency (60 ms)
      âœ“ should validate status enum (54 ms)
      âœ“ should reject invalid status (63 ms)
      âœ“ should default status to pending (51 ms)
    Default Values
      âœ“ should default capturedAmount to 0 (54 ms)
      âœ“ should default refundedAmount to 0 (51 ms)
      âœ“ should default hasDispute to false (51 ms)
      âœ“ should have empty refunds array (51 ms)
    Virtual Properties
      âœ“ should calculate netAmount correctly (52 ms)
      âœ“ should handle zero amounts (51 ms)
      âœ“ should handle full refund (52 ms)
    Instance Methods
      canRefund()
        âœ“ should allow refund when status is captured (52 ms)
        âœ“ should allow refund when status is partially_refunded (51 ms)
        âœ“ should not allow refund when status is pending (52 ms)
        âœ“ should not allow refund when fully refunded (52 ms)
        âœ“ should validate refund amount (60 ms)
        âœ“ should handle null amount parameter (51 ms)
      canCapture()
        âœ“ should allow capture when status is authorized (52 ms)
        âœ“ should not allow capture when status is captured (52 ms)
        âœ“ should not allow capture when status is pending (54 ms)
      addRefund()
        âœ“ should add refund to refunds array (53 ms)
        âœ“ should update refundedAmount (52 ms)
        âœ“ should update lastRefundAt (52 ms)
        âœ“ should set status to partially_refunded for partial refund (51 ms)
        âœ“ should set status to refunded for full refund (52 ms)
        âœ“ should handle multiple refunds (53 ms)
        âœ“ should handle refund that exceeds captured amount (56 ms)
    Static Methods
      findByOrder()
        âœ“ should find payments by orderId (52 ms)
      findSuccessfulByCustomer()
        âœ“ should find successful payments by customer with default limit (61 ms)
        âœ“ should accept custom limit (54 ms)
      calculateRevenue()
        âœ“ should calculate revenue for a period (52 ms)
    Middleware
      âœ“ should have pre-save middleware defined (51 ms)
    Refund Schema
      âœ“ should validate refund subdocument (52 ms)
      âœ“ should require refundId in refund (52 ms)
      âœ“ should require amount in refund (52 ms)
      âœ“ should validate refund amount is non-negative (52 ms)
      âœ“ should set default createdAt for refund (51 ms)
    Dispute Tracking
      âœ“ should validate dispute status enum (53 ms)
      âœ“ should allow dispute fields when hasDispute is true (52 ms)
      âœ“ should validate dispute amount is non-negative (51 ms)
    Metadata and Response Fields
      âœ“ should store metadata as Map (54 ms)
      âœ“ should store response as mixed type (52 ms)
    JSON Transformation
      âœ“ should remove __v and response fields from JSON (54 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Jane Smith

      at Object.log [as createOrder] (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Test Affiliate

      at Object.log [as createOrder] (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 10,
        "perBagFee": 2,
        "totalFee": 10,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:238:13)

  console.log
    Updated customer isActive status to true for customer: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:260:15)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:125:11)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Test Affiliate

      at Object.log [as createOrder] (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 10,
        "perBagFee": 2,
        "totalFee": 10,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "orderId": "ORD123456",
      "estimatedTotal": 49.46,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:238:13)

  console.log
    Updated customer isActive status to true for customer: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:260:15)

  console.error
    Failed to send notification emails: Error: Email failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/orderController.test.js:180:73)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      266 |       await emailService.sendAffiliateNewOrderEmail(affiliate, customer, newOrder);
      267 |     } catch (emailError) {
    > 268 |       console.error('Failed to send notification emails:', emailError);
          |               ^
      269 |       // Continue with the response even if emails fail
      270 |     }
      271 |

      at Object.error [as createOrder] (server/controllers/orderController.js:268:15)
      at Object.<anonymous> (tests/unit/orderController.test.js:183:7)

  console.log
    Creating order with data: {
      "customerId": "INVALID",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:125:11)

  console.log
    Customer not found with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:129:13)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "INVALID",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at Object.log [as createOrder] (server/controllers/orderController.js:125:11)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:153:11)

  console.log
    Affiliate not found with ID: INVALID

      at Object.log [as createOrder] (server/controllers/orderController.js:157:13)

  console.log
    Creating order with data: {
      "customerId": "CUST456",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning"
    }

      at Object.log [as createOrder] (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST456

      at Object.log [as createOrder] (server/controllers/orderController.js:125:11)

  console.log
    Found customer: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at Object.log [as createOrder] (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: undefined undefined

      at Object.log [as createOrder] (server/controllers/orderController.js:160:11)

PASS tests/unit/orderController.test.js
  Order Controller
    createOrder
      âœ“ should successfully create a new order (55 ms)
      âœ“ should handle email sending failures gracefully (20 ms)
      âœ“ should return error for invalid customer (13 ms)
      âœ“ should return error for invalid affiliate (2 ms)
      âœ“ should enforce authorization (3 ms)
    getOrderDetails
      âœ“ should return order details for authorized user (3 ms)
      âœ“ should return 404 for non-existent order (1 ms)
      âœ“ should enforce authorization for customers
    updateOrderStatus
      âœ“ should successfully update order status (2 ms)
      âœ“ should update actual weight when processing
      âœ“ should validate status transitions (1 ms)
      âœ“ should send commission email when complete
    cancelOrder
      âœ“ should successfully cancel an order (2 ms)
      âœ“ should prevent cancelling non-cancellable orders

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentController.test.js
  Payment Controller
    getConfig
      âœ“ should return payment configuration when properly configured (52 ms)
      âœ“ should return error when Paygistix is not configured (57 ms)
      âœ“ should handle errors gracefully (58 ms)
    logSubmission
      âœ“ should log payment submission successfully (57 ms)
      âœ“ should handle logging errors (51 ms)
    createPaymentToken
      âœ“ should create payment token successfully (53 ms)
      âœ“ should handle no available callbacks (51 ms)
      âœ“ should handle token creation errors (54 ms)
    checkPaymentStatus
      âœ“ should return payment status successfully (52 ms)
      âœ“ should handle token not found (51 ms)
      âœ“ should handle database errors (52 ms)
    cancelPaymentToken
      âœ“ should cancel pending payment token (52 ms)
      âœ“ should not cancel non-pending tokens (52 ms)
      âœ“ should handle token not found (54 ms)
    updatePaymentStatus
      âœ“ should update payment status to success (54 ms)
      âœ“ should update payment status to failed (51 ms)
    handleFormCallback
      âœ“ should process callback successfully (51 ms)
      âœ“ should handle no pending payment for callback (51 ms)
      âœ“ should handle callback processing errors (54 ms)
    processCallbackResult
      âœ“ should process successful payment from query params (74 ms)
      âœ“ should process failed payment (52 ms)
      âœ“ should handle body parameters (52 ms)
      âœ“ should redirect with all parameters (51 ms)
    getPoolStats
      âœ“ should return pool statistics (51 ms)
      âœ“ should handle stats retrieval errors (51 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/authorizationHelpers.test.js (12.481 s)
  AuthorizationHelpers
    canAccessCustomer
      âœ“ should allow admin access to any customer (447 ms)
      âœ“ should allow administrator access to any customer (227 ms)
      âœ“ should allow customer to access their own data (207 ms)
      âœ“ should deny customer access to other customer data (203 ms)
      âœ“ should allow affiliate to access their customers (204 ms)
      âœ“ should deny affiliate access to other affiliate customers (210 ms)
    canAccessOrder
      âœ“ should allow admin access to any order (209 ms)
      âœ“ should allow administrator access to any order (204 ms)
      âœ“ should allow customer to access their own order (205 ms)
      âœ“ should deny customer access to other customer order (207 ms)
      âœ“ should allow affiliate to access their orders (203 ms)
      âœ“ should deny affiliate access to other affiliate orders (204 ms)
      âœ“ should allow operator access to their affiliate orders (205 ms)
      âœ“ should deny operator access to other affiliate orders (203 ms)
    canAccessAffiliate
      âœ“ should allow admin access to any affiliate (205 ms)
      âœ“ should allow administrator access to any affiliate (207 ms)
      âœ“ should allow affiliate to access their own data (213 ms)
      âœ“ should deny affiliate access to other affiliate data (205 ms)
      âœ“ should deny customer access to affiliate data (207 ms)
    requireRole middleware
      âœ“ should allow access for allowed role (212 ms)
      âœ“ should allow access for multiple allowed roles (207 ms)
      âœ“ should deny access for unauthorized role (204 ms)
      âœ“ should deny access when no user (241 ms)
    requireAnyRole middleware
      âœ“ should allow access for any of the allowed roles (203 ms)
      âœ“ should deny access for unauthorized role (204 ms)
      âœ“ should deny access when no user (210 ms)
    isAdmin
      âœ“ should return true for admin role (208 ms)
      âœ“ should return true for administrator role (206 ms)
      âœ“ should return false for non-admin roles (209 ms)
    isOperator
      âœ“ should return true for operator role (203 ms)
      âœ“ should return true for admin role (206 ms)
      âœ“ should return true for administrator role (205 ms)
      âœ“ should return false for customer and affiliate (204 ms)
    isAffiliate
      âœ“ should return true for affiliate role (205 ms)
      âœ“ should return true for operator role (201 ms)
      âœ“ should return true for admin role (208 ms)
      âœ“ should return false for customer (207 ms)
    checkCustomerAccess middleware
      âœ“ should allow customer to access own data (208 ms)
      âœ“ should allow admin to access any customer (204 ms)
      âœ“ should allow administrator to access any customer (204 ms)
      âœ“ should deny customer access to other customers (212 ms)
      âœ“ should use customerId from body if not in params (202 ms)
      âœ“ should return 400 when no customer ID provided (203 ms)
    hasPermission
      âœ“ should return true for admin user (203 ms)
      âœ“ should return true for administrator user (205 ms)
      âœ“ should check permissions array when present (203 ms)
      âœ“ should use role-based permissions for operator (212 ms)
      âœ“ should use role-based permissions for affiliate (208 ms)
      âœ“ should use role-based permissions for customer (211 ms)
    requirePermission middleware
      âœ“ should allow access when user has permission (210 ms)
      âœ“ should deny access when user lacks permission (210 ms)
    applyRoleFilters middleware
      âœ“ should not apply filters for admin (205 ms)
      âœ“ should apply customerId filter for customers (209 ms)
      âœ“ should apply affiliateId filter for affiliates (206 ms)
      âœ“ should apply affiliateId filter for operators (206 ms)
      âœ“ should deny access for unknown role (204 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentCallbackRoute.test.js
  Payment Callback Route
    GET /payment_callback
      Successful payment
        âœ“ should handle approved payment successfully (10 ms)
        âœ“ should handle success status as well as approved (10 ms)
        âœ“ should update existing payment if found (2 ms)
        âœ“ should handle customer not found gracefully (2 ms)
        âœ“ should handle email send failure gracefully (2 ms)
        âœ“ should not update customer if already active (2 ms)
      Failed payment
        âœ“ should handle declined payment (2 ms)
        âœ“ should handle failed status (2 ms)
        âœ“ should increment payment attempts on failure (2 ms)
        âœ“ should use default error message when none provided (2 ms)
      Error handling
        âœ“ should handle order not found (2 ms)
        âœ“ should handle unknown payment status (2 ms)
        âœ“ should handle database errors gracefully (2 ms)
        âœ“ should handle payment save error (2 ms)
      Edge cases
        âœ“ should handle missing amount parameter (1 ms)
        âœ“ should handle malformed maskedCard (2 ms)
        âœ“ should log callback parameters (1 ms)
    POST /payment_callback
      âœ“ should handle POST callback and return JSON response (8 ms)
      âœ“ should handle POST callback errors (2 ms)
      âœ“ should handle empty POST body (2 ms)
      âœ“ should handle POST with form-urlencoded data (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-123

      at Object.log [as exportVendors] (server/controllers/quickbooksController.js:102:13)

  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-123

      at Object.log [as exportVendors] (server/controllers/quickbooksController.js:94:15)

PASS tests/unit/quickbooksController.test.js
  QuickBooks Controller
    exportVendors
      âœ“ should export vendors as JSON (7 ms)
      âœ“ should export vendors as CSV (2 ms)
      âœ“ should return 404 when no verified vendors found
      âœ“ should handle errors gracefully (1 ms)
    exportPaymentSummary
      âœ“ should export payment summary as JSON (1 ms)
      âœ“ should export payment summary as CSV (1 ms)
      âœ“ should return 400 when dates are missing
      âœ“ should return 404 when no payable commissions found (1 ms)
      âœ“ should filter out orders without verified W-9
    exportCommissionDetail
      âœ“ should export commission detail as JSON (1 ms)
      âœ“ should return 400 when required parameters are missing
      âœ“ should return 404 when affiliate not found
      âœ“ should return 400 when affiliate has no verified W-9 (1 ms)
    getExportHistory
      âœ“ should get export history (1 ms)
      âœ“ should filter by type

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/socialAuthRoutes.test.js
  Social Auth Routes - Simple Tests
    Google OAuth Routes
      âœ“ should initiate Google OAuth when configured (6 ms)
      âœ“ should return 404 when Google OAuth is not configured (3 ms)
      âœ“ should handle Google OAuth callback (2 ms)
    Facebook OAuth Routes
      âœ“ should initiate Facebook OAuth when configured (2 ms)
      âœ“ should return 404 when Facebook OAuth is not configured (2 ms)
      âœ“ should handle Facebook OAuth callback (3 ms)
    LinkedIn OAuth Routes
      âœ“ should initiate LinkedIn OAuth when configured (2 ms)
      âœ“ should return 404 when LinkedIn OAuth is not configured (2 ms)
      âœ“ should handle LinkedIn OAuth callback (2 ms)
    Social Registration Route
      âœ“ should handle social registration with valid data (5 ms)
      âœ“ should validate required fields for social registration (2 ms)
      âœ“ should validate service radius range (2 ms)
      âœ“ should validate payment method (2 ms)
      âœ“ should accept valid payment methods including venmo (4 ms)
    Social Account Linking Route
      âœ“ should handle social account linking (2 ms)
      âœ“ should validate provider for account linking (2 ms)
      âœ“ should require social token for account linking (1 ms)
    Social Login Callback Route
      âœ“ should handle social login callback (10 ms)
      âœ“ should validate social login data (2 ms)
    Customer OAuth Routes
      âœ“ should initiate Google OAuth for customers (2 ms)
      âœ“ should handle customer Google OAuth callback redirect (2 ms)
      âœ“ should handle customer Facebook callback (1 ms)
      âœ“ should handle customer LinkedIn callback (2 ms)
    Customer Social Registration Route
      âœ“ should handle customer social registration (2 ms)
      âœ“ should validate customer registration fields (2 ms)
      âœ“ should validate service frequency (1 ms)
    Error Handling
      âœ“ should handle errors gracefully (15 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching dashboard data: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:223:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1251 |
      1252 |   } catch (error) {
    > 1253 |     console.error('Error fetching dashboard data:', error);
           |             ^
      1254 |     res.status(500).json({
      1255 |       success: false,
      1256 |       message: 'Failed to fetch dashboard data'

      at Object.error [as getDashboard] (server/controllers/administratorController.js:1253:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:225:7)

  console.error
    Error fetching order analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:284:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1383 |
      1384 |   } catch (error) {
    > 1385 |     console.error('Error fetching order analytics:', error);
           |             ^
      1386 |     res.status(500).json({
      1387 |       success: false,
      1388 |       message: 'Failed to fetch order analytics'

      at Object.error [as getOrderAnalytics] (server/controllers/administratorController.js:1385:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:286:7)

  console.error
    Error fetching operator analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:347:44)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1512 |
      1513 |   } catch (error) {
    > 1514 |     console.error('Error fetching operator analytics:', error);
           |             ^
      1515 |     res.status(500).json({
      1516 |       success: false,
      1517 |       message: 'Failed to fetch operator analytics'

      at Object.error [as getOperatorAnalytics] (server/controllers/administratorController.js:1514:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:349:7)

  console.error
    Error fetching affiliate analytics: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:403:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1614 |
      1615 |   } catch (error) {
    > 1616 |     console.error('Error fetching affiliate analytics:', error);
           |             ^
      1617 |     res.status(500).json({
      1618 |       success: false,
      1619 |       message: 'Failed to fetch affiliate analytics'

      at Object.error [as getAffiliateAnalytics] (server/controllers/administratorController.js:1616:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:405:7)

  console.error
    Error exporting report: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:513:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as find] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at find (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1864:30)
        at Object.generateOrdersReport [as exportReport] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1643:26)
        at Object.exportReport (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:516:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1679 |
      1680 |   } catch (error) {
    > 1681 |     console.error('Error exporting report:', error);
           |             ^
      1682 |     res.status(500).json({
      1683 |       success: false,
      1684 |       message: 'Failed to export report'

      at Object.error [as exportReport] (server/controllers/administratorController.js:1681:13)
      at Object.<anonymous> (tests/unit/adminDashboard.test.js:516:7)

  console.error
    Error fetching affiliates list: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:576:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as find] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at Object.find [as getAffiliatesList] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:1716:40)
        at Object.getAffiliatesList (/var/www/wavemax/wavemax-affiliate-program/tests/unit/adminDashboard.test.js:579:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1733 |     });
      1734 |   } catch (error) {
    > 1735 |     console.error('Error fetching affiliates list:', error);
           |             ^
      1736 |     res.status(500).json({
      1737 |       success: false,
      1738 |       message: 'Failed to fetch affiliates list',

      at Object.error [as getAffiliatesList] (server/controllers/administratorController.js:1735:13)
      at Object.getAffiliatesList (tests/unit/adminDashboard.test.js:579:37)

PASS tests/unit/adminDashboard.test.js
  Admin Dashboard Functions
    getDashboard
      âœ“ should fetch comprehensive dashboard data (3 ms)
      âœ“ should handle errors in dashboard data fetching (16 ms)
    getOrderAnalytics
      âœ“ should fetch order analytics with timeline and distribution
      âœ“ should handle errors (1 ms)
    getOperatorAnalytics
      âœ“ should fetch operator performance analytics
      âœ“ should handle errors (2 ms)
    getAffiliateAnalytics
      âœ“ should fetch affiliate performance analytics
      âœ“ should handle errors (2 ms)
    exportReport
      âœ“ should export orders report (1 ms)
      âœ“ should export comprehensive report
      âœ“ should handle invalid report type (1 ms)
      âœ“ should handle export errors (32 ms)
    getAffiliatesList
      âœ“ should fetch filtered affiliates list (1 ms)
      âœ“ should handle errors in affiliates list (2 ms)
    Report Generation Functions
      âœ“ should generate orders report

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passwordValidatorEnhanced.test.js
  Enhanced Password Validator
    validatePasswordStrength
      Length Requirements
        âœ“ should reject passwords shorter than 8 characters (2 ms)
        âœ“ should accept passwords with 8 or more characters (1 ms)
      Character Type Requirements
        âœ“ should require at least one uppercase letter
        âœ“ should require at least one lowercase letter (1 ms)
        âœ“ should require at least one number (1 ms)
        âœ“ should require at least one special character
        âœ“ should accept passwords with all required character types (1 ms)
      Common Password Detection
        âœ“ should reject common passwords (1 ms)
        âœ“ should accept non-common passwords
      Sequential Character Detection
        âœ“ should reject passwords with sequential numbers (1 ms)
        âœ“ should reject passwords with sequential letters
        âœ“ should accept passwords without sequential characters
      Repeated Character Detection
        âœ“ should reject passwords with too many repeated characters
        âœ“ should accept passwords with acceptable repeated characters (1 ms)
      Username/Email Inclusion Check
        âœ“ should reject passwords containing username
        âœ“ should reject passwords containing email (1 ms)
        âœ“ should accept passwords not containing username or email
      Password History Check
        âœ“ should reject passwords in history (1 ms)
        âœ“ should accept passwords not in history
      Complete Valid Passwords
        âœ“ should accept completely valid passwords
    getPasswordStrength
      âœ“ should return correct strength scores (1 ms)
      âœ“ should return correct strength labels
    isPasswordInHistory
      âœ“ should return true for passwords in history
      âœ“ should return false for passwords not in history
      âœ“ should handle empty history
    customPasswordValidator
      âœ“ should return custom validator function (1 ms)
      âœ“ should validate passwords correctly in express-validator context
      âœ“ should throw for invalid passwords in express-validator context (18 ms)
      âœ“ should include admin-specific validation when userType is admin (1 ms)
      âœ“ should include admin-specific validation when userType is operator
    passwordValidationMiddleware
      âœ“ should call next() for valid passwords (1 ms)
      âœ“ should return 400 error for invalid passwords (1 ms)
      âœ“ should skip validation if no password in request
      âœ“ should include strength assessment in response for invalid passwords
    Edge Cases and Security
      âœ“ should handle null and undefined inputs gracefully (1 ms)
      âœ“ should handle very long passwords
      âœ“ should handle special Unicode characters
      âœ“ should be case-sensitive for username/email checks (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/administrator.test.js (7.506 s)
  Administrator Model
    Schema Validation
      âœ“ should create a valid administrator (179 ms)
      âœ“ should require all mandatory fields (84 ms)
      âœ“ should enforce email format validation (133 ms)
      âœ“ should enforce unique email constraint (536 ms)
      âœ“ should enforce unique adminId constraint (508 ms)
      âœ“ should validate permission enum values (128 ms)
      âœ“ should accept valid permissions (158 ms)
      âœ“ should trim whitespace from string fields (164 ms)
      âœ“ should convert email to lowercase (163 ms)
      âœ“ should not allow role to be changed after creation (226 ms)
    Password Handling
      âœ“ should store password as hash and salt (198 ms)
      âœ“ should verify correct password (244 ms)
      âœ“ should reject incorrect password (245 ms)
      âœ“ should not expose password in JSON output (169 ms)
    Login Attempts and Account Locking
      âœ“ should increment login attempts (240 ms)
      âœ“ should lock account after 5 failed attempts (232 ms)
      âœ“ should reset login attempts on successful login (246 ms)
      âœ“ should reset attempts if lock has expired (226 ms)
      âœ“ should correctly identify locked accounts (165 ms)
    Password Reset
      âœ“ should generate password reset token (165 ms)
      âœ“ should set password reset expiry to 30 minutes (167 ms)
    Permissions
      âœ“ should check single permission correctly (162 ms)
      âœ“ should check multiple permissions with AND operation (174 ms)
      âœ“ should check multiple permissions with OR operation (163 ms)
      âœ“ should set default permissions if none provided (167 ms)
    Static Methods
      âœ“ should find active administrators (323 ms)
      âœ“ should find administrator by email with password (191 ms)
      âœ“ should handle case-insensitive email search (201 ms)
      âœ“ should return null for non-existent email (107 ms)
    Timestamps
      âœ“ should auto-generate timestamps on creation (162 ms)
      âœ“ should update updatedAt on modification (320 ms)
    Admin ID Generation
      âœ“ should auto-generate unique admin ID (264 ms)
      âœ“ should not override provided admin ID (165 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/formatters.test.js
  Formatters
    currency
      âœ“ should format USD currency with default locale (1 ms)
      âœ“ should format zero amount
      âœ“ should format negative amounts (1 ms)
      âœ“ should handle different currencies
      âœ“ should handle null and undefined (1 ms)
      âœ“ should handle string numbers
    date
      âœ“ should format date with default (short) format
      âœ“ should format date with medium format (1 ms)
      âœ“ should format date with long format
      âœ“ should format date with full format (1 ms)
      âœ“ should format datetime
      âœ“ should format time only (1 ms)
      âœ“ should handle ISO format
      âœ“ should handle string dates
      âœ“ should handle invalid dates
    datetime
      âœ“ should format datetime with default options (1 ms)
      âœ“ should format datetime with custom options
      âœ“ should handle invalid dates (1 ms)
    relativeTime
      âœ“ should format relative time for days
      âœ“ should format relative time for hours
      âœ“ should handle empty dates (1 ms)
    phone
      âœ“ should format 10-digit US phone number with default format
      âœ“ should format phone with country code
      âœ“ should format with dots format
      âœ“ should format with international format
      âœ“ should format 11-digit with international format
      âœ“ should handle phone with existing formatting
      âœ“ should handle phone with dots and format them
      âœ“ should return original for unrecognized formats
      âœ“ should handle invalid phone numbers
    address
      âœ“ should format complete address in single format (1 ms)
      âœ“ should format address with address2
      âœ“ should handle missing fields
      âœ“ should format as multi-line
      âœ“ should format as short (city, state only)
      âœ“ should handle empty address (1 ms)
    name
      âœ“ should format single name correctly
      âœ“ should capitalize names correctly
      âœ“ should handle McDonald and MacLeod type names
      âœ“ should format as lastFirst when requested
      âœ“ should handle single word names with lastFirst
      âœ“ should handle empty names
    fullName
      âœ“ should format full name from first and last
      âœ“ should format as lastFirst when requested
      âœ“ should handle missing first name (1 ms)
      âœ“ should handle missing last name
      âœ“ should handle empty names
    percentage
      âœ“ should format percentage with default decimals (0)
      âœ“ should format percentage with custom decimals
      âœ“ should format zero percentage
      âœ“ should format percentage with 1 decimal (1 ms)
      âœ“ should handle null and undefined
      âœ“ should multiply by 100 automatically
    weight
      âœ“ should format weight with default unit (lbs)
      âœ“ should format weight with custom unit
      âœ“ should handle null and undefined
      âœ“ should handle zero weight (1 ms)
    status
      âœ“ should format order status
      âœ“ should format payment status
      âœ“ should format bag status (1 ms)
      âœ“ should handle unknown status with capitalization
      âœ“ should default to order status map
    orderId
      âœ“ should return full order ID
      âœ“ should return short format when requested
      âœ“ should return full ID for short IDs even when short format requested
      âœ“ should handle empty order ID
    bagId
      âœ“ should return full bag ID
      âœ“ should extract bag number when requested
      âœ“ should extract multi-digit bag number
      âœ“ should return full ID if no bag pattern found
      âœ“ should handle empty bag ID
    truncate
      âœ“ should truncate long text with default settings (3 ms)
      âœ“ should truncate with custom length
      âœ“ should not truncate short text
      âœ“ should use custom suffix
      âœ“ should handle text equal to max length
      âœ“ should handle empty text (1 ms)
    fileSize
      âœ“ should format bytes
      âœ“ should format zero bytes
      âœ“ should format kilobytes
      âœ“ should format megabytes (1 ms)
      âœ“ should format gigabytes
      âœ“ should format with decimals when needed
    duration
      âœ“ should format seconds only
      âœ“ should format minutes and seconds
      âœ“ should format hours, minutes, and seconds
      âœ“ should handle zero duration (1 ms)
      âœ“ should handle negative or null values
      âœ“ should format hours only
      âœ“ should format minutes only
    plural
      âœ“ should use singular for count of 1
      âœ“ should use plural for count > 1
      âœ“ should use plural for count of 0
      âœ“ should auto-pluralize with s when no plural provided
      âœ“ should handle irregular plurals
      âœ“ should use singular for 1 even with custom plural
    list
      âœ“ should format single item
      âœ“ should format two items with default separator (1 ms)
      âœ“ should format multiple items with default separators
      âœ“ should format with custom separators
      âœ“ should handle empty array
      âœ“ should handle many items

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-001', operatorId: 'op123' }

      at log (server/controllers/operatorController.js:1224:13)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-001', operatorId: 'op123' }

      at log (server/controllers/operatorController.js:1224:13)

  console.log
    scanProcessed called with: { qrCode: 'CUST-12345#bag-002', operatorId: 'op123' }

      at log (server/controllers/operatorController.js:1224:13)

  console.log
    completePickup called with: {
      bagIds: [ 'bag-001', 'bag-002' ],
      orderId: 'ORD-123456',
      operatorId: 'op123'
    }

      at log (server/controllers/operatorController.js:1476:13)

  console.log
    Updating bags to completed. Current bag statuses: [
      { bagId: 'bag-001', status: 'processed' },
      { bagId: 'bag-002', status: 'processed' }
    ]

      at log (server/controllers/operatorController.js:1512:13)

  console.log
    Before save - Order status: complete

      at log (server/controllers/operatorController.js:1525:13)

  console.log
    Before save - Bag statuses: [
      { bagId: 'bag-001', status: 'completed' },
      { bagId: 'bag-002', status: 'completed' }
    ]

      at log (server/controllers/operatorController.js:1526:13)

  console.log
    After save - Order status: complete

      at log (server/controllers/operatorController.js:1531:15)

  console.log
    After save - Bag statuses: [
      { bagId: 'bag-001', status: 'completed' },
      { bagId: 'bag-002', status: 'completed' }
    ]

      at log (server/controllers/operatorController.js:1532:15)

  console.log
    Delivery notification sent to customer john@example.com

      at log (server/controllers/operatorController.js:1569:17)

  console.log
    completePickup called with: { bagIds: [ 'bag-001' ], orderId: 'ORD-123456', operatorId: 'op123' }

      at log (server/controllers/operatorController.js:1476:13)

  console.log
    completePickup called with: {
      bagIds: [ 'bag-001', 'bag-wrong' ],
      orderId: 'ORD-123456',
      operatorId: 'op123'
    }

      at log (server/controllers/operatorController.js:1476:13)

PASS tests/unit/bagTracking.test.js
  Bag Tracking System
    scanBag
      âœ“ should parse new QR format correctly (1 ms)
      âœ“ should handle legacy QR format (1 ms)
    weighBags
      âœ“ should add bags to order and update status (1 ms)
      âœ“ should update existing bag when duplicate bag ID provided
    scanProcessed
      âœ“ should update bag status to processed (5 ms)
      âœ“ should show warning for already processed bag (1 ms)
      âœ“ should trigger completion actions when all bags processed (2 ms)
    completePickup
      âœ“ should complete order when all bags scanned (3 ms)
      âœ“ should reject if bag count mismatch (1 ms)
      âœ“ should reject if wrong bag scanned (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/generalPaymentCallback.test.js
  General Payment Callback Routes
    GET /
      Registration Payment
        âœ“ should redirect to success page on approved registration payment (5 ms)
        âœ“ should redirect to success page on success status (3 ms)
        âœ“ should redirect to register page with error on failed registration payment (2 ms)
        âœ“ should handle missing response message on failure (1 ms)
        âœ“ should handle registration payment callback errors (2 ms)
      Order Payment
        âœ“ should handle approved order payment successfully (4 ms)
        âœ“ should handle success status for order payment (2 ms)
        âœ“ should update existing payment record (1 ms)
        âœ“ should handle declined order payment (2 ms)
        âœ“ should handle failed order payment (1 ms)
        âœ“ should handle unknown payment status (1 ms)
        âœ“ should handle order not found (1 ms)
        âœ“ should handle missing orderId in query (2 ms)
        âœ“ should handle email service failure gracefully (1 ms)
        âœ“ should skip customer update if customer not found (2 ms)
        âœ“ should not update already active customer (1 ms)
        âœ“ should handle payment callback errors (3 ms)
        âœ“ should use order amount if payment amount not provided (1 ms)
        âœ“ should handle partial masked card (2 ms)
        âœ“ should handle missing masked card (1 ms)
      General error handling
        âœ“ should handle general callback errors (1 ms)
    POST /
      Registration Payment
        âœ“ should create customer on approved registration payment with session (12 ms)
        âœ“ should handle success status for registration (3 ms)
        âœ“ should handle customer creation error (3 ms)
        âœ“ should handle no pending registration (1 ms)
        âœ“ should handle declined registration payment (2 ms)
        âœ“ should handle failed registration payment without message (2 ms)
      Order Payment POST
        âœ“ should acknowledge order payment callback (2 ms)
        âœ“ should handle order payment with explicit type (2 ms)
      General POST error handling
        âœ“ should handle POST callback errors (13 ms)
        âœ“ should log POST callback data (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/rbac.test.js
  RBAC Middleware
    Role Hierarchy
      âœ“ should define correct role hierarchy (1 ms)
      âœ“ should define allowed roles
    checkRole Middleware
      âœ“ should reject when no user is present (1 ms)
      âœ“ should reject when user has no role
      âœ“ should reject when user has invalid role (1 ms)
      âœ“ should accept when user has exact required role
      âœ“ should accept when user has higher role in hierarchy
      âœ“ should reject when user has lower role in hierarchy
      âœ“ should handle array of required roles (1 ms)
      âœ“ should accept administrator accessing operator resources
      âœ“ should reject operator accessing administrator resources (1 ms)
    checkAllRoles Middleware
      âœ“ should reject when no user is present
      âœ“ should accept when user has access to all required roles
      âœ“ should reject when user lacks access to any required role (1 ms)
      âœ“ should accept admin for any combination of roles
    checkResourceOwnership Middleware
      âœ“ should reject when no user is present (1 ms)
      âœ“ should allow admin access to any resource
      âœ“ should allow administrator access to any resource
      âœ“ should allow affiliate access to own resource via params
      âœ“ should allow customer access to own resource via body
      âœ“ should allow operator access to own resource
      âœ“ should reject affiliate access to another affiliate resource
      âœ“ should prefer params over body for resource ID
    checkAdminPermission Middleware
      âœ“ should reject when user is not administrator (1 ms)
      âœ“ should reject when administrator not found (8 ms)
      âœ“ should reject when administrator is not active (1 ms)
      âœ“ should accept when administrator has required permission
      âœ“ should handle array of required permissions
      âœ“ should reject when administrator lacks any required permission (1 ms)
      âœ“ should handle database errors
    checkOperatorStatus Middleware
      âœ“ should skip check for non-operators (1 ms)
      âœ“ should reject when operator not found
      âœ“ should reject when operator is not active (1 ms)
      âœ“ should reject when operator is not on shift
      âœ“ should accept active operator on shift
      âœ“ should handle database errors (1 ms)
    filterResponseFields Middleware
      âœ“ should pass through data when no user present
      âœ“ should pass through data when user has no role (1 ms)
      âœ“ should pass through all fields when role has wildcard permission
      âœ“ should filter fields based on role permissions
      âœ“ should handle nested field permissions (1 ms)
      âœ“ should handle array data
      âœ“ should handle standard response format with data property
      âœ“ should use default permissions when role not specified (1 ms)
      âœ“ should handle deeply nested fields
      âœ“ should handle non-object data gracefully (1 ms)
      âœ“ should handle empty allowed fields

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[31merror[39m: Failed to retrieve PKCE verifier: ENOENT: no such file or directory, open '/var/www/wavemax/wavemax-affiliate-program/temp/pkce/test_state_789.json' {"code":"ENOENT","errno":-2,"path":"/var/www/wavemax/wavemax-affiliate-program/temp/pkce/test_state_789.json","service":"wavemax-affiliate","stack":"Error: ENOENT: no such file or directory, open '/var/www/wavemax/wavemax-affiliate-program/temp/pkce/test_state_789.json'\n    at open (node:internal/fs/promises:639:25)\n    at Object.readFile (node:internal/fs/promises:1246:14)\n    at DocuSignService.getPkceVerifier (/var/www/wavemax/wavemax-affiliate-program/server/services/docusignService.js:85:23)\n    at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/docusignService.test.js:113:31)","syscall":"open","timestamp":"2025-10-17T02:11:06.444Z"}
[32minfo[39m: Token exchange request: {"client_id":"test_integration_key","has_verifier":true,"redirect_uri":"https://test.com/callback","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:06.770Z","url":"https://account-d.docusign.com/oauth/token","verifier_length":13}
  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:11:06.771Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

[32minfo[39m: Token saved to database {"expiresAt":"2025-10-17T03:11:06.771Z","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:06.812Z","tokenId":"default"}
[32minfo[39m: Token exchange successful {"expiresIn":3600,"hasAccessToken":true,"hasRefreshToken":true,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:06.813Z"}
[31merror[39m: PKCE verifier not found for state: {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:06.923Z"}
[32minfo[39m: Token exchange request: {"client_id":"test_integration_key","has_verifier":true,"redirect_uri":"https://test.com/callback","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:07.022Z","url":"https://account-d.docusign.com/oauth/token","verifier_length":8}
[31merror[39m: Failed to exchange code for token: {"error":"Network error","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:07.022Z"}
  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:11:07.103Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:11:07.164Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

  console.log
    DocuSignToken saved: {
      tokenId: 'default',
      expiresAt: 2025-10-17T03:11:07.411Z,
      status: 'active'
    }

      at Function.log [as saveToken] (server/models/DocuSignToken.js:118:13)

[32minfo[39m: DocuSign envelope created: {"affiliateId":"123456789","envelopeId":"test_envelope_id","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:07.820Z"}
[31merror[39m: Failed to create W9 envelope: {"affiliateEmail":"test@example.com","data":{"message":"Invalid template ID"},"service":"wavemax-affiliate","status":400,"templateId":"test_template_id","timestamp":"2025-10-17T02:11:07.898Z"}
[32minfo[39m: DocuSign in test mode - returning mock envelope {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:07.984Z"}
[32minfo[39m: Embedded signing URL generated: {"affiliateId":"123456","envelopeId":"test_envelope_id","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:08.065Z"}
[32minfo[39m: Processing DocuSign webhook event: {"envelopeId":"test_envelope_id","event":"envelope-completed","service":"wavemax-affiliate","status":"completed","timestamp":"2025-10-17T02:11:08.304Z"}
[32minfo[39m: Processing DocuSign webhook event: {"envelopeId":"test_envelope_id","event":"envelope-declined","service":"wavemax-affiliate","status":"declined","timestamp":"2025-10-17T02:11:08.383Z"}
[32minfo[39m: Downloaded completed W9: {"envelopeId":"test_envelope_id","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:08.541Z"}
[32minfo[39m: Voided envelope: {"envelopeId":"test_envelope_id","reason":"Cancelled by user","service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:08.619Z"}
[31merror[39m: Authentication required: {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:09.331Z"}
PASS tests/unit/docusignService.test.js
  DocuSign Service
    PKCE Generation
      âœ“ should generate valid PKCE challenge and verifier (90 ms)
    PKCE Storage
      âœ“ should store and retrieve PKCE verifier (93 ms)
      âœ“ should delete verifier after retrieval (94 ms)
      âœ“ should clean up old PKCE files (78 ms)
    Authorization URL
      âœ“ should generate correct authorization URL (81 ms)
      âœ“ should use provided state if given (78 ms)
    Token Exchange
      âœ“ should exchange authorization code for tokens (152 ms)
      âœ“ should throw error if PKCE verifier not found (98 ms)
      âœ“ should handle token exchange errors (80 ms)
    Token Refresh
      âœ“ should refresh access token using refresh token (205 ms)
      âœ“ should throw error if no refresh token available (104 ms)
    Access Token Management
      âœ“ should return valid access token if not expired (182 ms)
      âœ“ should refresh token if expired (123 ms)
      âœ“ should throw error if no valid token and no refresh token (103 ms)
    Envelope Creation
      âœ“ should create W9 envelope for affiliate (79 ms)
      âœ“ should handle envelope creation errors (84 ms)
      âœ“ should return mock envelope in test mode (80 ms)
    Embedded Signing URL
      âœ“ should generate embedded signing URL (84 ms)
    Webhook Signature Verification
      âœ“ should verify valid webhook signature (77 ms)
      âœ“ should reject invalid webhook signature (78 ms)
    Webhook Event Processing
      âœ“ should process completed envelope event (79 ms)
      âœ“ should handle declined envelope (79 ms)
    Envelope Status
      âœ“ should get envelope status (79 ms)
    Document Download
      âœ“ should download completed W9 document (78 ms)
    Envelope Voiding
      âœ“ should void an envelope (78 ms)
    hasValidToken
      âœ“ should return true when a valid token exists (182 ms)
      âœ“ should return false when no valid token exists (107 ms)
      âœ“ should return false when token is expired (146 ms)
    authenticate
      âœ“ should return access token when authentication succeeds (172 ms)
      âœ“ should throw error when authentication fails (105 ms)
    extractTaxInfoFromTabs
      âœ“ should extract SSN tax info from tabs (79 ms)
      âœ“ should extract EIN tax info from tabs (83 ms)
      âœ“ should extract business name from tabs (106 ms)
      âœ“ should return empty object when no tax info found (93 ms)
      âœ“ should handle empty tabs (79 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/paymentExport.test.js
  PaymentExport Model Unit Tests
    Schema Validation
      âœ“ should create a valid PaymentExport (59 ms)
      âœ“ should generate exportId automatically (69 ms)
      âœ“ should require type field (61 ms)
      âœ“ should validate type enum values (58 ms)
      âœ“ should reject invalid type values (57 ms)
      âœ“ should require generatedBy field (54 ms)
    Period Fields
      âœ“ should store period dates for payment summary (56 ms)
      âœ“ should store period dates for commission detail (54 ms)
    Export Data
      âœ“ should store vendor export data (54 ms)
      âœ“ should store payment summary data (55 ms)
      âœ“ should store commission detail data (55 ms)
    Affiliate IDs
      âœ“ should store multiple affiliate IDs for vendor export (58 ms)
      âœ“ should store single affiliate ID for commission detail (57 ms)
      âœ“ should allow empty affiliate IDs array (136 ms)
    Timestamps
      âœ“ should have createdAt and updatedAt timestamps (54 ms)
    Indexes
      âœ“ should have required indexes defined (52 ms)
    Different Export Types
      âœ“ should handle vendor export type correctly (56 ms)
      âœ“ should handle payment summary export type correctly (57 ms)
      âœ“ should handle commission detail export type correctly (60 ms)
    Export ID Generation
      âœ“ should generate unique export IDs (52 ms)
    Reference Validation
      âœ“ should validate generatedBy as ObjectId reference (54 ms)
      âœ“ should accept valid ObjectId for generatedBy (52 ms)
    Instance Methods
      markDownloaded()
        âœ“ should mark export as downloaded (179 ms)
        âœ“ should increment download count on multiple downloads (229 ms)
        âœ“ should not change status if already downloaded (170 ms)
        âœ“ should update downloadedAt timestamp (186 ms)
      updateImportStatus()
        âœ“ should update import status to success (172 ms)
        âœ“ should update import status to failed (174 ms)
        âœ“ should handle partial import status (171 ms)
    Static Methods
      findByPeriod()
        âœ“ should find exports within period (159 ms)
        âœ“ should filter by type when specified (148 ms)
        âœ“ should return empty array when no matches (149 ms)
        âœ“ should sort by generatedAt descending (176 ms)
      existsForPeriod()
        âœ“ should find existing export for period (150 ms)
        âœ“ should not find export for different period (147 ms)
        âœ“ should exclude failed exports (179 ms)
        âœ“ should find export with non-failed status (186 ms)
    Virtual Properties
      ageInDays
        âœ“ should calculate age in days correctly (90 ms)
        âœ“ should return 1 for exports created today (89 ms)
        âœ“ should handle exports created in the past correctly (55 ms)
        âœ“ should update as time passes (54 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: undefined, per-bag: undefined

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "undefined undefined"
      }
    }

      at log (server/controllers/authController.js:674:13)

  console.log
    Customer affiliateId: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: undefined, per-bag: undefined

      at Object.log [as customerLogin] (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "undefined undefined"
      }
    }

      at Object.log [as customerLogin] (server/controllers/authController.js:674:13)

  console.log
    Customer affiliateId: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at Object.log [as customerLogin] (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: undefined, per-bag: undefined

      at Object.log [as customerLogin] (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "undefined undefined"
      }
    }

      at Object.log [as customerLogin] (server/controllers/authController.js:674:13)

  console.error
    Token verification error: Error: User data not found in request
        at Object.<anonymous>.exports.verifyToken (/var/www/wavemax/wavemax-affiliate-program/server/controllers/authController.js:871:13)
        at Object.verifyToken (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authController.test.js:395:28)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      892 |     });
      893 |   } catch (error) {
    > 894 |     console.error('Token verification error:', error);
          |             ^
      895 |     res.status(500).json({
      896 |       success: false,
      897 |       message: 'An error occurred during token verification'

      at Object.error [as verifyToken] (server/controllers/authController.js:894:13)
      at Object.verifyToken (tests/unit/authController.test.js:395:28)

PASS tests/unit/authController.test.js
  Auth Controller
    affiliateLogin
      âœ“ should successfully login an affiliate with valid credentials (3 ms)
      âœ“ should return 401 for non-existent affiliate (1 ms)
      âœ“ should return 401 for incorrect password
    customerLogin
      âœ“ should successfully login a customer with valid credentials (8 ms)
      âœ“ should return 401 for non-existent customer
      âœ“ should login customer using emailOrUsername field (2 ms)
      âœ“ should prioritize emailOrUsername over username field (2 ms)
      âœ“ should return error when neither username nor emailOrUsername provided
    verifyToken
      âœ“ should verify a valid JWT token (1 ms)
      âœ“ should handle missing user data (42 ms)
    refreshToken
      âœ“ should refresh token successfully (1 ms)
      âœ“ should return error for invalid refresh token (1 ms)
      âœ“ should return error for expired refresh token
    administratorLogin
      âœ“ should successfully login administrator (6 ms)
      âœ“ should handle locked account (1 ms)
      âœ“ should handle inactive administrator
    operatorLogin
      âœ“ should successfully login operator with PIN (1 ms)
      âœ“ should fail with invalid PIN
    logout
      âœ“ should logout user and blacklist token (1 ms)
    forgotPassword
      âœ“ should send password reset email for affiliate (1 ms)
      âœ“ should handle non-existent email gracefully
    resetPassword
      âœ“ should reset password with valid token (1 ms)
      âœ“ should reject expired token (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_test-session-id', popup: 'true' },
      headers: {},
      state: 'oauth_test-session-id',
      stateStartsWithCustomer: false
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test-session-id',
      isCustomerRequest: false,
      willDelegate: false
    }

      at log (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test-session-id',
      sessionId: 'oauth_test-session-id',
      allParams: { state: 'oauth_test-session-id', popup: 'true' }
    }

      at log (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: 'true',
      state: 'oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at log (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'customer_test-session-id', popup: 'true' },
      headers: {},
      state: 'customer_test-session-id',
      stateStartsWithCustomer: true
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'customer_test-session-id',
      isCustomerRequest: true,
      willDelegate: true
    }

      at log (server/controllers/authController.js:989:13)

  console.log
    [OAuth] Delegating to handleCustomerSocialCallback

      at log (server/controllers/authController.js:997:15)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: {},
      headers: {},
      state: undefined,
      stateStartsWithCustomer: undefined
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: undefined,
      isCustomerRequest: undefined,
      willDelegate: undefined
    }

      at log (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: { state: undefined, sessionId: null, allParams: {} }

      at log (server/controllers/authController.js:1007:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_test-session-id', popup: 'true' },
      headers: {},
      state: 'oauth_test-session-id',
      stateStartsWithCustomer: false
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test-session-id',
      isCustomerRequest: false,
      willDelegate: false
    }

      at log (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test-session-id',
      sessionId: 'oauth_test-session-id',
      allParams: { state: 'oauth_test-session-id', popup: 'true' }
    }

      at log (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: 'true',
      state: 'oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: false
    }

      at log (server/controllers/authController.js:1052:13)

info: undefined {"eventType":"LOGIN_SUCCESS","reason":"Social login successful","success":true,"timestamp":"2025-10-17T02:11:17.633Z","userType":"affiliate","username":"johndoe"}
  console.error
    Error storing OAuth session: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:142:64)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1098 |             await OAuthSession.createSession(sessionId, message);
      1099 |           } catch (dbError) {
    > 1100 |             console.error('Error storing OAuth session:', dbError);
           |                     ^
      1101 |           }
      1102 |         }
      1103 |

      at error (server/controllers/authController.js:1100:21)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:146:7)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'oauth_test-session-id', popup: 'true' },
      headers: {},
      state: 'oauth_test-session-id',
      stateStartsWithCustomer: false
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: {
      state: 'oauth_test-session-id',
      isCustomerRequest: false,
      willDelegate: false
    }

      at log (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'oauth_test-session-id',
      sessionId: 'oauth_test-session-id',
      allParams: { state: 'oauth_test-session-id', popup: 'true' }
    }

      at log (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: 'true',
      state: 'oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at log (server/controllers/authController.js:1052:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'new-user',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at log (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at log (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: undefined,
      isPopup: true,
      userIsNew: true
    }

      at log (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: undefined,
      userObject: {
        provider: 'google',
        socialId: 'google123',
        email: 'customer@example.com',
        firstName: 'Customer',
        lastName: 'User',
        isNewUser: true
      }
    }

      at log (server/controllers/authController.js:1889:13)

  console.warn
    Email template placeholder [AFFILIATE_ID] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:258:7)

  console.log
    [sendEmail] Sending email to: undefined

      at log (server/utils/emailService.js:127:13)

  console.error
    Error sending email: Error: No recipient email address provided
        at sendEmail (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:131:13)
        at Object.sendEmail [as sendAffiliateWelcomeEmail] (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:345:11)
        at Object.<anonymous>.exports.completeSocialRegistration (/var/www/wavemax/wavemax-affiliate-program/server/controllers/authController.js:1496:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:258:7)

      152 |     return info;
      153 |   } catch (error) {
    > 154 |     console.error('Error sending email:', error);
          |             ^
      155 |     throw error;
      156 |   }
      157 | };

      at error (server/utils/emailService.js:154:13)
      at Object.sendEmail [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:345:11)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:258:7)

  console.error
    Error sending affiliate welcome email: Error: No recipient email address provided
        at sendEmail (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:131:13)
        at Object.sendEmail [as sendAffiliateWelcomeEmail] (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:345:11)
        at Object.<anonymous>.exports.completeSocialRegistration (/var/www/wavemax/wavemax-affiliate-program/server/controllers/authController.js:1496:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:258:7)

      349 |     );
      350 |   } catch (error) {
    > 351 |     console.error('Error sending affiliate welcome email:', error);
          |             ^
      352 |   }
      353 | };
      354 |

      at Object.error [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:351:13)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:258:7)

info: undefined {"action":"SOCIAL_REGISTRATION","details":{"provider":"google","registrationMethod":"social"},"eventType":"ACCOUNT_CREATED","timestamp":"2025-10-17T02:11:18.207Z","userType":"affiliate"}
  console.warn
    Email template placeholder [AFFILIATE_ID] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:352:7)

  console.log
    [sendEmail] Sending email to: undefined

      at log (server/utils/emailService.js:127:13)

  console.error
    Error sending email: Error: No recipient email address provided
        at sendEmail (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:131:13)
        at Object.sendEmail [as sendAffiliateWelcomeEmail] (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:345:11)
        at Object.<anonymous>.exports.completeSocialRegistration (/var/www/wavemax/wavemax-affiliate-program/server/controllers/authController.js:1496:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:352:7)

      152 |     return info;
      153 |   } catch (error) {
    > 154 |     console.error('Error sending email:', error);
          |             ^
      155 |     throw error;
      156 |   }
      157 | };

      at error (server/utils/emailService.js:154:13)
      at Object.sendEmail [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:345:11)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:352:7)

  console.error
    Error sending affiliate welcome email: Error: No recipient email address provided
        at sendEmail (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:131:13)
        at Object.sendEmail [as sendAffiliateWelcomeEmail] (/var/www/wavemax/wavemax-affiliate-program/server/utils/emailService.js:345:11)
        at Object.<anonymous>.exports.completeSocialRegistration (/var/www/wavemax/wavemax-affiliate-program/server/controllers/authController.js:1496:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:352:7)

      349 |     );
      350 |   } catch (error) {
    > 351 |     console.error('Error sending affiliate welcome email:', error);
          |             ^
      352 |   }
      353 | };
      354 |

      at Object.error [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:351:13)
      at Object.<anonymous>.exports.completeSocialRegistration (server/controllers/authController.js:1496:7)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:352:7)

info: undefined {"action":"SOCIAL_REGISTRATION","details":{"provider":"google","registrationMethod":"social"},"eventType":"ACCOUNT_CREATED","timestamp":"2025-10-17T02:11:18.851Z","userType":"affiliate"}
  console.log
    [sendCustomerWelcomeEmail] Customer: { email: undefined, firstName: undefined, customerId: undefined }

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:939:13)

  console.log
    [sendCustomerWelcomeEmail] Affiliate: undefined

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:944:13)

  console.error
    Missing customer or affiliate data for welcome email

      949 |     // Validate inputs
      950 |     if (!customer || !affiliate) {
    > 951 |       console.error('Missing customer or affiliate data for welcome email');
          |               ^
      952 |       return;
      953 |     }
      954 |     

      at Object.error [as sendCustomerWelcomeEmail] (server/utils/emailService.js:951:15)
      at sendCustomerWelcomeEmail (server/controllers/authController.js:2270:26)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:412:7)

info: undefined {"action":"SOCIAL_CUSTOMER_REGISTRATION","details":{"provider":"facebook","registrationMethod":"social"},"eventType":"ACCOUNT_CREATED","timestamp":"2025-10-17T02:11:19.221Z","userType":"customer"}
  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-success',
        provider: 'google',
        socialToken: 'social-jwt-token',
        socialId: 'google123',
        email: 'test@example.com',
        firstName: 'John',
        lastName: 'Doe'
      }
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-success',
        provider: 'google',
        socialToken: 'social-jwt-token',
        socialId: 'google123',
        email: 'test@example.com',
        firstName: 'John',
        lastName: 'Doe'
      }
    }

      at log (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-login',
        token: 'jwt-token',
        refreshToken: 'refresh-token',
        affiliate: {
          affiliateId: 'AFF001',
          id: 'affiliate-id',
          firstName: 'John',
          lastName: 'Doe',
          email: 'john@example.com',
          businessName: 'Test Business'
        }
      }
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-login',
        token: 'jwt-token',
        refreshToken: 'refresh-token',
        affiliate: {
          affiliateId: 'AFF001',
          id: 'affiliate-id',
          firstName: 'John',
          lastName: 'Doe',
          email: 'john@example.com',
          businessName: 'Test Business'
        }
      }
    }

      at log (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-error',
        message: 'Social authentication failed'
      }
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-error',
        message: 'Social authentication failed'
      }
    }

      at log (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with an affiliate account. Would you like to login as an affiliate instead?',
        provider: 'google',
        accountType: 'affiliate',
        affiliateData: {
          affiliateId: 'AFF123456',
          firstName: 'John',
          lastName: 'Affiliate',
          email: 'john@example.com',
          businessName: 'Johns Business'
        }
      }
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with an affiliate account. Would you like to login as an affiliate instead?',
        provider: 'google',
        accountType: 'affiliate',
        affiliateData: {
          affiliateId: 'AFF123456',
          firstName: 'John',
          lastName: 'Affiliate',
          email: 'john@example.com',
          businessName: 'Johns Business'
        }
      }
    }

      at log (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'found',
      resultData: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with a customer account. Would you like to login as a customer instead?',
        provider: 'google',
        accountType: 'customer',
        customerData: {
          firstName: 'Jane',
          lastName: 'Customer',
          email: 'jane@example.com'
        }
      }
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        type: 'social-auth-account-conflict',
        message: 'This social media account is already associated with a customer account. Would you like to login as a customer instead?',
        provider: 'google',
        accountType: 'customer',
        customerData: {
          firstName: 'Jane',
          lastName: 'Customer',
          email: 'jane@example.com'
        }
      }
    }

      at log (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'test-session-123',
      sessionResult: 'not found',
      resultData: null
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: test-session-123

      at log (server/controllers/authController.js:1557:11)

  console.error
    OAuth session polling error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerEnhanced.test.js:615:65)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1592 |
      1593 |   } catch (error) {
    > 1594 |     console.error('OAuth session polling error:', error);
           |             ^
      1595 |     res.status(500).json({
      1596 |       success: false,
      1597 |       message: 'An error occurred while polling OAuth session'

      at error (server/controllers/authController.js:1594:13)
      at Object.<anonymous> (tests/unit/authControllerEnhanced.test.js:618:7)

PASS tests/unit/authControllerEnhanced.test.js (5.349 s)
  Enhanced Auth Controller - OAuth Methods
    handleSocialCallback
      âœ“ should create OAuth session and redirect for affiliate context (357 ms)
      âœ“ should handle customer context from state parameter (172 ms)
      âœ“ should handle missing user data gracefully (163 ms)
      âœ“ should handle OAuth session creation errors (171 ms)
      âœ“ should extract profile data correctly for different providers (170 ms)
    handleCustomerSocialCallback
      âœ“ should create customer OAuth session (161 ms)
    completeSocialRegistration
      âœ“ should complete social registration successfully (229 ms)
      âœ“ should sanitize social data and reject if fields become empty (164 ms)
      âœ“ should check for existing email and username (155 ms)
      âœ“ should check for existing social account (162 ms)
      âœ“ should generate unique username from social data (165 ms)
      âœ“ should handle JWT verification errors (159 ms)
    completeSocialCustomerRegistration
      âœ“ should complete customer social registration successfully (206 ms)
      âœ“ should validate affiliate existence (153 ms)
      âœ“ should sanitize customer social data (153 ms)
    pollOAuthSession
      âœ“ should return complete session data when available (157 ms)
      âœ“ should return social-auth-login session data (155 ms)
      âœ“ should return social-auth-error session data (154 ms)
      âœ“ should return social-auth-account-conflict session data for affiliate conflict (154 ms)
      âœ“ should return social-auth-account-conflict session data for customer conflict (154 ms)
      âœ“ should return pending status when session not ready (158 ms)
      âœ“ should handle database errors gracefully (168 ms)
    Error Handling and Edge Cases
      âœ“ should handle malformed JWT tokens (156 ms)
      âœ“ should handle database connection errors (157 ms)
      âœ“ should handle missing required fields in social data (156 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/passportConfig.test.js
  Passport Configuration Tests
    Strategy Configuration
      âœ“ should configure Google strategy when credentials are present (7 ms)
      âœ“ should not configure Google strategy without credentials (1 ms)
      âœ“ should configure Facebook strategy when credentials are present (2 ms)
      âœ“ should not configure Facebook strategy without credentials (1 ms)
      âœ“ should configure LinkedIn strategy when credentials are present (2 ms)
    Google OAuth Strategy
      âœ“ should handle database errors (2 ms)
      Customer Context
        âœ“ should handle existing customer with Google account (2 ms)
        âœ“ should link Google account to existing customer (1 ms)
        âœ“ should handle existing affiliate conflict (1 ms)
        âœ“ should return new user data (2 ms)
      Affiliate Context
        âœ“ should handle existing affiliate with Google account (8 ms)
        âœ“ should handle customer conflict (2 ms)
        âœ“ should link Google account to existing affiliate with email (2 ms)
        âœ“ should return new affiliate user data (2 ms)
    Facebook OAuth Strategy
      âœ“ should handle existing affiliate (2 ms)
      âœ“ should return new user data for registration (1 ms)
      âœ“ should link Facebook account to existing affiliate (2 ms)
      âœ“ should handle Facebook error (1 ms)
    LinkedIn OAuth Strategy
      âœ“ should handle existing affiliate (2 ms)
      âœ“ should link LinkedIn account to existing affiliate (1 ms)
      âœ“ should return new LinkedIn user data (1 ms)
      âœ“ should handle LinkedIn error (2 ms)
    Serialization
      âœ“ should serialize user with _id (1 ms)
      âœ“ should serialize user with socialId (1 ms)
      âœ“ should deserialize user (1 ms)
      âœ“ should handle deserialization errors (1 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/systemConfig.test.js (8.77 s)
  SystemConfig Model
    Schema Validation
      âœ“ should create a valid system config (126 ms)
      âœ“ should require mandatory fields (85 ms)
      âœ“ should enforce unique key constraint (288 ms)
      âœ“ should validate category enum (82 ms)
      âœ“ should validate dataType enum (83 ms)
      âœ“ should accept all valid categories (409 ms)
      âœ“ should accept all valid data types (247 ms)
      âœ“ should trim string fields (127 ms)
    Value Validation
      Number validation
        âœ“ should reject non-number values for number dataType (82 ms)
        âœ“ should enforce minimum value validation (81 ms)
        âœ“ should enforce maximum value validation (85 ms)
        âœ“ should accept valid number within range (118 ms)
      Boolean validation
        âœ“ should reject non-boolean values for boolean dataType (82 ms)
        âœ“ should accept boolean values (113 ms)
      String validation
        âœ“ should reject non-string values for string dataType (91 ms)
        âœ“ should enforce regex validation (83 ms)
        âœ“ should accept valid string matching regex (119 ms)
      Array validation
        âœ“ should reject non-array values for array dataType (81 ms)
        âœ“ should accept array values (116 ms)
      Object validation
        âœ“ should reject non-object values for object dataType (82 ms)
        âœ“ should reject arrays for object dataType (81 ms)
        âœ“ should accept object values (122 ms)
      Allowed values validation
        âœ“ should enforce allowed values (80 ms)
        âœ“ should accept allowed values (116 ms)
    Static Methods
      getValue
        âœ“ should return config value (146 ms)
        âœ“ should return defaultValue when value is undefined (145 ms)
        âœ“ should return provided default when config not found (106 ms)
        âœ“ should return null when config not found and no default provided (108 ms)
      setValue
        âœ“ should update config value (177 ms)
        âœ“ should throw error for non-existent config (130 ms)
        âœ“ should throw error for non-editable config (146 ms)
        âœ“ should update updatedBy when provided (196 ms)
        âœ“ should validate new value according to dataType (145 ms)
      getByCategory
        âœ“ should return all configs for a category (153 ms)
        âœ“ should return only public configs when specified (146 ms)
        âœ“ should return empty array for non-existent category (164 ms)
        âœ“ should sort by key (226 ms)
      getPublicConfigs
        âœ“ should return only public configs (162 ms)
        âœ“ should sort by category then key (158 ms)
      initializeDefaults
        âœ“ should create default configurations (662 ms)
        âœ“ should not overwrite existing configurations (611 ms)
        âœ“ should add missing configurations (635 ms)
    Timestamps
      âœ“ should auto-generate timestamps on creation (122 ms)
      âœ“ should update updatedAt on modification (250 ms)
    toJSON transformation
      âœ“ should include currentValue in JSON output (116 ms)
      âœ“ should use defaultValue when value is undefined (116 ms)
    Edge Cases
      âœ“ should handle mixed types for value and defaultValue (118 ms)
      âœ“ should handle empty validation object (116 ms)
      âœ“ should skip validation when value is not modified (150 ms)

[32m'info'[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:31.433Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/customerController.test.js
  Customer Controller
    registerCustomer
      âœ“ should successfully register a new customer (272 ms)
      âœ“ should return error for invalid affiliate (102 ms)
      âœ“ should return error for duplicate email (107 ms)
    getCustomerProfile
      âœ“ should return customer profile for authorized customer (113 ms)
      âœ“ should return 403 for unauthorized access (102 ms)
      âœ“ should return 404 for non-existent customer (103 ms)
    updateCustomerProfile
      âœ“ should successfully update customer profile (102 ms)
      âœ“ should prevent updating protected fields (111 ms)
    getCustomerOrders
      âœ“ should return customer orders with pagination (105 ms)
    deleteCustomerData
      âœ“ should delete all customer data when authorized (103 ms)
      âœ“ should reject deletion when there are active orders (104 ms)
      âœ“ should reject unauthorized deletion (102 ms)
      âœ“ should handle deletion errors (103 ms)
    registerCustomer with missing payment info
      âœ“ should handle missing payment info gracefully (103 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:11:33.727Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    V2 registration: 2 free bags, no payment required

      at log (server/controllers/customerController.js:131:13)

  console.log
    Payment version in test: v2

      at Object.log (tests/unit/v2ControllerLogic.test.js:129:15)

  console.log
    V2 registration: 2 free bags, no payment required

      at log (server/controllers/customerController.js:131:13)

  console.log
    Generated V2 payment links for order ORD-71cfc6c1-d099-426e-850d-ae972e213a62 - Amount: $50

      at log (server/controllers/orderController.js:452:17)

  console.log
    V2 payment request would be sent to v2customer@test.com for order ORD-71cfc6c1-d099-426e-850d-ae972e213a62

      at log (server/controllers/orderController.js:457:19)

  console.log
    Customer confirmed payment for order 68f1a5da6bdd69d3ed797e72: { paymentMethod: 'venmo', paymentDetails: undefined }

      at log (server/controllers/orderController.js:1221:13)

  console.log
    Escalating payment timeout for order 68f1a5da6bdd69d3ed797e72 to admin

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:340:15)

  console.log
    Admin escalation details: {
      orderId: 'ORD-d190def5-7a24-4cbb-b382-566b73eaf1dc',
      orderMongoId: new ObjectId('68f1a5da6bdd69d3ed797e72'),
      customerName: 'Test Customer',
      customerEmail: 'v2customer@test.com',
      customerPhone: '555-2222',
      affiliateName: 'Test Affiliate',
      affiliateEmail: 'affiliate@test.com',
      paymentAmount: 45,
      hoursSinceRequest: 0,
      paymentRequestedAt: 2025-10-17T02:11:38.575Z,
      attemptsMade: 0
    }

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:369:15)

  console.log
    Admin escalation email would be sent to admin@wavemax.promo for order 68f1a5da6bdd69d3ed797e72

      at PaymentVerificationJob.log [as escalateToAdmin] (server/jobs/paymentVerificationJob.js:375:15)

  console.warn
    Mailcow API key not configured. Email scanning disabled.

      31 |       
      32 |       if (!encryptedKey) {
    > 33 |         console.warn('Mailcow API key not configured. Email scanning disabled.');
         |                 ^
      34 |         return;
      35 |       }
      36 |       

      at MailcowService.warn [as initialize] (server/services/mailcowService.js:33:17)
      at MailcowService.searchEmails (server/services/mailcowService.js:184:5)
      at PaymentEmailScanner.checkOrderPayment (server/services/paymentEmailScanner.js:433:22)
      at Object.<anonymous>.exports.confirmPayment (server/controllers/orderController.js:1239:22)
      at Object.<anonymous> (tests/unit/v2ControllerLogic.test.js:416:7)

  console.log
    Creating order with data: {
      "customerId": "CUST-86c69e1c-4107-4f2b-aabe-8ce02002e955",
      "affiliateId": "AFF-d874dd36-16d0-4976-9d36-8ab3a22b9561",
      "pickupDate": "2025-10-18T02:11:41.154Z",
      "pickupTime": "morning",
      "numberOfBags": 3,
      "estimatedWeight": 35,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      }
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: false, stainRemover: true }

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST-86c69e1c-4107-4f2b-aabe-8ce02002e955

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: V2 Customer

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF-d874dd36-16d0-4976-9d36-8ab3a22b9561

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:160:11)

  console.log
    V2 customer order - payment will be collected after weighing

      at log (server/controllers/orderController.js:224:15)

  console.log
    Creating order with data: {
      "customerId": "CUST-86c69e1c-4107-4f2b-aabe-8ce02002e955",
      "affiliateId": "AFF-d874dd36-16d0-4976-9d36-8ab3a22b9561",
      "pickupDate": "2025-10-18T02:11:41.154Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "status": "pending",
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-86c69e1c-4107-4f2b-aabe-8ce02002e955",
      "affiliateId": "AFF-d874dd36-16d0-4976-9d36-8ab3a22b9561",
      "pickupDate": "2025-10-18T02:11:41.154Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a5dd6bdd69d3ed797ef2",
      "orderId": "ORD-97564264-5659-47f0-8c5c-63d43e524451",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:11:41.301Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a5dd6bdd69d3ed797ef2",
      "customerId": "CUST-86c69e1c-4107-4f2b-aabe-8ce02002e955",
      "affiliateId": "AFF-d874dd36-16d0-4976-9d36-8ab3a22b9561",
      "pickupDate": "2025-10-18T02:11:41.154Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 7,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-97564264-5659-47f0-8c5c-63d43e524451",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:11:41.301Z",
      "updatedAt": "2025-10-17T02:11:41.301Z",
      "baseRate": 1.25,
      "estimatedTotal": 75.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: false, stainRemover: true }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST-86c69e1c-4107-4f2b-aabe-8ce02002e955",
      "affiliateId": "AFF-d874dd36-16d0-4976-9d36-8ab3a22b9561",
      "pickupDate": "2025-10-18T02:11:41.154Z",
      "pickupTime": "morning",
      "estimatedWeight": 35,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": true
      },
      "addOnTotal": 7,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a5dd6bdd69d3ed797ef2",
      "orderId": "ORD-97564264-5659-47f0-8c5c-63d43e524451",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:11:41.301Z",
      "updatedAt": "2025-10-17T02:11:41.301Z",
      "baseRate": 1.25,
      "estimatedTotal": 75.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Creating order with data: {
      "customerId": "CUST-c4096312-83d7-4d70-a985-d4747f66ea22",
      "affiliateId": "AFF-00160420-04f6-4252-8d2e-55b5b83538c3",
      "pickupDate": "2025-10-19T02:11:42.014Z",
      "pickupTime": "evening",
      "numberOfBags": 1,
      "estimatedWeight": 10
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST-c4096312-83d7-4d70-a985-d4747f66ea22

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: V2 Customer

      at log (server/controllers/orderController.js:132:11)

  console.log
    Customer already has an active order: ORD-653b7ebf-63d7-4f59-8cfa-7c78a1e929ae

      at log (server/controllers/orderController.js:141:13)

  console.error
    Order status update error: Error: QR code generation failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/v2ControllerLogic.test.js:730:9)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

      484 |     });
      485 |   } catch (error) {
    > 486 |     console.error('Order status update error:', error);
          |             ^
      487 |     res.status(500).json({
      488 |       success: false,
      489 |       message: 'An error occurred while updating the order status'

      at error (server/controllers/orderController.js:486:13)
      at Object.<anonymous> (tests/unit/v2ControllerLogic.test.js:754:7)

PASS tests/unit/v2ControllerLogic.test.js (10.726 s)
  V2 Controller Logic
    V2 Customer Registration
      âœ“ should register customer with V2 settings when payment_version is v2 (1151 ms)
      âœ“ should limit initial bags to configured maximum (776 ms)
      âœ“ should default to V1 registration when payment_version is v1 (774 ms)
    V2 Order Processing
      âœ“ should generate payment links when order is weighed (WDF complete) (751 ms)
      âœ“ should not generate payment links for V1 customers (825 ms)
      âœ“ should handle payment confirmation from customer (1002 ms)
      âœ“ should allow admin to manually verify payment (738 ms)
      âœ“ should not send pickup notification until payment is verified (895 ms)
    V2 Order Creation
      âœ“ should create V2 order with pending payment status (802 ms)
      âœ“ should prevent V2 customer from creating order if previous payment pending (679 ms)
    Edge Cases and Error Handling
      âœ“ should handle missing SystemConfig gracefully (772 ms)
      âœ“ should handle payment link generation failure gracefully (751 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Checking email availability for: new@example.com

      at log (server/controllers/authController.js:2401:13)

  console.log
    Email check results: {
      email: 'new@example.com',
      affiliateFound: false,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at log (server/controllers/authController.js:2411:13)

  console.log
    Checking email availability for: existing@example.com

      at log (server/controllers/authController.js:2401:13)

  console.log
    Email check results: {
      email: 'existing@example.com',
      affiliateFound: true,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at log (server/controllers/authController.js:2411:13)

  console.log
    Checking email availability for: customer@example.com

      at log (server/controllers/authController.js:2401:13)

  console.log
    Email check results: {
      email: 'customer@example.com',
      affiliateFound: false,
      customerFound: true,
      administratorFound: false,
      operatorFound: false
    }

      at log (server/controllers/authController.js:2411:13)

  console.log
    Checking email availability for: test@example.com

      at log (server/controllers/authController.js:2401:13)

  console.error
    Check email error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerAdditional.test.js:145:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2425 |
      2426 |   } catch (error) {
    > 2427 |     console.error('Check email error:', error);
           |             ^
      2428 |     res.status(500).json({
      2429 |       success: false,
      2430 |       message: 'Error checking email availability'

      at error (server/controllers/authController.js:2427:13)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:148:7)

  console.log
    Checking username availability for: newuser

      at log (server/controllers/authController.js:2348:13)

  console.log
    Username check results: {
      username: 'newuser',
      affiliateFound: false,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at log (server/controllers/authController.js:2358:13)

  console.log
    Checking username availability for: existinguser

      at log (server/controllers/authController.js:2348:13)

  console.log
    Username check results: {
      username: 'existinguser',
      affiliateFound: true,
      customerFound: false,
      administratorFound: false,
      operatorFound: false
    }

      at log (server/controllers/authController.js:2358:13)

  console.log
    Checking username availability for: testuser

      at log (server/controllers/authController.js:2348:13)

  console.error
    Check username error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerAdditional.test.js:208:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2372 |
      2373 |   } catch (error) {
    > 2374 |     console.error('Check username error:', error);
           |             ^
      2375 |     res.status(500).json({
      2376 |       success: false,
      2377 |       message: 'Error checking username availability'

      at error (server/controllers/authController.js:2374:13)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:211:7)

  console.log
    Auto-login attempt from IP: 127.0.0.1

      at log (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at log (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at log (server/controllers/authController.js:387:13)

  console.log
    Auto-login attempt from IP: 192.168.1.1

      at log (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at log (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at log (server/controllers/authController.js:387:13)

  console.log
    Auto-login denied - IP not whitelisted: 192.168.1.1

      at log (server/controllers/authController.js:390:15)

  console.log
    Auto-login attempt from IP: 127.0.0.1

      at log (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at log (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at log (server/controllers/authController.js:387:13)

  console.error
    Default operator not found: OP001

      400 |     
      401 |     if (!operator) {
    > 402 |       console.error('Default operator not found:', defaultOperatorId);
          |               ^
      403 |       return res.status(404).json({
      404 |         success: false,
      405 |         message: 'Default operator not configured'

      at error (server/controllers/authController.js:402:15)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:312:7)

  console.log
    Auto-login attempt from IP: 127.0.0.1

      at log (server/controllers/authController.js:382:13)

  console.log
    Whitelisted IPs: [ '127.0.0.1' ]

      at log (server/controllers/authController.js:386:13)

  console.log
    Whitelisted Ranges: []

      at log (server/controllers/authController.js:387:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'affiliate' },
      headers: { referer: 'http://localhost:3000', 'user-agent': 'test-user-agent' },
      state: 'affiliate',
      stateStartsWithCustomer: false
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'affiliate', isCustomerRequest: false, willDelegate: false }

      at log (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'affiliate',
      sessionId: null,
      allParams: { state: 'affiliate' }
    }

      at log (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: 'affiliate',
      referer: 'http://localhost:3000',
      isPopup: false,
      userIsNew: false
    }

      at log (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'exists',
      query: { state: 'affiliate' },
      headers: { referer: 'http://localhost:3000', 'user-agent': 'test-user-agent' },
      state: 'affiliate',
      stateStartsWithCustomer: false
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'affiliate', isCustomerRequest: false, willDelegate: false }

      at log (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'affiliate',
      sessionId: null,
      allParams: { state: 'affiliate' }
    }

      at log (server/controllers/authController.js:1007:13)

  console.log
    OAuth Callback Debug: {
      popup: undefined,
      state: 'affiliate',
      referer: 'http://localhost:3000',
      isPopup: false,
      userIsNew: undefined
    }

      at log (server/controllers/authController.js:1052:13)

  console.log
    [OAuth] handleSocialCallback called with: {
      user: 'null',
      query: { state: 'affiliate' },
      headers: { referer: 'http://localhost:3000', 'user-agent': 'test-user-agent' },
      state: 'affiliate',
      stateStartsWithCustomer: false
    }

      at log (server/controllers/authController.js:976:11)

  console.log
    [OAuth] Customer request check: { state: 'affiliate', isCustomerRequest: false, willDelegate: false }

      at log (server/controllers/authController.js:989:13)

  console.log
    OAuth Callback State Parameter Debug: {
      state: 'affiliate',
      sessionId: null,
      allParams: { state: 'affiliate' }
    }

      at log (server/controllers/authController.js:1007:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'existing-customer',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at log (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at log (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: 'http://localhost:3000',
      isPopup: true,
      userIsNew: false
    }

      at log (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Called with: {
      user: 'exists',
      userType: 'new-user',
      query: { state: 'customer_oauth_test-session-id' },
      url: undefined,
      originalUrl: undefined
    }

      at log (server/controllers/authController.js:1606:11)

  console.log
    Customer OAuth Callback State Parameter Debug: {
      state: 'customer_oauth_test-session-id',
      sessionId: 'oauth_test',
      allParams: { state: 'customer_oauth_test-session-id' }
    }

      at log (server/controllers/authController.js:1640:13)

  console.log
    Customer OAuth Callback Debug: {
      popup: undefined,
      state: 'customer_oauth_test-session-id',
      referer: 'http://localhost:3000',
      isPopup: true,
      userIsNew: true
    }

      at log (server/controllers/authController.js:1759:13)

  console.log
    [handleCustomerSocialCallback] Checking for existing affiliate: {
      isExistingAffiliate: undefined,
      userObject: {
        provider: 'google',
        socialId: 'google123',
        email: 'jane@example.com',
        firstName: 'Jane',
        lastName: 'Doe',
        isNewUser: true,
        displayName: 'Jane Doe'
      }
    }

      at log (server/controllers/authController.js:1889:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: session123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'session123',
      sessionResult: 'found',
      resultData: {
        sessionId: 'session123',
        status: 'completed',
        userId: 'user123',
        userType: 'affiliate',
        token: 'mock-token'
      }
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: {
        sessionId: 'session123',
        status: 'completed',
        userId: 'user123',
        userType: 'affiliate',
        token: 'mock-token'
      }
    }

      at log (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: session123

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: {
      sessionId: 'session123',
      sessionResult: 'found',
      resultData: { sessionId: 'session123', status: 'pending' }
    }

      at log (server/controllers/authController.js:1571:13)

  console.log
    Sending OAuth response: {
      success: true,
      result: { sessionId: 'session123', status: 'pending' }
    }

      at log (server/controllers/authController.js:1590:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: invalid

      at log (server/controllers/authController.js:1557:11)

  console.log
    OAuth Session Polling Debug: { sessionId: 'invalid', sessionResult: 'not found', resultData: null }

      at log (server/controllers/authController.js:1571:13)

  console.log
    [OAuth] pollOAuthSession called for sessionId: session123

      at log (server/controllers/authController.js:1557:11)

  console.error
    OAuth session polling error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/authControllerAdditional.test.js:862:53)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1592 |
      1593 |   } catch (error) {
    > 1594 |     console.error('OAuth session polling error:', error);
           |             ^
      1595 |     res.status(500).json({
      1596 |       success: false,
      1597 |       message: 'An error occurred while polling OAuth session'

      at error (server/controllers/authController.js:1594:13)
      at Object.<anonymous> (tests/unit/authControllerAdditional.test.js:865:7)

PASS tests/unit/authControllerAdditional.test.js
  Auth Controller - Additional Coverage
    checkEmail
      âœ“ should return available when email does not exist (6 ms)
      âœ“ should return not available when email exists in Affiliate (1 ms)
      âœ“ should return not available when email exists in Customer (2 ms)
      âœ“ should handle errors (15 ms)
      âœ“ should return error for missing email (1 ms)
    checkUsername
      âœ“ should return available when username does not exist (2 ms)
      âœ“ should return not available when username exists (1 ms)
      âœ“ should handle errors (3 ms)
      âœ“ should return error for missing username
    operatorAutoLogin
      âœ“ should auto-login operator from store IP (5 ms)
      âœ“ should fail from invalid IP (9 ms)
      âœ“ should handle missing default operator (4 ms)
      âœ“ should handle inactive operator (2 ms)
    handleSocialCallback
      âœ“ should handle successful social auth callback for affiliate (3 ms)
      âœ“ should redirect new user to registration (6 ms)
      âœ“ should handle errors (2 ms)
    handleCustomerSocialCallback
      âœ“ should handle customer social auth callback (2 ms)
      âœ“ should handle new customer registration (2 ms)
    completeSocialRegistration
      âœ“ should complete affiliate social registration (17 ms)
      âœ“ should handle existing email (1 ms)
      âœ“ should handle invalid token
      âœ“ should handle missing social data (4 ms)
    completeSocialCustomerRegistration
      âœ“ should complete customer social registration (1 ms)
      âœ“ should handle invalid affiliate code
    pollOAuthSession
      âœ“ should return completed session data (2 ms)
      âœ“ should return session data for pending session (2 ms)
      âœ“ should handle session not found (1 ms)
      âœ“ should handle errors (2 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/unit/operator.test.js (10.59 s)
  Operator Model
    Schema Validation
      âœ“ should create a valid operator (183 ms)
      âœ“ should require all mandatory fields (91 ms)
      âœ“ should enforce email format validation (94 ms)
      âœ“ should enforce unique email constraint (751 ms)
      âœ“ should enforce unique username constraint (658 ms)
      âœ“ should validate username format (78 ms)
      âœ“ should validate shift time format (78 ms)
      âœ“ should accept valid shift times (161 ms)
      âœ“ should enforce quality score range (78 ms)
      âœ“ should trim whitespace from string fields (165 ms)
      âœ“ should convert email and username to lowercase (164 ms)
      âœ“ should not allow role to be changed after creation (221 ms)
    Password Handling
      âœ“ should hash password on save (192 ms)
      âœ“ should verify correct password (249 ms)
      âœ“ should reject incorrect password (239 ms)
      âœ“ should not expose password in JSON output (157 ms)
    Login Attempts and Account Locking
      âœ“ should increment login attempts (218 ms)
      âœ“ should lock account after 5 failed attempts (448 ms)
      âœ“ should lock for 30 minutes (450 ms)
      âœ“ should reset login attempts on successful login (281 ms)
      âœ“ should reset attempts if lock has expired (252 ms)
      âœ“ should correctly identify locked accounts (172 ms)
    Password Reset
      âœ“ should generate password reset token (79 ms)
      âœ“ should set password reset expiry to 30 minutes (80 ms)
    Shift Management
      isOnShift virtual
        âœ“ should return true when no shift times are set (79 ms)
        âœ“ should correctly identify operator on shift during normal hours (77 ms)
        âœ“ should correctly identify operator off shift (77 ms)
        âœ“ should handle overnight shifts correctly (79 ms)
    Processing Statistics
      âœ“ should update processing stats correctly (194 ms)
      âœ“ should handle first order processing (195 ms)
      âœ“ should update quality score with passing result (217 ms)
      âœ“ should update quality score with failing result (196 ms)
    Static Methods
      findActive
        âœ“ should find only active operators (281 ms)
      findOnShift
        âœ“ should find only operators on shift (289 ms)
      findByEmailWithPassword
        âœ“ should find operator by email with password (187 ms)
        âœ“ should handle case-insensitive email search (185 ms)
        âœ“ should return null for non-existent email (103 ms)
      findAvailableOperators
        âœ“ should find operators with low order count (278 ms)
        âœ“ should sort by current order count (301 ms)
        âœ“ should respect limit parameter (935 ms)
    Timestamps
      âœ“ should auto-generate timestamps on creation (170 ms)
      âœ“ should update updatedAt on modification (303 ms)
    Operator ID Generation
      âœ“ should auto-generate unique operator ID (256 ms)
      âœ“ should not override provided operator ID (161 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Failed to initiate W9 signing: Error: Template not found
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/w9ControllerDocuSign.test.js:250:58)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      258 |     });
      259 |   } catch (error) {
    > 260 |     console.error('Failed to initiate W9 signing:', error);
          |             ^
      261 |     logger.error('Failed to initiate W9 signing:', error);
      262 |     res.status(500).json({
      263 |       error: 'Failed to create W9 signing session',

      at error (server/controllers/w9ControllerDocuSign.js:260:13)

  console.log
    Envelope mismatch: { expected: 'test_envelope_id', received: 'wrong_envelope_id' }

      at log (server/controllers/w9ControllerDocuSign.js:291:15)

  console.log
    Envelope mismatch: { expected: undefined, received: 'test_envelope_id' }

      at log (server/controllers/w9ControllerDocuSign.js:291:15)

PASS tests/unit/w9ControllerDocuSign.test.js (7.984 s)
  W9 Controller DocuSign Methods
    Check DocuSign Auth
      âœ“ should return authorized true if valid token exists (254 ms)
      âœ“ should return authorization URL if no valid token (125 ms)
      âœ“ should handle service errors (130 ms)
    OAuth Callback
      âœ“ should handle successful OAuth callback (121 ms)
      âœ“ should handle missing authorization code (118 ms)
      âœ“ should handle missing state parameter (119 ms)
      âœ“ should display error page on token exchange failure (121 ms)
    Initiate W9 Signing
      âœ“ should create new envelope and return signing URL (206 ms)
      âœ“ should return existing envelope if one is in progress (176 ms)
      âœ“ should require DocuSign authorization if no valid token (144 ms)
      âœ“ should handle affiliate not found (170 ms)
      âœ“ should handle envelope creation errors (156 ms)
    Get Envelope Status
      âœ“ should return envelope status from DocuSign (739 ms)
      âœ“ should handle mismatched envelope ID (185 ms)
      âœ“ should handle affiliate with no W9 information (209 ms)
      âœ“ should return local status if DocuSign API fails (178 ms)
      âœ“ should clear envelope ID if declined (239 ms)
    DocuSign Webhook
      âœ“ should process completed envelope webhook (238 ms)
      âœ“ should reject webhook with invalid signature (120 ms)
      âœ“ should handle affiliate not found (148 ms)
      âœ“ should process completed W9 without downloading document (241 ms)
    Check Authorization Status
      âœ“ should return authorized true if valid token exists (118 ms)
      âœ“ should return authorized false if no valid token (131 ms)
      âœ“ should handle service errors (116 ms)
    Get W9 Signing Status
      âœ“ should return W9 status for affiliate (118 ms)
      âœ“ should include tax info for verified W9 (119 ms)
      âœ“ should check DocuSign status for in-progress envelopes (121 ms)
      âœ“ should handle affiliate not found (120 ms)
      âœ“ should handle errors gracefully (116 ms)
    Cancel W9 Signing
      âœ“ should cancel W9 signing successfully (221 ms)
      âœ“ should handle no W9 signing in progress (149 ms)
      âœ“ should handle affiliate not found (117 ms)
      âœ“ should handle void envelope errors (146 ms)
    Resend W9 Request
      âœ“ should resend W9 request successfully (169 ms)
      âœ“ should handle affiliate not found (118 ms)
      âœ“ should continue if voiding existing envelope fails (188 ms)
      âœ“ should handle envelope creation errors (118 ms)
    Send W9 To Affiliate
      âœ“ should send W9 to affiliate successfully (149 ms)
      âœ“ should handle affiliate not found (123 ms)
      âœ“ should prevent sending to affiliate with verified W9 (127 ms)
      âœ“ should prevent sending to affiliate with submitted W9 (120 ms)
      âœ“ should handle authorization errors (117 ms)
      âœ“ should handle template configuration errors (119 ms)
      âœ“ should handle general errors (122 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching administrators: TypeError: Administrator.find(...).select is not a function
        at select (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:56:8)
        at Object.getAdministrators (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerEnhanced.test.js:161:15)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      73 |
      74 |   } catch (error) {
    > 75 |     console.error('Error fetching administrators:', error);
         |             ^
      76 |     res.status(500).json({
      77 |       success: false,
      78 |       message: 'Failed to fetch administrators'

      at error (server/controllers/administratorController.js:75:13)
      at Object.getAdministrators (tests/unit/administratorControllerEnhanced.test.js:161:15)

  console.error
    Error updating operator profile: TypeError: updatedOperator.toObject is not a function
        at toObject (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:2258:70)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerEnhanced.test.js:1078:9)

      2264 |     });
      2265 |   } catch (error) {
    > 2266 |     console.error('Error updating operator profile:', error);
           |             ^
      2267 |     res.status(500).json({
      2268 |       success: false,
      2269 |       message: 'An error occurred while updating the profile'

      at error (server/controllers/administratorController.js:2266:13)
      at Object.<anonymous> (tests/unit/administratorControllerEnhanced.test.js:1078:9)

  console.error
    Error fetching administrators: Error: Connection timeout
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorControllerEnhanced.test.js:1093:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      73 |
      74 |   } catch (error) {
    > 75 |     console.error('Error fetching administrators:', error);
         |             ^
      76 |     res.status(500).json({
      77 |       success: false,
      78 |       message: 'Failed to fetch administrators'

      at error (server/controllers/administratorController.js:75:13)
      at Object.<anonymous> (tests/unit/administratorControllerEnhanced.test.js:1096:7)

PASS tests/unit/administratorControllerEnhanced.test.js
  Administrator Controller - Enhanced Coverage
    Administrator Management
      getAdministrators
        âœ“ should get all administrators with pagination (209 ms)
        âœ“ should filter administrators by search query (53 ms)
        âœ“ should handle database errors (103 ms)
      getAdministratorById
        âœ“ should get administrator by ID (52 ms)
        âœ“ should return 404 for non-existent administrator (52 ms)
        âœ“ should return 400 for invalid ObjectId (64 ms)
      createAdministrator
        âœ“ should create new administrator with valid data (102 ms)
        âœ“ should return validation errors (54 ms)
        âœ“ should handle duplicate email error (52 ms)
      updateAdministrator
        âœ“ should update administrator successfully (52 ms)
        âœ“ should not allow self-demotion of last super admin (61 ms)
      deleteAdministrator
        âœ“ should delete administrator successfully (55 ms)
        âœ“ should prevent self-deletion (52 ms)
        âœ“ should prevent deletion of last administrator (52 ms)
      resetAdministratorPassword
        âœ“ should reset administrator password (102 ms)
        âœ“ should handle email sending failure (100 ms)
      getPermissions
        âœ“ should return all available permissions (55 ms)
    Operator Management Extensions
      deactivateOperator
        âœ“ should deactivate operator (52 ms)
        âœ“ should handle non-existent operator (52 ms)
      resetOperatorPassword
        âœ“ should reset operator password and send email (52 ms)
      resetOperatorPin
        âœ“ should reset operator PIN (52 ms)
        âœ“ should validate PIN format (53 ms)
      deleteOperator
        âœ“ should delete operator permanently (52 ms)
      getAvailableOperators
        âœ“ should get available operators for assignment (52 ms)
      updateOperatorStats
        âœ“ should update operator statistics (54 ms)
    Analytics Extensions
      getOperatorAnalytics
        âœ“ should get operator analytics with date range (53 ms)
        âœ“ should handle missing date range (53 ms)
      getAffiliateAnalytics
        âœ“ should get affiliate analytics (54 ms)
      exportReport
        âœ“ should export report as CSV (54 ms)
        âœ“ should export report as JSON (53 ms)
        âœ“ should reject invalid report type (52 ms)
    Operator Self-Management
      getOperatorSelf
        âœ“ should get current operator profile (53 ms)
        âœ“ should handle non-operator users (52 ms)
      updateOperatorSelf
        âœ“ should allow operator to update own profile (52 ms)
        âœ“ should prevent changing restricted fields (53 ms)
    Error Handling
      âœ“ should handle database connection errors (53 ms)
      âœ“ should handle validation errors (58 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.warn
    Welcome email could not be sent: Error: Email failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:284:64)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      204 |       // Email sent successfully - no need to check result
      205 |     } catch (emailError) {
    > 206 |       console.warn('Welcome email could not be sent:', emailError);
          |               ^
      207 |       // Continue with registration process even if email fails
      208 |     }
      209 |

      at Object.warn [as registerAffiliate] (server/controllers/affiliateController.js:206:15)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:286:7)

  console.error
    Affiliate registration error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:298:57)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      214 |     });
      215 |   } catch (error) {
    > 216 |     console.error('Affiliate registration error:', error);
          |             ^
      217 |     res.status(500).json({
      218 |       success: false,
      219 |       message: 'An error occurred during registration'

      at Object.error [as registerAffiliate] (server/controllers/affiliateController.js:216:13)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:315:7)

  console.error
    Error decrypting PayPal email: Error: Decryption failed
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:377:15)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at Object.mockConstructor [as decrypt] (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at decrypt (/var/www/wavemax/wavemax-affiliate-program/server/controllers/affiliateController.js:277:26)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at Object.getAffiliateProfile (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:26:7)
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:380:7)

      278 |         : affiliate.paypalEmail;
      279 |     } catch (error) {
    > 280 |       console.error('Error decrypting PayPal email:', error);
          |               ^
      281 |       // Don't include if decryption fails
      282 |     }
      283 |   }

      at error (server/controllers/affiliateController.js:280:15)
      at Object.getAffiliateProfile (tests/unit/affiliateController.test.js:26:7)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:380:7)

  console.error
    Delete affiliate data error: Error: Database error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/affiliateController.test.js:1132:55)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      961 |     });
      962 |   } catch (error) {
    > 963 |     console.error('Delete affiliate data error:', error);
          |             ^
      964 |     res.status(500).json({
      965 |       success: false,
      966 |       message: 'An error occurred while deleting data'

      at Object.error [as deleteAffiliateData] (server/controllers/affiliateController.js:963:13)
      at Object.<anonymous> (tests/unit/affiliateController.test.js:1134:7)

PASS tests/unit/affiliateController.test.js
  Affiliate Controller
    registerAffiliate
      âœ“ should successfully register a new affiliate (58 ms)
      âœ“ should return validation errors (59 ms)
      âœ“ should handle duplicate email or username (58 ms)
      âœ“ should handle email service failure gracefully (80 ms)
      âœ“ should handle database errors (53 ms)
      âœ“ should return 404 for non-existent affiliate (51 ms)
      âœ“ should return 403 for unauthorized access (52 ms)
      âœ“ should handle decryption errors gracefully (64 ms)
    updateAffiliateProfile
      âœ“ should successfully update affiliate profile (52 ms)
      âœ“ should handle password change (53 ms)
      âœ“ should reject incorrect current password (52 ms)
      âœ“ should update payment method (53 ms)
    getAffiliateEarnings
      âœ“ should return earnings for specified period (52 ms)
      âœ“ should handle different time periods (50 ms)
      âœ“ should handle missing customers gracefully (51 ms)
    getAffiliateCustomers
      âœ“ should return paginated customers with search (52 ms)
      âœ“ should handle different sort options (52 ms)
    getAffiliateOrders
      âœ“ should return filtered orders (52 ms)
      âœ“ should handle date filters correctly (52 ms)
    getAffiliateTransactions
      âœ“ should return paginated transactions (53 ms)
    getAffiliateDashboardStats
      âœ“ should return comprehensive dashboard statistics (52 ms)
      âœ“ should handle empty data gracefully (58 ms)
    getPublicAffiliateInfo
      âœ“ should return only public affiliate information (59 ms)
      âœ“ should return 404 for non-existent affiliate (52 ms)
    Error handling
      âœ“ should handle database connection errors (57 ms)
    deleteAffiliateData
      âœ“ should delete all affiliate data in development environment (54 ms)
      âœ“ should reject deletion in production environment (53 ms)
      âœ“ should reject unauthorized deletion (52 ms)
      âœ“ should handle deletion errors (53 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.error
    Error fetching administrators: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:381:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      73 |
      74 |   } catch (error) {
    > 75 |     console.error('Error fetching administrators:', error);
         |             ^
      76 |     res.status(500).json({
      77 |       success: false,
      78 |       message: 'Failed to fetch administrators'

      at Object.error [as getAdministrators] (server/controllers/administratorController.js:75:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:384:7)

  console.error
    Error fetching administrator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:815:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      111 |
      112 |   } catch (error) {
    > 113 |     console.error('Error fetching administrator:', error);
          |             ^
      114 |     res.status(500).json({
      115 |       success: false,
      116 |       message: 'Failed to fetch administrator'

      at Object.error [as getAdministratorById] (server/controllers/administratorController.js:113:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:818:7)

  console.error
    Error changing administrator password: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:930:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      546 |
      547 |   } catch (error) {
    > 548 |     console.error('Error changing administrator password:', error);
          |             ^
      549 |     res.status(500).json({
      550 |       success: false,
      551 |       message: 'Failed to change password'

      at Object.error [as changeAdministratorPassword] (server/controllers/administratorController.js:548:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:933:7)

  console.error
    Error fetching operator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:997:47)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      851 |
      852 |   } catch (error) {
    > 853 |     console.error('Error fetching operator:', error);
          |             ^
      854 |     res.status(500).json({
      855 |       success: false,
      856 |       message: 'Failed to fetch operator details'

      at Object.error [as getOperatorById] (server/controllers/administratorController.js:853:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1000:7)

  console.error
    Error resetting operator password: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1063:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1036 |
      1037 |   } catch (error) {
    > 1038 |     console.error('Error resetting operator password:', error);
           |             ^
      1039 |     res.status(500).json({
      1040 |       success: false,
      1041 |       message: 'Failed to reset operator password'

      at Object.error [as resetOperatorPassword] (server/controllers/administratorController.js:1038:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1065:7)

  console.error
    Error fetching operator analytics: Error: Aggregation Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1118:41)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1512 |
      1513 |   } catch (error) {
    > 1514 |     console.error('Error fetching operator analytics:', error);
           |             ^
      1515 |     res.status(500).json({
      1516 |       success: false,
      1517 |       message: 'Failed to fetch operator analytics'

      at Object.error [as getOperatorAnalytics] (server/controllers/administratorController.js:1514:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1120:7)

  console.error
    Error fetching affiliate analytics: Error: Aggregation Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1172:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1614 |
      1615 |   } catch (error) {
    > 1616 |     console.error('Error fetching affiliate analytics:', error);
           |             ^
      1617 |     res.status(500).json({
      1618 |       success: false,
      1619 |       message: 'Failed to fetch affiliate analytics'

      at Object.error [as getAffiliateAnalytics] (server/controllers/administratorController.js:1616:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1174:7)

  console.error
    Error exporting report: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1294:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1679 |
      1680 |   } catch (error) {
    > 1681 |     console.error('Error exporting report:', error);
           |             ^
      1682 |     res.status(500).json({
      1683 |       success: false,
      1684 |       message: 'Failed to export report'

      at Object.error [as exportReport] (server/controllers/administratorController.js:1681:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1297:7)

  console.error
    Error fetching affiliates list: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1340:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      1733 |     });
      1734 |   } catch (error) {
    > 1735 |     console.error('Error fetching affiliates list:', error);
           |             ^
      1736 |     res.status(500).json({
      1737 |       success: false,
      1738 |       message: 'Failed to fetch affiliates list',

      at Object.error [as getAffiliatesList] (server/controllers/administratorController.js:1735:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1343:7)

  console.error
    Error updating operator stats: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1520:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2083 |     });
      2084 |   } catch (error) {
    > 2085 |     console.error('Error updating operator stats:', error);
           |             ^
      2086 |     res.status(500).json({
      2087 |       success: false,
      2088 |       message: 'An error occurred while updating operator statistics'

      at Object.error [as updateOperatorStats] (server/controllers/administratorController.js:2085:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1522:7)

  console.error
    Error getting available operators: TypeError: Operator.find(...).sort(...).limit is not a function
        at Object.limit [as getAvailableOperators] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:2106:8)
        at Object.getAvailableOperators (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1570:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2112 |     });
      2113 |   } catch (error) {
    > 2114 |     console.error('Error getting available operators:', error);
           |             ^
      2115 |     res.status(500).json({
      2116 |       success: false,
      2117 |       message: 'An error occurred while fetching available operators'

      at Object.error [as getAvailableOperators] (server/controllers/administratorController.js:2114:13)
      at Object.getAvailableOperators (tests/unit/administratorController.test.js:1570:37)

  console.error
    Error deleting operator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1624:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2162 |     });
      2163 |   } catch (error) {
    > 2164 |     console.error('Error deleting operator:', error);
           |             ^
      2165 |     res.status(500).json({
      2166 |       success: false,
      2167 |       message: 'An error occurred while deleting the operator'

      at Object.error [as deleteOperator] (server/controllers/administratorController.js:2164:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1626:7)

  console.error
    Error resetting operator PIN: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1684:43)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2210 |     });
      2211 |   } catch (error) {
    > 2212 |     console.error('Error resetting operator PIN:', error);
           |             ^
      2213 |     res.status(500).json({
      2214 |       success: false,
      2215 |       message: 'An error occurred while resetting the PIN'

      at Object.error [as resetOperatorPin] (server/controllers/administratorController.js:2212:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1686:7)

  console.error
    Error fetching environment variables: TypeError: Cannot read properties of undefined (reading 'DEFAULT_ADMIN_EMAIL')
        at Object.DEFAULT_ADMIN_EMAIL [as getEnvironmentVariables] (/var/www/wavemax/wavemax-affiliate-program/server/controllers/administratorController.js:2399:56)
        at Object.getEnvironmentVariables (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1732:37)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      2456 |
      2457 |   } catch (error) {
    > 2458 |     console.error('Error fetching environment variables:', error);
           |             ^
      2459 |     res.status(500).json({
      2460 |       success: false,
      2461 |       message: 'Failed to fetch environment variables'

      at Object.error [as getEnvironmentVariables] (server/controllers/administratorController.js:2458:13)
      at Object.getEnvironmentVariables (tests/unit/administratorController.test.js:1732:37)

  console.error
    Error updating administrator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1852:45)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      315 |
      316 |   } catch (error) {
    > 317 |     console.error('Error updating administrator:', error);
          |             ^
      318 |     res.status(500).json({
      319 |       success: false,
      320 |       message: 'Failed to update administrator'

      at Object.error [as updateAdministrator] (server/controllers/administratorController.js:317:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1855:7)

  console.error
    Error deleting administrator: Error: DB Error
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/unit/administratorController.test.js:1889:44)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      387 |
      388 |   } catch (error) {
    > 389 |     console.error('Error deleting administrator:', error);
          |             ^
      390 |     res.status(500).json({
      391 |       success: false,
      392 |       message: 'Failed to delete administrator'

      at Object.error [as deleteAdministrator] (server/controllers/administratorController.js:389:13)
      at Object.<anonymous> (tests/unit/administratorController.test.js:1891:7)

PASS tests/unit/administratorController.test.js
  Administrator Controller
    getAdministrators
      âœ“ should get administrators with pagination (1 ms)
      âœ“ should handle errors (31 ms)
    createAdministrator
      âœ“ should create administrator
      âœ“ should handle validation errors (1 ms)
    updateAdministrator
      âœ“ should update administrator
      âœ“ should prevent self-deactivation
    deleteAdministrator
      âœ“ should delete administrator
      âœ“ should prevent self-deletion
    resetAdministratorPassword
      âœ“ should reset password (1 ms)
    Operator Management
      âœ“ createOperator should create new operator (1 ms)
      âœ“ getOperators should return operators list
      âœ“ updateOperator should update operator details (1 ms)
      âœ“ deactivateOperator should deactivate operator
    Analytics Functions
      âœ“ getDashboard should return dashboard data (1 ms)
      âœ“ getOrderAnalytics should return order analytics (1 ms)
    System Configuration
      âœ“ getSystemConfig should return configurations
      âœ“ updateSystemConfig should update configuration (1 ms)
    getPermissions
      âœ“ should return available permissions
    getAdministratorById
      âœ“ should get administrator by id (1 ms)
      âœ“ should handle not found
      âœ“ should handle errors (2 ms)
    changeAdministratorPassword
      âœ“ should change password successfully (4 ms)
      âœ“ should reject incorrect current password
      âœ“ should validate new password strength (1 ms)
      âœ“ should handle errors (1 ms)
    getOperatorById
      âœ“ should get operator by id
      âœ“ should handle operator not found (1 ms)
      âœ“ should handle errors (1 ms)
    resetOperatorPassword
      âœ“ should reset operator password
      âœ“ should handle operator not found
      âœ“ should handle errors (1 ms)
    getOperatorAnalytics
      âœ“ should get operator analytics
      âœ“ should handle errors (1 ms)
    getAffiliateAnalytics
      âœ“ should get affiliate analytics
      âœ“ should handle errors (2 ms)
    exportReport
      âœ“ should export orders report
      âœ“ should export operators report (1 ms)
      âœ“ should handle invalid report type
      âœ“ should handle errors (2 ms)
    getAffiliatesList
      âœ“ should get affiliates list
      âœ“ should handle errors (2 ms)
    getSystemHealth
      âœ“ should get system health status (1 ms)
      âœ“ should handle database connection issues
      âœ“ should handle errors (1 ms)
    updateOperatorStats
      âœ“ should update operator stats with processing time
      âœ“ should handle operator not found (1 ms)
      âœ“ should validate processing time
      âœ“ should handle errors (2 ms)
    getAvailableOperators
      âœ“ should get available operators
      âœ“ should handle errors (30 ms)
    deleteOperator
      âœ“ should delete operator (1 ms)
      âœ“ should prevent deletion with active orders
      âœ“ should handle errors (2 ms)
    resetOperatorPin
      âœ“ should reset operator PIN
      âœ“ should handle operator not found
      âœ“ should handle errors (2 ms)
    getEnvironmentVariables
      âœ“ should get environment variables (1 ms)
      âœ“ should handle errors (2 ms)
    Additional coverage for getAdministrators
      âœ“ should handle search with active filter (1 ms)
    Additional coverage for createAdministrator
      âœ“ should handle duplicate email
      âœ“ should handle password validation failure
    Additional coverage for updateAdministrator
      âœ“ should handle administrator not found
      âœ“ should handle database errors (1 ms)
    Additional coverage for deleteAdministrator
      âœ“ should prevent deleting last super admin (1 ms)
      âœ“ should handle database errors (1 ms)
    Additional coverage for resetAdministratorPassword
      âœ“ should handle admin not found
      âœ“ should handle weak password

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:12.470Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:13.533Z"}
  console.log
    CSRF token generation: {
      sessionID: '13cbb231ad683ec85b8c96bbe9b56fb2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: weF7M0B0-tzzRqDR7eG274vM_sHE7GOGH_AY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 13cbb231ad683ec85b8c96bbe9b56fb2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KnWS0DvK19...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 17.424 ms - 67[0m
[34mdebug[39m: POST /api/v1/administrators/reset-rate-limits {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:13.567Z"}
  console.log
    CSRF check for: /api/v1/administrators/reset-rate-limits {
      sessionID: '13cbb231ad683ec85b8c96bbe9b56fb2',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A13cbb231ad683ec85b8c96bbe9b56fb2.JPn3r6hy6hXUhxsOCPgWFxaUG7D05Llq46NOrxLSptg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/reset-rate-limits [32m200[0m 197.057 ms - 72[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:14.802Z"}
  console.log
    CSRF token generation: {
      sessionID: '8792b57f25b24a6f975a7ce93dd1abb3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4sFbDZyI-ZQKxGfgTfwloxQ4JK74HRd4vnu0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8792b57f25b24a6f975a7ce93dd1abb3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: FoUMssLiKU...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.145 ms - 67[0m
[34mdebug[39m: POST /api/v1/administrators/reset-rate-limits {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:14.810Z"}
  console.log
    CSRF check for: /api/v1/administrators/reset-rate-limits {
      sessionID: '8792b57f25b24a6f975a7ce93dd1abb3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A8792b57f25b24a6f975a7ce93dd1abb3.8FhSGmmJdC%2FIGmSO2ogUKLPmyvv11NqYiO646IIKFGQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/reset-rate-limits [32m200[0m 82.049 ms - 72[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:15.782Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cf682206322614f18205215751f8251a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: SZRE1ySA-LsWj9E5VgeTC_F6uJpzCefUHkWI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cf682206322614f18205215751f8251a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9zySz4aGYu...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.698 ms - 67[0m
[34mdebug[39m: POST /api/v1/administrators/reset-rate-limits {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:15.795Z"}
  console.log
    CSRF check for: /api/v1/administrators/reset-rate-limits {
      sessionID: 'cf682206322614f18205215751f8251a',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Acf682206322614f18205215751f8251a.aRJsQ4tikckY2vqDr1eEqeFYkqWs4xYF0zBWzf83t9w',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/reset-rate-limits [32m200[0m 83.334 ms - 72[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:16.783Z"}
  console.log
    CSRF token generation: {
      sessionID: '7f1bfa49aeb100735e11a99f099fd8b8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: VU9JlW8j-J2xONSPdZ27XBcRWT3GVZircvAs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7f1bfa49aeb100735e11a99f099fd8b8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ZmPsU_iDo7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.400 ms - 67[0m
[34mdebug[39m: POST /api/v1/administrators/reset-rate-limits {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:16.824Z"}
  console.log
    CSRF check for: /api/v1/administrators/reset-rate-limits {
      sessionID: '7f1bfa49aeb100735e11a99f099fd8b8',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7f1bfa49aeb100735e11a99f099fd8b8.n5NaV7fdbUmahB9VNIAJzQHK5%2FT9dXQc%2Bq8k7HTV7O4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/reset-rate-limits [33m403[0m 62.153 ms - 78[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:17.777Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b74caa6003002c56e27812138447e17f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: oxmMhwYS-jjHWzrbzTR6DzFAZQj0jIGFNWBQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b74caa6003002c56e27812138447e17f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: z7Rr2F8qn7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.178 ms - 67[0m
[34mdebug[39m: POST /api/v1/administrators/reset-rate-limits {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:17.786Z"}
  console.log
    CSRF check for: /api/v1/administrators/reset-rate-limits {
      sessionID: 'b74caa6003002c56e27812138447e17f',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ab74caa6003002c56e27812138447e17f.6g9cz2VU1TfWekloMDuwFQrr7r%2FRmrLhpwpdFsuk%2BKI',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/reset-rate-limits [33m401[0m 2.753 ms - 47[0m
PASS tests/integration/administratorRoutes.test.js (7.04 s)
  POST /api/v1/administrators/reset-rate-limits
    âœ“ should reset rate limits successfully when type is provided (1883 ms)
    âœ“ should reset rate limits successfully when IP is provided (981 ms)
    âœ“ should reset all rate limits when no filter is provided (991 ms)
    âœ“ should return 403 if user does not have required permission (1003 ms)
    âœ“ should return 401 if no token is provided (912 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:19.668Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:20.613Z"}
  console.log
    CSRF token generation: {
      sessionID: '66dbcb3be53434253b5c86b4763befd7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: uNBRRuNn-6L4lEQNN9OV9xew4gdZcV-5tlAE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 66dbcb3be53434253b5c86b4763befd7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dr2ILuQ522...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.444 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:20.627Z"}
  console.log
    Customer affiliateId: TEST_AFF_1760667140061

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: TEST_AFF_1760667140061

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 5, per-bag: 2

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "TEST_CUST_1760667140327",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "testcustomer1760667140327@example.com",
      "phone": "555-0456",
      "address": "456 Test Ave",
      "city": "Test City",
      "state": "CA",
      "zipCode": "90210",
      "affiliateId": "TEST_AFF_1760667140061",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "TEST_AFF_1760667140061",
        "name": "Test Affiliate",
        "minimumDeliveryFee": 5,
        "perBagDeliveryFee": 2
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 331.068 ms - 824[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:22.067Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '66dbcb3be53434253b5c86b4763befd7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A66dbcb3be53434253b5c86b4763befd7.Zn%2BwtRRKkEx56HtpA%2BvhhXsVy9WJaM6bolSBsgi3sXU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1760667140327",
      "affiliateId": "TEST_AFF_1760667140061",
      "pickupDate": "2025-10-18T02:12:22.065Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: TEST_CUST_1760667140327

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Test Customer

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: TEST_AFF_1760667140061

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:160:11)

  console.log
    Applying bag credit of $25 to first order for customer TEST_CUST_1760667140327

      at log (server/controllers/orderController.js:180:15)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1760667140327",
      "affiliateId": "TEST_AFF_1760667140061",
      "pickupDate": "2025-10-18T02:12:22.065Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "TEST_CUST_1760667140327",
      "affiliateId": "TEST_AFF_1760667140061",
      "pickupDate": "2025-10-18T02:12:22.065Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a606e09359ec626a3faf",
      "orderId": "ORD-826398c1-dbea-49ab-aa33-d3ea872b825d",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:22.253Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "_id": "68f1a606e09359ec626a3faf",
      "customerId": "TEST_CUST_1760667140327",
      "affiliateId": "TEST_AFF_1760667140061",
      "pickupDate": "2025-10-18T02:12:22.065Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 2,
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-826398c1-dbea-49ab-aa33-d3ea872b825d",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:22.253Z",
      "updatedAt": "2025-10-17T02:12:22.253Z",
      "baseRate": 1.25,
      "estimatedTotal": 7,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "TEST_CUST_1760667140327",
      "affiliateId": "TEST_AFF_1760667140061",
      "pickupDate": "2025-10-18T02:12:22.065Z",
      "pickupTime": "morning",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 25,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a606e09359ec626a3faf",
      "orderId": "ORD-826398c1-dbea-49ab-aa33-d3ea872b825d",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:22.253Z",
      "updatedAt": "2025-10-17T02:12:22.253Z",
      "baseRate": 1.25,
      "estimatedTotal": 7,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Reset bag credit for customer TEST_CUST_1760667140327 after applying $25 to first order ORD-826398c1-dbea-49ab-aa33-d3ea872b825d

      at log (server/controllers/orderController.js:245:15)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: testcustomer1760667140327@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: testcustomer1760667140327@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-826398c1-dbea-49ab-aa33-d3ea872b825d
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $7.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Test Affiliate
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> test1760667140061@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: test1760667140061@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1760667140061@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-826398c1-dbea-49ab-aa33-d3ea872b825d
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, CA 90210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 20 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 323.843 ms - 292[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:23.671Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a432c843e175821aa825b7d4e6484e59',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: SkQwAthu-WudNjNPItp_Nc6VjsrEWRAGGMCY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a432c843e175821aa825b7d4e6484e59

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bPhz5s6W6_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.472 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:23.681Z"}
  console.log
    Customer affiliateId: TEST_AFF_1760667143544

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: TEST_AFF_1760667143544

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 5, per-bag: 2

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "TEST_CUST_1760667143637",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "testcustomer1760667143637@example.com",
      "phone": "555-0456",
      "address": "456 Test Ave",
      "city": "Test City",
      "state": "CA",
      "zipCode": "90210",
      "affiliateId": "TEST_AFF_1760667143544",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "TEST_AFF_1760667143544",
        "name": "Test Affiliate",
        "minimumDeliveryFee": 5,
        "perBagDeliveryFee": 2
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 142.490 ms - 824[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:24.477Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'a432c843e175821aa825b7d4e6484e59',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa432c843e175821aa825b7d4e6484e59.rQGRJzEnTgGFZW5lLBn08S%2FwupFQDrx4HsbXIxGPVh0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1760667143637",
      "affiliateId": "TEST_AFF_1760667143544",
      "pickupDate": "2025-10-19T02:12:24.476Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "numberOfBags": 1
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: TEST_CUST_1760667143637

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Test Customer

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: TEST_AFF_1760667143544

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Test Affiliate

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "TEST_CUST_1760667143637",
      "affiliateId": "TEST_AFF_1760667143544",
      "pickupDate": "2025-10-19T02:12:24.476Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "numberOfBags": 1,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "TEST_CUST_1760667143637",
      "affiliateId": "TEST_AFF_1760667143544",
      "pickupDate": "2025-10-19T02:12:24.476Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a608e09359ec626a3ff9",
      "orderId": "ORD-280efa03-931a-4756-8c5a-85234c52e32d",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:24.648Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "_id": "68f1a608e09359ec626a3ff9",
      "customerId": "TEST_CUST_1760667143637",
      "affiliateId": "TEST_AFF_1760667143544",
      "pickupDate": "2025-10-19T02:12:24.476Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-280efa03-931a-4756-8c5a-85234c52e32d",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:24.648Z",
      "updatedAt": "2025-10-17T02:12:24.648Z",
      "baseRate": 1.25,
      "estimatedTotal": 23.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "TEST_CUST_1760667143637",
      "affiliateId": "TEST_AFF_1760667143544",
      "pickupDate": "2025-10-19T02:12:24.476Z",
      "pickupTime": "afternoon",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 5,
        "perBagFee": 2,
        "totalFee": 5,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a608e09359ec626a3ff9",
      "orderId": "ORD-280efa03-931a-4756-8c5a-85234c52e32d",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:24.648Z",
      "updatedAt": "2025-10-17T02:12:24.648Z",
      "baseRate": 1.25,
      "estimatedTotal": 23.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: testcustomer1760667143637@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: testcustomer1760667143637@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-280efa03-931a-4756-8c5a-85234c52e32d
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/19/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $23.75
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Test Affiliate
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> test1760667143544@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: test1760667143544@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1760667143544@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Test,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-280efa03-931a-4756-8c5a-85234c52e32d
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, CA 90210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/19/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 15 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 1
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 271.482 ms - 293[0m
PASS tests/integration/bagCredit.test.js (6.919 s)
  Bag Credit Functionality
    âœ“ Should apply bag credit to first order (3482 ms)
    âœ“ Should not apply bag credit to second order (2193 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:26.564Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.log
    Payment verified for order ORD-12345678-1234-1234-1234-123456789012

      at PaymentEmailScanner.log [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:363:15)

  console.log
    Sending payment confirmation to john@example.com

      at PaymentEmailScanner.log [as sendPaymentConfirmation] (server/services/paymentEmailScanner.js:395:15)

  console.warn
    Payment insufficient. Expected: $2.35, Received: $1

      325 |       if (payment.amount < expectedAmount) {
      326 |         // Payment is less than required - notify admin but don't verify
    > 327 |         console.warn(`Payment insufficient. Expected: $${expectedAmount}, Received: $${payment.amount}`);
          |                 ^
      328 |         
      329 |         // Notify admin about insufficient payment
      330 |         try {

      at PaymentEmailScanner.warn [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:327:17)
      at Object.<anonymous> (tests/integration/venmo-payment-parsing.test.js:171:24)

  console.log
    [sendEmail] Sending email to: admin@wavemaxlaundry.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: admin@wavemaxlaundry.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Underpayment Received - Order ORD-12345678-1234-1234-1234-123456789012

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: 
          <!DOCTYPE html>
          <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
                h3 { color: #34495e; margin-top: 20px; }
                ul { background: #f4f4f4; padding: 15px; border-radius: 5px; }
                li { margin: 5px 0; }
                .alert { background: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin: 20px 0; }
                .error { background: #f8d7da; border: 1px solid #dc3545; }
                hr { border: none; border-top: 1px solid #ddd; margin: 30px 0; }
              </style>
            </head>
            <body>
              
            <h2>Payment Underpayment Alert</h2>
            
            <p>Customer has underpaid by $1.35</p>
            
            <h3>Order Details:</h3>
            <ul>
              <li><strong>Order ID:</strong> 68f1a60d0304a01e81c9474b</li>
              <li><strong>Short Order ID:</strong> 81C9474B</li>
              <li><strong>Customer:</strong> John Houlihan</li>
              <li><strong>Customer Email:</strong> john@example.com</li>
              <li><strong>Customer Phone:</strong> 555-1234</li>
            </ul>
            
            <h3>Payment Details:</h3>
            <ul>
              <li><strong>Expected Amount:</strong> $2.35</li>
              <li><strong>Received Amount:</strong> $1.00</li>
              <li><strong>Difference:</strong> $1.35</li>
              <li><strong>Payment Method:</strong> venmo</li>
              <li><strong>Transaction ID:</strong> 4410913674527352924</li>
              <li><strong>Sender:</strong> John Houlihan</li>
            </ul>
            
            <h3>Action Required:</h3>
            <p>Payment verification was blocked. Please follow up with the customer for the remaining amount.</p>
            
            <hr>
            <p style="color: #666; font-size: 12px;">
              This is an automated notification from the WaveMAX Payment Scanner system.
            </p>
          
            </body>
          </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Admin notification sent: Underpayment Received - Order ORD-12345678-1234-1234-1234-123456789012

      at Object.log [as sendAdminNotification] (server/utils/emailService.js:2772:13)

  console.log
    Admin notified about underpayment for order 68f1a60d0304a01e81c9474b

      at PaymentEmailScanner.log [as notifyAdminPaymentIssue] (server/services/paymentEmailScanner.js:577:15)

PASS tests/integration/venmo-payment-parsing.test.js
  Venmo Payment Email Parsing
    HTML Email Parsing
      âœ“ should parse Venmo HTML payment confirmation email (582 ms)
      âœ“ should correctly extract amount from Venmo HTML format (319 ms)
      âœ“ should extract order ID from payment note (319 ms)
      âœ“ should verify payment amount matches order total (461 ms)
      âœ“ should reject payment with incorrect amount (431 ms)
    Order ID Matching
      âœ“ should match order by orderId field (345 ms)
      âœ“ should handle UUID format in order ID (317 ms)
    Email Provider Detection
      âœ“ should identify Venmo emails (321 ms)
      âœ“ should return null for unknown providers (326 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:31.327Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/v1/service-area/config {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:31.673Z"}
[0mGET /api/v1/service-area/config [32m200[0m 4.001 ms - 79[0m
[34mdebug[39m: GET /api/v1/service-area/autocomplete {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:33.335Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)

[0mGET /api/v1/service-area/autocomplete [32m200[0m 8.744 ms - 832[0m
[34mdebug[39m: GET /api/v1/service-area/cities {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:34.204Z"}
[0mGET /api/v1/service-area/cities [32m200[0m 1.354 ms - 258[0m
[34mdebug[39m: GET /api/v1/service-area/zip-codes {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:35.059Z"}
[0mGET /api/v1/service-area/zip-codes [32m200[0m 2.190 ms - 581[0m
[34mdebug[39m: GET /api/v1/service-area/city/76574 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:35.917Z"}
[0mGET /api/v1/service-area/city/76574 [32m200[0m 1.920 ms - 32[0m
[34mdebug[39m: GET /api/v1/service-area/city/00000 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:36.765Z"}
[0mGET /api/v1/service-area/city/00000 [33m404[0m 1.235 ms - 64[0m
[34mdebug[39m: GET /api/v1/service-area/zip-codes/Austin {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:37.622Z"}
[0mGET /api/v1/service-area/zip-codes/Austin [32m200[0m 1.445 ms - 373[0m
[34mdebug[39m: GET /api/v1/service-area/zip-codes/InvalidCity123 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:38.471Z"}
[0mGET /api/v1/service-area/zip-codes/InvalidCity123 [33m404[0m 1.330 ms - 60[0m
[34mdebug[39m: POST /api/v1/service-area/validate {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:39.330Z"}
[0mPOST /api/v1/service-area/validate [32m200[0m 6.580 ms - 123[0m
[34mdebug[39m: POST /api/v1/service-area/validate {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:40.206Z"}
[0mPOST /api/v1/service-area/validate [32m200[0m 1.360 ms - 43[0m
[34mdebug[39m: POST /api/v1/service-area/validate {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:41.067Z"}
[0mPOST /api/v1/service-area/validate [32m200[0m 1.214 ms - 47[0m
[34mdebug[39m: POST /api/v1/service-area/validate {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:41.996Z"}
  console.error
    Error validating address: Error: Service error
        at ServiceAreaService.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/serviceAreaRoutes.test.js:203:23)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:397:39
        at ServiceAreaService.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:404:13)
        at ServiceAreaService.mockConstructor (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-mock/build/index.js:148:19)
        at validateAddress (/var/www/wavemax/wavemax-affiliate-program/server/routes/serviceAreaRoutes.js:164:54)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:284:15
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at serveStatic (/var/www/wavemax/wavemax-affiliate-program/node_modules/serve-static/index.js:75:16)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/server.js:479:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/server/config/csrf-config.js:231:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at serveStatic (/var/www/wavemax/wavemax-affiliate-program/node_modules/serve-static/index.js:75:16)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:646:15
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:265:14)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at SessionStrategy.strategy.pass (/var/www/wavemax/wavemax-affiliate-program/node_modules/passport/lib/middleware/authenticate.js:355:9)
        at SessionStrategy.Object.<anonymous>.SessionStrategy.authenticate (/var/www/wavemax/wavemax-affiliate-program/node_modules/passport/lib/strategies/session.js:126:10)
        at attempt (/var/www/wavemax/wavemax-affiliate-program/node_modules/passport/lib/middleware/authenticate.js:378:16)
        at authenticate (/var/www/wavemax/wavemax-affiliate-program/node_modules/passport/lib/middleware/authenticate.js:379:7)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at initialize (/var/www/wavemax/wavemax-affiliate-program/node_modules/passport/lib/middleware/initialize.js:98:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at next (/var/www/wavemax/wavemax-affiliate-program/server.js:421:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at session (/var/www/wavemax/wavemax-affiliate-program/node_modules/express-session/index.js:487:7)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express-rate-limit/dist/index.cjs:625:9
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express-rate-limit/dist/index.cjs:611:5

      208 |     });
      209 |   } catch (error) {
    > 210 |     console.error('Error validating address:', error);
          |             ^
      211 |     res.status(500).json({
      212 |       success: false,
      213 |       message: 'Failed to validate address'

      at error (server/routes/serviceAreaRoutes.js:210:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at serveStatic (node_modules/serve-static/index.js:75:16)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (server.js:479:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (server/config/csrf-config.js:231:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at serveStatic (node_modules/serve-static/index.js:75:16)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express/lib/router/index.js:646:15
      at next (node_modules/express/lib/router/index.js:265:14)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at SessionStrategy.strategy.pass (node_modules/passport/lib/middleware/authenticate.js:355:9)
      at SessionStrategy.Object.<anonymous>.SessionStrategy.authenticate (node_modules/passport/lib/strategies/session.js:126:10)
      at attempt (node_modules/passport/lib/middleware/authenticate.js:378:16)
      at authenticate (node_modules/passport/lib/middleware/authenticate.js:379:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at initialize (node_modules/passport/lib/middleware/initialize.js:98:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at next (server.js:421:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at session (node_modules/express-session/index.js:487:7)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at node_modules/express-rate-limit/dist/index.cjs:625:9
      at node_modules/express-rate-limit/dist/index.cjs:611:5

[0mPOST /api/v1/service-area/validate [31m500[0m 29.130 ms - 56[0m
PASS tests/integration/serviceAreaRoutes.test.js (12.45 s)
  Service Area Routes
    GET /api/v1/service-area/config
      âœ“ should return service area configuration (1662 ms)
    GET /api/v1/service-area/autocomplete
      âœ“ should return autocomplete data (869 ms)
    GET /api/v1/service-area/cities
      âœ“ should return list of valid cities (854 ms)
    GET /api/v1/service-area/zip-codes
      âœ“ should return list of valid zip codes (857 ms)
    GET /api/v1/service-area/city/:zipCode
      âœ“ should return city for a valid zip code (849 ms)
      âœ“ should return 404 for invalid zip code (856 ms)
    GET /api/v1/service-area/zip-codes/:city
      âœ“ should return zip codes for a valid city (849 ms)
      âœ“ should return 404 for invalid city (858 ms)
    POST /api/v1/service-area/validate
      âœ“ should validate a valid address successfully (877 ms)
      âœ“ should fail validation if service area check fails (861 ms)
      âœ“ should fail validation if geocoding fails (927 ms)
      âœ“ should handle errors gracefully (915 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:44.061Z"}
[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:44.118Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:44.432Z"}
  console.log
    CSRF token generation: {
      sessionID: '6ade41c7ee6317acd168e5662a9e5f10',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FLhF2LAs-tASILvUQRXZrJV6W6hIdFAztLbo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6ade41c7ee6317acd168e5662a9e5f10

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: gLqBKCLE5d...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.687 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:45.193Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:45.549Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:45.550Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:45.636Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-e15d8efd-17f4-417e-bb32-dca4bf6f4ad8",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 145.746 ms - 719[0m
[34mdebug[39m: GET /api/v1/payments/config {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:45.844Z"}
[32minfo[39m: Payment config accessed {"hasHash":true,"hostname":"127.0.0.1","ip":"::ffff:127.0.0.1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:45.849Z"}
[0mGET /api/v1/payments/config [32m200[0m 4.862 ms - 342[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:46.795Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dcbb3e763941615ff897918be327248f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: w3DrCK75-GBpcDmfANJG61gZWefLg_aIgJAU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dcbb3e763941615ff897918be327248f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: V9LIbdeoHG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.716 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:46.931Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:47.240Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:47.240Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:47.329Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-bc85d4c2-1af3-4785-a0aa-284b4b221710",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 141.935 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:47.535Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rt4h-ek3m6xd: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:47.569Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"test@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:47.603Z","token":"mgu7rt4h-ek3m6xd"}
[0mPOST /api/v1/payments/create-token [32m200[0m 68.575 ms - 405[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:48.457Z"}
  console.log
    CSRF token generation: {
      sessionID: '10983cbb7ec9c74b0a194737e4ca75fd',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: si19LJMj-HkSGksp54I7DEbgasYZE8X-tZFI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 10983cbb7ec9c74b0a194737e4ca75fd

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: TrHBH6MmQk...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.502 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:48.593Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:48.921Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:48.922Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:49.004Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-ce65a295-945e-4828-8d23-b29d6a48588d",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 142.968 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:49.207Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7ruex-ws0mxe7: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:49.240Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"test@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:49.273Z","token":"mgu7ruex-ws0mxe7"}
[0mPOST /api/v1/payments/create-token [32m200[0m 66.023 ms - 405[0m
[34mdebug[39m: GET /api/v1/payments/check-status/mgu7ruex-ws0mxe7 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:49.276Z"}
[0mGET /api/v1/payments/check-status/mgu7ruex-ws0mxe7 [32m200[0m 28.091 ms - 76[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.149Z"}
  console.log
    CSRF token generation: {
      sessionID: '50af659074f4f295f8dc942e72dc4250',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: VLoZtO2L-pnfgwNXPlNLRYFqOJvjTha0Lk6s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 50af659074f4f295f8dc942e72dc4250

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: z-ehpaDdPU...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.054 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.288Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.602Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.602Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.685Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-435012c7-86aa-4a57-88ea-340645d6f46c",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 135.380 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.883Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rvpg-ncdoobw: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.915Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"test@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.947Z","token":"mgu7rvpg-ncdoobw"}
[0mPOST /api/v1/payments/create-token [32m200[0m 64.473 ms - 405[0m
[34mdebug[39m: POST /api/v1/payments/cancel-token/mgu7rvpg-ncdoobw {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:50.949Z"}
  console.log
    CSRF check for: /api/v1/payments/cancel-token/mgu7rvpg-ncdoobw {
      sessionID: '50af659074f4f295f8dc942e72dc4250',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A50af659074f4f295f8dc942e72dc4250.OC4%2FVLppRpcPS%2BUANvYOHidUEBe7CGobIZy3LwUfyU0',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[32minfo[39m: Released callback handler for payment token mgu7rvpg-ncdoobw: {"callbackPath":"/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:51.045Z"}
[32minfo[39m: Payment token cancelled: {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:51.045Z","token":"mgu7rvpg-ncdoobw"}
[0mPOST /api/v1/payments/cancel-token/mgu7rvpg-ncdoobw [32m200[0m 96.205 ms - 73[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:51.894Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ea51e1154aa4ad711ba8e4785d6acb31',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 8MVFwUGi-vb7eTr1yNV2yl_cPgLzfLOZy0Oc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ea51e1154aa4ad711ba8e4785d6acb31

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: BDWVJCiP9L...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.351 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.029Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.338Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.339Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.423Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-5118f383-49c8-4dd4-8304-fe5b913d134a",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 138.603 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.623Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.626Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.628Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.630Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.632Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.634Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.636Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.637Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.639Z"}
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.640Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx1t-7f4tlqx: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.657Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx21-i54rcvd: {"callbackPath":"/api/v1/payments/callback/handler-5","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-5","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.670Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx1v-pgt852i: {"callbackPath":"/api/v1/payments/callback/handler-2","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-2","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.673Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx23-kjxcrxo: {"callbackPath":"/api/v1/payments/callback/handler-6","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-6","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.675Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx1z-36wruvn: {"callbackPath":"/api/v1/payments/callback/handler-3","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-3","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.676Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx1x-tbmi3mi: {"callbackPath":"/api/v1/payments/callback/handler-4","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-4","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.677Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx29-lej8tq1: {"callbackPath":"/api/v1/payments/callback/handler-10","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-10","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.681Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx24-n4i68ly: {"callbackPath":"/api/v1/payments/callback/handler-8","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-8","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.684Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx26-jf70doc: {"callbackPath":"/api/v1/payments/callback/handler-7","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-7","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.685Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7rx27-ig696dh: {"callbackPath":"/api/v1/payments/callback/handler-9","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-9","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.687Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"customer0@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.688Z","token":"mgu7rx1t-7f4tlqx"}
[0mPOST /api/v1/payments/create-token [32m200[0m 64.961 ms - 405[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-5","customerEmail":"customer4@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.701Z","token":"mgu7rx21-i54rcvd"}
[0mPOST /api/v1/payments/create-token [32m200[0m 68.766 ms - 405[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-6","customerEmail":"customer5@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.705Z","token":"mgu7rx23-kjxcrxo"}
[0mPOST /api/v1/payments/create-token [32m200[0m 71.334 ms - 405[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-2","customerEmail":"customer1@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.709Z","token":"mgu7rx1v-pgt852i"}
[0mPOST /api/v1/payments/create-token [32m200[0m 82.466 ms - 405[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-3","customerEmail":"customer3@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.717Z","token":"mgu7rx1z-36wruvn"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-10","customerEmail":"customer9@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.718Z","token":"mgu7rx29-lej8tq1"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-8","customerEmail":"customer6@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.719Z","token":"mgu7rx24-n4i68ly"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-4","customerEmail":"customer2@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.720Z","token":"mgu7rx1x-tbmi3mi"}
[0mPOST /api/v1/payments/create-token [32m200[0m 87.249 ms - 405[0m
[0mPOST /api/v1/payments/create-token [32m200[0m 78.548 ms - 407[0m
[0mPOST /api/v1/payments/create-token [32m200[0m 83.810 ms - 405[0m
[0mPOST /api/v1/payments/create-token [32m200[0m 91.938 ms - 405[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-7","customerEmail":"customer7@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.722Z","token":"mgu7rx26-jf70doc"}
[0mPOST /api/v1/payments/create-token [32m200[0m 84.847 ms - 405[0m
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-9","customerEmail":"customer8@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.724Z","token":"mgu7rx27-ig696dh"}
[0mPOST /api/v1/payments/create-token [32m200[0m 84.996 ms - 405[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.730Z"}
[33mwarn[39m: No callback handlers available. All handlers are currently in use. {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:52.759Z"}
[0mPOST /api/v1/payments/create-token [31m503[0m 29.230 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:53.634Z"}
  console.log
    CSRF token generation: {
      sessionID: '56606bcd386bfe46bf35ab1e64d20ac6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0nTVFZ9e-IzAqnSLH3sVme9PgKl_sVR2nxWU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 56606bcd386bfe46bf35ab1e64d20ac6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LyqlDTonoW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.266 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:53.775Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.093Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.094Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.182Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-2daeba00-e62f-4710-976b-7d5269f5c112",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 153.493 ms - 719[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.397Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7ryf3-h0dnxdl: {"callbackPath":"/api/v1/payments/callback/handler-1","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.430Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-1","customerEmail":"cancel@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.462Z","token":"mgu7ryf3-h0dnxdl"}
[0mPOST /api/v1/payments/create-token [32m200[0m 65.275 ms - 405[0m
[34mdebug[39m: POST /api/v1/payments/cancel-token/mgu7ryf3-h0dnxdl {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.465Z"}
  console.log
    CSRF check for: /api/v1/payments/cancel-token/mgu7ryf3-h0dnxdl {
      sessionID: '56606bcd386bfe46bf35ab1e64d20ac6',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A56606bcd386bfe46bf35ab1e64d20ac6.WoiN%2BYk4hbb3IxDKjR1G9uCnJ%2FRUwkFb9dZka4up22g',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[32minfo[39m: Released callback handler for payment token mgu7ryf3-h0dnxdl: {"callbackPath":"/api/v1/payments/callback/handler-1","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.559Z"}
[32minfo[39m: Payment token cancelled: {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.559Z","token":"mgu7ryf3-h0dnxdl"}
[0mPOST /api/v1/payments/cancel-token/mgu7ryf3-h0dnxdl [32m200[0m 94.477 ms - 73[0m
[34mdebug[39m: POST /api/v1/payments/create-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.562Z"}
[32minfo[39m: Acquired callback handler for payment token mgu7ryjn-59idu7r: {"callbackPath":"/api/v1/payments/callback/handler-2","callbackUrl":"http://localhost:3005/api/v1/payments/callback/handler-2","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.595Z"}
[32minfo[39m: Payment token created with callback assignment: {"callbackPath":"/api/v1/payments/callback/handler-2","customerEmail":"new@example.com","service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:54.628Z","token":"mgu7ryjn-59idu7r"}
[0mPOST /api/v1/payments/create-token [32m200[0m 65.720 ms - 405[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:55.496Z"}
  console.log
    CSRF token generation: {
      sessionID: '3cc023a6c06d41f72bf7f13b2f5e477c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: GyETkUSl-dqfNdnGHydB_4_LhFJ2-Y0qcwhs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3cc023a6c06d41f72bf7f13b2f5e477c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JxIIdieOas...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.690 ms - 67[0m
[32minfo[39m: Initializing callback pool... {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:55.635Z"}
[32minfo[39m: Initialized 10 callback handlers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:55.962Z"}
[32minfo[39m: Callback pool cleanup job started (runs every 5 minutes) {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:55.962Z"}
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:56.047Z"}
  console.log
    Customer affiliateId: AFF-TEST-123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: null

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: null

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST-071d139e-3d70-4b1b-870e-1c02a302f0eb",
      "firstName": "Test",
      "lastName": "Customer",
      "email": "test@example.com",
      "phone": "+1234567890",
      "address": "123 Test St",
      "city": "Test City",
      "state": "TS",
      "zipCode": "12345",
      "affiliateId": "AFF-TEST-123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": null
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 142.118 ms - 719[0m
[34mdebug[39m: GET /api/v1/payments/pool-stats {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:56.252Z"}
[0mGET /api/v1/payments/pool-stats [32m200[0m 29.897 ms - -[0m
[32minfo[39m: Callback pool cleanup job stopped {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:57.144Z"}
PASS tests/integration/payment.test.js (14.09 s)
  Payment Integration Tests
    Payment Configuration Tests
      âœ“ should get payment configuration (2372 ms)
    Payment Token Tests
      âœ“ should create payment token (1662 ms)
      âœ“ should check payment status (1692 ms)
      âœ“ should cancel payment token (1745 ms)
    Payment Callback Tests
      âœ“ should return 503 when all callback handlers are locked (1735 ms)
      âœ“ should release callback handler when payment is cancelled (1866 ms)
    Pool Statistics Tests
      âœ“ should get pool statistics (1649 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:58.064Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:12:59.140Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:12:59.128Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:12:59.128Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:12:59.128Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a62b1d2dac0d10c2bfd0",
      "orderId": "ORD-6676e14f-9c98-4317-8bc6-248f83a0b408",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:59.532Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68f1a62b1d2dac0d10c2bfd0",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:12:59.128Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 2,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-6676e14f-9c98-4317-8bc6-248f83a0b408",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:59.532Z",
      "updatedAt": "2025-10-17T02:12:59.532Z",
      "baseRate": 1.25,
      "estimatedTotal": 42,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:12:59.128Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with premium detergent",
      "estimatedWeight": 20,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a62b1d2dac0d10c2bfd0",
      "orderId": "ORD-6676e14f-9c98-4317-8bc6-248f83a0b408",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:12:59.532Z",
      "updatedAt": "2025-10-17T02:12:59.532Z",
      "baseRate": 1.25,
      "estimatedTotal": 42,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: customer.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-6676e14f-9c98-4317-8bc6-248f83a0b408
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $42.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: affiliate.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-6676e14f-9c98-4317-8bc6-248f83a0b408
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 20 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Test with premium detergent
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/orders [32m201[0m 511.197 ms - 292[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:00.962Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:00.959Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      }
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:00.959Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:00.959Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a62d1d2dac0d10c2c012",
      "orderId": "ORD-3058126d-77bb-411b-832f-f2b47e9b8a62",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:01.134Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68f1a62d1d2dac0d10c2c012",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:00.959Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 9,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-3058126d-77bb-411b-832f-f2b47e9b8a62",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:01.134Z",
      "updatedAt": "2025-10-17T02:13:01.134Z",
      "baseRate": 1.25,
      "estimatedTotal": 61.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:00.959Z",
      "pickupTime": "afternoon",
      "specialPickupInstructions": "All add-ons please",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 9,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a62d1d2dac0d10c2c012",
      "orderId": "ORD-3058126d-77bb-411b-832f-f2b47e9b8a62",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:01.134Z",
      "updatedAt": "2025-10-17T02:13:01.134Z",
      "baseRate": 1.25,
      "estimatedTotal": 61.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: customer.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-3058126d-77bb-411b-832f-f2b47e9b8a62
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $61.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: affiliate.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-3058126d-77bb-411b-832f-f2b47e9b8a62
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Afternoon (12pm - 5pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 3
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> All add-ons please
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/orders [32m201[0m 275.714 ms - 290[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:02.420Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:02.414Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:02.414Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:02.414Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a62e1d2dac0d10c2c043",
      "orderId": "ORD-53a4deeb-7b42-4d8c-9952-cbde21084cd2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:02.592Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68f1a62e1d2dac0d10c2c043",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:02.414Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-53a4deeb-7b42-4d8c-9952-cbde21084cd2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:02.592Z",
      "updatedAt": "2025-10-17T02:13:02.592Z",
      "baseRate": 1.25,
      "estimatedTotal": 46.25,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:02.414Z",
      "pickupTime": "evening",
      "specialPickupInstructions": "No add-ons",
      "estimatedWeight": 25,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a62e1d2dac0d10c2c043",
      "orderId": "ORD-53a4deeb-7b42-4d8c-9952-cbde21084cd2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:02.592Z",
      "updatedAt": "2025-10-17T02:13:02.592Z",
      "baseRate": 1.25,
      "estimatedTotal": 46.25,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: customer.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-53a4deeb-7b42-4d8c-9952-cbde21084cd2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Evening (5pm - 8pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $46.25
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: affiliate.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-53a4deeb-7b42-4d8c-9952-cbde21084cd2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Evening (5pm - 8pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 25 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> No add-ons
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/orders [32m201[0m 275.330 ms - 293[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:03.859Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:03.857Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "numberOfBags": 4,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:03.857Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "numberOfBags": 4,
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:03.857Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "status": "pending",
      "numberOfBags": 4,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a6301d2dac0d10c2c074",
      "orderId": "ORD-e85f2436-a4d2-475e-859b-1e31010ef4b2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:04.088Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "_id": "68f1a6301d2dac0d10c2c074",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:03.857Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "status": "pending",
      "numberOfBags": 4,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 8,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-e85f2436-a4d2-475e-859b-1e31010ef4b2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:04.088Z",
      "updatedAt": "2025-10-17T02:13:04.088Z",
      "baseRate": 1.25,
      "estimatedTotal": 78,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:03.857Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test total calculation",
      "estimatedWeight": 40,
      "status": "pending",
      "numberOfBags": 4,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 8,
      "feeBreakdown": {
        "numberOfBags": 4,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 20,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a6301d2dac0d10c2c074",
      "orderId": "ORD-e85f2436-a4d2-475e-859b-1e31010ef4b2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:04.088Z",
      "updatedAt": "2025-10-17T02:13:04.088Z",
      "baseRate": 1.25,
      "estimatedTotal": 78,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: customer.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-e85f2436-a4d2-475e-859b-1e31010ef4b2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $78.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: affiliate.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-e85f2436-a4d2-475e-859b-1e31010ef4b2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 40 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 4
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Test total calculation
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/orders [32m201[0m 341.560 ms - 291[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:05.387Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:05.385Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "numberOfBags": 5,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      }
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:05.385Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "numberOfBags": 5,
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:05.385Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 5,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a6311d2dac0d10c2c0a5",
      "orderId": "ORD-cbb7c23c-2cdd-424d-8e09-c42c5be6be8b",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:05.558Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "_id": "68f1a6311d2dac0d10c2c0a5",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:05.385Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 5,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 15,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-cbb7c23c-2cdd-424d-8e09-c42c5be6be8b",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:05.558Z",
      "updatedAt": "2025-10-17T02:13:05.558Z",
      "baseRate": 1.25,
      "estimatedTotal": 102.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: true }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:05.385Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Commission test",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 5,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": true
      },
      "addOnTotal": 15,
      "feeBreakdown": {
        "numberOfBags": 5,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": false
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a6311d2dac0d10c2c0a5",
      "orderId": "ORD-cbb7c23c-2cdd-424d-8e09-c42c5be6be8b",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:05.558Z",
      "updatedAt": "2025-10-17T02:13:05.558Z",
      "baseRate": 1.25,
      "estimatedTotal": 102.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: customer.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-cbb7c23c-2cdd-424d-8e09-c42c5be6be8b
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $102.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: affiliate.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-cbb7c23c-2cdd-424d-8e09-c42c5be6be8b
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 50 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 5
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Commission test
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/orders [32m201[0m 268.608 ms - 292[0m
[34mdebug[39m: GET /api/orders/ORD-fcc863b1-c7e3-431c-9ef2-56c6c7ae1f57 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:06.909Z"}
[0mGET /api/orders/ORD-fcc863b1-c7e3-431c-9ef2-56c6c7ae1f57 [32m200[0m 113.798 ms - -[0m
[34mdebug[39m: GET /api/orders/ORD-70ed0283-18bc-4f1c-ae97-a5b05a398ada {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:08.266Z"}
[0mGET /api/orders/ORD-70ed0283-18bc-4f1c-ae97-a5b05a398ada [32m200[0m 114.974 ms - -[0m
[34mdebug[39m: POST /api/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:09.563Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:09.562Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      }
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST_ADDON_001

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Customer AddOn

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF_ADDON_001

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: Affiliate AddOn

      at log (server/controllers/orderController.js:160:11)

  console.log
    Applying WDF credit of $10 to order for customer CUST_ADDON_001

      at log (server/controllers/orderController.js:187:15)

  console.log
    Creating order with data: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:09.562Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:09.562Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a6351d2dac0d10c2c132",
      "orderId": "ORD-9f4c60a1-827f-462a-a029-ad1ea2d9afe2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:09.735Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "_id": "68f1a6351d2dac0d10c2c132",
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:09.562Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 6,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-9f4c60a1-827f-462a-a029-ad1ea2d9afe2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:09.735Z",
      "updatedAt": "2025-10-17T02:13:09.735Z",
      "baseRate": 1.25,
      "estimatedTotal": 48.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: true, fabricSoftener: true, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST_ADDON_001",
      "affiliateId": "AFF_ADDON_001",
      "pickupDate": "2025-10-18T02:13:09.562Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Test with credit",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": true,
        "fabricSoftener": true,
        "stainRemover": false
      },
      "addOnTotal": 6,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 15,
        "perBagFee": 5,
        "totalFee": 15,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 10,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a6351d2dac0d10c2c132",
      "orderId": "ORD-9f4c60a1-827f-462a-a029-ad1ea2d9afe2",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:13:09.735Z",
      "updatedAt": "2025-10-17T02:13:09.735Z",
      "baseRate": 1.25,
      "estimatedTotal": 48.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Reset WDF credit for customer CUST_ADDON_001 after applying to order ORD-9f4c60a1-827f-462a-a029-ad1ea2d9afe2

      at log (server/controllers/orderController.js:253:15)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: customer.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Customer,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-9f4c60a1-827f-462a-a029-ad1ea2d9afe2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $48.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> Affiliate AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 1234567890
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> affiliate.addon@test.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: affiliate.addon@test.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: affiliate.addon@test.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello Affiliate,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-9f4c60a1-827f-462a-a029-ad1ea2d9afe2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Customer AddOn
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 9876543210
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Test Ave, Test City, TS 12345
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 10/18/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 3
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Test with credit
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/orders [32m201[0m 301.594 ms - 292[0m
PASS tests/integration/orderAddOns.test.js (13.522 s)
  Order API - Add-on Functionality Integration Tests
    POST /api/orders - Create Order with Add-ons
      âœ“ should create order with single add-on selected (2286 ms)
      âœ“ should create order with multiple add-ons selected (1454 ms)
      âœ“ should create order with no add-ons when not specified (1461 ms)
      âœ“ should calculate correct total with add-ons and delivery fee (1502 ms)
      âœ“ should include add-ons in total but not in commission calculation (1479 ms)
    GET /api/orders/:orderId - Retrieve Order with Add-ons
      âœ“ should return order details including add-ons (1312 ms)
      âœ“ should include add-ons when admin retrieves order (1377 ms)
    Order with Add-ons and WDF Credit
      âœ“ should apply WDF credit after add-on calculation (1531 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:11.837Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:12.641Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:12.995Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 354.380 ms - 629[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:14.215Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:14.359Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 145.221 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-1623a8cf-3825-43ef-a3f4-6c020f10a58f/customers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:14.375Z"}
[0mGET /api/v1/affiliates/AFF-1623a8cf-3825-43ef-a3f4-6c020f10a58f/customers [32m200[0m 111.266 ms - 513[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:15.527Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:15.670Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 143.569 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-abde6e40-b883-4a2b-baef-264c55f3176a/customers?customerId=CUST-0f886888-bf1d-451b-9e79-0e045464b456 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:15.760Z"}
[0mGET /api/v1/affiliates/AFF-abde6e40-b883-4a2b-baef-264c55f3176a/customers?customerId=CUST-0f886888-bf1d-451b-9e79-0e045464b456 [32m200[0m 108.339 ms - 513[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:16.902Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:17.047Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 146.000 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-b5fdf9f0-c5ee-44ca-9f1f-c61f9ef29485/customers?customerId=NONEXISTENT123 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:17.054Z"}
[0mGET /api/v1/affiliates/AFF-b5fdf9f0-c5ee-44ca-9f1f-c61f9ef29485/customers?customerId=NONEXISTENT123 [32m200[0m 110.557 ms - 128[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:18.176Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:18.328Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 152.856 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-e0fab9d6-97c2-4ab7-aee6-06572616530f/customers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:18.333Z"}
[0mGET /api/v1/affiliates/AFF-e0fab9d6-97c2-4ab7-aee6-06572616530f/customers [33m401[0m 1.164 ms - 47[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:19.342Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:19.487Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 145.201 ms - 629[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:19.490Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:19.644Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 154.318 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-9bdfcd12-6948-49db-98f6-5fd49c8eaaa0/customers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:19.647Z"}
[0mGET /api/v1/affiliates/AFF-9bdfcd12-6948-49db-98f6-5fd49c8eaaa0/customers [32m200[0m 108.115 ms - 513[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-9bdfcd12-6948-49db-98f6-5fd49c8eaaa0/dashboard {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:19.758Z"}
[0mGET /api/v1/affiliates/AFF-9bdfcd12-6948-49db-98f6-5fd49c8eaaa0/dashboard [32m200[0m 134.687 ms - 217[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:20.915Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:21.059Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 144.632 ms - 629[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:22.070Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:22.210Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 140.940 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-48632073-3856-4b13-a9ad-e193bb30bbfe {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:22.214Z"}
[0mGET /api/v1/affiliates/AFF-48632073-3856-4b13-a9ad-e193bb30bbfe [32m200[0m 54.963 ms - 659[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:23.263Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:23.402Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 139.070 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-0c73facb-9a47-413a-bf94-cc54d901563b/dashboard {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:23.405Z"}
[0mGET /api/v1/affiliates/AFF-0c73facb-9a47-413a-bf94-cc54d901563b/dashboard [32m200[0m 135.784 ms - 217[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:24.549Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:24.688Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 140.135 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-5afe26a9-6850-44b6-b6a5-ac0195b07c80/customers?customerId=INVALID_ID {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:24.692Z"}
[0mGET /api/v1/affiliates/AFF-5afe26a9-6850-44b6-b6a5-ac0195b07c80/customers?customerId=INVALID_ID [32m200[0m 110.260 ms - 128[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:25.831Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:25.979Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 148.260 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/INVALID_AFFILIATE/customers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:25.982Z"}
[0mGET /api/v1/affiliates/INVALID_AFFILIATE/customers [33m403[0m 27.816 ms - 42[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:26.998Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:27.145Z","userType":"affiliate","username":"john@testaffiliate.com"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 147.627 ms - 629[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-f4d0dac2-0a55-455a-b423-ec72926b7db0/customers {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:27.148Z"}
[0mGET /api/v1/affiliates/AFF-f4d0dac2-0a55-455a-b423-ec72926b7db0/customers [32m200[0m 106.956 ms - 513[0m
PASS tests/integration/affiliateCustomerFiltering.test.js (17.145 s)
  Affiliate Customer Filtering Integration Tests
    Email URL Generation for Customer Filtering
      âœ“ should generate correct dashboard URL with customer parameter (1894 ms)
    Affiliate Dashboard Customer Filtering API
      âœ“ should return customers for authenticated affiliate (1307 ms)
      âœ“ should filter customers by customerId when provided (1367 ms)
      âœ“ should return empty array when filtering by non-existent customerId (1281 ms)
      âœ“ should require authentication to access customer list (1171 ms)
    Complete Email-to-Dashboard Flow Simulation
      âœ“ should handle complete flow from email generation to dashboard access (1557 ms)
      âœ“ should handle URL parameters correctly throughout the flow (1170 ms)
    Dashboard Data Loading for Customer Highlighting
      âœ“ should load affiliate profile data correctly (1198 ms)
      âœ“ should load dashboard statistics correctly (1285 ms)
    Error Handling in Customer Filtering Flow
      âœ“ should handle invalid customer ID gracefully (1245 ms)
      âœ“ should handle invalid affiliate ID (1204 ms)
      âœ“ should handle database connection issues gracefully (1257 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:29.112Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:29.497Z"}
  console.log
    CSRF token generation: {
      sessionID: '9601f35d5deaf5d12f033cc20af6cdae',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DkpE5Ghz-PYm3T46hR5YTHjiSl1Trhp9K9Fw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9601f35d5deaf5d12f033cc20af6cdae

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: EFAE6lc3kR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.134 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:29.911Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    [sendEmail] Sending email to: new@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: new@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi New,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>âš ï¸ IMPORTANT: W-9 Form Information</h3>
            <p><strong>Tax Documentation Process</strong></p>
            <p>To comply with IRS regulations:</p>
            <ul>
              <li>When your annual earnings exceed $600, you will receive a W-9 form via DocuSign</li>
              <li>Complete and sign the form electronically through DocuSign</li>
              <li>Please watch for the DocuSign email to avoid interruption in commission payouts</li>
              <li>Your prompt response ensures uninterrupted commission payments</li>
            </ul>
            <p>Note: The W-9 form will be automatically sent via DocuSign when you reach the $600 annual earnings threshold.</p>
            <p>For questions about the W-9 process, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-58c52360-17e9-4e4d-a853-18a4febb5c17</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-58c52360-17e9-4e4d-a853-18a4febb5c17">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-58c52360-17e9-4e4d-a853-18a4febb5c17</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-58c52360-17e9-4e4d-a853-18a4febb5c17">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-58c52360-17e9-4e4d-a853-18a4febb5c17</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 515.101 ms - 120[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:31.514Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f378af881f51c6ef3de63cac0e008009',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: LePiJTfv-vi22w9N6tbCnL7c9YKPf7VFJZGA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f378af881f51c6ef3de63cac0e008009

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: WIdGDG6Hyy...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.229 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-a802dcde-bfbe-4e0d-a42a-df854eb3fe78 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:31.563Z"}
[0mGET /api/v1/affiliates/AFF-a802dcde-bfbe-4e0d-a42a-df854eb3fe78 [32m200[0m 59.478 ms - 609[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:32.481Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e88cb15a11913710f16f41a94eaba9f6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jbt15oDM-lLSFVWuBe9rJAYfhJfxL9CON_bI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e88cb15a11913710f16f41a94eaba9f6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: TsgWGSkp6M...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.283 ms - 67[0m
[34mdebug[39m: PUT /api/v1/affiliates/AFF-db0f676b-7fb7-41b4-b577-17b922248d13 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:32.527Z"}
[0mPUT /api/v1/affiliates/AFF-db0f676b-7fb7-41b4-b577-17b922248d13 [32m200[0m 94.246 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:33.505Z"}
  console.log
    CSRF token generation: {
      sessionID: '3fc2b270a6b899627ed863d6cce10099',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MLNb8Yho-8ZHmSKiLkTw1L4al_pSBqHiNPiA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3fc2b270a6b899627ed863d6cce10099

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JsP9yKsI8i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.321 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:33.643Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:13:33.787Z","userType":"affiliate","username":"testaffiliate"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 144.450 ms - 629[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:34.682Z"}
  console.log
    CSRF token generation: {
      sessionID: '1db35b294ee325443e64c60608e8ed2b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BqTrpRKv-fz9P_Po1klON2pqEMSkYjmLqFTQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1db35b294ee325443e64c60608e8ed2b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Yq2Um41CuZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.217 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-f4e5b708-557a-4a4a-882d-0d692b94e7f4/customers?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:34.770Z"}
[0mGET /api/v1/affiliates/AFF-f4e5b708-557a-4a4a-882d-0d692b94e7f4/customers?page=1&limit=10 [32m200[0m 108.864 ms - 853[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:35.763Z"}
  console.log
    CSRF token generation: {
      sessionID: '16cd55d854410971ca33885a48e7988d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: THoZba4L-UcTcIsL0kMeKCl4SAHK6vG7Deek

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 16cd55d854410971ca33885a48e7988d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LeZbZHiI4j...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.266 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-4fbfa4c7-dec1-464d-91ba-adac8f8adab0/orders?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:35.875Z"}
[0mGET /api/v1/affiliates/AFF-4fbfa4c7-dec1-464d-91ba-adac8f8adab0/orders?page=1&limit=10 [32m200[0m 110.226 ms - 576[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:36.821Z"}
  console.log
    CSRF token generation: {
      sessionID: '85b45dfa0ef2d3bb46f213d43bbd7a6c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0FATgWAO-aHEXm2rHngzZXDxdOGmH-MMKtgs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 85b45dfa0ef2d3bb46f213d43bbd7a6c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: M8hW1dc32D...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 20.715 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF-fe2b2a0a-c86f-4e8b-81ec-3e569accd0bd/transactions?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:36.916Z"}
[0mGET /api/v1/affiliates/AFF-fe2b2a0a-c86f-4e8b-81ec-3e569accd0bd/transactions?page=1&limit=10 [32m200[0m 114.666 ms - 849[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:37.893Z"}
  console.log
    CSRF token generation: {
      sessionID: '41af77505c2fa984b51e89d9f38ee284',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: k4Ad1jUY-c7ZiJttuP371ui3X_wdZwMNuR1k

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 41af77505c2fa984b51e89d9f38ee284

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bGCYKioTST...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.607 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/affiliates/AFF-88c9765b-d07e-42b7-89e0-17086fb9e920/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:38.031Z"}
  console.log
    CSRF check for: /api/v1/affiliates/AFF-88c9765b-d07e-42b7-89e0-17086fb9e920/delete-all-data {
      sessionID: '41af77505c2fa984b51e89d9f38ee284',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A41af77505c2fa984b51e89d9f38ee284.d1scyS0DwM2TQioX3gygOPf1BhOgtkxlOTHcl2cnIoE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/affiliates/AFF-88c9765b-d07e-42b7-89e0-17086fb9e920/delete-all-data [32m200[0m 209.496 ms - 191[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:39.176Z"}
  console.log
    CSRF token generation: {
      sessionID: 'bba064c92e72a1496524d4cfdb6ad76f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eNYiBoDa-_b71FFX93MJ9axZH02GU7v8q0w0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: bba064c92e72a1496524d4cfdb6ad76f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: I5RgJ1JZX0...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.237 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/affiliates/AFF-834b96dc-2b2d-406f-b47d-be6793846802/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:39.224Z"}
  console.log
    CSRF check for: /api/v1/affiliates/AFF-834b96dc-2b2d-406f-b47d-be6793846802/delete-all-data {
      sessionID: 'bba064c92e72a1496524d4cfdb6ad76f',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Abba064c92e72a1496524d4cfdb6ad76f.pm7hI%2FSNmtrVRx%2BewBn%2FpYlg24r1Lpu%2FYU9HtTknE38',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/affiliates/AFF-834b96dc-2b2d-406f-b47d-be6793846802/delete-all-data [33m403[0m 31.294 ms - 59[0m
PASS tests/integration/affiliate.test.js (11.886 s)
  Affiliate API
    âœ“ should register a new affiliate (2027 ms)
    âœ“ should get affiliate profile (966 ms)
    âœ“ should update affiliate profile (1023 ms)
    âœ“ should login affiliate (1176 ms)
    âœ“ should get affiliate's customers list (1081 ms)
    âœ“ should get affiliate's orders (1058 ms)
    âœ“ should get affiliate's earnings/transactions (1071 ms)
    âœ“ Delete all affiliate data (development only) (1282 ms)
    âœ“ Reject delete in production environment (945 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:140:22)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:167:22)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:917:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:917:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:917:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliatePasswordResetEmail] (server/utils/emailService.js:917:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:186:22)

  console.log
    Missing template: order-confirmation.html

      at Object.log (tests/integration/emailService.integration.test.js:226:19)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendAffiliateWelcomeEmail] (server/utils/emailService.js:333:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:276:9)

  console.log
    [sendEmail] Sending email to: undefined

      at log (server/utils/emailService.js:127:13)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:301:7)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 0)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 1)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [EMAIL_CONTENT] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [RESET_LINK] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_NAME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

  console.warn
    Email template placeholder [USER_EMAIL] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1179:18)
          at async Promise.all (index 2)
      at Object.<anonymous> (tests/integration/emailService.integration.test.js:333:7)

PASS tests/integration/emailService.integration.test.js
  Email Service Integration
    Email Service Configuration
      âœ“ should load and configure the email service correctly (20 ms)
      âœ“ should have all required email functions (20 ms)
    Console Email Provider
      âœ“ should log affiliate welcome emails to console (27 ms)
      âœ“ should log customer welcome emails to console (29 ms)
      âœ“ should log password reset emails to console (17 ms)
    Email Template Verification
      âœ“ should verify email templates directory exists (3 ms)
      âœ“ should verify essential email templates exist (1 ms)
    Mailcow SMTP Configuration
      âœ“ should handle Mailcow SMTP configuration (10 ms)
      âœ“ should handle secure Mailcow SMTP on port 465 (14 ms)
    Error Handling
      âœ“ should handle missing required fields gracefully (38 ms)
      âœ“ should handle invalid email addresses (19 ms)
    Bulk Email Operations
      âœ“ should handle multiple email sends efficiently (30 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:42.078Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:42.925Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:42.933Z","userId":"test-fb-123"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"AFQP8K0PL3","facebookUserId":"test-fb-123","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:43.256Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 331.427 ms - 96[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:44.367Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:44.370Z","userId":"test-fb-456"}
[32minfo[39m: Facebook data deleted for affiliate {"action":"facebook_data_deleted","affiliateId":"68f1a658b2486f3ef5499117","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:44.522Z"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"S6D39SCAUO","facebookUserId":"test-fb-456","hasAffiliate":true,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:44.556Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 188.874 ms - 96[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:45.571Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:45.573Z","userId":"test-fb-789"}
[32minfo[39m: Facebook data deleted for affiliate {"action":"facebook_data_deleted","affiliateId":"68f1a659b2486f3ef5499147","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:45.726Z"}
[32minfo[39m: Facebook data deleted for customer {"action":"facebook_data_deleted","customerId":"68f1a659b2486f3ef5499148","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:45.758Z"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"Y9EP6LJWSL","facebookUserId":"test-fb-789","hasAffiliate":true,"hasCustomer":true,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:45.790Z","userType":"both"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 218.519 ms - 96[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:46.739Z"}
[31merror[39m: Invalid signed request signature {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:46.740Z"}
[31merror[39m: Invalid signed request received {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:46.740Z"}
[0mPOST /api/v1/auth/facebook/deletion-callback [33m400[0m 1.247 ms - 34[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:47.665Z"}
[0mPOST /api/v1/auth/facebook/deletion-callback [33m400[0m 1.377 ms - 205[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:48.587Z"}
[31merror[39m: Invalid signed request format {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:48.588Z"}
[31merror[39m: Invalid signed request received {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:48.588Z"}
[0mPOST /api/v1/auth/facebook/deletion-callback [33m400[0m 1.252 ms - 34[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/TESTCODE01 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:49.548Z"}
[0mGET /api/v1/auth/facebook/deletion-status/TESTCODE01 [32m200[0m 28.890 ms - 343[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/NOTEXIST99 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:50.495Z"}
[0mGET /api/v1/auth/facebook/deletion-status/NOTEXIST99 [33m404[0m 27.784 ms - 38[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/invalid! {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:51.447Z"}
[0mGET /api/v1/auth/facebook/deletion-status/invalid! [33m400[0m 1.491 ms - 234[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/ {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:52.354Z"}
[0mGET /api/v1/auth/facebook/deletion-status/ [33m404[0m 1.889 ms - 128[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/FAILCODE01 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:53.290Z"}
[0mGET /api/v1/auth/facebook/deletion-status/FAILCODE01 [32m200[0m 29.623 ms - 255[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:54.231Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:54.232Z","userId":"test-fb-lifecycle"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"A8ZOJRRT10","facebookUserId":"test-fb-lifecycle","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:54.384Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 153.487 ms - 96[0m
[34mdebug[39m: GET /api/v1/auth/facebook/deletion-status/A8ZOJRRT10 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:54.386Z"}
[0mGET /api/v1/auth/facebook/deletion-status/A8ZOJRRT10 [32m200[0m 27.967 ms - 267[0m
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.336Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.338Z","userId":"test-fb-concurrent-0"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.339Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.341Z","userId":"test-fb-concurrent-1"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.342Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.343Z","userId":"test-fb-concurrent-2"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.344Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.345Z","userId":"test-fb-concurrent-3"}
[34mdebug[39m: POST /api/v1/auth/facebook/deletion-callback {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.346Z"}
[32minfo[39m: Successfully parsed Facebook signed request {"algorithm":"HMAC-SHA256","service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.347Z","userId":"test-fb-concurrent-4"}
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"NG9GN3I1Y3","facebookUserId":"test-fb-concurrent-0","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.484Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 147.957 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"XVOBAEQVY3","facebookUserId":"test-fb-concurrent-2","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.494Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 152.311 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"NUAAO11LGY","facebookUserId":"test-fb-concurrent-3","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.500Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 156.387 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"HXSFSW5CS9","facebookUserId":"test-fb-concurrent-1","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.502Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 162.097 ms - 96[0m
[32minfo[39m: Facebook data deletion request received {"confirmationCode":"UBTU35QWRI","facebookUserId":"test-fb-concurrent-4","hasAffiliate":false,"hasCustomer":false,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:13:55.504Z","userType":"affiliate"}
[0mPOST /api/v1/auth/facebook/deletion-callback [32m200[0m 157.742 ms - 96[0m
PASS tests/integration/facebookDataDeletion.test.js (14.926 s)
  Facebook Data Deletion Integration Tests
    POST /api/v1/auth/facebook/deletion-callback
      âœ“ should handle valid deletion request (1827 ms)
      âœ“ should delete data for existing affiliate (1200 ms)
      âœ“ should delete data for both affiliate and customer (1208 ms)
      âœ“ should reject request with invalid signature (925 ms)
      âœ“ should reject request without signed_request (923 ms)
      âœ“ should handle malformed signed request (926 ms)
    GET /api/v1/auth/facebook/deletion-status/:code
      âœ“ should return status for valid confirmation code (981 ms)
      âœ“ should return 404 for non-existent code (948 ms)
      âœ“ should return error for invalid code format (911 ms)
      âœ“ should return error for missing code (903 ms)
      âœ“ should show failed status with errors (971 ms)
    Data Deletion Process
      âœ“ should track deletion request lifecycle (1102 ms)
      âœ“ should handle concurrent deletion requests (1116 ms)

  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

PASS tests/integration/adminCreation.test.js
  Admin Creation Integration Tests
    Direct Database Admin Creation
      âœ“ should create admin with sequential ID when no admins exist (210 ms)
      âœ“ should create admin with next sequential ID when admins exist (318 ms)
      âœ“ should handle admin creation with all permissions (191 ms)
      âœ“ should handle admin creation with partial permissions (190 ms)
    Admin Model Validation
      âœ“ should require email field (155 ms)
      âœ“ should save admins with different adminIds successfully (270 ms)
      âœ“ should save admins with different emails successfully (277 ms)
    Password Handling
      âœ“ should hash password before saving (191 ms)
      âœ“ should validate password with verifyPassword method (293 ms)
    Admin Query Operations
      âœ“ should find admin by adminId (360 ms)
      âœ“ should find admin by email (320 ms)
      âœ“ should find active admins only (321 ms)
      âœ“ should find admins with specific permissions (347 ms)
      âœ“ should get last admin for ID generation (321 ms)
    Email Integration
      âœ“ should call email service after admin creation (208 ms)
      âœ“ should handle email service failures gracefully (222 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:01.710Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/v1/w9/check-auth {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:02.614Z"}
[0mGET /api/v1/w9/check-auth [32m200[0m 135.762 ms - 115[0m
[34mdebug[39m: GET /api/auth/docusign/callback?code=auth_code_from_docusign&state=test_state_123 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:02.754Z"}
[32minfo[39m: OAuth callback - token exchange completed {"hasAccessToken":true,"hasRefreshToken":true,"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:02.756Z"}
[0mGET /api/auth/docusign/callback?code=auth_code_from_docusign&state=test_state_123 [32m200[0m 2.431 ms - -[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:02.885Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

[32minfo[39m: W9 upload attempt via DocuSign {"action":"upload_attempt","details":{"envelopeId":"env_123456","method":"docusign","success":true},"performedBy":{"ipAddress":"::ffff:127.0.0.1","userEmail":"test@example.com","userId":"68f1a66a7ef694205a57c33c","userName":"Test Affiliate","userType":"affiliate"},"service":"wavemax-affiliate","target":{"affiliateId":"AFF000001","affiliateName":"Test Affiliate"},"timestamp":"2025-10-17T02:14:02.982Z"}
[0mPOST /api/v1/w9/initiate-signing [32m200[0m 96.677 ms - 139[0m
[34mdebug[39m: GET /api/v1/w9/envelope-status/env_123456 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:03.012Z"}
[0mGET /api/v1/w9/envelope-status/env_123456 [32m200[0m 92.570 ms - 48[0m
[34mdebug[39m: POST /api/v1/w9/docusign-webhook {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:03.108Z"}
[32minfo[39m: W9 status updated for affiliate AFF000001: {"details":{"envelopeId":"env_123456","event":"envelope-completed","status":"completed","success":true},"docusignStatus":"completed","envelopeId":"env_123456","performedBy":{"ipAddress":"::ffff:127.0.0.1","userEmail":"system@docusign","userName":"DocuSign System","userType":"system"},"service":"wavemax-affiliate","status":"verified","target":{"affiliateId":"AFF000001","affiliateName":"Test Affiliate"},"timestamp":"2025-10-17T02:14:03.171Z"}
[0mPOST /api/v1/w9/docusign-webhook [32m200[0m 63.264 ms - 70[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:04.309Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

[0mPOST /api/v1/w9/initiate-signing [32m200[0m 58.563 ms - 156[0m
[34mdebug[39m: GET /api/v1/w9/envelope-status/declined_env {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:05.319Z"}
[0mGET /api/v1/w9/envelope-status/declined_env [32m200[0m 86.229 ms - 49[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:06.419Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

[32minfo[39m: W9 upload attempt via DocuSign {"action":"upload_attempt","details":{"envelopeId":"new_env_after_refresh","method":"docusign","success":true},"performedBy":{"ipAddress":"::ffff:127.0.0.1","userEmail":"test@example.com","userId":"68f1a66e7ef694205a57c3df","userName":"Test Affiliate","userType":"affiliate"},"service":"wavemax-affiliate","target":{"affiliateId":"AFF000001","affiliateName":"Test Affiliate"},"timestamp":"2025-10-17T02:14:06.508Z"}
[0mPOST /api/v1/w9/initiate-signing [32m200[0m 89.534 ms - 143[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:07.458Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.error
    Failed to initiate W9 signing: Error: Invalid template ID
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:294:9)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      258 |     });
      259 |   } catch (error) {
    > 260 |     console.error('Failed to initiate W9 signing:', error);
          |             ^
      261 |     logger.error('Failed to initiate W9 signing:', error);
      262 |     res.status(500).json({
      263 |       error: 'Failed to create W9 signing session',

      at error (server/controllers/w9ControllerDocuSign.js:260:13)

[31merror[39m: Failed to initiate W9 signing: Invalid template ID {"service":"wavemax-affiliate","stack":"Error: Invalid template ID\n    at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:294:9)\n    at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-10-17T02:14:07.517Z"}
[0mPOST /api/v1/w9/initiate-signing [31m500[0m 59.599 ms - 79[0m
[34mdebug[39m: POST /api/v1/w9/initiate-signing {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:08.447Z"}
  console.log
    Skipping CSRF for authenticated request without session cookie

      at log (server/config/csrf-config.js:237:13)

  console.error
    Failed to initiate W9 signing: Error: Network timeout
        at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:311:9)
        at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)
        at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)

      258 |     });
      259 |   } catch (error) {
    > 260 |     console.error('Failed to initiate W9 signing:', error);
          |             ^
      261 |     logger.error('Failed to initiate W9 signing:', error);
      262 |     res.status(500).json({
      263 |       error: 'Failed to create W9 signing session',

      at error (server/controllers/w9ControllerDocuSign.js:260:13)

[31merror[39m: Failed to initiate W9 signing: Network timeout {"service":"wavemax-affiliate","stack":"Error: Network timeout\n    at Object.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/tests/integration/docusignW9.test.js:311:9)\n    at Promise.then.completed (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:121:9)\n    at run (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/var/www/wavemax/wavemax-affiliate-program/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-10-17T02:14:08.506Z"}
[0mPOST /api/v1/w9/initiate-signing [31m500[0m 58.956 ms - 75[0m
[34mdebug[39m: POST /api/v1/w9/docusign-webhook {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:09.424Z"}
[33mwarn[39m: Invalid DocuSign webhook signature {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:09.425Z"}
[0mPOST /api/v1/w9/docusign-webhook [33m401[0m 1.109 ms - 29[0m
[34mdebug[39m: GET /api/v1/w9/envelope-status/other_envelope {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:10.389Z"}
  console.log
    Envelope mismatch: { expected: undefined, received: 'other_envelope' }

      at log (server/controllers/w9ControllerDocuSign.js:291:15)

[0mGET /api/v1/w9/envelope-status/other_envelope [33m403[0m 54.763 ms - 24[0m
[34mdebug[39m: GET /api/v1/w9/authorization-status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:11.513Z"}
[0mGET /api/v1/w9/authorization-status [32m200[0m 27.939 ms - 65[0m
PASS tests/integration/docusignW9.test.js (11.644 s)
  DocuSign W9 Integration Tests
    Complete W9 Signing Flow
      âœ“ should complete full W9 signing flow from authorization to completion (2135 ms)
    Resume Existing Signing Session
      âœ“ should resume existing envelope instead of creating new one (1025 ms)
    Handle Declined Envelope
      âœ“ should reset W9 status when envelope is declined (1095 ms)
    Token Refresh Flow
      âœ“ should handle expired token and refresh automatically (1072 ms)
    Error Handling
      âœ“ should handle DocuSign service errors gracefully (989 ms)
      âœ“ should handle network errors during envelope creation (983 ms)
    Security Tests
      âœ“ should reject webhook with invalid signature (926 ms)
      âœ“ should prevent accessing another affiliates envelope status (1154 ms)
    Authorization Status Check
      âœ“ should verify authorization after OAuth callback (955 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:13.302Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/v1/system/config/public {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:14.933Z"}
[0mGET /api/v1/system/config/public [32m200[0m 33.334 ms - 905[0m
[34mdebug[39m: GET /api/v1/system/config/public {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:16.448Z"}
[0mGET /api/v1/system/config/public [32m200[0m 28.652 ms - 905[0m
[34mdebug[39m: GET /api/v1/system/config/public/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:17.812Z"}
[0mGET /api/v1/system/config/public/wdf_base_rate_per_pound [32m200[0m 28.668 ms - 172[0m
[34mdebug[39m: GET /api/v1/system/config/public/non_existent_key {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:19.147Z"}
[0mGET /api/v1/system/config/public/non_existent_key [33m404[0m 27.664 ms - 35[0m
[34mdebug[39m: GET /api/v1/system/config/public/private_key {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:20.537Z"}
[0mGET /api/v1/system/config/public/private_key [33m404[0m 27.403 ms - 35[0m
[34mdebug[39m: GET /api/v1/system/config {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:21.921Z"}
[0mGET /api/v1/system/config [32m200[0m 57.607 ms - -[0m
[34mdebug[39m: GET /api/v1/system/config {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:23.281Z"}
[0mGET /api/v1/system/config [33m401[0m 1.299 ms - 47[0m
[34mdebug[39m: GET /api/v1/system/config {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:24.593Z"}
[0mGET /api/v1/system/config [33m403[0m 28.002 ms - 68[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:25.930Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b1e0bf84bcfc1e9151f0eda43e94f363',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 7UJEASLg-VVs3dQPdtI6pEOtxV3SWGQsXyc0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b1e0bf84bcfc1e9151f0eda43e94f363

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: mi_XpG8mwH...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.174 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:26.046Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: 'b1e0bf84bcfc1e9151f0eda43e94f363',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ab1e0bf84bcfc1e9151f0eda43e94f363.%2BAzui5HgLEQXugoWvBSYfw0HKlJ3En3icVeTJZbI46w',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [32m200[0m 119.992 ms - 149[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:27.639Z"}
  console.log
    CSRF token generation: {
      sessionID: '4b357a945d9917bc6c70633ad46a7580',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1FKPZ2iT-m-F7k2Gph0InGVecpykrFoASuHE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4b357a945d9917bc6c70633ad46a7580

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5kopmYAA0a...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 12.692 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:27.770Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: '4b357a945d9917bc6c70633ad46a7580',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A4b357a945d9917bc6c70633ad46a7580.VfEONtk3f9UUxcHLUme8%2FwqE1yxFyAi%2Fp1m0eezqzOs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Error updating config: Error: Value must be a number for key: wdf_base_rate_per_pound
        at model.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/server/models/SystemConfig.js:67:21)
        at callMiddlewareFunction (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:628:27)
        at model.next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:93:7)
        at _next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:146:10)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:653:30
        at processTicksAndRejections (node:internal/process/task_queues:77:11)

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [33m400[0m 99.432 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:29.183Z"}
  console.log
    CSRF token generation: {
      sessionID: '0b563cf33138fc866eff5e893650f0b5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: cCry6tYc-eVbeMGipwup24Jy_ObrwHiOn9ag

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0b563cf33138fc866eff5e893650f0b5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ZwUc9i1KES...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.103 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:29.307Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: '0b563cf33138fc866eff5e893650f0b5',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A0b563cf33138fc866eff5e893650f0b5.o3XKn0Kqdlv%2FzysaG6dAKIiWhW1tLbn2WLcE4magUmA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Error updating config: Error: Value must be at least 0.5 for key: wdf_base_rate_per_pound
        at model.<anonymous> (/var/www/wavemax/wavemax-affiliate-program/server/models/SystemConfig.js:72:23)
        at callMiddlewareFunction (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:628:27)
        at model.next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:93:7)
        at _next (/var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:146:10)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/kareem/index.js:653:30
        at processTicksAndRejections (node:internal/process/task_queues:77:11)

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [33m400[0m 86.697 ms - 71[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:30.763Z"}
  console.log
    CSRF token generation: {
      sessionID: '85ad834ee491f32dbe874098d6328a32',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1VHytADg-I42Xe5jOv1Ii9REhBL5hP9fR5f0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 85ad834ee491f32dbe874098d6328a32

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1gBe8FaDzp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.174 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/non_editable_config {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:30.929Z"}
  console.log
    CSRF check for: /api/v1/system/config/non_editable_config {
      sessionID: '85ad834ee491f32dbe874098d6328a32',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A85ad834ee491f32dbe874098d6328a32.kaM1NVNW0ZXNDodMlcfyGJ3hyyBETfMBSZoS0pD6dCo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Error updating config: Error: Configuration is not editable: non_editable_config
        at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (/var/www/wavemax/wavemax-affiliate-program/server/models/SystemConfig.js:140:11)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/server/routes/systemConfigRoutes.js:83:20

      92 |     });
      93 |   } catch (error) {
    > 94 |     console.error('Error updating config:', error);
         |             ^
      95 |     res.status(400).json({ error: error.message });
      96 |   }
      97 | });

      at error (server/routes/systemConfigRoutes.js:94:13)

[0mPUT /api/v1/system/config/non_editable_config [33m400[0m 96.226 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:32.384Z"}
  console.log
    CSRF token generation: {
      sessionID: '714cb19e3dd0c1592fcdfc3195d548c6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: OYeQ2ds2-Ax_4TkVwO4QKQMZtDhMsJbvun0c

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 714cb19e3dd0c1592fcdfc3195d548c6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 6V0lYg4xDO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.192 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:32.582Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ac572f1145800a57fa87cd42a50291c4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3JKkfWTd-QeWHmcct8LCvCZpQqnju6DLOxhw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ac572f1145800a57fa87cd42a50291c4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: hGQWmDtdDF...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.412 ms - 67[0m
[34mdebug[39m: PUT /api/v1/system/config/wdf_base_rate_per_pound {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:32.590Z"}
  console.log
    CSRF check for: /api/v1/system/config/wdf_base_rate_per_pound {
      sessionID: 'ac572f1145800a57fa87cd42a50291c4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aac572f1145800a57fa87cd42a50291c4.eIFuJVbNPLbb3JtHj0aCvzjVXZAZbxZY2K0ImfG40z4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/system/config/wdf_base_rate_per_pound [33m403[0m 56.231 ms - 78[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:33.975Z"}
  console.log
    CSRF token generation: {
      sessionID: '18ebbe8d89761acc37cf1f014b561aa6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kqKdG3kK-eRL5doPiS5bkSi0mQVtNJNT8RzU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 18ebbe8d89761acc37cf1f014b561aa6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 4iBP8LiPkp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.301 ms - 67[0m
[34mdebug[39m: POST /api/v1/system/config/initialize {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:34.017Z"}
  console.log
    CSRF check for: /api/v1/system/config/initialize {
      sessionID: '18ebbe8d89761acc37cf1f014b561aa6',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A18ebbe8d89761acc37cf1f014b561aa6.MYpJsAHz2H2KjQy%2FtMHanQ%2BO4O9%2Fp%2FhiPgAJx3D8mg8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/system/config/initialize [32m200[0m 412.185 ms - 48[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:35.769Z"}
  console.log
    CSRF token generation: {
      sessionID: '6352a987e2d54225933ce80084ce5981',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: w53QmB0S-97cGoxrw0ysGLy9azKbbk6webUM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6352a987e2d54225933ce80084ce5981

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2T1Vqu0jHR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.487 ms - 67[0m
[34mdebug[39m: POST /api/v1/system/config/initialize {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:35.836Z"}
  console.log
    CSRF check for: /api/v1/system/config/initialize {
      sessionID: '6352a987e2d54225933ce80084ce5981',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A6352a987e2d54225933ce80084ce5981.cxBNcluFqYpN9H%2F1x11VyNploezKTL1TwM7xrVu%2FL8s',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/system/config/initialize [32m200[0m 428.513 ms - 48[0m
PASS tests/integration/systemConfig.test.js (26.252 s)
  System Config API Tests
    Public Endpoints
      GET /api/v1/system/config/public
        âœ“ should return all public configurations (1717 ms)
        âœ“ should not return private configurations (1402 ms)
      GET /api/v1/system/config/public/:key
        âœ“ should return a specific public configuration (1324 ms)
        âœ“ should return 404 for non-existent config (1375 ms)
        âœ“ should return 404 for private config accessed via public endpoint (1404 ms)
    Admin Endpoints
      GET /api/v1/system/config
        âœ“ should return all configurations for admin (1362 ms)
        âœ“ should return 401 without authentication (1318 ms)
        âœ“ should return 403 for non-admin users (1342 ms)
      PUT /api/v1/system/config/:key
        âœ“ should update a configuration value (1691 ms)
        âœ“ should validate value based on data type (1554 ms)
        âœ“ should validate value against min/max constraints (1560 ms)
        âœ“ should not allow updating non-editable configs (1629 ms)
        âœ“ should require system_config permission (1615 ms)
      POST /api/v1/system/config/initialize
        âœ“ should initialize default configurations (1775 ms)
        âœ“ should not overwrite existing configurations (1952 ms)
    Integration with Order Model
      âœ“ should use SystemConfig WDF rate in new orders (1507 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:39.877Z"}
[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:40.566Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:41.991Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NZT4MsMg-kSge4EBggTgPCugDIGoQtW-0jNE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 11.173 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:42.012Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    V2 registration: 2 free bags, no payment required

      at log (server/controllers/customerController.js:131:13)

  console.error
    Failed to send affiliate notification: TypeError: emailService.sendAffiliateNewCustomerEmail is not a function
        at sendAffiliateNewCustomerEmail (/var/www/wavemax/wavemax-affiliate-program/server/controllers/customerController.js:205:24)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

      209 |     );
      210 |   } catch (emailError) {
    > 211 |     console.error('Failed to send affiliate notification:', emailError);
          |             ^
      212 |     // Don't fail registration if notification fails
      213 |   }
      214 |

      at error (server/controllers/customerController.js:211:13)

[0mPOST /api/customers/register [32m201[0m 276.440 ms - 400[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:43.297Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: dQn0qbWM-cPvgPirll3lkvUPp5-nwuByUMzU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.568 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:44.226Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ORucDnj8-FCuKx5hZ31uPtDhpWHQxrl_l0AA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.055 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:45.361Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: AB4lO4dK-7mS_j_c9Y6tvTmdfleYAL2VMRvY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.450 ms - 67[0m
  console.log
    No order ID found in payment note

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:169:17)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:46.237Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: hL1UX2Ue-21VLITI9z1ax2C5CejvN0yKNWhM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 21.053 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:48.095Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RR3mtj37-w2oINygjZZuOUyXcwnY6P8jhiPE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.861 ms - 67[0m
  console.log
    Order not found for pickup test, skipping

      at Object.log (tests/integration/v2-complete-payment-flow.test.js:371:17)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:49.064Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DFphhXvJ-jwYkrl4IM3-5_sfaV8px3s1hT-E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.320 ms - 67[0m
  console.error
    Order not found: new ObjectId('68f1a69915320b8369a079f1')

      301 |       
      302 |       if (!order) {
    > 303 |         console.error('Order not found:', payment.orderId);
          |                 ^
      304 |         return false;
      305 |       }
      306 |       

      at PaymentEmailScanner.error [as verifyAndUpdateOrder] (server/services/paymentEmailScanner.js:303:17)
      at Object.<anonymous> (tests/integration/v2-complete-payment-flow.test.js:419:24)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:50.104Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: m5oAJ1zr-Zn6fpUKeLu2C9aEVIeJODHiVxI4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.575 ms - 67[0m
  console.log
    No order ID found in payment note

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:169:17)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:50.976Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9a4736f4f4d04f8e35e4b1ef2417c39',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: XlRD1PM2-iWkCebpo3FNJcDf6K78k3Xh1H5o

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9a4736f4f4d04f8e35e4b1ef2417c39

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rS1r6Sy2fq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.042 ms - 67[0m
  console.log
    Not a payment email from known provider: random@example.com (subject: Random email)

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:152:17)

PASS tests/integration/v2-complete-payment-flow.test.js (12.304 s)
  V2 Complete Payment Flow
    Step 1: Customer Registration
      âœ“ should register V2 customer without payment (1336 ms)
    Step 2: Order Creation
      âœ“ should create order with pending payment status (929 ms)
    Step 3: Order Processing and Weight Update
      âœ“ should update order with actual weight and trigger payment request (1135 ms)
    Step 4: Payment Email Processing
      âœ“ should parse Venmo payment confirmation email and verify payment (877 ms)
    Step 5: Order Completion
      âœ“ should mark order as ready for pickup after payment verification (1857 ms)
      âœ“ should complete order when customer picks up (969 ms)
    Edge Cases
      âœ“ should reject payment with incorrect amount (1040 ms)
      âœ“ should handle order not found scenario (871 ms)
      âœ“ should ignore non-payment emails (855 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:53.022Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:53.397Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c775ee3719b69033b5aed37000624d48',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RhME5Wrh-myUfDCiJNMf7Yc80MiUtYQiUUXM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c775ee3719b69033b5aed37000624d48

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: f4MKLYartV...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.829 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:54.213Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    [sendCustomerWelcomeEmail] Customer: {
      email: 'bob@example.com',
      firstName: 'Bob',
      customerId: 'CUST-c1da14da-50ed-42b8-b0b7-bd24568be63c'
    }

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:939:13)

  console.log
    [sendCustomerWelcomeEmail] Affiliate: { affiliateId: 'AFF123', businessName: undefined }

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:944:13)

  console.log
    Language-specific template not found for en/customer-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: bob@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: bob@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Service

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Service</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #ffffff !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .service-box {
          border: 1px solid #e0e0e0;
          border-radius: 4px;
          padding: 15px;
          margin: 20px 0;
          background-color: #f9f9f9;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .steps {
          padding: 0;
        }
        .step {
          display: flex;
          margin-bottom: 15px;
          align-items: flex-start;
        }
        .step-number {
          background-color: #1e3a8a;
          color: #ffffff !important;
          width: 25px;
          height: 25px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          margin-right: 10px;
          flex-shrink: 0;
        }
        .step-content {
          flex: 1;
        }
        .divider {
          height: 1px;
          background-color: #e0e0e0;
          margin: 20px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to WaveMAX Laundry!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Bob,</h2>
            <p>Welcome to WaveMAX Laundry Service! Your account has been successfully created and you're ready to enjoy premium wash, dry, fold laundry services.</p>
          </div>
          
          <div class="highlight">
            <h3>Your Account Information</h3>
            <p><strong>Customer ID:</strong> CUST-c1da14da-50ed-42b8-b0b7-bd24568be63c</p>
            <p><strong>Your Service Provider:</strong> John Doe</p>
          </div>
          
          <div class="service-box" style="background-color: #f0f7ff; border: 1px solid #3b82f6;">
            <h3>How Our Service Works</h3>
            <p>Schedule your laundry pickup online. After we pick up and weigh your laundry, you'll receive an invoice. Pay conveniently via Venmo, PayPal, or CashApp.</p>
            
            <div style="background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 6px; padding: 15px; margin: 15px 0;">
              <h4 style="margin-top: 0; color: #1e3a8a;">Account Credit Details</h4>
              <table style="width: 100%; border-collapse: collapse;">
                <tr>
                  <td style="padding: 5px 0;">Bags Purchased</td>
                  <td style="text-align: right; font-weight: bold;">0</td>
                </tr>
                <tr>
                  <td style="padding: 5px 0;">Cost per Bag</td>
                  <td style="text-align: right;">$0.00</td>
                </tr>
                <tr style="border-top: 2px solid #e0e0e0;">
                  <td style="padding: 8px 0; font-weight: bold; color: #1e3a8a;">Total Account Credit</td>
                  <td style="text-align: right; font-weight: bold; color: #1e3a8a; font-size: 18px;">$0.00</td>
                </tr>
              </table>
            </div>
            
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
              <strong>Note:</strong> No upfront payment required. You'll pay after your laundry is picked up and weighed.
            </p>
          </div>
          
          <div class="service-box">
            <h3>How It Works</h3>
            <div class="steps">
              <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                  <strong>Schedule a Pickup</strong>
                  <p>Login to your dashboard and schedule a convenient pickup time.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                  <strong>Prepare Your Laundry</strong>
                  <p>Place your laundry in the provided bags. Your service provider will pick them up.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                  <strong>We Do the Rest</strong>
                  <p>Your laundry is professionally washed, dried, and folded at our facility.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                  <strong>Delivery to Your Door</strong>
                  <p>Your clean, fresh laundry is delivered back to you, usually within 24-48 hours.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="divider"></div>
          
          <div class="section">
            <h3>Ready to Schedule Your First Pickup?</h3>
            <p>Click the button below to access your dashboard and schedule your first pickup.</p>
            <div style="text-align: center; margin: 20px 0;">
              <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule Pickup</a>
            </div>
            <p style="text-align: center; color: #1e3a8a; font-style: italic;">Remember: Your account has been credited for your prepaid bags!</p>
          </div>
          
          <div class="section">
            <h3>Questions?</h3>
            <p>Your service provider is here to help! Feel free to reach out:</p>
            <p><strong>Name:</strong> John Doe<br>
            <strong>Phone:</strong> 555-123-4567<br>
            <strong>Email:</strong> john@example.com</p>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Access your customer dashboard anytime to manage orders and track deliveries.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="background-color: #3b82f6;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team.</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Customer welcome email sent successfully to: bob@example.com

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1197:13)

  console.log
    [sendAffiliateNewCustomerEmail] Affiliate: {
      email: 'john@example.com',
      affiliateId: 'AFF123',
      businessName: undefined
    }

      at Object.log [as sendAffiliateNewCustomerEmail] (server/utils/emailService.js:361:13)

  console.log
    [sendAffiliateNewCustomerEmail] Customer: {
      email: 'bob@example.com',
      firstName: 'Bob',
      customerId: 'CUST-c1da14da-50ed-42b8-b0b7-bd24568be63c'
    }

      at Object.log [as sendAffiliateNewCustomerEmail] (server/utils/emailService.js:366:13)

  console.log
    Language-specific template not found for en/affiliate-new-customer, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Customer Registration

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Customer Registration</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f4f4f4;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background-color: #1e3a8a;
                color: #ffffff;
                padding: 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 28px;
            }
            .content {
                padding: 40px 30px;
            }
            .content h2 {
                color: #1e3a8a;
                font-size: 24px;
                margin-bottom: 20px;
            }
            .info-box {
                background-color: #f0f7ff;
                border-left: 4px solid #3b82f6;
                padding: 20px;
                margin: 20px 0;
            }
            .customer-details {
                background-color: #f9f9f9;
                padding: 20px;
                border-radius: 8px;
                margin: 20px 0;
            }
            .customer-details h3 {
                color: #1e3a8a;
                margin-top: 0;
            }
            .detail-row {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e0e0e0;
            }
            .detail-row:last-child {
                border-bottom: none;
            }
            .detail-label {
                font-weight: bold;
                color: #555;
            }
            .button {
                display: inline-block;
                background-color: #ffffff !important;
                color: #ffffff !important;
                padding: 12px 30px;
                text-decoration: none !important;
                border-radius: 6px;
                font-weight: bold;
                margin: 20px 0;
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .footer {
                background-color: #f8f9fa;
                padding: 20px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #3b82f6;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Customer Registration!</h1>
            </div>
            
            <div class="content">
                <h2>Congratulations, John Doe!</h2>
                
                <p>Great news! A new customer has just registered through your affiliate link.</p>
                
                <div class="info-box">
                    <strong>Action Required:</strong> Please deliver 1 laundry bag(s) to your new customer within 48 hours.
                    <br><small>Note: This customer received their first bag FREE as part of our promotional offer.</small>
                </div>
                
                <div class="customer-details">
                    <h3>Customer Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Customer ID:</span>
                        <span>CUST-c1da14da-50ed-42b8-b0b7-bd24568be63c</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span>
                        <span>Bob Johnson</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span>bob@example.com</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span>
                        <span>(555) 555-5555</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span>
                        <span>789 Pine St, Austin, TX 78703</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Service Frequency:</span>
                        <span>weekly</span>
                    </div>
                </div>
                
                <h3>Next Steps:</h3>
                <ol><li>Contact the customer to arrange bag delivery</li><li>Deliver <strong>1</strong> laundry bag(s) they purchased during registration</li><li>Explain the pickup and delivery process</li><li>Schedule their first pickup if requested</li><li>Remind them that bag fees will be credited on their first order</li></ol>
                
                <center>
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate&customer=CUST-c1da14da-50ed-42b8-b0b7-bd24568be63c" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Customer in Dashboard</a>
                </center>
                
                <p>Remember: Providing excellent service from the start helps ensure customer retention and positive reviews!</p>
            </div>
            
            <div class="footer">
                <p>This email was sent by WaveMAX Laundry Affiliate Program</p>
                <p>Questions? Contact us at <a href="mailto:support@wavemax.promo">support@wavemax.promo</a></p>
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/customers/register [32m201[0m 298.815 ms - 400[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:55.535Z"}
  console.log
    CSRF token generation: {
      sessionID: '00ec1f80f5a7342c80bffa98c49359ea',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: yUf8JEnJ-n_nsMiSnmNZapiZBXxGlXYpVeOk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 00ec1f80f5a7342c80bffa98c49359ea

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Y8nMsu20Cd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.192 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:55.795Z"}
[0mPOST /api/v1/customers/register [33m400[0m 28.885 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:56.682Z"}
  console.log
    CSRF token generation: {
      sessionID: '1976043b35209693e558d8b3b8fbdeeb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FEczBueU-OYEYDhkmf8iqUmkmsrrwOjm_5Rs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1976043b35209693e558d8b3b8fbdeeb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 7m_TTLFnzi...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.142 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:56.951Z"}
[0mPOST /api/v1/customers/register [33m400[0m 82.704 ms - 70[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:57.896Z"}
  console.log
    CSRF token generation: {
      sessionID: '06dbffdb47d354d58862a1cc9b022a1f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ROzfv4wk-QC0DHs3KSfczWK1YIJ2JjwXNhbA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 06dbffdb47d354d58862a1cc9b022a1f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: RGmBlccsGB...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.005 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:58.151Z"}
[0mPOST /api/v1/customers/register [33m400[0m 83.117 ms - 71[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:59.092Z"}
  console.log
    CSRF token generation: {
      sessionID: '45af830b9c28b23be29ffacfb149bf41',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: rFn27S9O-wUWN6mH_WQNOdelcyYljeJElVWE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 45af830b9c28b23be29ffacfb149bf41

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5aQyAfRRil...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.945 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:14:59.406Z"}
[0mGET /api/v1/customers/CUST123/profile [32m200[0m 64.435 ms - 835[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:00.357Z"}
  console.log
    CSRF token generation: {
      sessionID: '78939f1f066a06bddc64ac40510518f7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0SYsKkhi-ytRXDpbKC-Q2I5-cyyIAnOn0oWQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 78939f1f066a06bddc64ac40510518f7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bTsXtbyn7l...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.887 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:00.650Z"}
[0mGET /api/v1/customers/CUST123/profile [32m200[0m 85.001 ms - 835[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:01.602Z"}
  console.log
    CSRF token generation: {
      sessionID: '705008f459ddebf7186b54c538e7efd1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eNY5MTKL-Dqfw8QTTLw71w5l8V9nkSSvh51Q

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 705008f459ddebf7186b54c538e7efd1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: -wx2aaXBiz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.804 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:01.869Z"}
[0mGET /api/v1/customers/CUST123/profile [33m403[0m 35.526 ms - 66[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:02.771Z"}
  console.log
    CSRF token generation: {
      sessionID: '520f681d6c4ed44f2a8d61b00d1b7dd6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9hsOOPCu-7rSg90K3laNEc24hCXmlVpT_CkY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 520f681d6c4ed44f2a8d61b00d1b7dd6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ZEiF8MenxP...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.686 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:03.034Z"}
  console.error
    Customer access check error: TypeError: Cannot read properties of undefined (reading 'role')
        at role (/var/www/wavemax/wavemax-affiliate-program/server/middleware/authorizationHelpers.js:121:20)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at next (/var/www/wavemax/wavemax-affiliate-program/server/routes/customerRoutes.js:94:5)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at Route.dispatch (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:119:3)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:284:15
        at param (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:365:14)
        at param (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:376:14)
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:421:3)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at Function.handle (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:175:3)
        at router (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:47:12)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at trim_prefix (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:328:13)
        at /var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:286:9
        at Function.process_params (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:346:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/index.js:280:10)
        at SendStream.error (/var/www/wavemax/wavemax-affiliate-program/node_modules/serve-static/index.js:121:7)
        at SendStream.emit (node:events:524:28)
        at SendStream.error (/var/www/wavemax/wavemax-affiliate-program/node_modules/send/index.js:270:17)
        at SendStream.onStatError (/var/www/wavemax/wavemax-affiliate-program/node_modules/send/index.js:417:12)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/send/index.js:730:16)
        at onstat (/var/www/wavemax/wavemax-affiliate-program/node_modules/send/index.js:719:14)
        at FSReqCallback.oncomplete (node:fs:198:21)

      163 |
      164 |     } catch (error) {
    > 165 |       console.error('Customer access check error:', error);
          |               ^
      166 |       return res.status(500).json({
      167 |         success: false,
      168 |         message: 'Authorization check failed'

      at error (server/middleware/authorizationHelpers.js:165:15)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at next (server/routes/customerRoutes.js:94:5)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at Route.dispatch (node_modules/express/lib/router/route.js:119:3)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at node_modules/express/lib/router/index.js:284:15
      at param (node_modules/express/lib/router/index.js:365:14)
      at param (node_modules/express/lib/router/index.js:376:14)
      at Function.process_params (node_modules/express/lib/router/index.js:421:3)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at Function.handle (node_modules/express/lib/router/index.js:175:3)
      at router (node_modules/express/lib/router/index.js:47:12)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at trim_prefix (node_modules/express/lib/router/index.js:328:13)
      at node_modules/express/lib/router/index.js:286:9
      at Function.process_params (node_modules/express/lib/router/index.js:346:12)
      at next (node_modules/express/lib/router/index.js:280:10)
      at SendStream.error (node_modules/serve-static/index.js:121:7)
      at SendStream.error (node_modules/send/index.js:270:17)
      at SendStream.onStatError (node_modules/send/index.js:417:12)
      at next (node_modules/send/index.js:730:16)
      at onstat (node_modules/send/index.js:719:14)

[0mGET /api/v1/customers/CUST123/profile [31m500[0m 13.270 ms - 56[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:03.928Z"}
  console.log
    CSRF token generation: {
      sessionID: '6c46421043f6cb05e067ef5e1aa173ac',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MriTUCOs-9b9g75awM0lB8Lb1krwVnS-sWzQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6c46421043f6cb05e067ef5e1aa173ac

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VpYTI21OrL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.360 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:04.189Z"}
[0mPUT /api/v1/customers/CUST123/profile [32m200[0m 99.132 ms - 989[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:05.199Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f8a3342584e3138706fcd4fcadc82255',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: qDfve2Dm-Ri4x7B22bsvOa5fObNydbatPVxQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f8a3342584e3138706fcd4fcadc82255

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ezd31G0t_Z...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.330 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/profile {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:05.464Z"}
[0mPUT /api/v1/customers/CUST123/profile [33m400[0m 56.495 ms - 55[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:06.408Z"}
  console.log
    CSRF token generation: {
      sessionID: '16887c4d5b5557ca02e915e87c6c03c4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: aeaRfbVd-Oc_6wIk8xGE5sqlBqwn0Qi0KS5c

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 16887c4d5b5557ca02e915e87c6c03c4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: nx8M2YUs_u...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.482 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/orders?page=1&limit=10 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:06.871Z"}
[0mGET /api/v1/customers/CUST123/orders?page=1&limit=10 [32m200[0m 73.714 ms - 894[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:07.798Z"}
  console.log
    CSRF token generation: {
      sessionID: '10ebb2e282c4ca1c1d728aaa8a487684',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: oGtudz4j-K6Kb1II9u6djYGuEwPQe3XIP8co

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 10ebb2e282c4ca1c1d728aaa8a487684

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2TiDuxk9Ek...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.262 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/orders?status=complete {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:08.083Z"}
[0mGET /api/v1/customers/CUST123/orders?status=complete [32m200[0m 57.365 ms - 519[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:08.997Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e6a59363e562c79698c79b6da707aad0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0gjBAYt6-VwIzVWYmWHqkvpyZKKmS6xCtGUk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e6a59363e562c79698c79b6da707aad0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QklgFquolQ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.647 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:09.262Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/password {
      sessionID: 'e6a59363e562c79698c79b6da707aad0',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ae6a59363e562c79698c79b6da707aad0.5tRKEMBWvr5KGDEEvbcokdfaXSrbxEi7Gg0FMjP5JyQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/customers/CUST123/password [32m200[0m 194.511 ms - 58[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:09.459Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 144.007 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:10.481Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c215fef149f87415c0ff9c970e1fbe90',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: dpHSnPKY-_jjsg2LtjiVBCerPP_M4EJCTJQY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c215fef149f87415c0ff9c970e1fbe90

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: xd-uKWYuot...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.838 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:10.744Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/password {
      sessionID: 'c215fef149f87415c0ff9c970e1fbe90',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac215fef149f87415c0ff9c970e1fbe90.D1Q23cyzbz89ezjHfycgaR8DDUL15pGxDo%2Bil2JmDYw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/customers/CUST123/password [33m400[0m 110.618 ms - 59[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:11.714Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a7f262ba2b3a6d0755bce60d6a3ad63a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lF19brBT-eqd_agKbTUZOpjJP-S63gPb0YkM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a7f262ba2b3a6d0755bce60d6a3ad63a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: EBaShGeoLn...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.878 ms - 67[0m
[34mdebug[39m: PUT /api/v1/customers/CUST123/password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:12.001Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/password {
      sessionID: 'a7f262ba2b3a6d0755bce60d6a3ad63a',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa7f262ba2b3a6d0755bce60d6a3ad63a.fqFdNaXCkY%2F20W6WXfV7IeLsj6ksIZLuSEhuBKMJ%2BuE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/customers/CUST123/password [32m200[0m 188.586 ms - 58[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:13.062Z"}
  console.log
    CSRF token generation: {
      sessionID: '7a5cb0d3a77c76a35b488b129476456d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nSYIPDqO-DBj6B3CdRKRMrJzoQw9g8DC4g0w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7a5cb0d3a77c76a35b488b129476456d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 3CbO1eQI7L...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.441 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/dashboard {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:13.362Z"}
[0mGET /api/v1/customers/CUST123/dashboard [32m200[0m 72.483 ms - 928[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:14.276Z"}
  console.log
    CSRF token generation: {
      sessionID: '6e5f0aa34e2612b2f3721dd2a280aecb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: X5b1eNx6-rshvoqhP3r3fFo7U3DK2D_2Wsd4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6e5f0aa34e2612b2f3721dd2a280aecb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 7A9lDFLRqA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.719 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/dashboard?includeMonthlyStats=true {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:14.575Z"}
[0mGET /api/v1/customers/CUST123/dashboard?includeMonthlyStats=true [32m200[0m 59.888 ms - 928[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:15.464Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fb5688d09afaa88e1aab134679bff026',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: P2MZqZY5-42LuVjrHAGM07diRlmIg6FYmpuM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fb5688d09afaa88e1aab134679bff026

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: IG8aCNSBkZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.516 ms - 67[0m
[34mdebug[39m: GET /api/v1/customers/CUST123/dashboard {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:15.763Z"}
[0mGET /api/v1/customers/CUST123/dashboard [32m200[0m 88.982 ms - 928[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:16.750Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e8f8bff948aa04e990b785c8662e101c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: e7ZBA3Rz-Q8dboAAVmAogFENxVgACXoVE5ws

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e8f8bff948aa04e990b785c8662e101c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _YcIzNjaGP...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.429 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/customers/CUST123/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:17.089Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/delete-all-data {
      sessionID: 'e8f8bff948aa04e990b785c8662e101c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ae8f8bff948aa04e990b785c8662e101c.e%2BWASmXn2Wq9G5G3icTTm%2Ba3fS2zD7OKfj3GTCioWdk',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/customers/CUST123/delete-all-data [33m400[0m 57.968 ms - 72[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:18.092Z"}
  console.log
    CSRF token generation: {
      sessionID: '33c0bdb483699a7f9a3dc8ce18ace238',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9Sidb4Yd-63kLTPeJU2RgvZZBgSAJGaBahR0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 33c0bdb483699a7f9a3dc8ce18ace238

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: agEv5NRj7h...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.126 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/customers/CUST123/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:18.349Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/delete-all-data {
      sessionID: '33c0bdb483699a7f9a3dc8ce18ace238',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A33c0bdb483699a7f9a3dc8ce18ace238.9WAGYjuXe1qeU9xUqGGNYmofhAhr2lcRpWVenKatAS4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/customers/CUST123/delete-all-data [32m200[0m 88.243 ms - 66[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:19.295Z"}
  console.log
    CSRF token generation: {
      sessionID: '01779f41d68f6d275456a2c4e3b69b8c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: W5WVl1l2-_g7zDHRvRj8-Jy5VpDJoat3jjUk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 01779f41d68f6d275456a2c4e3b69b8c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: J-Q0oESKKl...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.524 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/customers/CUST123/delete-all-data {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:19.631Z"}
  console.log
    CSRF check for: /api/v1/customers/CUST123/delete-all-data {
      sessionID: '01779f41d68f6d275456a2c4e3b69b8c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A01779f41d68f6d275456a2c4e3b69b8c.uTrqGDD%2Bxlqz4TXo41RXrUMRS3TGaAZPfXb4mY231QU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/customers/CUST123/delete-all-data [33m403[0m 32.271 ms - 66[0m
PASS tests/integration/customer.test.js (28.459 s)
  Customer Integration Tests
    POST /api/v1/customers/register
      âœ“ should register a new customer (2149 ms)
      âœ“ should fail with invalid affiliate ID (1146 ms)
      âœ“ should fail with duplicate email (1215 ms)
      âœ“ should fail with duplicate username (1195 ms)
    GET /api/v1/customers/:customerId/profile
      âœ“ should return customer profile for authenticated customer (1265 ms)
      âœ“ should return customer profile for affiliate (1245 ms)
      âœ“ should fail for unauthorized customer (1168 ms)
      âœ“ should return limited data without authentication (1157 ms)
    PUT /api/v1/customers/:customerId/profile
      âœ“ should update customer profile (1271 ms)
      âœ“ should not update protected fields (1208 ms)
    GET /api/v1/customers/:customerId/orders
      âœ“ should return customer orders with pagination (1391 ms)
      âœ“ should filter orders by status (1198 ms)
    PUT /api/v1/customers/:customerId/password
      âœ“ should update customer password (1484 ms)
      âœ“ should fail with incorrect current password (1233 ms)
      âœ“ should fail with weak new password (1346 ms)
    GET /api/v1/customers/:customerId/dashboard
      âœ“ should return customer dashboard statistics (1215 ms)
      âœ“ should return monthly statistics (1188 ms)
      âœ“ should allow affiliate to view customer dashboard (1286 ms)
    DELETE /api/v1/customers/:customerId/delete-all-data
      âœ“ should delete all customer data in development environment (1342 ms)
      âœ“ should reject deletion in production environment (1202 ms)
      âœ“ should reject unauthorized deletion (1288 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:21.571Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:24.302Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-f918b1d5-465e-4bdd-acd5-81ae41c4551a

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 108.249 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:26.001Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-5ac7e036-ba69-4684-b9b3-5c39042bbc44

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 100.903 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:27.635Z"}
[0mGET /api/v1/quickbooks/vendors [33m404[0m 55.162 ms - 66[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-10-10&endDate=2025-10-17&format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:29.140Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-10-10&endDate=2025-10-17&format=csv [32m200[0m 123.816 ms - 322[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-10-10&endDate=2025-10-17&format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:30.691Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-10-10&endDate=2025-10-17&format=json [32m200[0m 120.182 ms - 961[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:32.365Z"}
[0mGET /api/v1/quickbooks/payment-summary [33m400[0m 38.144 ms - 66[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2026-10-17&endDate=2026-10-17 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:33.856Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2026-10-17&endDate=2026-10-17 [33m404[0m 108.439 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-10-10&endDate=2025-10-17&format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:35.445Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-10-10&endDate=2025-10-17&format=csv [32m200[0m 142.128 ms - 169[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-01-01 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:37.040Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-001&startDate=2025-01-01 [33m400[0m 29.260 ms - 81[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-003&startDate=2025-01-01&endDate=2025-01-31 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:38.619Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-QB-003&startDate=2025-01-01&endDate=2025-01-31 [33m400[0m 56.225 ms - 76[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail?affiliateId=AFF-NONEXISTENT&startDate=2025-01-01&endDate=2025-01-31 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:40.195Z"}
[0mGET /api/v1/quickbooks/commission-detail?affiliateId=AFF-NONEXISTENT&startDate=2025-01-01&endDate=2025-01-31 [33m404[0m 57.573 ms - 49[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:41.723Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-d2164aef-2b34-4ba7-bc1d-c51d4e207e59

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 92.750 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:41.818Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json [33m404[0m 80.804 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/history {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:41.902Z"}
[0mGET /api/v1/quickbooks/history [32m200[0m 97.829 ms - 946[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:43.481Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-2d47074b-24d1-4a06-bda7-f45c07f6273d

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 91.882 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:43.575Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json [33m404[0m 83.007 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/history?type=vendor {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:43.662Z"}
[0mGET /api/v1/quickbooks/history?type=vendor [32m200[0m 85.317 ms - 946[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.213Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-3bb8aaf9-86f3-42d4-8da4-e8b5d575bab3

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 96.971 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.312Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-01-01&endDate=2025-01-31&format=json [33m404[0m 81.691 ms - 83[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.396Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-cc1003a8-9e72-4320-a8e3-dfa891be4bc7

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 96.678 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.496Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-8b0799fb-338c-4984-a47b-64f53d6d54b8

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 91.551 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.590Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-08c50012-5c92-4c88-a25a-e0939dd5c27e

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 96.240 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.690Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-84c8130e-2bb9-47ea-a697-857ff0f73129

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 96.882 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.791Z"}
  console.log
    QuickBooks vendor export: JSON, 2 records, exportId: EXP-f39a2015-cd87-4520-929a-c1570ed345da

      at log (server/controllers/quickbooksController.js:102:13)

[0mGET /api/v1/quickbooks/vendors?format=json [32m200[0m 94.036 ms - 915[0m
[34mdebug[39m: GET /api/v1/quickbooks/history?limit=3 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:45.889Z"}
[0mGET /api/v1/quickbooks/history?limit=3 [32m200[0m 103.947 ms - -[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:47.538Z"}
[0mGET /api/v1/quickbooks/vendors [33m401[0m 1.661 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:47.542Z"}
[0mGET /api/v1/quickbooks/payment-summary [33m401[0m 0.854 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/commission-detail {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:47.545Z"}
[0mGET /api/v1/quickbooks/commission-detail [33m401[0m 0.756 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/history {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:47.548Z"}
[0mGET /api/v1/quickbooks/history [33m401[0m 0.671 ms - 47[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:49.019Z"}
  console.log
    Authorization failed for path: /vendors - User role: affiliate Allowed roles: [ 'administrator' ]

      at log (server/middleware/auth.js:146:15)

[0mGET /api/v1/quickbooks/vendors [33m403[0m 31.082 ms - 54[0m
[34mdebug[39m: GET /api/v1/quickbooks/vendors?format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:50.519Z"}
  console.log
    QuickBooks vendor export: CSV, 2 records, exportId: EXP-266997a5-a1dc-4794-9af8-9ceee8e82440

      at log (server/controllers/quickbooksController.js:94:15)

[0mGET /api/v1/quickbooks/vendors?format=csv [32m200[0m 94.580 ms - 354[0m
[34mdebug[39m: GET /api/v1/quickbooks/payment-summary?startDate=2025-10-10&endDate=2025-10-17&format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:52.216Z"}
[0mGET /api/v1/quickbooks/payment-summary?startDate=2025-10-10&endDate=2025-10-17&format=csv [32m200[0m 126.782 ms - 322[0m
PASS tests/integration/quickbooks.test.js (32.564 s)
  QuickBooks Export Integration Tests
    Vendor Export
      âœ“ should export verified vendors as CSV (2409 ms)
      âœ“ should export vendors as JSON (1583 ms)
      âœ“ should handle no verified vendors gracefully (1562 ms)
    Payment Summary Export
      âœ“ should export payment summary for date range as CSV (1550 ms)
      âœ“ should export payment summary as JSON with correct aggregations (1657 ms)
      âœ“ should require date parameters (1511 ms)
      âœ“ should handle empty date range (1555 ms)
    Commission Detail Export
      âœ“ should export commission details for specific affiliate (1613 ms)
      âœ“ should require all parameters (1523 ms)
      âœ“ should reject unverified affiliate export (1621 ms)
      âœ“ should handle non-existent affiliate (1515 ms)
    Export History
      âœ“ should retrieve export history (1795 ms)
      âœ“ should filter export history by type (1730 ms)
      âœ“ should limit export history results (2283 ms)
    Security and Permissions
      âœ“ should require admin authentication for all QuickBooks endpoints (1503 ms)
      âœ“ should not allow affiliate access to QuickBooks exports (1505 ms)
    CSV Format Validation
      âœ“ should generate QuickBooks-compatible vendor CSV (1570 ms)
      âœ“ should generate QuickBooks-compatible payment CSV (1743 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:54.813Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:56.194Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MiBSePi9-viSjGi8xQzlj9L6Sb4unvN4oiCc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.544 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:56.205Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

  console.log
    V2 registration: 2 free bags, no payment required

      at log (server/controllers/customerController.js:131:13)

  console.error
    Failed to send welcome email: TypeError: emailService.sendCustomerWelcomeEmail is not a function
        at sendCustomerWelcomeEmail (/var/www/wavemax/wavemax-affiliate-program/server/controllers/customerController.js:193:24)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

      197 |     );
      198 |   } catch (emailError) {
    > 199 |     console.error('Failed to send welcome email:', emailError);
          |             ^
      200 |     // Don't fail registration if email fails
      201 |   }
      202 |

      at error (server/controllers/customerController.js:199:13)

  console.error
    Failed to send affiliate notification: TypeError: emailService.sendAffiliateNewCustomerEmail is not a function
        at sendAffiliateNewCustomerEmail (/var/www/wavemax/wavemax-affiliate-program/server/controllers/customerController.js:205:24)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

      209 |     );
      210 |   } catch (emailError) {
    > 211 |     console.error('Failed to send affiliate notification:', emailError);
          |             ^
      212 |     // Don't fail registration if notification fails
      213 |   }
      214 |

      at error (server/controllers/customerController.js:211:13)

[0mPOST /api/customers/register [32m201[0m 264.406 ms - 400[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:57.431Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MtlgzqFB-piQUp7b2LwnuFLnp6CvYVjWLsyg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.576 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:57.439Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: AaLEyjKu-BX6NCAGs7WKbO1o6XAH67wIn874

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.956 ms - 67[0m
[34mdebug[39m: POST /api/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:57.447Z"}
[0mPOST /api/auth/customer/login [33m401[0m 28.180 ms - 64[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:58.314Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ccQKpNyv-lM3VUISEkcW1WCjEX5QRn6tsTHo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.633 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:59.119Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: AwUQPWHl-lPA-ZXp5lR1jHBwTy9Zt884O-JE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.706 ms - 67[0m
[34mdebug[39m: POST /api/orders/create {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:15:59.129Z"}
  console.log
    CSRF check for: /api/orders/create {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa19632eb0689d8dc8855b046b6ef850.OfFxJSpZyTNE8xPsgMDMn9aawNVnf1kAgyY%2BE%2Fxhg0g',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/orders/create [33m404[0m 4.430 ms - 129[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:00.126Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: q0UdJBod-soD_HfRW73s9OW7wNHyPy0dBcH8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.741 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:00.137Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: XRLnjBED-VWBSBjUIB5yMlItoqz6HEt_yfN4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.706 ms - 67[0m
[34mdebug[39m: POST /api/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:00.146Z"}
[0mPOST /api/auth/administrator/login [33m400[0m 1.639 ms - 84[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:03.356Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KTMaDs1N-2bQaacD1EHqQ2YBZYmSQzs5wDN8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.892 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:05.039Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Mjw2AlmR-aPHlyulrj_ZwBZH1OP-5FqzNME0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.551 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:05.847Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: r8RKjyAO-PAWJfPJgk5YvnVD3Ep-US_U8k14

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.874 ms - 67[0m
[34mdebug[39m: POST /api/orders/confirm-payment {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:05.854Z"}
  console.log
    CSRF check for: /api/orders/confirm-payment {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa19632eb0689d8dc8855b046b6ef850.OfFxJSpZyTNE8xPsgMDMn9aawNVnf1kAgyY%2BE%2Fxhg0g',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/orders/confirm-payment [33m400[0m 30.301 ms - 136[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:06.766Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gB1AaFLt-sbV35fYJujuUn8mcWr43Ll5IVd0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.913 ms - 67[0m
  console.log
    No order ID found in payment note

      at PaymentEmailScanner.log [as parsePaymentEmail] (server/services/paymentEmailScanner.js:169:17)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:08.462Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: wooIj78p-iJYHS0j0cibPm3CrcQ88sdz7q1A

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.307 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:10.173Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: O8zYhx2x-Nr943EaQp5SEJL_7_GoiOqsBNQE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.059 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:11.992Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: zOw2UCUT-uk3Td723H43SP4izzjHW7N07NS4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.531 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:13.803Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3dcR1HA5-xZI5FbGViepWRkmyHBYraV8PB_g

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.587 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:15.621Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: J45vcBkS-yCJ0xLDODFiU2xPnMJeHQBgJ8kY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.583 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:17.406Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: XaR8fhHy-sKcwxEvQfk5Ukelq9_Vn-VpzFEQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.402 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:19.153Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9Ewpa0IS-PkSjXT0wqywmYUaEjutMs1OFiLo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.422 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:20.997Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9uVs14Dc-gyQ9aCHSDh294ZHvkoBX89gU6TE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.800 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:21.799Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eDL9doYj-RyIvHgZ6jEsHBDtfjwwRf2pg0vE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.333 ms - 67[0m
[34mdebug[39m: POST /api/orders/confirm-payment {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:21.808Z"}
  console.log
    CSRF check for: /api/orders/confirm-payment {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa19632eb0689d8dc8855b046b6ef850.OfFxJSpZyTNE8xPsgMDMn9aawNVnf1kAgyY%2BE%2Fxhg0g',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/orders/confirm-payment [33m400[0m 34.994 ms - 138[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:22.690Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 469PyaQ9-Efg5dYcmTK7ANgvv8TAibqouw5g

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.012 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:22.700Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: VakQlJze-hZqErq9kggeFBbVrQm-aATqjAeU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.762 ms - 67[0m
[34mdebug[39m: POST /api/orders/confirm-payment {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:22.707Z"}
  console.log
    CSRF check for: /api/orders/confirm-payment {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa19632eb0689d8dc8855b046b6ef850.OfFxJSpZyTNE8xPsgMDMn9aawNVnf1kAgyY%2BE%2Fxhg0g',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.error
    Payment confirmation error: TypeError: Cannot read properties of undefined (reading 'length')
        at length (/var/www/wavemax/wavemax-affiliate-program/server/controllers/orderController.js:1171:17)
        at Layer.handle [as handle_request] (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/layer.js:95:5)
        at next (/var/www/wavemax/wavemax-affiliate-program/node_modules/express/lib/router/route.js:149:13)
        at middleware (/var/www/wavemax/wavemax-affiliate-program/node_modules/express-validator/lib/middlewares/check.js:16:13)

      1254 |     
      1255 |   } catch (error) {
    > 1256 |     console.error('Payment confirmation error:', error);
           |             ^
      1257 |     res.status(500).json({
      1258 |       success: false,
      1259 |       message: 'An error occurred while processing your payment confirmation'

      at error (server/controllers/orderController.js:1256:13)
      at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
      at next (node_modules/express/lib/router/route.js:149:13)
      at middleware (node_modules/express-validator/lib/middlewares/check.js:16:13)

[0mPOST /api/orders/confirm-payment [31m500[0m 16.199 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:23.559Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Lk5Rhh85-zIR9Cq5RSKikP5J8hZt4d09bOCE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.093 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:24.475Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HGuzRlwN-7Ynege-lV377_tjgWFx4XHK-G04

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.057 ms - 67[0m
[34mdebug[39m: POST /api/orders/confirm-payment {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:24.483Z"}
  console.log
    CSRF check for: /api/orders/confirm-payment {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa19632eb0689d8dc8855b046b6ef850.OfFxJSpZyTNE8xPsgMDMn9aawNVnf1kAgyY%2BE%2Fxhg0g',
      hasCsrfSecret: true,
      hasAuth: false,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/orders/confirm-payment [33m409[0m 29.303 ms - 112[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:25.355Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: gTaj6Gnp-VBEZUr01uYnGBH_Cx8GiQ9cNTts

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.867 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:25.390Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: QNrMedmD-oszWVqSVAmkerBQozawyAibG4Lk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.272 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:25.397Z"}
[0mPOST /api/customers/register [33m400[0m 1.875 ms - 507[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:26.243Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9TlDTEpy-kKKRQ_REtrjnScpkUndYTESehr0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.381 ms - 67[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:26.283Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa19632eb0689d8dc8855b046b6ef850',
      hasSession: true,
      hasCsrfSecret: true
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vSz8haSm-z-VsDJywkJu_P3peIFIUpztPLX8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa19632eb0689d8dc8855b046b6ef850

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lalB7-gC2i...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.446 ms - 67[0m
[34mdebug[39m: POST /api/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:26.291Z"}
[0mPOST /api/customers/register [33m400[0m 1.513 ms - 507[0m
PASS tests/integration/v2-payment-flow.test.js (33.574 s)
  V2 Payment Flow Integration Tests
    V2 Customer Registration
      âœ“ should register a V2 customer without payment (1252 ms)
      âœ“ should allow V2 customer to login (882 ms)
    V2 Pickup Scheduling
      âœ“ should create order without prepayment for V2 customer (1811 ms)
    Payment Link Generation
      âœ“ should generate payment links when order is weighed (3229 ms)
      âœ“ should send payment request email (1684 ms)
    Payment Confirmation Flow
      âœ“ should handle customer payment confirmation (1727 ms)
      âœ“ should verify payment through email scanning (1696 ms)
      âœ“ should mark order as paid when payment verified (1711 ms)
    Payment Reminder System
      âœ“ should send reminder after 30 minutes (1818 ms)
      âœ“ should send hourly reminders after first 30 minutes (1811 ms)
      âœ“ should escalate to admin after 4 hours (1818 ms)
    Manual Payment Verification (Admin)
      âœ“ should allow admin to manually verify payment (1785 ms)
    Pickup Ready Notification
      âœ“ should send pickup ready notification only after payment verified (1747 ms)
      âœ“ should not send pickup ready if payment not verified (1844 ms)
    Error Handling
      âœ“ should handle invalid payment amounts (1692 ms)
      âœ“ should handle missing order ID in payment confirmation (869 ms)
      âœ“ should handle duplicate payment confirmations (1796 ms)
    Feature Toggle
      âœ“ should use V1 flow when payment_version is v1 (887 ms)
      âœ“ should use V2 flow when payment_version is v2 (868 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:28.225Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:29.476Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd6e0b95eded2245da37c7c498585aa8c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vIYemMIw-3v-ezhZ0_PxKHryp8yBBMhrz9rI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d6e0b95eded2245da37c7c498585aa8c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: oFpt1Uf06U...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.729 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:29.575Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 186.860 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:29.916Z"}
[0mGET /api/v1/administrators [32m200[0m 114.991 ms - 865[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:31.114Z"}
  console.log
    CSRF token generation: {
      sessionID: '96c7dc23d95893bca97ea59dde750a79',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vCFAKRRe-41rJuVZ8nvV89NbNDO8yMSm1feM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 96c7dc23d95893bca97ea59dde750a79

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1Rf2quIBpZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.371 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:31.201Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 142.310 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators?active=true {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:31.429Z"}
[0mGET /api/v1/administrators?active=true [32m200[0m 110.964 ms - 376[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:32.508Z"}
  console.log
    CSRF token generation: {
      sessionID: '527a864cce72ca44c7b55ca05370415a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xnjP1iK4-4sph7Nhn6uU1_Z-k_9e06Ynw8UE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 527a864cce72ca44c7b55ca05370415a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PnZ32k6_5F...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.687 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:32.598Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.461 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators?page=2&limit=5 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:33.573Z"}
[0mGET /api/v1/administrators?page=2&limit=5 [32m200[0m 108.573 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:34.631Z"}
  console.log
    CSRF token generation: {
      sessionID: '7b3ad8e84311a17c14eb4eb48710c09d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: PuDjOsKy-zVfw8RLflce8NGloLXvZfvszZTs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7b3ad8e84311a17c14eb4eb48710c09d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: WsDq89VuKg...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.009 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:34.717Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 144.630 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:34.864Z"}
[0mGET /api/v1/administrators [33m401[0m 1.256 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:35.815Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e146c06e41a9c63e406f4bb15aad36f0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BLSt8qwZ-OuQ1mBIRZFcz5mkZIiqgyP_Ucbs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e146c06e41a9c63e406f4bb15aad36f0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 74OWv784qW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.513 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:35.907Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 138.299 ms - 615[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:36.082Z"}
[0mPOST /api/v1/auth/customer/login [33m401[0m 83.897 ms - 64[0m
  console.log
    Customer login failed: { success: false, message: 'Invalid username/email or password' }

      at Object.log (tests/integration/administrator.test.js:224:17)

[34mdebug[39m: GET /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:36.177Z"}
[0mGET /api/v1/administrators [33m401[0m 1.725 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:37.155Z"}
  console.log
    CSRF token generation: {
      sessionID: '46ed8e5ec51028adbe8e8adaabb98567',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: dZUDvXhW-pKBCTaVtTP2R3mhiqXbVDIc64OQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 46ed8e5ec51028adbe8e8adaabb98567

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8APJ68E737...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.159 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:37.250Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.982 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/68f1a705d8f992b280a0a84d {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:37.478Z"}
[0mGET /api/v1/administrators/68f1a705d8f992b280a0a84d [32m200[0m 82.444 ms - 283[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:38.500Z"}
  console.log
    CSRF token generation: {
      sessionID: '421d8402fd98e88a37d3eacbaefb0074',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KmvSfqaH-qJoI06vKVpH8eg11qS0S9YPFexQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 421d8402fd98e88a37d3eacbaefb0074

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ud8M0F9Hrx...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.928 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:38.592Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 179.532 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/68f1a706d8f992b280a0a87c {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:38.774Z"}
[0mGET /api/v1/administrators/68f1a706d8f992b280a0a87c [33m404[0m 83.386 ms - 53[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:39.798Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e9bcad97c07dc6bfe4c0f40f452ca97f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mnac7UlV-H9MApcssj9jZ7rdXyxygUoGFYDM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e9bcad97c07dc6bfe4c0f40f452ca97f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Lkld8jANi9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.099 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:39.886Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.899 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/invalid-id {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:40.031Z"}
[0mGET /api/v1/administrators/invalid-id [33m400[0m 54.682 ms - 54[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:41.015Z"}
  console.log
    CSRF token generation: {
      sessionID: '7d03cdbe1616035a1165c3b023a29d3b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: LtvUPBJ7-NAydhrXczEzCBsWlB9KrVCDT-zQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7d03cdbe1616035a1165c3b023a29d3b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: CXCnFN-OcH...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.619 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:41.106Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 139.865 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:41.249Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '7d03cdbe1616035a1165c3b023a29d3b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7d03cdbe1616035a1165c3b023a29d3b.hTzNXj3P%2B9RQoojX5bO33wuoBLLRkYzbu7NDzJQwVDc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [32m201[0m 191.396 ms - 329[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:41.443Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 140.530 ms - 677[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:42.525Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ae32c336a5d3de5d08b3873b48508b07',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: XqsfoGHj-pk-se_3OEoXXzq6LCERiPc5n8-Q

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ae32c336a5d3de5d08b3873b48508b07

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: N3yAlJole0...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.002 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:42.615Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 142.310 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:42.759Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'ae32c336a5d3de5d08b3873b48508b07',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aae32c336a5d3de5d08b3873b48508b07.0cu0oANyw7BB7D%2BYbbDftucYj93ssnEzFJe5ngDFgr8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 56.890 ms - 309[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:43.746Z"}
  console.log
    CSRF token generation: {
      sessionID: '2332cc8a94e266a873ae5ded10665fd6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NwVuTF4s-Oa9TQMdvaOgsyNi5A3-5O11Y97w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2332cc8a94e266a873ae5ded10665fd6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: e0Gq9cmZu8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.247 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:43.841Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.740 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:43.987Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '2332cc8a94e266a873ae5ded10665fd6',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A2332cc8a94e266a873ae5ded10665fd6.QP5UeuO%2BdzH9%2FTjtmmNr7d%2BFIkhkwX5PNrKDbQt9XSU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 56.976 ms - 170[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:44.989Z"}
  console.log
    CSRF token generation: {
      sessionID: '74b27a476186f90cb73ceb4d41d86a8b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xv2p1oKJ-RTKzxkFllr-MTCmr367jUL04pDk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 74b27a476186f90cb73ceb4d41d86a8b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _XCW5MV2bi...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.356 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:45.093Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.243 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:45.239Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '74b27a476186f90cb73ceb4d41d86a8b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A74b27a476186f90cb73ceb4d41d86a8b.65oTZa52psXiF6uf%2FXN%2Bi78s%2B0Y7gE8ZwngAruD882M',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 56.717 ms - 204[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:46.219Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e0076a9e233ea12a471dd584f46f5cd9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: fbMxv2Z3-2wLStBtzmCeOuhOlVCI8W9OJLRc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e0076a9e233ea12a471dd584f46f5cd9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Zq9cZRQbh9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.121 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:46.304Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.153 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:46.454Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'e0076a9e233ea12a471dd584f46f5cd9',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ae0076a9e233ea12a471dd584f46f5cd9.0QxlTQfP49l3io1WnyEmRcEmZr5vGcnQAIx45K%2BmKt0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m409[0m 82.432 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:47.485Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ed36f2f2c8888fd40693b2b1fc627c97',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jCS4GwEr-WRXgeIm9X8YYrjOcNyqgAiAIwv8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ed36f2f2c8888fd40693b2b1fc627c97

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: gW6DQiGZxY...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 11.073 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:47.576Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 138.035 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:47.819Z"}
  console.log
    CSRF token generation: {
      sessionID: '235296fa0c7795420e25ddf16aeaab6c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: cQIJIllL-mnu6mQhPGWrE6hZA1TrWVBKVyl0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 235296fa0c7795420e25ddf16aeaab6c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: RHCiQ6X9Go...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.202 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:47.826Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 137.075 ms - 649[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:47.965Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '235296fa0c7795420e25ddf16aeaab6c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A235296fa0c7795420e25ddf16aeaab6c.Z6xoaaAGoO%2FX52ZwXHJTiG3UkfeXXm9AN%2FbXJYEjP0c',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m403[0m 56.012 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:48.966Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a86091a6f84b7abd957e36d61f345a6e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: sxBPRZ38-jMYusFSerd5QSZs7Du-KTddj97A

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a86091a6f84b7abd957e36d61f345a6e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: gJ7WZ0Oqxs...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.813 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:49.052Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 134.212 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a711d8f992b280a0a9ed {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:49.275Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a711d8f992b280a0a9ed {
      sessionID: 'a86091a6f84b7abd957e36d61f345a6e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa86091a6f84b7abd957e36d61f345a6e.HTp%2BRQMdF5zmazvSZBl6ruuQ%2FyeACbI2oljGCwr6j1k',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a711d8f992b280a0a9ed [32m200[0m 91.529 ms - 337[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:50.310Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fc2542ccdfa1e9c080b29ab0e0f1dc40',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ij4HQRAq-N2YxYON-HQjBisQ13KWlHqkJkNk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fc2542ccdfa1e9c080b29ab0e0f1dc40

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: AWHd4w9v1a...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.879 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:50.402Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 144.227 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a712d8f992b280a0aa1c {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:50.628Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a712d8f992b280a0aa1c {
      sessionID: 'fc2542ccdfa1e9c080b29ab0e0f1dc40',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Afc2542ccdfa1e9c080b29ab0e0f1dc40.loE1zK4usZ%2BaZr6n51XBHQoSKw6BfBLkwvSf%2BdZIkiU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a712d8f992b280a0aa1c [32m200[0m 114.035 ms - 318[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:51.681Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a9684d0bd4e57ab856a4759456ac9a91',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RQf1TXMb-ViNGbKBZrCQ9UfAP1OPs16Ie0d4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a9684d0bd4e57ab856a4759456ac9a91

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: sytGBRn14t...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.692 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:51.776Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.877 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a713d8f992b280a0aa4c {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:52.007Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a713d8f992b280a0aa4c {
      sessionID: 'a9684d0bd4e57ab856a4759456ac9a91',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa9684d0bd4e57ab856a4759456ac9a91.H9Lx0niDOKRg%2FKtcpMbkI3GTOfAYCkJTquyYkhy1iw8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a713d8f992b280a0aa4c [32m200[0m 136.666 ms - 316[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:52.146Z"}
  console.log
    CSRF token generation: {
      sessionID: '132e0d694d87d3399aacc36f9d22b628',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 8mLYSotf-QRg3F_jJAulSf4mC8PBdanzLXXM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 132e0d694d87d3399aacc36f9d22b628

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tAWHlNXuY6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.119 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:52.153Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 135.671 ms - 645[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:53.231Z"}
  console.log
    CSRF token generation: {
      sessionID: '9e71bfd8d360a9133f26c402bbbb8520',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: oIVP2Huh-bd2p9UHr77Wi5FfOrYUT_i3-huY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9e71bfd8d360a9133f26c402bbbb8520

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: qsourn038U...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.321 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:53.326Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 137.054 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a715d8f992b280a0aa7f {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:53.547Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a715d8f992b280a0aa7f {
      sessionID: '9e71bfd8d360a9133f26c402bbbb8520',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A9e71bfd8d360a9133f26c402bbbb8520.uBVEaAOAf8haRz3BAt8wsn5%2B6f7Id%2FDKs1n9LjmZE6A',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a715d8f992b280a0aa7f [32m200[0m 86.938 ms - 317[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:53.636Z"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 29.641 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:54.612Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c1b4b7c53edc0de90781023628100e50',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZIuyYjL7-VkuQo5N5GHmE4RdW35N3rw8hqSQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c1b4b7c53edc0de90781023628100e50

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1NVgMdDfOE...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.162 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:54.698Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 138.583 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a716d8f992b280a0aaaf {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:54.924Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a716d8f992b280a0aaaf {
      sessionID: 'c1b4b7c53edc0de90781023628100e50',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac1b4b7c53edc0de90781023628100e50.43nduAmA7DS900gCvbTxBhB%2B69GqAHrB0cOuiczwxsA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a716d8f992b280a0aaaf [32m200[0m 83.317 ms - 316[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:55.941Z"}
  console.log
    CSRF token generation: {
      sessionID: '97af104596812e5a5a362ed6b0ca16af',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: OYXL4tmn-gKka9rN8ApVJgvqnsGE6SvYYIuI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 97af104596812e5a5a362ed6b0ca16af

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: WlwcI59LL6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.650 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:56.028Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.663 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a718d8f992b280a0aade {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:56.268Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a718d8f992b280a0aade {
      sessionID: '97af104596812e5a5a362ed6b0ca16af',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A97af104596812e5a5a362ed6b0ca16af.hITorBb6zYWYEUo%2FfY4wDQxOnHUysB8qXVGdkOGNk8c',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a718d8f992b280a0aade [33m409[0m 82.536 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:57.281Z"}
  console.log
    CSRF token generation: {
      sessionID: '0404c3a2ecbeaa0a0f785e0e0e1ba797',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: yWvQSlS2--NHVeHtOrRjKTREQEv27Rk9WryI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0404c3a2ecbeaa0a0f785e0e0e1ba797

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LenERm1-w9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.191 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:57.367Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 137.855 ms - 615[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a719d8f992b280a0ab07 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:57.588Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a719d8f992b280a0ab07 {
      sessionID: '0404c3a2ecbeaa0a0f785e0e0e1ba797',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A0404c3a2ecbeaa0a0f785e0e0e1ba797.ItTpzxm0x58rS6%2BZEji58HhtMRKseIWnlhKZsqXnmZk',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a719d8f992b280a0ab07 [33m400[0m 55.872 ms - 64[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:58.579Z"}
  console.log
    CSRF token generation: {
      sessionID: '78e57333001352ebdc8accfc3bd9e829',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: yGVT37K7-ArTRF9_gNpksK5Mp27-F60FAKN0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 78e57333001352ebdc8accfc3bd9e829

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: xVS59jwiTG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.098 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:58.670Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.781 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:58.995Z"}
  console.log
    CSRF token generation: {
      sessionID: '2d6523cf653a77ab649d5227dbf4f97d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ymRV5Fy9-LfzqSvw9qi-jJs5lQDXuMSOuJK0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2d6523cf653a77ab649d5227dbf4f97d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 23RlSZ6Hdr...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.112 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:59.004Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 136.455 ms - 650[0m
[34mdebug[39m: PATCH /api/v1/administrators/68f1a71ad8f992b280a0ab3b {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:16:59.142Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a71ad8f992b280a0ab3b {
      sessionID: '2d6523cf653a77ab649d5227dbf4f97d',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A2d6523cf653a77ab649d5227dbf4f97d.mrJl%2Bcj7JBicphonbw3hQ7fkCm7f3qRvVwRlxpNuTJc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/administrators/68f1a71ad8f992b280a0ab3b [33m403[0m 55.711 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:00.150Z"}
  console.log
    CSRF token generation: {
      sessionID: '65be6514c49549398d583c523516e7a4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZgcTe7H1-bRt-OAB-M5Q_5LZ3CmiUhbd-dXA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 65be6514c49549398d583c523516e7a4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: gM3UgvJP6K...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.263 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:00.236Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 140.469 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68f1a71cd8f992b280a0ab6f {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:00.466Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a71cd8f992b280a0ab6f {
      sessionID: '65be6514c49549398d583c523516e7a4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A65be6514c49549398d583c523516e7a4.j5lG3APIPk0Nbo9fCcb5wuJrYfuGjaMWSVNfg4Pobso',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68f1a71cd8f992b280a0ab6f [32m200[0m 117.277 ms - 63[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:01.546Z"}
  console.log
    CSRF token generation: {
      sessionID: '405602f7d0fe70f0f4946c212f27c471',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tM0E942x-ERSvhRDPThdrcrZNT4LclPiGSmI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 405602f7d0fe70f0f4946c212f27c471

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QZeOM781WR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.052 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:01.636Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.019 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68f1a71dd8f992b280a0ab9a {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:01.870Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a71dd8f992b280a0ab9a {
      sessionID: '405602f7d0fe70f0f4946c212f27c471',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A405602f7d0fe70f0f4946c212f27c471.LgH2rCQGGOD4RBOiwD4kuidKNgNVRA5nSRO9Zv%2BKRw4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68f1a71dd8f992b280a0ab9a [33m400[0m 56.830 ms - 60[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:02.870Z"}
  console.log
    CSRF token generation: {
      sessionID: '288b28c5200bccbfc07619117967a9c3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3CO8FUxI-eiE-U9e_JKUqpcDhNsPUt1mwoVA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 288b28c5200bccbfc07619117967a9c3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _BuOspHyQR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.132 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:02.968Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.664 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68f1a71ed8f992b280a0abc8 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:03.231Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a71ed8f992b280a0abc8 {
      sessionID: '288b28c5200bccbfc07619117967a9c3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A288b28c5200bccbfc07619117967a9c3.C3uAzFl3fBYTO5HkJWH7V9vN4nzFFf5kn1pnmWxHkDs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68f1a71ed8f992b280a0abc8 [33m400[0m 55.332 ms - 60[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:04.232Z"}
  console.log
    CSRF token generation: {
      sessionID: '1473ef3e2e81c2f5843fc8d7cd54edd5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nL6yy12k-EMLINzaj0223xYixov3h5aK6Skc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1473ef3e2e81c2f5843fc8d7cd54edd5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: aibP2noRcM...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.036 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:04.360Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 185.152 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:04.721Z"}
  console.log
    CSRF token generation: {
      sessionID: '96577b0079d20b7f18ff3eef1fc6e6c7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 7zVakYub-pmfGkfqE_yxDY6eJ1fo5CAPAxCQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 96577b0079d20b7f18ff3eef1fc6e6c7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ezXNWfMBfh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.958 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:04.729Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.743 ms - 655[0m
[34mdebug[39m: DELETE /api/v1/administrators/68f1a720d8f992b280a0abfd {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:04.880Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a720d8f992b280a0abfd {
      sessionID: '96577b0079d20b7f18ff3eef1fc6e6c7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A96577b0079d20b7f18ff3eef1fc6e6c7.wHUVm%2BqXFyaJeDfj4F8fYncMogF6KutOUxKDiuV5oxs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68f1a720d8f992b280a0abfd [33m403[0m 56.696 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:05.893Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd6de97a36a33f79012720d0e0ef40d02',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KFCt9UZM-HCKEsvv5nN7FoSPF5LmU9sskMqc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d6de97a36a33f79012720d0e0ef40d02

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: xswFsu3_XO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.414 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:05.996Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 137.823 ms - 615[0m
[34mdebug[39m: DELETE /api/v1/administrators/68f1a722d8f992b280a0ac33 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:06.221Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a722d8f992b280a0ac33 {
      sessionID: 'd6de97a36a33f79012720d0e0ef40d02',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad6de97a36a33f79012720d0e0ef40d02.jzBBrmw447s73FV3yAfxWfqIGzGTa0FhYfnmyeLB9LY',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/administrators/68f1a722d8f992b280a0ac33 [33m404[0m 108.695 ms - 53[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:07.266Z"}
  console.log
    CSRF token generation: {
      sessionID: '4af359e43df55d9a6dd4f06ad482e4fe',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: z51hf3na-IlSTe7RPf6o0Th7Yyzs9rC8el0k

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4af359e43df55d9a6dd4f06ad482e4fe

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ZB9f3hLdq2...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.416 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:07.357Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 140.659 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators/68f1a723d8f992b280a0ac62/reset-password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:07.580Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a723d8f992b280a0ac62/reset-password {
      sessionID: '4af359e43df55d9a6dd4f06ad482e4fe',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A4af359e43df55d9a6dd4f06ad482e4fe.ooY4Q0sg1oX0JpaNP8fSbYvHv8IZXXPz36%2B%2BsMXgWL0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68f1a723d8f992b280a0ac62/reset-password [32m200[0m 178.057 ms - 56[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:07.761Z"}
  console.log
    CSRF token generation: {
      sessionID: '012aea78f311ce6e38b7a3907cc8e4b7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3zUpyy8X-xneTkhuAVyBRREnF2I2j2Zrn3Hk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 012aea78f311ce6e38b7a3907cc8e4b7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: GsWcHe6iO-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.386 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:07.769Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 173.448 ms - 644[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:07.947Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e3e34ee010bb330303ddd5dda75b3582',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Kf5rR21u-d-NXQECL2oXx6rMT6HDqH2tbbnc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e3e34ee010bb330303ddd5dda75b3582

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2V5K4ByyNr...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.084 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:07.956Z"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 109.780 ms - 55[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:09.037Z"}
  console.log
    CSRF token generation: {
      sessionID: '7fb1a4648944c642fa9d027b66d11fe4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: wtPJIT4R-4j08xepqGYZB_DOWZIvWdWk_cI0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7fb1a4648944c642fa9d027b66d11fe4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: n2cJRtdmPT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.765 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:09.136Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 142.868 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators/68f1a725d8f992b280a0ac98/reset-password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:09.399Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a725d8f992b280a0ac98/reset-password {
      sessionID: '7fb1a4648944c642fa9d027b66d11fe4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7fb1a4648944c642fa9d027b66d11fe4.mGfaq6hxNw9vI5yTJYxSHBCtZDms1tcskchlTvPe398',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68f1a725d8f992b280a0ac98/reset-password [32m200[0m 166.786 ms - 56[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:10.533Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b9fc8864170d5596c712089cf9409000',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: qTY0EMEq-asafRXtJ6dGb-x20GzEzOc9jmBc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b9fc8864170d5596c712089cf9409000

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: coaiDfstTJ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.345 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:10.623Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.987 ms - 615[0m
[34mdebug[39m: POST /api/v1/administrators/68f1a726d8f992b280a0acca/reset-password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:10.866Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a726d8f992b280a0acca/reset-password {
      sessionID: 'b9fc8864170d5596c712089cf9409000',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ab9fc8864170d5596c712089cf9409000.dE4On9IppuNCbqOKbXae71P3m8sT6RzatH90yu6FFhk',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68f1a726d8f992b280a0acca/reset-password [33m400[0m 56.025 ms - 313[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:11.876Z"}
  console.log
    CSRF token generation: {
      sessionID: '22c5d2712124f24a9767239954df2c55',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lGFrZzth-ONfhMDRSPCqKh29jNXhvj14aOcU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 22c5d2712124f24a9767239954df2c55

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: O_C-j0BaWr...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.125 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:12.033Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.755 ms - 615[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:12.351Z"}
  console.log
    CSRF token generation: {
      sessionID: '15880a4c232c804c843fc12ee5406091',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 67RQzAbt-b3TTYtmYfor2-cta3o8jtROKbb0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 15880a4c232c804c843fc12ee5406091

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QCIkOOYMNb...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.698 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:12.360Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.149 ms - 650[0m
[34mdebug[39m: POST /api/v1/administrators/68f1a728d8f992b280a0acf8/reset-password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:12.511Z"}
  console.log
    CSRF check for: /api/v1/administrators/68f1a728d8f992b280a0acf8/reset-password {
      sessionID: '15880a4c232c804c843fc12ee5406091',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A15880a4c232c804c843fc12ee5406091.yai4ve3qG952y1nouuvjuzYMM4qZMdl6fMSEJ4ffzp8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators/68f1a728d8f992b280a0acf8/reset-password [33m403[0m 57.098 ms - 86[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:13.521Z"}
  console.log
    CSRF token generation: {
      sessionID: '6e4f7610d78a5af97f5132519bcf0a8f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: IIhwE6bO-XldwYDp6At9i1jDgf0nvFb9D-oY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6e4f7610d78a5af97f5132519bcf0a8f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: HN-sqHJGoA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.704 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:13.609Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.343 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/permissions {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:13.763Z"}
[0mGET /api/v1/administrators/permissions [32m200[0m 28.026 ms - 361[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:14.744Z"}
  console.log
    CSRF token generation: {
      sessionID: '33b66962d944e412dbabdabc11bf9f86',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TOJuNroC-bis-2sZF28Gtj_WPrIi_03Fj19A

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 33b66962d944e412dbabdabc11bf9f86

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XqPqiyRaBO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.644 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:14.840Z"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.074 ms - 615[0m
[34mdebug[39m: GET /api/v1/administrators/permissions {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:14.986Z"}
[0mGET /api/v1/administrators/permissions [33m401[0m 0.874 ms - 47[0m
PASS tests/integration/administrator.test.js (48.569 s)
  Administrator Integration Tests
    GET /api/v1/administrators
      âœ“ should get all administrators with admin token (2322 ms)
      âœ“ should filter by active status (1403 ms)
      âœ“ should support pagination (2127 ms)
      âœ“ should require admin authentication (1182 ms)
      âœ“ should require administrator permissions (1340 ms)
    GET /api/v1/administrators/:id
      âœ“ should get administrator by ID (1344 ms)
      âœ“ should return 404 for non-existent administrator (1300 ms)
      âœ“ should handle invalid ObjectId (1216 ms)
    POST /api/v1/administrators
      âœ“ should create new administrator (1508 ms)
      âœ“ should validate required fields (1222 ms)
      âœ“ should validate email format (1244 ms)
      âœ“ should validate password strength (1231 ms)
      âœ“ should prevent duplicate emails (1267 ms)
      âœ“ should require administrators.create permission (1476 ms)
    PATCH /api/v1/administrators/:id
      âœ“ should update administrator details (1341 ms)
      âœ“ should update email (1374 ms)
      âœ“ should update password (1553 ms)
      âœ“ should deactivate administrator (1382 ms)
      âœ“ should not allow updating adminId (1328 ms)
      âœ“ should validate email uniqueness on update (1341 ms)
      âœ“ should prevent self-deactivation (1294 ms)
      âœ“ should require administrators.update permission (1572 ms)
    DELETE /api/v1/administrators/:id
      âœ“ should delete administrator (1395 ms)
      âœ“ should prevent self-deletion (1326 ms)
      âœ“ should prevent deleting last administrator with all permissions (1362 ms)
      âœ“ should require administrators.delete permission (1657 ms)
      âœ“ should handle non-existent administrator (1374 ms)
    POST /api/v1/administrators/:id/reset-password
      âœ“ should reset administrator password (1770 ms)
      âœ“ should clear login attempts on password reset (1496 ms)
      âœ“ should validate password strength (1340 ms)
      âœ“ should require administrators.update permission (1645 ms)
    GET /api/v1/administrators/permissions
      âœ“ should get available permissions list (1222 ms)
      âœ“ should require authentication (1179 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:16.958Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.124Z"}
  console.log
    CSRF token generation: {
      sessionID: '0f3164b1095cffb2d9b6339d63137240',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DVWJcdYI-6W4OKWTOCI-O1u_tN6WWhdNtCT8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0f3164b1095cffb2d9b6339d63137240

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PVxNDe_avX...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.020 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.135Z"}
  console.log
    Service area data loaded: 69 zip codes in 21 cities

      at ServiceAreaService.log [as loadServiceAreaData] (server/services/serviceAreaService.js:40:15)
          at Array.map (<anonymous>)

[0mPOST /api/v1/affiliates/register [33m400[0m 7.572 ms - 178[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.148Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.963 ms - 190[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.152Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.560 ms - 190[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.167Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.100 ms - 221[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.172Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.495 ms - 193[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.176Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.486 ms - 198[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.179Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.355 ms - 198[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.182Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.258 ms - 182[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:18.187Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.464 ms - 229[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:19.298Z"}
  console.log
    CSRF token generation: {
      sessionID: '58429f1fb2a995cb0d3c03275710634c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 2tVaPSMB-4IMsQqDbqGtWWvP5USMzvtD7FlA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 58429f1fb2a995cb0d3c03275710634c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: og3V561u_Q...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.018 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:19.339Z"}
  console.log
    [sendEmail] Sending email to: test0@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test0@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>âš ï¸ IMPORTANT: W-9 Form Information</h3>
            <p><strong>Tax Documentation Process</strong></p>
            <p>To comply with IRS regulations:</p>
            <ul>
              <li>When your annual earnings exceed $600, you will receive a W-9 form via DocuSign</li>
              <li>Complete and sign the form electronically through DocuSign</li>
              <li>Please watch for the DocuSign email to avoid interruption in commission payouts</li>
              <li>Your prompt response ensures uninterrupted commission payments</li>
            </ul>
            <p>Note: The W-9 form will be automatically sent via DocuSign when you reach the $600 annual earnings threshold.</p>
            <p>For questions about the W-9 process, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-8cda4523-04dc-448d-a722-bf4eee5614b4</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-8cda4523-04dc-448d-a722-bf4eee5614b4">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-8cda4523-04dc-448d-a722-bf4eee5614b4</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-8cda4523-04dc-448d-a722-bf4eee5614b4">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-8cda4523-04dc-448d-a722-bf4eee5614b4</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 172.430 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:19.557Z"}
  console.log
    [sendEmail] Sending email to: test1@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>âš ï¸ IMPORTANT: W-9 Form Information</h3>
            <p><strong>Tax Documentation Process</strong></p>
            <p>To comply with IRS regulations:</p>
            <ul>
              <li>When your annual earnings exceed $600, you will receive a W-9 form via DocuSign</li>
              <li>Complete and sign the form electronically through DocuSign</li>
              <li>Please watch for the DocuSign email to avoid interruption in commission payouts</li>
              <li>Your prompt response ensures uninterrupted commission payments</li>
            </ul>
            <p>Note: The W-9 form will be automatically sent via DocuSign when you reach the $600 annual earnings threshold.</p>
            <p>For questions about the W-9 process, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-d4a98403-0156-4522-9cee-7bc3abebf925</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-d4a98403-0156-4522-9cee-7bc3abebf925">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-d4a98403-0156-4522-9cee-7bc3abebf925</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-d4a98403-0156-4522-9cee-7bc3abebf925">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-d4a98403-0156-4522-9cee-7bc3abebf925</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 182.768 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:19.773Z"}
  console.log
    [sendEmail] Sending email to: test2@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>âš ï¸ IMPORTANT: W-9 Form Information</h3>
            <p><strong>Tax Documentation Process</strong></p>
            <p>To comply with IRS regulations:</p>
            <ul>
              <li>When your annual earnings exceed $600, you will receive a W-9 form via DocuSign</li>
              <li>Complete and sign the form electronically through DocuSign</li>
              <li>Please watch for the DocuSign email to avoid interruption in commission payouts</li>
              <li>Your prompt response ensures uninterrupted commission payments</li>
            </ul>
            <p>Note: The W-9 form will be automatically sent via DocuSign when you reach the $600 annual earnings threshold.</p>
            <p>For questions about the W-9 process, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-0a32d094-f3f2-44dc-92ff-7533c169982f</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-0a32d094-f3f2-44dc-92ff-7533c169982f">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-0a32d094-f3f2-44dc-92ff-7533c169982f</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-0a32d094-f3f2-44dc-92ff-7533c169982f">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-0a32d094-f3f2-44dc-92ff-7533c169982f</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 171.907 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:19.980Z"}
  console.log
    [sendEmail] Sending email to: test3@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test3@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>âš ï¸ IMPORTANT: W-9 Form Information</h3>
            <p><strong>Tax Documentation Process</strong></p>
            <p>To comply with IRS regulations:</p>
            <ul>
              <li>When your annual earnings exceed $600, you will receive a W-9 form via DocuSign</li>
              <li>Complete and sign the form electronically through DocuSign</li>
              <li>Please watch for the DocuSign email to avoid interruption in commission payouts</li>
              <li>Your prompt response ensures uninterrupted commission payments</li>
            </ul>
            <p>Note: The W-9 form will be automatically sent via DocuSign when you reach the $600 annual earnings threshold.</p>
            <p>For questions about the W-9 process, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-e548bf99-a970-40bc-a903-789c02fb1dc3</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-e548bf99-a970-40bc-a903-789c02fb1dc3">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-e548bf99-a970-40bc-a903-789c02fb1dc3</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-e548bf99-a970-40bc-a903-789c02fb1dc3">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-e548bf99-a970-40bc-a903-789c02fb1dc3</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 162.088 ms - 120[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:20.177Z"}
  console.log
    [sendEmail] Sending email to: test4@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test4@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Test,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>âš ï¸ IMPORTANT: W-9 Form Information</h3>
            <p><strong>Tax Documentation Process</strong></p>
            <p>To comply with IRS regulations:</p>
            <ul>
              <li>When your annual earnings exceed $600, you will receive a W-9 form via DocuSign</li>
              <li>Complete and sign the form electronically through DocuSign</li>
              <li>Please watch for the DocuSign email to avoid interruption in commission payouts</li>
              <li>Your prompt response ensures uninterrupted commission payments</li>
            </ul>
            <p>Note: The W-9 form will be automatically sent via DocuSign when you reach the $600 annual earnings threshold.</p>
            <p>For questions about the W-9 process, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-8c7b3a04-24c1-42cb-8581-421eccc9a00f</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-8c7b3a04-24c1-42cb-8581-421eccc9a00f">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-8c7b3a04-24c1-42cb-8581-421eccc9a00f</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-8c7b3a04-24c1-42cb-8581-421eccc9a00f">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-8c7b3a04-24c1-42cb-8581-421eccc9a00f</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 172.128 ms - 120[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:21.335Z"}
  console.log
    CSRF token generation: {
      sessionID: '9610e67ca71bb42cdf37253421228638',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6sBUUluK-JjtkoYlC3KNyXIKqk1mBBTzOuIc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9610e67ca71bb42cdf37253421228638

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: s4pVvTivq8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.933 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:21.343Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 2.167 ms - 645[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:22.313Z"}
  console.log
    CSRF token generation: {
      sessionID: '9e3c7357ddba070afbda1fcbdf4c00b6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: EVU7dNUc-inTbSHk8RkmqY4jre6klkQehVAM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9e3c7357ddba070afbda1fcbdf4c00b6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: nS05v0aQGH...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.751 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:22.321Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.606 ms - 646[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:23.283Z"}
  console.log
    CSRF token generation: {
      sessionID: '676c4b6cd764b53d85ffdc6a96f077ed',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: UwN8SBUe-NSaFpcKlG6zdSZaKDOU-014X2x0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 676c4b6cd764b53d85ffdc6a96f077ed

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: nn5MpuaN1d...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.918 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:23.290Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.675 ms - 210[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:23.294Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.546 ms - 211[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:23.297Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.697 ms - 212[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:23.302Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.810 ms - 212[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:24.266Z"}
  console.log
    CSRF token generation: {
      sessionID: '4cdb6ae6cbe85b62ff7860a5dd59a9f2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lafIJMOh-IkSHAyXfDlgLqbzSQ6PJFfzneMc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4cdb6ae6cbe85b62ff7860a5dd59a9f2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: iSODJ1c1M6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.491 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:24.427Z"}
[0mPOST /api/v1/customers/register [33m400[0m 1.775 ms - 181[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:25.394Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c29b6caed0608ebe82ea06a99f96903e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kgCavao9-yoU94qaRaXISqAw9yBT7MCw6tV0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c29b6caed0608ebe82ea06a99f96903e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: alGF7jgVvZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.331 ms - 67[0m
[34mdebug[39m: POST /api/v1/customers/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:25.545Z"}
  console.log
    [sendCustomerWelcomeEmail] Customer: {
      email: 'customer2@example.com',
      firstName: 'Customer',
      customerId: 'CUST-1b602857-2d5b-4ba6-8424-1d6d0b8d8385'
    }

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:939:13)

  console.log
    [sendCustomerWelcomeEmail] Affiliate: {
      affiliateId: 'AFF-ee5d5a9d-9534-425a-a1d0-7553ab53383f',
      businessName: undefined
    }

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:944:13)

  console.log
    Language-specific template not found for en/customer-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: customer2@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: customer2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Service

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Service</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #ffffff !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .service-box {
          border: 1px solid #e0e0e0;
          border-radius: 4px;
          padding: 15px;
          margin: 20px 0;
          background-color: #f9f9f9;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .steps {
          padding: 0;
        }
        .step {
          display: flex;
          margin-bottom: 15px;
          align-items: flex-start;
        }
        .step-number {
          background-color: #1e3a8a;
          color: #ffffff !important;
          width: 25px;
          height: 25px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          margin-right: 10px;
          flex-shrink: 0;
        }
        .step-content {
          flex: 1;
        }
        .divider {
          height: 1px;
          background-color: #e0e0e0;
          margin: 20px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to WaveMAX Laundry!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Customer,</h2>
            <p>Welcome to WaveMAX Laundry Service! Your account has been successfully created and you're ready to enjoy premium wash, dry, fold laundry services.</p>
          </div>
          
          <div class="highlight">
            <h3>Your Account Information</h3>
            <p><strong>Customer ID:</strong> CUST-1b602857-2d5b-4ba6-8424-1d6d0b8d8385</p>
            <p><strong>Your Service Provider:</strong> Test Affiliate</p>
          </div>
          
          <div class="service-box" style="background-color: #f0f7ff; border: 1px solid #3b82f6;">
            <h3>How Our Service Works</h3>
            <p>Schedule your laundry pickup online. After we pick up and weigh your laundry, you'll receive an invoice. Pay conveniently via Venmo, PayPal, or CashApp.</p>
            
            <div style="background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 6px; padding: 15px; margin: 15px 0;">
              <h4 style="margin-top: 0; color: #1e3a8a;">Account Credit Details</h4>
              <table style="width: 100%; border-collapse: collapse;">
                <tr>
                  <td style="padding: 5px 0;">Bags Purchased</td>
                  <td style="text-align: right; font-weight: bold;">0</td>
                </tr>
                <tr>
                  <td style="padding: 5px 0;">Cost per Bag</td>
                  <td style="text-align: right;">$0.00</td>
                </tr>
                <tr style="border-top: 2px solid #e0e0e0;">
                  <td style="padding: 8px 0; font-weight: bold; color: #1e3a8a;">Total Account Credit</td>
                  <td style="text-align: right; font-weight: bold; color: #1e3a8a; font-size: 18px;">$0.00</td>
                </tr>
              </table>
            </div>
            
            <p style="font-size: 14px; color: #666; margin-top: 10px;">
              <strong>Note:</strong> No upfront payment required. You'll pay after your laundry is picked up and weighed.
            </p>
          </div>
          
          <div class="service-box">
            <h3>How It Works</h3>
            <div class="steps">
              <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                  <strong>Schedule a Pickup</strong>
                  <p>Login to your dashboard and schedule a convenient pickup time.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                  <strong>Prepare Your Laundry</strong>
                  <p>Place your laundry in the provided bags. Your service provider will pick them up.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                  <strong>We Do the Rest</strong>
                  <p>Your laundry is professionally washed, dried, and folded at our facility.</p>
                </div>
              </div>
              <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                  <strong>Delivery to Your Door</strong>
                  <p>Your clean, fresh laundry is delivered back to you, usually within 24-48 hours.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="divider"></div>
          
          <div class="section">
            <h3>Ready to Schedule Your First Pickup?</h3>
            <p>Click the button below to access your dashboard and schedule your first pickup.</p>
            <div style="text-align: center; margin: 20px 0;">
              <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule Pickup</a>
            </div>
            <p style="text-align: center; color: #1e3a8a; font-style: italic;">Remember: Your account has been credited for your prepaid bags!</p>
          </div>
          
          <div class="section">
            <h3>Questions?</h3>
            <p>Your service provider is here to help! Feel free to reach out:</p>
            <p><strong>Name:</strong> Test Affiliate<br>
            <strong>Phone:</strong> +1234567890<br>
            <strong>Email:</strong> testaffiliate2@example.com</p>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Access your customer dashboard anytime to manage orders and track deliveries.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="background-color: #3b82f6;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team.</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Customer welcome email sent successfully to: customer2@example.com

      at Object.log [as sendCustomerWelcomeEmail] (server/utils/emailService.js:1197:13)

  console.log
    [sendAffiliateNewCustomerEmail] Affiliate: {
      email: 'testaffiliate2@example.com',
      affiliateId: 'AFF-ee5d5a9d-9534-425a-a1d0-7553ab53383f',
      businessName: undefined
    }

      at Object.log [as sendAffiliateNewCustomerEmail] (server/utils/emailService.js:361:13)

  console.log
    [sendAffiliateNewCustomerEmail] Customer: {
      email: 'customer2@example.com',
      firstName: 'Customer',
      customerId: 'CUST-1b602857-2d5b-4ba6-8424-1d6d0b8d8385'
    }

      at Object.log [as sendAffiliateNewCustomerEmail] (server/utils/emailService.js:366:13)

  console.log
    Language-specific template not found for en/affiliate-new-customer, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: testaffiliate2@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: testaffiliate2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Customer Registration

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Customer Registration</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f4f4f4;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background-color: #1e3a8a;
                color: #ffffff;
                padding: 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 28px;
            }
            .content {
                padding: 40px 30px;
            }
            .content h2 {
                color: #1e3a8a;
                font-size: 24px;
                margin-bottom: 20px;
            }
            .info-box {
                background-color: #f0f7ff;
                border-left: 4px solid #3b82f6;
                padding: 20px;
                margin: 20px 0;
            }
            .customer-details {
                background-color: #f9f9f9;
                padding: 20px;
                border-radius: 8px;
                margin: 20px 0;
            }
            .customer-details h3 {
                color: #1e3a8a;
                margin-top: 0;
            }
            .detail-row {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid #e0e0e0;
            }
            .detail-row:last-child {
                border-bottom: none;
            }
            .detail-label {
                font-weight: bold;
                color: #555;
            }
            .button {
                display: inline-block;
                background-color: #ffffff !important;
                color: #ffffff !important;
                padding: 12px 30px;
                text-decoration: none !important;
                border-radius: 6px;
                font-weight: bold;
                margin: 20px 0;
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .footer {
                background-color: #f8f9fa;
                padding: 20px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #3b82f6;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Customer Registration!</h1>
            </div>
            
            <div class="content">
                <h2>Congratulations, Test Affiliate!</h2>
                
                <p>Great news! A new customer has just registered through your affiliate link.</p>
                
                <div class="info-box">
                    <strong>Action Required:</strong> Please deliver 1 laundry bag(s) to your new customer within 48 hours.
                    <br><small>Note: This customer received their first bag FREE as part of our promotional offer.</small>
                </div>
                
                <div class="customer-details">
                    <h3>Customer Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Customer ID:</span>
                        <span>CUST-1b602857-2d5b-4ba6-8424-1d6d0b8d8385</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span>
                        <span>Customer Test</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span>
                        <span>customer2@example.com</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span>
                        <span>(123) 456-7890</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span>
                        <span>456 Customer St, Austin, TX 78701</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Service Frequency:</span>
                        <span>weekly</span>
                    </div>
                </div>
                
                <h3>Next Steps:</h3>
                <ol><li>Contact the customer to arrange bag delivery</li><li>Deliver <strong>1</strong> laundry bag(s) they purchased during registration</li><li>Explain the pickup and delivery process</li><li>Schedule their first pickup if requested</li><li>Remind them that bag fees will be credited on their first order</li></ol>
                
                <center>
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate&customer=CUST-1b602857-2d5b-4ba6-8424-1d6d0b8d8385" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Customer in Dashboard</a>
                </center>
                
                <p>Remember: Providing excellent service from the start helps ensure customer retention and positive reviews!</p>
            </div>
            
            <div class="footer">
                <p>This email was sent by WaveMAX Laundry Affiliate Program</p>
                <p>Questions? Contact us at <a href="mailto:support@wavemax.promo">support@wavemax.promo</a></p>
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/customers/register [32m201[0m 204.538 ms - 400[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:26.714Z"}
  console.log
    CSRF token generation: {
      sessionID: '28311c286172efeac9713292272ba5cc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: qga1Ql3T-QUGR1IxtKuCIis2MOPrctJEFFug

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 28311c286172efeac9713292272ba5cc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: BhFygEIdyt...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.801 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:26.801Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:26.948Z","userType":"administrator","username":"setup@example.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:26.949Z","userId":"68f1a736eaa9c28ea6c4cc3f","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 148.190 ms - 656[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:26.952Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: '28311c286172efeac9713292272ba5cc',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A28311c286172efeac9713292272ba5cc.dHK7I6he8avxrRYCgeFYv0SzONv5I7zgTC0UwIwIGaQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/administrators [33m400[0m 58.057 ms - 207[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:27.989Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd79b1844f457c1182519d10573dd2283',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: aAR9CxZz-fZXwwdXe2Bvc0Us1xir6eqoC3h0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d79b1844f457c1182519d10573dd2283

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: inlHKQXxJi...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.879 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:28.082Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:28.223Z","userType":"administrator","username":"setup@example.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:28.223Z","userId":"68f1a738eaa9c28ea6c4cc6c","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.462 ms - 656[0m
[34mdebug[39m: POST /api/v1/administrators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:28.226Z"}
  console.log
    CSRF check for: /api/v1/administrators {
      sessionID: 'd79b1844f457c1182519d10573dd2283',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad79b1844f457c1182519d10573dd2283.TUVVctHcQw9NiRF%2B3MkEajorsx9x4RHrnnwDEnoEucE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"CREATE_ADMINISTRATOR","details":{"adminId":"ADM002","email":"newuser@example.com"},"eventType":"ACCOUNT_CREATED","ip":"::ffff:127.0.0.1","method":"POST","path":"/","targetId":"68f1a738eaa9c28ea6c4cc76","targetType":"administrator","timestamp":"2025-10-17T02:17:28.420Z","userId":"68f1a738eaa9c28ea6c4cc6c","userRole":"administrator","userType":"administrator"}
[0mPOST /api/v1/administrators [32m201[0m 194.611 ms - 341[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:29.400Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c85df07b30b7d65ef6e92e5a4c2c19bc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: hjWj8BVY-pi0ZC1mpBvr5kRx-5F8kAx5HvDA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c85df07b30b7d65ef6e92e5a4c2c19bc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lY3nh2blz9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.265 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:29.488Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:29.632Z","userType":"administrator","username":"opsetup@example.com"}
info: undefined {"adminId":"ADMIN002","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:29.633Z","userId":"68f1a739eaa9c28ea6c4cc9d","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.149 ms - 646[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:29.635Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: 'c85df07b30b7d65ef6e92e5a4c2c19bc',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac85df07b30b7d65ef6e92e5a4c2c19bc.LAPuYPkJ6p2shPBv6COr7ngKs4Onm%2BNlrjju1s0pIIo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 57.258 ms - 207[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:30.658Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ffff54799820693e3006b8c0f8f48e93',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1OmZqNG7-GFXlAfj7PN1xC05qjImAu4RpJsM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ffff54799820693e3006b8c0f8f48e93

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: wE-ZHctXrd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.256 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:30.754Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:30.904Z","userType":"administrator","username":"opsetup@example.com"}
info: undefined {"adminId":"ADMIN002","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:30.904Z","userId":"68f1a73aeaa9c28ea6c4ccca","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 150.733 ms - 646[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:30.907Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: 'ffff54799820693e3006b8c0f8f48e93',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Affff54799820693e3006b8c0f8f48e93.wc%2FlYStOzovsH0i06GJ8nBrqDdwbswLr%2FVxcTJVxQzY',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/operator-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: newoperator@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: newoperator@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Operations Team

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Welcome to WaveMAX Operations Team</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                padding: 40px 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 32px;
                font-weight: 700;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .header p {
                margin: 10px 0 0;
                font-size: 18px;
                opacity: 0.9;
            }
            .content {
                padding: 40px 30px;
            }
            .greeting {
                font-size: 20px;
                color: #27ae60;
                margin-bottom: 20px;
                font-weight: 600;
            }
            .credentials-box {
                background-color: #e8f8f5;
                border: 2px solid #2ecc71;
                border-radius: 8px;
                padding: 25px;
                margin: 30px 0;
                text-align: center;
            }
            .credentials-title {
                font-size: 18px;
                font-weight: 600;
                color: #27ae60;
                margin-bottom: 15px;
            }
            .credential-item {
                margin: 15px 0;
                font-size: 16px;
            }
            .credential-label {
                font-weight: 600;
                color: #333;
            }
            .credential-value {
                display: block;
                font-size: 24px;
                color: #2c3e50;
                font-weight: 700;
                margin-top: 5px;
                letter-spacing: 2px;
            }
            .pin-highlight {
                background-color: #f1c40f;
                padding: 5px 15px;
                border-radius: 6px;
                display: inline-block;
            }
            .info-grid {
                display: table;
                width: 100%;
                margin: 20px 0;
            }
            .info-row {
                display: table-row;
            }
            .info-label {
                display: table-cell;
                padding: 10px 15px;
                font-weight: 600;
                color: #27ae60;
                width: 40%;
                vertical-align: top;
            }
            .info-value {
                display: table-cell;
                padding: 10px 15px;
                color: #333;
            }
            .button-container {
                text-align: center;
                margin: 40px 0;
            }
            .button {
                display: inline-block;
                padding: 16px 40px;
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                text-decoration: none !important;
                border-radius: 8px;
                font-size: 18px;
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .important-notes {
                background-color: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
            }
            .important-notes h3 {
                color: #856404;
                margin-bottom: 10px;
            }
            .important-notes ul {
                margin: 10px 0;
                padding-left: 20px;
            }
            .important-notes li {
                margin: 5px 0;
                color: #856404;
            }
            .footer {
                background-color: #f8f9fa;
                padding: 30px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #2ecc71;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Welcome to WaveMAX Operations</h1>
                <p>Your Operator Account is Ready</p>
            </div>
            
            <div class="content">
                <div class="greeting">
                    Welcome aboard, Worker!
                </div>
                
                <p>We're excited to have you join the WaveMAX operations team. Your operator account has been created and you're ready to start processing orders.</p>
                
                <div class="credentials-box">
                    <div class="credentials-title">Your Login Credentials</div>
                    <div class="credential-item">
                        <span class="credential-label">Employee ID:</span>
                        <span class="credential-value">OPRMGU7XVUL213BF4</span>
                    </div>
                    <div class="credential-item">
                        <span class="credential-label">Temporary PIN:</span>
                        <span class="credential-value pin-highlight">SecureM@ster7!9K</span>
                    </div>
                </div>
                
                <div class="info-grid">
                    <div class="info-row">
                        <div class="info-label">Email:</div>
                        <div class="info-value">newoperator@example.com</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Shift Hours:</div>
                        <div class="info-value">Not specified</div>
                    </div>
                </div>
                
                <div class="button-container">
                    <a href="https://wavemax.promo/embed-app-v2.html?login=operator" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to Operator Portal</a>
                </div>
                
                <div class="important-notes">
                    <h3>Important Information:</h3>
                    <ul><li>Change your PIN on first login</li><li>You can only login during your assigned shift hours</li><li>Keep your PIN confidential - never share it with anyone</li><li>Clock in at the start of your shift and clock out when finished</li><li>Contact your supervisor if you have any questions</li></ul>
                </div>
                
                <p>If you need assistance or have questions about your account, please contact your supervisor or the administrator.</p>
            </div>
            
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This email contains confidential login information. Please keep it secure.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

info: undefined {"action":"CREATE_OPERATOR","details":{"email":"newoperator@example.com","operatorId":"OPRMGU7XVUL213BF4"},"ip":"::ffff:127.0.0.1","method":"POST","path":"/","targetId":"68f1a73beaa9c28ea6c4ccd3","targetType":"operator","timestamp":"2025-10-17T02:17:31.093Z","userId":"68f1a73aeaa9c28ea6c4ccca","userRole":"administrator","userType":"administrator"}
[0mPOST /api/v1/operators [32m201[0m 186.858 ms - 416[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:32.062Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a960b8ee9eb3af1cc7756a5e6666a890',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: G4OHffgY-43XmBwV2bNzn8dQtTPmG260L4R4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a960b8ee9eb3af1cc7756a5e6666a890

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: TJce8wGCiW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.145 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/reset-password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:32.189Z"}
[0mPOST /api/v1/auth/reset-password [33m400[0m 1.551 ms - 104[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:33.155Z"}
  console.log
    CSRF token generation: {
      sessionID: '1067c8cfec92fd4e3caafaa05dd7f734',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: qsAXcGOQ-JCoe15vK2lTcAfoGpsFoMHsX-tY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1067c8cfec92fd4e3caafaa05dd7f734

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: StE6M5Kl8a...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.063 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/reset-password {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:33.286Z"}
[0mPOST /api/v1/auth/reset-password [32m200[0m 107.966 ms - 65[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:34.374Z"}
  console.log
    CSRF token generation: {
      sessionID: '94b04bd0e27f7a001bab83da8bb0c373',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MXtSqyhy-z6ZwoV6nofUNADRycpdBPy2vVyE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 94b04bd0e27f7a001bab83da8bb0c373

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: opFOvU7nAo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.338 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:34.477Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:34.626Z","userType":"affiliate","username":"logintest"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 149.023 ms - 630[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:35.589Z"}
  console.log
    CSRF token generation: {
      sessionID: '7d1cbf2442d674a02f7b33221d737fbc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 17gf9oHT-n0I0NO-pMIDkcv7DrHDSYMGDN4E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7d1cbf2442d674a02f7b33221d737fbc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: EXV9-v0_vy...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.134 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:35.596Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.830 ms - 643[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:36.566Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e1ff8b913d87889875b28020354b0685',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jABGYPgR-Rk7Blrix3Y5uLT6gNc-V4UZnjWs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e1ff8b913d87889875b28020354b0685

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VotBv9pjA5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.118 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:36.582Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.495 ms - 664[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:37.541Z"}
  console.log
    CSRF token generation: {
      sessionID: '54a0f87b2b45646879fbbd17ba2e7cac',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kGIo8lQE-C_D7q3d3zuIe9qos0lCrBaDgK9g

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 54a0f87b2b45646879fbbd17ba2e7cac

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1Ws01i6wme...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.299 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:37.582Z"}
  console.log
    [sendEmail] Sending email to: mixed@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: mixed@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Laundry Affiliate Program

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Welcome to WaveMAX Laundry Affiliate Program</title>
      <style>
        body {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          color: #333333;
          margin: 0;
          padding: 0;
        }
        .container {
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          background-color: #1e3a8a;
          color: #ffffff !important;
          padding: 20px;
          text-align: center;
        }
        .logo {
          max-width: 180px;
          margin-bottom: 10px;
        }
        .content {
          padding: 20px;
          background-color: #ffffff;
        }
        .section {
          margin-bottom: 20px;
        }
        .button {
          display: inline-block;
          background-color: #1e3a8a !important;
          color: #ffffff !important;
          padding: 12px 20px;
          text-decoration: none !important;
          border-radius: 4px;
          font-weight: bold;
          text-align: center;
        }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        .footer {
          background-color: #f5f5f5;
          padding: 20px;
          text-align: center;
          font-size: 12px;
          color: #666666;
        }
        .stats {
          display: flex;
          justify-content: space-between;
          text-align: center;
          margin: 20px 0;
        }
        .stat {
          flex: 1;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 4px;
          margin: 0 5px;
        }
        .stat-value {
          font-size: 24px;
          font-weight: bold;
          color: #1e3a8a;
        }
        .stat-label {
          font-size: 12px;
          color: #666666;
        }
        .highlight {
          background-color: #f0f7ff;
          border-left: 4px solid #1e3a8a;
          padding: 15px;
          margin: 20px 0;
        }
        .important-notice {
          background-color: #fef3c7;
          border: 2px solid #f59e0b;
          border-radius: 4px;
          padding: 20px;
          margin: 20px 0;
        }
        .important-notice h3 {
          color: #d97706;
          margin-top: 0;
        }
        .important-notice ul {
          margin: 10px 0;
          padding-left: 20px;
        }
        .important-notice li {
          margin: 5px 0;
        }
        @media (max-width: 480px) {
          .container {
            padding: 10px;
          }
          .content {
            padding: 15px;
          }
          .stats {
            flex-direction: column;
          }
          .stat {
            margin: 5px 0;
          }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <img src="https://www.wavemaxlaundry.com/assets/WaveMax/images/logo-wavemax.png" alt="WaveMAX Laundry" class="logo">
          <h1>Welcome to the Affiliate Program!</h1>
        </div>
        
        <div class="content">
          <div class="section">
            <h2>Hi Mixed,</h2>
            <p>Congratulations and welcome to the WaveMAX Laundry Affiliate Program! We're excited to have you join our network of affiliate partners.</p>
            <p>You're now ready to start offering premium wash, dry, fold laundry services to your customers, with pickup and delivery handled by you.</p>
          </div>
          
          <div class="important-notice">
            <h3>âš ï¸ IMPORTANT: W-9 Form Information</h3>
            <p><strong>Tax Documentation Process</strong></p>
            <p>To comply with IRS regulations:</p>
            <ul>
              <li>When your annual earnings exceed $600, you will receive a W-9 form via DocuSign</li>
              <li>Complete and sign the form electronically through DocuSign</li>
              <li>Please watch for the DocuSign email to avoid interruption in commission payouts</li>
              <li>Your prompt response ensures uninterrupted commission payments</li>
            </ul>
            <p>Note: The W-9 form will be automatically sent via DocuSign when you reach the $600 annual earnings threshold.</p>
            <p>For questions about the W-9 process, contact support@wavemax.com</p>
          </div>
          
          <div class="highlight">
            <h3>Your Affiliate Information</h3>
            <p><strong>Affiliate ID:</strong> AFF-bff4db0f-abb8-458e-8b4d-b6f8d2a0c055</p>
            <p><strong>Customer Landing Page:</strong> <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-bff4db0f-abb8-458e-8b4d-b6f8d2a0c055">https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?route=/affiliate-landing&code=AFF-bff4db0f-abb8-458e-8b4d-b6f8d2a0c055</a></p>
            <p>Share this professional landing page with potential customers to showcase your services and pricing.</p>
            <p><strong>Direct Registration URL:</strong> <a href="https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-bff4db0f-abb8-458e-8b4d-b6f8d2a0c055">https://wavemax.promo/embed-app-v2.html?route=/customer-login&affid=AFF-bff4db0f-abb8-458e-8b4d-b6f8d2a0c055</a></p>
            <p>Customers can also use this direct link to register. Each customer registered through your links will be associated with your account.</p>
          </div>
          
          <div class="section">
            <h3>Getting Started</h3>
            <ol>
              <li>Share your registration link with potential customers</li>
              <li>Receive laundry bags with unique barcodes for your customers</li>
              <li>Coordinate pickups and deliveries based on customer schedules</li>
              <li>Bring the laundry to our WaveMAX location for washing, drying, and folding</li>
              <li>Deliver clean laundry back to your customers</li>
              <li>Earn commissions on every order!</li>
            </ol>
          </div>
          
          <div class="stats">
            <div class="stat">
              <div class="stat-value">10%</div>
              <div class="stat-label">COMMISSION ON WDF</div>
            </div>
            <div class="stat">
              <div class="stat-value">100%</div>
              <div class="stat-label">OF DELIVERY FEES</div>
            </div>
            <div class="stat">
              <div class="stat-value">$0</div>
              <div class="stat-label">STARTUP COST</div>
            </div>
          </div>
          
          <div class="section" style="text-align: center;">
            <p>Login to your dashboard to manage your affiliate account, track orders, and view your earnings.</p>
            <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Go to Dashboard</a>
          </div>
        </div>
        
        <div class="footer">
          <p>If you have any questions, please contact our support team at support@wavemax.promo</p>
          <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
          <p>123 Main Street, Austin, TX 78701</p>
        </div>
      </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/affiliates/register [32m201[0m 165.861 ms - 120[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:38.708Z"}
  console.log
    CSRF token generation: {
      sessionID: '58f8be12e2bbe4f0c47e34e4ba223b1d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NOyOKezi-2iDXzMlMQx8oglgodapOS9CA7FE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 58f8be12e2bbe4f0c47e34e4ba223b1d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: g_L2xdC1n9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.957 ms - 67[0m
[34mdebug[39m: POST /api/v1/affiliates/register {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:38.716Z"}
[0mPOST /api/v1/affiliates/register [33m400[0m 1.550 ms - 510[0m
PASS tests/integration/passwordValidation.test.js (23.504 s)
  Password Validation Integration Tests
    Affiliate Registration Password Validation
      âœ“ should reject weak passwords during affiliate registration (1868 ms)
      âœ“ should accept strong passwords during affiliate registration (2038 ms)
      âœ“ should reject passwords containing username (975 ms)
      âœ“ should reject passwords containing email (971 ms)
      âœ“ should reject passwords with sequential characters (978 ms)
    Customer Registration Password Validation
      âœ“ should enforce strong passwords for customer registration (1131 ms)
      âœ“ should accept strong passwords for customer registration (1321 ms)
    Administrator Password Validation
      âœ“ should enforce strong passwords for administrator creation (1265 ms)
      âœ“ should accept strong passwords for administrator creation (1420 ms)
    Operator Password Validation
      âœ“ should enforce strong passwords for operator creation (1259 ms)
      âœ“ should accept strong passwords for operator creation (1405 ms)
    Password Reset Validation
      âœ“ should enforce strong passwords during password reset (1092 ms)
      âœ“ should accept strong passwords during password reset (1204 ms)
    Login with Updated Passwords
      âœ“ should successfully login with strong password (1228 ms)
      âœ“ should handle case-insensitive username/email validation during registration (972 ms)
    Password Strength Edge Cases
      âœ“ should reject passwords with only special characters at the end (979 ms)
      âœ“ should accept passwords with mixed character distribution (1165 ms)
      âœ“ should handle Unicode characters in passwords appropriately (981 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:40.750Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:41.675Z"}
  console.log
    CSRF token generation: {
      sessionID: '211a4e83e4f6d2f5f16e234aabf59417',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RsOQQ16y-jGXGdn8qQ_rtB5FnlwwLiwUJsv8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 211a4e83e4f6d2f5f16e234aabf59417

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: xRrIgpjeax...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.199 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:41.821Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:41.988Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:41.988Z","userId":"68f1a745569fae556c29f961","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 167.615 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:41.992Z"}
  console.log
    CSRF token generation: {
      sessionID: '7200b1e9fb788f02672c24e390775b95',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: zkOho7cw-4Y-3NanmjU7xU05ht3cJCAttS5o

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7200b1e9fb788f02672c24e390775b95

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1UznJx64Rp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.589 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:42.086Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:42.187Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:42.187Z","userId":"68f1a746569fae556c29f96f","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 101.830 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:42.192Z"}
  console.log
    CSRF token generation: {
      sessionID: '64fdc6411ff2adb9244926e91de1719c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tf1K26dO-MxBSADaOHPIUbSfzxRV_A6A-oM0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 64fdc6411ff2adb9244926e91de1719c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: iZwfrlUJkU...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.967 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:42.352Z"}
[0mGET /api/v1/operators [32m200[0m 165.460 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:43.569Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f144d6f07b22ab3092f3062ed3d3c35f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: bptTsrzx-g95pp3A7QuNFAY9f2S0GY6DiN8I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f144d6f07b22ab3092f3062ed3d3c35f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: iUbM5VVKKz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.936 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:43.664Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:43.810Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:43.811Z","userId":"68f1a747569fae556c29f9b2","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.170 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:43.814Z"}
  console.log
    CSRF token generation: {
      sessionID: '48905e4e3e6aa361627b1f2c71603dec',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: f6hIHzRC-uWfLVwlePLOpG-38Q3xEtIrh4KU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 48905e4e3e6aa361627b1f2c71603dec

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: CfeDGnhKk2...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.392 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:43.902Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:44.045Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:44.046Z","userId":"68f1a747569fae556c29f9b8","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 143.953 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:44.050Z"}
  console.log
    CSRF token generation: {
      sessionID: '09d785da54aafd60d34d443480fdecf4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0lVzVuIs-Lmz-Q_RVf9XzLKKq7thCl_mII8g

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 09d785da54aafd60d34d443480fdecf4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NPcT3BLUYv...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.129 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators?active=true {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:44.143Z"}
[0mGET /api/v1/operators?active=true [32m200[0m 138.933 ms - 724[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:45.218Z"}
  console.log
    CSRF token generation: {
      sessionID: '9b4a97eab0aff16db5066b0b7d002b44',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TznwL013-kkSBy_p4p_e6hdjP7pyG0eHirgw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9b4a97eab0aff16db5066b0b7d002b44

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lyMKnx920t...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.259 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:45.318Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:45.456Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:45.457Z","userId":"68f1a749569fae556c29f9e8","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 138.970 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:45.459Z"}
  console.log
    CSRF token generation: {
      sessionID: '50eb31ea5b676c5b9c10ff008363e771',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vAwXmm2K-F54fQeV8RIFMgWHaJ5F1iFelZqs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 50eb31ea5b676c5b9c10ff008363e771

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: A4l4b84Z9e...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.314 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:45.549Z"}
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:682:30)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:1657:35)","timestamp":"2025-10-17T02:17:45.559Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:45.641Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:45.642Z","userId":"68f1a749569fae556c29f9ee","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.174 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:45.645Z"}
  console.log
    CSRF token generation: {
      sessionID: '0342f6ff1dcc2fb940957681f226aabb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: isFIJdh5-kixY6NDaJbfLv6KyoP2a1KucCDU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0342f6ff1dcc2fb940957681f226aabb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: mIDNgp9fW8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.366 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators?onShift=true {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:45.746Z"}
[0mGET /api/v1/operators?onShift=true [32m200[0m 109.892 ms - 724[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:46.793Z"}
  console.log
    CSRF token generation: {
      sessionID: '1fa286327ea60eab28759afd9a98de0f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: WVc2POaE-8v5G6npnfZ0ZHfkC7JGJ5c9xbxo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1fa286327ea60eab28759afd9a98de0f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KRHLe7FPRp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.778 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:46.882Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:47.022Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:47.022Z","userId":"68f1a74a569fae556c29fa1d","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 140.131 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:47.032Z"}
  console.log
    CSRF token generation: {
      sessionID: '8ea5463db6e6f295e0fcc54755dca635',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: cC0k3F59-vyd8oJU0L3jTRttPOfJkFv7DX74

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8ea5463db6e6f295e0fcc54755dca635

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tkIuD2RcR6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.492 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:47.122Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:47.213Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:47.214Z","userId":"68f1a74b569fae556c29fa23","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 91.911 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:47.216Z"}
  console.log
    CSRF token generation: {
      sessionID: '17e862bc1fe2d98551e73498b54d7bca',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 7fRzEFTX-lKWkIX5RuoBxTtaPqj6oERpNR54

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 17e862bc1fe2d98551e73498b54d7bca

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 7SAyPXEeE_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.892 ms - 67[0m
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:682:30)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:1657:35)","timestamp":"2025-10-17T02:17:47.242Z"}
[34mdebug[39m: GET /api/v1/operators?page=2&limit=5 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:48.063Z"}
[0mGET /api/v1/operators?page=2&limit=5 [32m200[0m 137.621 ms - -[0m
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:682:30)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:1657:35)","timestamp":"2025-10-17T02:17:48.923Z"}
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:49.153Z"}
  console.log
    CSRF token generation: {
      sessionID: '1cdf5bc0f3546c36fa2908dfe48d85e1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Rj5GC4zV-2DWoAqioEox2PyZJRUM9-bOo-1I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1cdf5bc0f3546c36fa2908dfe48d85e1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: nLA0Dxwxl4...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.743 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:49.239Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:49.383Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:49.383Z","userId":"68f1a74d569fae556c29fa70","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.809 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:49.385Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b71f414c8fe7a7d9fb53718e94255c7b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: c4wP1dKs-hCbg7O147buFS1Ibt1sSNw7S4o0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b71f414c8fe7a7d9fb53718e94255c7b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ufbGGhzu9_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.003 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:49.474Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:49.566Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:49.567Z","userId":"68f1a74d569fae556c29fa76","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.629 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:49.570Z"}
  console.log
    CSRF token generation: {
      sessionID: '04959c2e14f8e7407c0933d5917f4b5d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: nlDTfz7t-fN5lXBCTcABSzOGQVDsvpoLerMs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 04959c2e14f8e7407c0933d5917f4b5d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lUntLKu2oZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.157 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:49.577Z"}
[0mGET /api/v1/operators [33m401[0m 1.035 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:50.497Z"}
  console.log
    CSRF token generation: {
      sessionID: '81fa85cfd63b2472a89675a22264cd5b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: zro7BZwf-JZ4mco-JPsJIKb6Lgx5Lhkg9GtQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 81fa85cfd63b2472a89675a22264cd5b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dIwy1BG3Di...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.344 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:50.581Z"}
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:682:30)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:1657:35)","timestamp":"2025-10-17T02:17:50.604Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:50.733Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:50.733Z","userId":"68f1a74e569fae556c29fa9f","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.883 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:50.736Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a94ebdbb6fa16bca315e9d30d24a9484',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0P3tvTuy-F5bHxNZV0vhRFY1GOI8nqdzFR24

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a94ebdbb6fa16bca315e9d30d24a9484

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: J_VdTJMgx6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.388 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:50.822Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:50.923Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:50.924Z","userId":"68f1a74e569fae556c29faa5","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 101.821 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:50.926Z"}
  console.log
    CSRF token generation: {
      sessionID: '67a5310524c6f1e782cdc5cf6076dd38',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: pLRAcBmD-icAqP7eJfch2f03C22xQ8evJsh8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 67a5310524c6f1e782cdc5cf6076dd38

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: EdWapiEalv...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.127 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:51.013Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:51.152Z","userType":"administrator","username":"limited@wavemax.com"}
info: undefined {"adminId":"LIMITED001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:51.153Z","userId":"68f1a74e569fae556c29faab","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 139.646 ms - 649[0m
[34mdebug[39m: GET /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:51.155Z"}
[0mGET /api/v1/operators [33m403[0m 54.482 ms - 79[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:52.161Z"}
  console.log
    CSRF token generation: {
      sessionID: '701da6de1040fe0189b27f8e946bc06d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jGU4Y7Ix-uv8792Of8agZIH88dq_17luevps

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 701da6de1040fe0189b27f8e946bc06d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KpnxgWFKLF...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.001 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:52.247Z"}
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:682:30)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:1657:35)","timestamp":"2025-10-17T02:17:52.340Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:52.387Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:52.388Z","userId":"68f1a750569fae556c29fad6","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.382 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:52.391Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ebc2ae672d1b8b07c5f42d280f4723d3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9q2KkHUD-vCfNTjObrXNqoTirnuZWHS8Sj8M

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ebc2ae672d1b8b07c5f42d280f4723d3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: OYLf3AnRcd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.878 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:52.479Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:52.569Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:52.570Z","userId":"68f1a750569fae556c29fadc","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 90.623 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:52.572Z"}
  console.log
    CSRF token generation: {
      sessionID: '170da6d3a59a62cf7a26da55f991626d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NL3WqVYt-vxsmSadodamL0ID3jps7PBdVwcE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 170da6d3a59a62cf7a26da55f991626d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KbFXNUMPAj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.388 ms - 67[0m
[34mdebug[39m: GET /api/v1/administrators/operators/68f1a750569fae556c29fae2 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:52.663Z"}
[0mGET /api/v1/administrators/operators/68f1a750569fae556c29fae2 [32m200[0m 112.176 ms - 761[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:53.707Z"}
  console.log
    CSRF token generation: {
      sessionID: '09efa46daae2a2c89635b7e78d95cf0c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: a98IqQqG-cBpa81XH6nlw89KrrEO_hmVpEUA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 09efa46daae2a2c89635b7e78d95cf0c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2uO-OtjHe1...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.807 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:53.807Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:53.950Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:53.951Z","userId":"68f1a751569fae556c29fb0b","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.715 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:53.953Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f6f9c08295ee2faeaf95da0f3da5c119',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0r4YNONT-DZNUmsBdn03MLxuzhKzORTvOzic

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f6f9c08295ee2faeaf95da0f3da5c119

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KHRKT7LKTv...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.921 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:54.045Z"}
[31merror[39m: Error in callback pool cleanup job: Client must be connected before running operations {"errorLabelSet":{},"service":"wavemax-affiliate","stack":"MongoNotConnectedError: Client must be connected before running operations\n    at autoConnect (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:135:13)\n    at executeOperation (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/operations/execute_operation.ts:69:25)\n    at Collection.updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongodb/src/collection.ts:420:34)\n    at NativeCollection.<computed> [as updateMany] (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:246:33)\n    at model.Query._updateThunk (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4065:37)\n    at model.Query._updateMany (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4114:23)\n    at model.Query.exec (/var/www/wavemax/wavemax-affiliate-program/node_modules/mongoose/lib/query.js:4604:80)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.Object.<anonymous>.callbackPoolSchema.statics.releaseExpiredLocks (/var/www/wavemax/wavemax-affiliate-program/server/models/CallbackPool.js:682:30)\n    at Timeout._onTimeout (/var/www/wavemax/wavemax-affiliate-program/server/services/callbackPoolManager.js:1657:35)","timestamp":"2025-10-17T02:17:54.096Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:54.137Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:54.138Z","userId":"68f1a751569fae556c29fb11","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.426 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:54.140Z"}
  console.log
    CSRF token generation: {
      sessionID: '2d059579d55e4f85fae373a1b53a6f70',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: aVvgFbVS-wCtDxva82auuAxVBl0Ac3LOAdYA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2d059579d55e4f85fae373a1b53a6f70

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: woQ9O4Vpan...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.614 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/68f1a751569fae556c29fb11 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:54.147Z"}
[0mGET /api/v1/operators/68f1a751569fae556c29fb11 [32m200[0m 81.707 ms - 201[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:55.165Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dcae1be75c74ea7abb5d9123dca0d81c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 12FVig2M-TwBBwleMwhVcktFaCBqzotCTEz0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dcae1be75c74ea7abb5d9123dca0d81c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: zxwPNdhwGL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.289 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:55.254Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:55.398Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:55.398Z","userId":"68f1a753569fae556c29fb3d","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 144.230 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:55.401Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e02e53aca1a8410d197ff20ffb61a742',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RwdCwYG3-chYjgGwq2hNHAtXPsm--OWqzbZY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e02e53aca1a8410d197ff20ffb61a742

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: UvwS_gWEJi...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.347 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:55.490Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:55.584Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:55.584Z","userId":"68f1a753569fae556c29fb43","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 94.292 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:55.587Z"}
  console.log
    CSRF token generation: {
      sessionID: '2f99cc9d5965d6c22e996b739583a27f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Ugnxq1Pd-__vH9AhKck7BQmStY3Cl6htjj34

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2f99cc9d5965d6c22e996b739583a27f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: zwcNa6tX3_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.519 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/68f1a753569fae556c29fb49 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:55.679Z"}
[0mGET /api/v1/operators/68f1a753569fae556c29fb49 [33m403[0m 55.082 ms - 68[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:56.669Z"}
  console.log
    CSRF token generation: {
      sessionID: '374a35def649e2913e477e797b520d58',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xlpuKM8U-duTs30e2D9_rTmRIdZAFOqKSlJY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 374a35def649e2913e477e797b520d58

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VSR_nI2FbD...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.379 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:56.760Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:56.906Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:56.906Z","userId":"68f1a754569fae556c29fb70","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 146.362 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:56.909Z"}
  console.log
    CSRF token generation: {
      sessionID: '1a6415c68147426728d63eb3f28732a3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FR04RqQu-SEwkNQWH7RYr-T1biJN8pCaMSPQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1a6415c68147426728d63eb3f28732a3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: HPpoJFysy4...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.314 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:57.002Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:57.095Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:57.096Z","userId":"68f1a754569fae556c29fb76","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.740 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:57.098Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fb67177ecc3a7c8c74fbd176eaedd967',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mIVxrCki-8dAwD12GSjOj4-MyuFcXoKW_gZQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fb67177ecc3a7c8c74fbd176eaedd967

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: fjr8cDFAjD...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.636 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/68f1a755569fae556c29fb7c {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:57.105Z"}
[0mGET /api/v1/operators/68f1a755569fae556c29fb7c [33m404[0m 109.252 ms - 48[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:58.147Z"}
  console.log
    CSRF token generation: {
      sessionID: '47981c911b80df3c37b547da2e588eb7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: C7j0rFPn-R1Wb2xQ4MKV-3JNJSMBANPdkSec

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 47981c911b80df3c37b547da2e588eb7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Euy3bLN1O0...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.571 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:58.247Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:58.396Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:58.396Z","userId":"68f1a756569fae556c29fba4","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.218 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:58.400Z"}
  console.log
    CSRF token generation: {
      sessionID: '5e77db64761a1127549f21ee3d27e846',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tYhQphxM-DPFlcmIFyylznsfqCyKjXDp9yJM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5e77db64761a1127549f21ee3d27e846

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: X4UJM56aG8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.378 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:58.510Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:58.604Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:17:58.604Z","userId":"68f1a756569fae556c29fbaa","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.592 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:58.607Z"}
  console.log
    CSRF token generation: {
      sessionID: '57bd1db783886014b82905c0a1883ed1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: s6uxU9Ga-TtLKSENX8G8wh_M1VBvNeOLixm0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 57bd1db783886014b82905c0a1883ed1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: n__6J4h1PK...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.996 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:58.614Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '5e77db64761a1127549f21ee3d27e846',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A5e77db64761a1127549f21ee3d27e846.nr8C5QV2gt3nWpVADA2eVpGM7bLeeB1czdNKyOxXcUM',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/operator-welcome, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: newop@wavemax.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: newop@wavemax.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Welcome to WaveMAX Operations Team

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Welcome to WaveMAX Operations Team</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                line-height: 1.6;
                color: #333;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 600px;
                margin: 20px auto;
                background-color: #ffffff;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
            .header {
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                padding: 40px 30px;
                text-align: center;
            }
            .header h1 {
                margin: 0;
                font-size: 32px;
                font-weight: 700;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .header p {
                margin: 10px 0 0;
                font-size: 18px;
                opacity: 0.9;
            }
            .content {
                padding: 40px 30px;
            }
            .greeting {
                font-size: 20px;
                color: #27ae60;
                margin-bottom: 20px;
                font-weight: 600;
            }
            .credentials-box {
                background-color: #e8f8f5;
                border: 2px solid #2ecc71;
                border-radius: 8px;
                padding: 25px;
                margin: 30px 0;
                text-align: center;
            }
            .credentials-title {
                font-size: 18px;
                font-weight: 600;
                color: #27ae60;
                margin-bottom: 15px;
            }
            .credential-item {
                margin: 15px 0;
                font-size: 16px;
            }
            .credential-label {
                font-weight: 600;
                color: #333;
            }
            .credential-value {
                display: block;
                font-size: 24px;
                color: #2c3e50;
                font-weight: 700;
                margin-top: 5px;
                letter-spacing: 2px;
            }
            .pin-highlight {
                background-color: #f1c40f;
                padding: 5px 15px;
                border-radius: 6px;
                display: inline-block;
            }
            .info-grid {
                display: table;
                width: 100%;
                margin: 20px 0;
            }
            .info-row {
                display: table-row;
            }
            .info-label {
                display: table-cell;
                padding: 10px 15px;
                font-weight: 600;
                color: #27ae60;
                width: 40%;
                vertical-align: top;
            }
            .info-value {
                display: table-cell;
                padding: 10px 15px;
                color: #333;
            }
            .button-container {
                text-align: center;
                margin: 40px 0;
            }
            .button {
                display: inline-block;
                padding: 16px 40px;
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #ffffff !important;
                text-decoration: none !important;
                border-radius: 8px;
                font-size: 18px;
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            }
        a.button {
          color: #ffffff !important;
          text-decoration: none !important;
        }
        a.button:link,
        a.button:visited,
        a.button:hover,
        a.button:active {
          color: #ffffff !important;
          text-decoration: none !important;
        }
            .important-notes {
                background-color: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
            }
            .important-notes h3 {
                color: #856404;
                margin-bottom: 10px;
            }
            .important-notes ul {
                margin: 10px 0;
                padding-left: 20px;
            }
            .important-notes li {
                margin: 5px 0;
                color: #856404;
            }
            .footer {
                background-color: #f8f9fa;
                padding: 30px;
                text-align: center;
                color: #666;
                font-size: 14px;
            }
            .footer a {
                color: #2ecc71;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Welcome to WaveMAX Operations</h1>
                <p>Your Operator Account is Ready</p>
            </div>
            
            <div class="content">
                <div class="greeting">
                    Welcome aboard, New!
                </div>
                
                <p>We're excited to have you join the WaveMAX operations team. Your operator account has been created and you're ready to start processing orders.</p>
                
                <div class="credentials-box">
                    <div class="credentials-title">Your Login Credentials</div>
                    <div class="credential-item">
                        <span class="credential-label">Employee ID:</span>
                        <span class="credential-value">OPRMGU7YH7V616161</span>
                    </div>
                    <div class="credential-item">
                        <span class="credential-label">Temporary PIN:</span>
                        <span class="credential-value pin-highlight">NewPassw0rd!</span>
                    </div>
                </div>
                
                <div class="info-grid">
                    <div class="info-row">
                        <div class="info-label">Email:</div>
                        <div class="info-value">newop@wavemax.com</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">Shift Hours:</div>
                        <div class="info-value">00:00 - 23:59</div>
                    </div>
                </div>
                
                <div class="button-container">
                    <a href="https://wavemax.promo/embed-app-v2.html?login=operator" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to Operator Portal</a>
                </div>
                
                <div class="important-notes">
                    <h3>Important Information:</h3>
                    <ul><li>Change your PIN on first login</li><li>You can only login during your assigned shift hours</li><li>Keep your PIN confidential - never share it with anyone</li><li>Clock in at the start of your shift and clock out when finished</li><li>Contact your supervisor if you have any questions</li></ul>
                </div>
                
                <p>If you need assistance or have questions about your account, please contact your supervisor or the administrator.</p>
            </div>
            
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This email contains confidential login information. Please keep it secure.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

info: undefined {"action":"CREATE_OPERATOR","details":{"email":"newop@wavemax.com","operatorId":"OPRMGU7YH7V616161"},"ip":"::ffff:127.0.0.1","method":"POST","path":"/","targetId":"68f1a756569fae556c29fbb3","targetType":"operator","timestamp":"2025-10-17T02:17:58.785Z","userId":"68f1a756569fae556c29fba4","userRole":"administrator","userType":"administrator"}
[0mPOST /api/v1/operators [32m201[0m 171.433 ms - 449[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:59.756Z"}
  console.log
    CSRF token generation: {
      sessionID: '7c777d88eb0e4560a4afb1d7ed6eab24',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: VhW2QojM-1yobmJ_Sq2kRFLuiyKDNyPhqios

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7c777d88eb0e4560a4afb1d7ed6eab24

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 83nnCw7g5K...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.704 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:17:59.856Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:17:59.998Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:17:59.998Z","userId":"68f1a757569fae556c29fbd9","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.912 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:00.002Z"}
  console.log
    CSRF token generation: {
      sessionID: '81f67b4dd51ca73ff21665dc3768e5a3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: hDSpOfMx-m9vl7ydpmZX8_yfL9o1xYp_J30w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 81f67b4dd51ca73ff21665dc3768e5a3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: HoUJAUNpTN...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.866 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:00.100Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:00.194Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:00.194Z","userId":"68f1a758569fae556c29fbdf","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 94.052 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:00.197Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c87283cea037a6687d9b3f214f7f1504',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: m5EXb9CL-lYR3qB0CeOW1x7nWW_SKy6gIbhU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c87283cea037a6687d9b3f214f7f1504

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PoYZttvzm4...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.077 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:00.204Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '81f67b4dd51ca73ff21665dc3768e5a3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A81f67b4dd51ca73ff21665dc3768e5a3.khxx0ShVPAadP8RCRXuJjfJbBqUpYheRQYnXbWCGWck',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 56.681 ms - 309[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:01.195Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f51602860212d772e7f9f9571184d4fb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 2HW641qm-7X6m4hJzUfRZhuMbh1diTS6t1jk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f51602860212d772e7f9f9571184d4fb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KkLE3DhdtL...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.655 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:01.290Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:01.441Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:01.442Z","userId":"68f1a759569fae556c29fc0a","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 151.510 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:01.445Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c9821d17ef1e184cc1885c833980534c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: bnKaQDsP-NvJBrSD7tacB-ITqE6zb4n80TVE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c9821d17ef1e184cc1885c833980534c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Tqe40AYUdr...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.988 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:01.568Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:01.670Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:01.671Z","userId":"68f1a759569fae556c29fc10","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 102.746 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:01.673Z"}
  console.log
    CSRF token generation: {
      sessionID: '3768161932eb80758a7b3eed13a00c88',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZlV5uZLf-7rlHxlvx2wHYCYm1mOdqnkTbh-g

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3768161932eb80758a7b3eed13a00c88

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 4Rem9bg5g7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.580 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:01.679Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: 'c9821d17ef1e184cc1885c833980534c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac9821d17ef1e184cc1885c833980534c.r86yARQJc9b%2FlSXYwmq55ITgH%2Bns0jYfmI2JXUUsy78',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 60.484 ms - 170[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:02.693Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd3bdb2b30173306f352f2f652e4196fb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: oWRz6IKo-gwoUDbO8qopykUp7j_VQmgbGg-I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d3bdb2b30173306f352f2f652e4196fb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: cPOfib1T-V...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.263 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:02.809Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:02.947Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:02.947Z","userId":"68f1a75a569fae556c29fc3b","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 138.436 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:02.950Z"}
  console.log
    CSRF token generation: {
      sessionID: '0e810db51f16e5df091307c2355d8679',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: oFLlZfVZ-jV8oNil9SB-rL1Mz6D-964cu9Vg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0e810db51f16e5df091307c2355d8679

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: mGd4BoXeZh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.473 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:03.039Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:03.132Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:03.133Z","userId":"68f1a75a569fae556c29fc41","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.912 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:03.135Z"}
  console.log
    CSRF token generation: {
      sessionID: '67616d6ceaacadc8df16ed1386ac08be',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6WiWeIlD-ptAQkCjHBb3SKoxFuscvI7_vIJ8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 67616d6ceaacadc8df16ed1386ac08be

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: vKuFoCLsq9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.582 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:03.143Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: '0e810db51f16e5df091307c2355d8679',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A0e810db51f16e5df091307c2355d8679.q6cLGqGg%2BTS1L0i9CkRibeb%2BS6DrTsMJzMDk3UuZ0Q4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m400[0m 56.817 ms - 80[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:04.339Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f3a5255f2169ba0343f145c5464c54e4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: WSrRVMzy-RubOKU-4FmmOyPJBfcGoDukb2Sg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f3a5255f2169ba0343f145c5464c54e4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: t0oDYQawXm...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.181 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:04.471Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:04.649Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:04.650Z","userId":"68f1a75c569fae556c29fc6c","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 178.632 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:04.652Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a380af4cc4a2af3eb2883cffb2bb9cf4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: B9Qi00FJ-ZYHWy9cGhLULJms5DFSFFzpjMHA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a380af4cc4a2af3eb2883cffb2bb9cf4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _Lr7An97Ma...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.437 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:04.743Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:04.835Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:04.836Z","userId":"68f1a75c569fae556c29fc72","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.837 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:04.841Z"}
  console.log
    CSRF token generation: {
      sessionID: 'de905264796f87db9f2424eb4319df71',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: dHdhPMAW-q9rRyfvSsoO0IET69ZJCuCFvfPw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: de905264796f87db9f2424eb4319df71

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 7C7XNU3W1q...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.031 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:04.854Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: 'a380af4cc4a2af3eb2883cffb2bb9cf4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa380af4cc4a2af3eb2883cffb2bb9cf4.vD0SPVf8YlFyeZV%2BngaHLJrfaIJgLeuETki1phHOXLk',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m409[0m 86.705 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:05.866Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd75dd49b60b082c11f044c7e4ddc7504',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 95O86QGL-Mgs5Tdd5LJ7vaakFjkSnz7RTA8Q

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d75dd49b60b082c11f044c7e4ddc7504

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QuXRqcNJV3...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.588 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:05.955Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:06.112Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:06.113Z","userId":"68f1a75d569fae556c29fc9e","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 157.800 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:06.116Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd8ee99f0f418a214d8655780a7e4a583',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: bjyCTB4A-VRdmQIAkRSosVyrfNIzrrkIrC74

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d8ee99f0f418a214d8655780a7e4a583

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Jl7xdW-SsE...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.322 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:06.230Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:06.320Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:06.321Z","userId":"68f1a75e569fae556c29fca4","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 91.076 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:06.324Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c3d55b1f1b6c6cbb31fb4bf8e62c9533',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ioQSz3bY-kAkFRaMf1rwZ8eWA7K6E6-IoX4g

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c3d55b1f1b6c6cbb31fb4bf8e62c9533

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8Ro_7GLPmd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.959 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:06.421Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:06.564Z","userType":"administrator","username":"limited2@wavemax.com"}
info: undefined {"adminId":"LIMITED002","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:06.565Z","userId":"68f1a75e569fae556c29fcaa","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.144 ms - 655[0m
[34mdebug[39m: POST /api/v1/operators {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:06.567Z"}
  console.log
    CSRF check for: /api/v1/operators {
      sessionID: 'd75dd49b60b082c11f044c7e4ddc7504',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad75dd49b60b082c11f044c7e4ddc7504.unzeCOFv44gOCdG%2BU90UGlEWVi2paJ1f3iHt3YUtUEw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/operators [33m403[0m 56.426 ms - 81[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:07.572Z"}
  console.log
    CSRF token generation: {
      sessionID: '60a597efe26e5cea6224309cdfa25072',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 5E3UNbVg-3ZS4phUAPK81mUezfxM4Pev0SoM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 60a597efe26e5cea6224309cdfa25072

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PGdxJIPsQa...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.533 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:07.678Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:07.822Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:07.822Z","userId":"68f1a75f569fae556c29fcd5","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.965 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:07.827Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a81d8e833fe95b671286d6a20f753404',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 1rRKpxbS--Psb-VmiANm0qwQBPi0EDNSPE44

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a81d8e833fe95b671286d6a20f753404

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: mAXopoX8ho...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.548 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:07.915Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:08.023Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:08.023Z","userId":"68f1a75f569fae556c29fcdb","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 108.681 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:08.028Z"}
  console.log
    CSRF token generation: {
      sessionID: '25a1bd029e9004203d2558012ec31a5d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: terXdqKK-R4CetRVQc8DKwEawZRwZLq11_dY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 25a1bd029e9004203d2558012ec31a5d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Wg-Yb8D9Fp...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.367 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a760569fae556c29fce1 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:08.122Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a760569fae556c29fce1 {
      sessionID: 'a81d8e833fe95b671286d6a20f753404',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa81d8e833fe95b671286d6a20f753404.eFikGeOnSqOi%2BbTde3xRcwZ91a%2BKOVqS%2BJKurYDdspI',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{"firstName":"Updated","lastName":"Name","shiftEnd":"18:00","shiftStart":"10:00"}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68f1a760569fae556c29fce1","targetId":"68f1a760569fae556c29fce1","targetType":"operator","timestamp":"2025-10-17T02:18:08.279Z","userId":"68f1a75f569fae556c29fcd5","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68f1a760569fae556c29fce1 [32m200[0m 157.503 ms - 442[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:09.315Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd6d62d77478f0b496e04043fcdb74241',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: cU4ZBAd5-eCJ5M-h96zZLTS8YmDuOxa7cuqY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d6d62d77478f0b496e04043fcdb74241

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yqwYj66AXQ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.416 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:09.409Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:09.554Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:09.555Z","userId":"68f1a761569fae556c29fd0b","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.565 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:09.557Z"}
  console.log
    CSRF token generation: {
      sessionID: '1b669cfc82db6f63068e63424138e125',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: URkQLtGZ-LVJOzohAmlITORcudNMG3SdBdUk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1b669cfc82db6f63068e63424138e125

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QICuHuIdjB...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.260 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:09.648Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:09.736Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:09.736Z","userId":"68f1a761569fae556c29fd11","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 88.932 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:09.739Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a3368c10e1b79f16249c9911b1b5ad36',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: bMSrbOcP-pezzrnxnE4-TiuFeEjG8ogKZ_fQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a3368c10e1b79f16249c9911b1b5ad36

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9AFdaKZ89p...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.596 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a761569fae556c29fd17 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:09.822Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a761569fae556c29fd17 {
      sessionID: '1b669cfc82db6f63068e63424138e125',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A1b669cfc82db6f63068e63424138e125.EwTsZjnkgG5U9ilpwA5pp2b59wBq0FpIygt4jLy3QHU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68f1a761569fae556c29fd17","targetId":"68f1a761569fae556c29fd17","targetType":"operator","timestamp":"2025-10-17T02:18:10.065Z","userId":"68f1a761569fae556c29fd0b","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68f1a761569fae556c29fd17 [32m200[0m 243.059 ms - 445[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:11.010Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f45964daf02a32e1c02bbf77233de182',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: crB86bNz-_NLCJ_i2L7XDdcMCHkf1421N0pI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f45964daf02a32e1c02bbf77233de182

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2z2qHNX40J...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.043 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:11.101Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:11.245Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:11.246Z","userId":"68f1a763569fae556c29fd45","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.264 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:11.249Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd5de4e8c2e993940686a329840a34a9c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: NVD5lOLx-C99AiLxkfpl6MzClV2Ngw7cfaWg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d5de4e8c2e993940686a329840a34a9c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: x9Z04CSPy6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.348 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:11.342Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:11.436Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:11.436Z","userId":"68f1a763569fae556c29fd4b","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 93.870 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:11.439Z"}
  console.log
    CSRF token generation: {
      sessionID: '859f0eb14cad34ceaa71b2b25664b57c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: yObl8x7z-vSxmCVNXupmw81ei7qOtlNqgX44

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 859f0eb14cad34ceaa71b2b25664b57c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 0lorK3x6Ym...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.208 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a763569fae556c29fd51 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:11.527Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a763569fae556c29fd51 {
      sessionID: 'd5de4e8c2e993940686a329840a34a9c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad5de4e8c2e993940686a329840a34a9c.6p2hXD24cg7jrZJf%2FuhiUoxpc%2FAl3I1%2FqtI5ggz%2Bzb8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{"isActive":false}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68f1a763569fae556c29fd51","targetId":"68f1a763569fae556c29fd51","targetType":"operator","timestamp":"2025-10-17T02:18:11.668Z","userId":"68f1a763569fae556c29fd45","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68f1a763569fae556c29fd51 [32m200[0m 141.219 ms - 446[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:12.649Z"}
  console.log
    CSRF token generation: {
      sessionID: '35a7a812c546d10fd3167b194101c8ac',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: bAvMgr73-iVC6LRxvRxBysq1JIyFiQczSE2w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 35a7a812c546d10fd3167b194101c8ac

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KYdZpGZORA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.973 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:12.758Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:12.896Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:12.896Z","userId":"68f1a764569fae556c29fd7c","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 138.700 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:12.899Z"}
  console.log
    CSRF token generation: {
      sessionID: '0fba5d14cc29ae388d094603549d3197',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: p32yYGSq-_R2Rz4sm9P9MvCMQtuppvVgCRI0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0fba5d14cc29ae388d094603549d3197

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LIGu1R9YZ5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.452 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:12.993Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:13.089Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:13.090Z","userId":"68f1a764569fae556c29fd82","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 96.859 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:13.093Z"}
  console.log
    CSRF token generation: {
      sessionID: '3db3fd129820dec80ed2e7115ba1692a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JvRVSFvH-zf9oTyUnkw1ils0e7F9Lng6TPcw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3db3fd129820dec80ed2e7115ba1692a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Td2QvFMDe4...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.724 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a765569fae556c29fd8a {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:13.311Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a765569fae556c29fd8a {
      sessionID: '35a7a812c546d10fd3167b194101c8ac',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A35a7a812c546d10fd3167b194101c8ac.l%2FdhTPaKDKavJaaRL6faw3MRgEkoU7n7rPD%2Bi6ooEts',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68f1a765569fae556c29fd8a [32m200[0m 187.559 ms - 212[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:14.421Z"}
  console.log
    CSRF token generation: {
      sessionID: '74518371c058774d9c79f65fb1558a0a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZwyMXCzh-ktqrBIr28jQXA9LqQGCRtK57R04

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 74518371c058774d9c79f65fb1558a0a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: scWIb39Olc...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.238 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:14.508Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:14.645Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:14.646Z","userId":"68f1a766569fae556c29fdb4","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 137.413 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:14.649Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd81249148d45548a9896ba02d0cde7b0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Rgs1vhCl-4xxYdsd6InvcZKbCd7PrZLFVEE8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d81249148d45548a9896ba02d0cde7b0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9oNIXX5IPJ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.884 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:14.736Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:14.828Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:14.829Z","userId":"68f1a766569fae556c29fdba","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.606 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:14.831Z"}
  console.log
    CSRF token generation: {
      sessionID: '4a7d2c2dcf9b5ac65675ad4859508fb4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eMWRs3d3--psflv1UYNkpNQqa5NX6nq2nfO0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4a7d2c2dcf9b5ac65675ad4859508fb4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 0w08kPtMLz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 19.176 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a766569fae556c29fdba {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:14.932Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a766569fae556c29fdba {
      sessionID: '4a7d2c2dcf9b5ac65675ad4859508fb4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A4a7d2c2dcf9b5ac65675ad4859508fb4.bmj6FGiV2I6rjNEQAg5wKPzXz5%2BTAoXK8czYBlWSNv0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68f1a766569fae556c29fdba [32m200[0m 114.772 ms - 242[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:16.045Z"}
  console.log
    CSRF token generation: {
      sessionID: '2dbf6a1a1f92790d63759dc25a854588',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Y5UitVDi-yhawda45Q4PEXyYhtSNjlfYspLs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2dbf6a1a1f92790d63759dc25a854588

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bYfCdPcJ2G...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.909 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:16.150Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:16.302Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:16.302Z","userId":"68f1a768569fae556c29fdea","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 152.718 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:16.306Z"}
  console.log
    CSRF token generation: {
      sessionID: '1d6aaa04d6cf76a7c412ee4a10e269f8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 2Hgl9vmq-UWgrKfij1brdrPtXJKA2r6LgGsY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1d6aaa04d6cf76a7c412ee4a10e269f8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: yzwau-Xol1...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.016 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:16.398Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:16.490Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:16.490Z","userId":"68f1a768569fae556c29fdf0","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.185 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:16.493Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f946080fb895aed9e0199c12272ec0d5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0IsFJjlr-YCwafBskSYO8uy5dxtmZPBqAN3w

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f946080fb895aed9e0199c12272ec0d5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: qPuYAZBc44...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.630 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a768569fae556c29fdf6 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:16.581Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a768569fae556c29fdf6 {
      sessionID: '1d6aaa04d6cf76a7c412ee4a10e269f8',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A1d6aaa04d6cf76a7c412ee4a10e269f8.bGltBLAe%2F2sZcob4LUtvfnMXRLbyWJRU9uvXgzrN64g',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"action":"UPDATE_OPERATOR","details":{"updates":{}},"ip":"::ffff:127.0.0.1","method":"PATCH","path":"/68f1a768569fae556c29fdf6","targetId":"68f1a768569fae556c29fdf6","targetType":"operator","timestamp":"2025-10-17T02:18:16.718Z","userId":"68f1a768569fae556c29fdea","userRole":"administrator","userType":"administrator"}
[0mPATCH /api/v1/operators/68f1a768569fae556c29fdf6 [32m200[0m 137.766 ms - 445[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:17.644Z"}
  console.log
    CSRF token generation: {
      sessionID: '6f8644f97e6caeb7727ebcd39321463c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vQ5X6y3S-DtEByylWWagWsDTxlYrMB-O3qs0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6f8644f97e6caeb7727ebcd39321463c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NIGytnuWoM...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.548 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:17.745Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:17.903Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:17.904Z","userId":"68f1a769569fae556c29fe20","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 159.380 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:17.908Z"}
  console.log
    CSRF token generation: {
      sessionID: '4d33fe722354b454e0fa3cbdb2118da4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: c3QaHBKh-vf4IAuDhi0SAIsxXdJzIQAij6yE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4d33fe722354b454e0fa3cbdb2118da4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PoKDPtGTL3...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.702 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:17.996Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:18.099Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:18.099Z","userId":"68f1a769569fae556c29fe26","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 103.266 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:18.102Z"}
  console.log
    CSRF token generation: {
      sessionID: '6422861055435c38e19458b31f5eaf1d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4QN8CAFG-BBOsOlBHa-V71We_BDWNARAVuBk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6422861055435c38e19458b31f5eaf1d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 4luRZp7AbS...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.619 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a76a569fae556c29fe2c {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:18.191Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a76a569fae556c29fe2c {
      sessionID: '4d33fe722354b454e0fa3cbdb2118da4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A4d33fe722354b454e0fa3cbdb2118da4.1i7JkwAnuUfCtxhgW5Et%2FXH3XcPGtPIxXrL2bYkIbp4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68f1a76a569fae556c29fe2c [33m409[0m 137.539 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:19.277Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b3e059ac8dc21b0c71f68dbfc27dd9e5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Nqc1JZKu-5uW4vGBsxWmJftYPwXaZDiE4fMw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b3e059ac8dc21b0c71f68dbfc27dd9e5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1HCG5VjvZn...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.539 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:19.375Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:19.522Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:19.522Z","userId":"68f1a76b569fae556c29fe56","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 147.640 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:19.525Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ae6fe3bd0ed796c23a8223f9b1952d8d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BN7ItQBV-1652I4kyi5HEwABYqZzwKdQnn_s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ae6fe3bd0ed796c23a8223f9b1952d8d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: KQUiUi2KK3...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.321 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:19.614Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:19.706Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:19.707Z","userId":"68f1a76b569fae556c29fe5c","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.553 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:19.709Z"}
  console.log
    CSRF token generation: {
      sessionID: '42c102a959e3a10d1f8e1972cb929eb7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0dFdyuxE-YAMBCrFqGqlO_UXF68jGYC0bRos

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 42c102a959e3a10d1f8e1972cb929eb7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: oeIYSMOxVZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.140 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/operators/68f1a76b569fae556c29fe62 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:19.795Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a76b569fae556c29fe62 {
      sessionID: 'ae6fe3bd0ed796c23a8223f9b1952d8d',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aae6fe3bd0ed796c23a8223f9b1952d8d.7c0pgpivvtl%2BV9G4%2BUjqyG%2BFKaJI4Ma4%2BBSUxefr2R0',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"0":"6","1":"8","10":"9","11":"f","12":"a","13":"e","14":"5","15":"5","16":"6","17":"c","18":"2","19":"9","2":"f","20":"f","21":"e","22":"5","23":"6","3":"1","4":"a","5":"7","6":"6","7":"b","8":"5","9":"6","timestamp":"2025-10-17T02:18:19.938Z"}
[0mDELETE /api/v1/operators/68f1a76b569fae556c29fe62 [32m200[0m 142.605 ms - 58[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:20.915Z"}
  console.log
    CSRF token generation: {
      sessionID: '509dd24450378121500432ed48ed2c47',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xRKKZS8d-NlJCyR0gaKRqYZgdNyh-ksGQhtM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 509dd24450378121500432ed48ed2c47

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JFdahcta3v...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.908 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:21.007Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:21.151Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:21.151Z","userId":"68f1a76c569fae556c29fe8d","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.817 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:21.153Z"}
  console.log
    CSRF token generation: {
      sessionID: '8bb91a858e0aefa75a72b4ca675905b3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 6xgMtsht-SOolj7y1evinvflvbfuxWhJgy0I

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8bb91a858e0aefa75a72b4ca675905b3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: s7GwNozcz_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.837 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:21.251Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:21.350Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:21.350Z","userId":"68f1a76d569fae556c29fe93","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 99.557 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:21.353Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a8a1721a7433b1ed98147aa952c764c6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Rs6SSAjL-VjNNmgiQYdGD6yJ31lbYXa0P6d8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a8a1721a7433b1ed98147aa952c764c6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VndtM9H85-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.028 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/operators/68f1a76d569fae556c29fe99 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:21.473Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a76d569fae556c29fe99 {
      sessionID: '8bb91a858e0aefa75a72b4ca675905b3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A8bb91a858e0aefa75a72b4ca675905b3.a8AynETWrARMphMs72Cr6Hz740feGk6RF%2Fztbm26x20',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/operators/68f1a76d569fae556c29fe99 [33m400[0m 110.226 ms - 71[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:22.516Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c5c8ed20326484f13c18586e2f48e7ab',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4Is8kSRY-limXSJ0VVSzVJMyytoJEw11o27M

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c5c8ed20326484f13c18586e2f48e7ab

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: hTXPhnUezZ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.130 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:22.643Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:22.791Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:22.792Z","userId":"68f1a76e569fae556c29fec3","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.631 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:22.795Z"}
  console.log
    CSRF token generation: {
      sessionID: '5573c614580bb28f5da71153ac10c1c1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: dkyWexe9-jRDgKN7V7nGvHhnaeZ_pZGXdvLg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5573c614580bb28f5da71153ac10c1c1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: AuFXyTZXSP...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.431 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:22.886Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:22.977Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:22.978Z","userId":"68f1a76e569fae556c29fec9","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 91.716 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:22.981Z"}
  console.log
    CSRF token generation: {
      sessionID: 'beaad86cd531789f3bf8dadd28bfc272',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3ahWHEw3-7Vm4oKw4OC7A7U6ORYWdEdtWLWk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: beaad86cd531789f3bf8dadd28bfc272

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NlRb_slDlW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.157 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:23.166Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:23.312Z","userType":"administrator","username":"limited3@wavemax.com"}
info: undefined {"adminId":"LIMITED003","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:23.312Z","userId":"68f1a76f569fae556c29fed1","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 146.471 ms - 655[0m
[34mdebug[39m: DELETE /api/v1/operators/68f1a76e569fae556c29fecf {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:23.315Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a76e569fae556c29fecf {
      sessionID: 'c5c8ed20326484f13c18586e2f48e7ab',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ac5c8ed20326484f13c18586e2f48e7ab.95U3dhWF3FiNcFRnxchgNboqDj7vTFOYkasZGKcjTks',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/operators/68f1a76e569fae556c29fecf [33m403[0m 55.660 ms - 81[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:24.300Z"}
  console.log
    CSRF token generation: {
      sessionID: '04cde5bf80aaa1e6ebc902dadaf2752a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: flQKPOPJ-oHH2hbW_9QHYbuvBOqZE825XKb4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 04cde5bf80aaa1e6ebc902dadaf2752a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: t6RiM17iAR...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.340 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:24.408Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:24.550Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:24.550Z","userId":"68f1a770569fae556c29fefc","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.663 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:24.553Z"}
  console.log
    CSRF token generation: {
      sessionID: '0807017f6825dcd4a5dd79d7be477bfc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: RS1A4lsP-5yZVcLMoQfNArcboMdgJ2EbMSLQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0807017f6825dcd4a5dd79d7be477bfc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _1ZGo-TCLl...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.367 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:24.643Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:24.736Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:24.737Z","userId":"68f1a770569fae556c29ff02","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 94.036 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:24.751Z"}
  console.log
    CSRF token generation: {
      sessionID: '91fce8fef3853f7b33e4d1dba3f26d8b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Uu6Nox5x-4FTTPVSs4askt_5ugTW8Rgjj6cY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 91fce8fef3853f7b33e4d1dba3f26d8b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8G6aEUX0Gt...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.533 ms - 67[0m
[34mdebug[39m: DELETE /api/v1/operators/68f1a770569fae556c29ff0a {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:24.866Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a770569fae556c29ff0a {
      sessionID: '0807017f6825dcd4a5dd79d7be477bfc',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A0807017f6825dcd4a5dd79d7be477bfc.l6TJCBykT%2BC18K7CgQcazqDVs6x8OBTeAaO1vOueyVc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mDELETE /api/v1/operators/68f1a770569fae556c29ff0a [33m404[0m 83.429 ms - 48[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:25.868Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a885c22a5ae1cac53ce38a4526abd07a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DTNLN3dA-PFfd8fzn25Y1Syvypq2pmtIurZ0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a885c22a5ae1cac53ce38a4526abd07a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LV5DUoS2mb...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.354 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:25.971Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:26.119Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:26.120Z","userId":"68f1a771569fae556c29ff31","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.147 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:26.123Z"}
  console.log
    CSRF token generation: {
      sessionID: '016ce72558b9d16d96cb87e66a667d11',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jWjuhl2u-TfMTJ3POphfpIqJx72_CEztQbTE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 016ce72558b9d16d96cb87e66a667d11

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JTftBzmebg...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.045 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:26.210Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:26.302Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:26.302Z","userId":"68f1a772569fae556c29ff37","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.618 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:26.305Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e5037ebd2bcf8b3c40768a82dbff6cec',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: jahMev5x-anhQo9YeY3K2rkmSCqeq2r7CtfI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e5037ebd2bcf8b3c40768a82dbff6cec

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ZeSi5pzn1S...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.805 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators/68f1a772569fae556c29ff3d/reset-pin {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:26.393Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a772569fae556c29ff3d/reset-pin {
      sessionID: '016ce72558b9d16d96cb87e66a667d11',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A016ce72558b9d16d96cb87e66a667d11.xoqYEI3hv0QkLMVbWTMIts%2F5ViivVK0874LGe9c9Ang',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"0":"6","1":"8","10":"9","11":"f","12":"a","13":"e","14":"5","15":"5","16":"6","17":"c","18":"2","19":"9","2":"f","20":"f","21":"f","22":"3","23":"1","3":"1","4":"a","5":"7","6":"7","7":"1","8":"5","9":"6","timestamp":"2025-10-17T02:18:26.576Z"}
[0mPOST /api/v1/operators/68f1a772569fae556c29ff3d/reset-pin [32m200[0m 182.957 ms - 51[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:27.503Z"}
  console.log
    CSRF token generation: {
      sessionID: '4270c8d35469d383e2d2058497e7d287',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: MXLwXfoI-BXmSINAloudEAV-1jkOi6pLm9Ts

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4270c8d35469d383e2d2058497e7d287

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Lh7pTZGzkd...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.341 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:27.604Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:27.747Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:27.747Z","userId":"68f1a773569fae556c29ff67","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.462 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:27.750Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f720438bbf63e3288c92dc7471462bc7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: vf4aTRbM-bbvtj7pyeLWrZqNHaNL8lVr1HT0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f720438bbf63e3288c92dc7471462bc7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JJtVRHX9bh...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.353 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:27.838Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:27.933Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:27.933Z","userId":"68f1a773569fae556c29ff6d","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 95.126 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:27.936Z"}
  console.log
    CSRF token generation: {
      sessionID: '4cd024cbda79ed943efb19486c4f5f2c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xGbICKs6-_tghjnpPOH3gHknDFFMTkHbpt3s

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4cd024cbda79ed943efb19486c4f5f2c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: URNNxdEp7q...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.480 ms - 67[0m
[34mdebug[39m: POST /api/v1/operators/68f1a773569fae556c29ff73/reset-pin {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:28.085Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a773569fae556c29ff73/reset-pin {
      sessionID: 'f720438bbf63e3288c92dc7471462bc7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Af720438bbf63e3288c92dc7471462bc7.MPlRAVPSHDSa3XctEHgpSAKSWaavjPavbP5go4zvBW4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

info: undefined {"0":"6","1":"8","10":"9","11":"f","12":"a","13":"e","14":"5","15":"5","16":"6","17":"c","18":"2","19":"9","2":"f","20":"f","21":"f","22":"6","23":"7","3":"1","4":"a","5":"7","6":"7","7":"3","8":"5","9":"6","timestamp":"2025-10-17T02:18:28.261Z"}
[0mPOST /api/v1/operators/68f1a773569fae556c29ff73/reset-pin [32m200[0m 176.384 ms - 51[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:29.204Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e7f48179e2ad7b3996a42192cd473530',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ieXzqlsO-5e4ZdDMNMbe_o_Dm4ukfl9tz7Xc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e7f48179e2ad7b3996a42192cd473530

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: p3hmhtox42...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.197 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:29.311Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:29.480Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:29.480Z","userId":"68f1a775569fae556c29ffa0","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 169.287 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:29.483Z"}
  console.log
    CSRF token generation: {
      sessionID: '69e1312674e0b3b0fddd207d10771694',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HUuWGKgc-bhLdoUVA91RgFeLPv4EuhHoWVms

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 69e1312674e0b3b0fddd207d10771694

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 7N7QstVTNK...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.945 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:29.602Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:29.693Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:29.693Z","userId":"68f1a775569fae556c29ffa6","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 91.155 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:29.696Z"}
  console.log
    CSRF token generation: {
      sessionID: '8da9b0fc13ca5e92dd18abd37a304285',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: a4JmmK1M-vj2oQsnAjlTKy9QiC-oAKzjylLk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8da9b0fc13ca5e92dd18abd37a304285

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: GhHNIPSSHD...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.605 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:29.934Z"}
[0mGET /api/v1/operators/available [32m200[0m 82.685 ms - 769[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:30.939Z"}
  console.log
    CSRF token generation: {
      sessionID: '2535079d121badb4028ee7fcff76692b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: IbbZ9sqj-lmmami78EEasmTnON0h9GlALyko

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2535079d121badb4028ee7fcff76692b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: IvXQ9Xqgad...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.395 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:31.029Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:31.172Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:31.172Z","userId":"68f1a776569fae556c29ffda","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.602 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:31.175Z"}
  console.log
    CSRF token generation: {
      sessionID: '087901e2a9dd981e9af93556e5ffad7a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: n4RIUcLh-WtV46HQbeEeoPcCP6KTne5_gfjU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 087901e2a9dd981e9af93556e5ffad7a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1VdyDY93Cx...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.718 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:31.263Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:31.355Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:31.355Z","userId":"68f1a777569fae556c29ffe0","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.231 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:31.358Z"}
  console.log
    CSRF token generation: {
      sessionID: '58efa529b1381b48dffd93fc54cc6ec4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4pJjVRpn-kVxU3TXpHLM2kmD9hqKf83Q9pGE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 58efa529b1381b48dffd93fc54cc6ec4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: sxsbDeFBSy...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.151 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available?limit=2 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:31.597Z"}
[0mGET /api/v1/operators/available?limit=2 [32m200[0m 80.773 ms - 536[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:32.628Z"}
  console.log
    CSRF token generation: {
      sessionID: '071c0c7ab414f4c85d5e55ae4bf0e4f5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BROQJwk2-pGHOdMsdpfpqUYkxOmM6QW60oLc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 071c0c7ab414f4c85d5e55ae4bf0e4f5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9-KbwAhUmQ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.278 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:32.738Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:32.880Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:32.881Z","userId":"68f1a778569fae556c2a0014","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 143.066 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:32.883Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cac6f4324af2db98d8a9737d7cb9c503',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: qmkTdczI-N5E02jWT1w1bexAoOz9Zwj5zNSU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cac6f4324af2db98d8a9737d7cb9c503

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: aqtDGV9Ofa...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.948 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:33.013Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:33.105Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:33.106Z","userId":"68f1a778569fae556c2a001a","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.152 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:33.108Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c7d3696ae6b569c3ad18543e3f891a12',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: EJ8NZZeh-_yNCK2o31uBs4fP5JtdO3Pl9pUQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c7d3696ae6b569c3ad18543e3f891a12

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QA9fs_Y9U8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.797 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:33.348Z"}
[0mGET /api/v1/operators/available [32m200[0m 82.652 ms - 769[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:34.369Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a9f41074823ea49184a0ae58d620884a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: enc794Ia-iGtBqCVR0A40Bctf3JeU3VYdJcc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a9f41074823ea49184a0ae58d620884a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: dFbKJIBDsn...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.745 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:34.461Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:34.632Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:34.632Z","userId":"68f1a77a569fae556c2a004e","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 171.649 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:34.635Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cf972e9a51ada2d1c01742e194efb2cf',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 71BCCQ66-B1bI2wRtztu8Cn_uRI_LPHbcFiU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cf972e9a51ada2d1c01742e194efb2cf

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: D6liTdPhFi...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.695 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:34.729Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:34.826Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:34.826Z","userId":"68f1a77a569fae556c2a0054","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 97.273 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:34.829Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b936d49f5bfcace2f9a4d15087ad0b38',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: UPpzFAyy-K68YEBCavav0xB-_m7T-_2dN46Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b936d49f5bfcace2f9a4d15087ad0b38

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QH6NzvpkL8...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.271 ms - 67[0m
[34mdebug[39m: GET /api/v1/operators/available {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:35.068Z"}
[0mGET /api/v1/operators/available [33m401[0m 1.049 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:36.014Z"}
  console.log
    CSRF token generation: {
      sessionID: '28f2c4c4abafc204f95ba6fc8b64a292',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: i63Fyvf8-ajKmDzv_ptNZZgUiXT6QCdui2e0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 28f2c4c4abafc204f95ba6fc8b64a292

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: H82eXwb7h7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.063 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:36.107Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:36.256Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:36.257Z","userId":"68f1a77c569fae556c2a0085","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.393 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:36.260Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd4788a13ab3f58b4d8e3f4737b5e67a8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: r0MzvzIA-NxNlb0G6C4y1wUMZYhnfzXhRnt4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d4788a13ab3f58b4d8e3f4737b5e67a8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: g6l3tOtdlo...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.434 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:36.347Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:36.439Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:36.439Z","userId":"68f1a77c569fae556c2a008b","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.817 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:36.442Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dca648a02f781a9666a024dd8f51e8b8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xZWLLNzZ-OET9CITCzskfq-Qb2-U1fOYrTLI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dca648a02f781a9666a024dd8f51e8b8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 5ziPdaUEcW...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.867 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a77c569fae556c2a0091/stats {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:36.531Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a77c569fae556c2a0091/stats {
      sessionID: 'd4788a13ab3f58b4d8e3f4737b5e67a8',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad4788a13ab3f58b4d8e3f4737b5e67a8.tHEwW0QN8mJ85QNr%2Bta2as7ZlzwD53BPdr1jvT0IobM',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68f1a77c569fae556c2a0091/stats [32m200[0m 115.013 ms - 267[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:37.564Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cc3e290e4b19a36a3d5dea959fa8d48b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ZHH3WgmD-KjR1J2C4d3PtZDMG7p16nvKjSVU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cc3e290e4b19a36a3d5dea959fa8d48b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8qzZrKUGl3...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.665 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:37.652Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:37.797Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:37.797Z","userId":"68f1a77d569fae556c2a00ba","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 145.596 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:37.800Z"}
  console.log
    CSRF token generation: {
      sessionID: '7147b273ed35d6cae853922d62ab8ed1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: TOF384fH-tFa5iKg0KxFlM5feqlnOBKOYLL0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7147b273ed35d6cae853922d62ab8ed1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: kHqOVkvOba...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.163 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:37.899Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:37.989Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:37.990Z","userId":"68f1a77d569fae556c2a00c0","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 90.410 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:37.992Z"}
  console.log
    CSRF token generation: {
      sessionID: '4aac40bfc5273022c484ae34bb4e1c29',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: i4KTVTj1-fJpKUOr5BLDEqftwv_0lGIfl0vE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4aac40bfc5273022c484ae34bb4e1c29

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tlFGqPmQQD...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.898 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a77d569fae556c2a00c6/stats {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:38.081Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a77d569fae556c2a00c6/stats {
      sessionID: '7147b273ed35d6cae853922d62ab8ed1',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7147b273ed35d6cae853922d62ab8ed1.T%2FS2qDD4czyP6juFWnN%2BCa%2Ftg7Kn1FUFEsy0dqOX21c',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68f1a77d569fae556c2a00c6/stats [32m200[0m 115.268 ms - 252[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:39.122Z"}
  console.log
    CSRF token generation: {
      sessionID: '44e9df5e559155a1b3f60c2b4b289cd0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4Hx5xEoP-vAa1jwha_NVzBDCHyJE2QUkLle4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 44e9df5e559155a1b3f60c2b4b289cd0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: mLATPvdnR7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.711 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:39.222Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:39.363Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:39.363Z","userId":"68f1a77f569fae556c2a00ef","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 141.164 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:39.366Z"}
  console.log
    CSRF token generation: {
      sessionID: '441fe1ddf04bb0322a5d89518907b6eb',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: B3ZWcTeZ-ipXeC6LzgB_samgJIa6f8nt908g

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 441fe1ddf04bb0322a5d89518907b6eb

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ooFhvjBCj7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.506 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:39.482Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:39.574Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:39.575Z","userId":"68f1a77f569fae556c2a00f5","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 92.725 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:39.577Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e76d25cd88a15f0b6d09d23d9dd50b89',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: OqOE4xkL-UqRh3_XOShNgeifaSZYLNSA6Ay8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e76d25cd88a15f0b6d09d23d9dd50b89

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NT1VnwINNA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.424 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a77f569fae556c2a00fb/stats {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:39.665Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a77f569fae556c2a00fb/stats {
      sessionID: '441fe1ddf04bb0322a5d89518907b6eb',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A441fe1ddf04bb0322a5d89518907b6eb.vCcjbPL5IcKL%2BH0Ul%2Fq7ge%2BIEwoEPJiTqhJm3hqcm9A',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68f1a77f569fae556c2a00fb/stats [32m200[0m 117.561 ms - 268[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:40.698Z"}
  console.log
    CSRF token generation: {
      sessionID: '7526e87b9ebab7e0eba14101b554a9ec',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: m8vrgBM3-09y6KST-C7QS28ZguOyIAPKHNI8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7526e87b9ebab7e0eba14101b554a9ec

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: iDd_9A6AoH...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.983 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:40.788Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:40.925Z","userType":"administrator","username":"superuser@wavemax.com"}
info: undefined {"adminId":"ADMIN001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:18:40.926Z","userId":"68f1a780569fae556c2a0124","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 137.230 ms - 618[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:40.928Z"}
  console.log
    CSRF token generation: {
      sessionID: 'ae046ddfcbdcf6ec9deff7745c9b47b3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FfVWnCv6-PNS799Z8il9dx79La5robQkSG4E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: ae046ddfcbdcf6ec9deff7745c9b47b3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: W9vAxVXIri...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.185 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:41.026Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:41.116Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:18:41.116Z","userId":"68f1a780569fae556c2a012a","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 90.140 ms - 603[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:41.123Z"}
  console.log
    CSRF token generation: {
      sessionID: '7a94873ecccf31a773f9eac44c20a960',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4da9fJ6a-b45CAR4vQs237uDOq73x7bQOEk8

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7a94873ecccf31a773f9eac44c20a960

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: u2iRG-7RmG...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.881 ms - 67[0m
[34mdebug[39m: PATCH /api/v1/operators/68f1a781569fae556c2a0130/stats {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:41.209Z"}
  console.log
    CSRF check for: /api/v1/operators/68f1a781569fae556c2a0130/stats {
      sessionID: 'ae046ddfcbdcf6ec9deff7745c9b47b3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aae046ddfcbdcf6ec9deff7745c9b47b3.NNiT4pAuv1%2BIWKKLmbm9Z6%2Fh2GZJN0CkbjDH1azLF4g',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPATCH /api/v1/operators/68f1a781569fae556c2a0130/stats [33m400[0m 56.479 ms - 62[0m
PASS tests/integration/operator.test.js (62.496 s)
  Operator Integration Tests
    GET /api/v1/operators
      âœ“ should get all operators with admin token (2417 ms)
      âœ“ should filter by active status (1647 ms)
      âœ“ should filter by on-shift status (1578 ms)
      âœ“ should support pagination (2358 ms)
      âœ“ should require authentication (1343 ms)
      âœ“ should require operator management permissions (1653 ms)
    GET /api/v1/operators/:id
      âœ“ should get operator by ID (1555 ms)
      âœ“ should allow operators to view their own profile (1462 ms)
      âœ“ should prevent operators from viewing other operators (1501 ms)
      âœ“ should return 404 for non-existent operator (1479 ms)
    POST /api/v1/operators
      âœ“ should create new operator (1605 ms)
      âœ“ should validate required fields (1443 ms)
      âœ“ should validate email format (1497 ms)
      âœ“ should validate shift time format (1598 ms)
      âœ“ should prevent duplicate emails (1576 ms)
      âœ“ should require operators.manage permission (1695 ms)
    PATCH /api/v1/operators/:id
      âœ“ should update operator details (1745 ms)
      âœ“ should update password (1702 ms)
      âœ“ should deactivate operator (1637 ms)
      âœ“ should allow operators to update their own profile (limited fields) (1773 ms)
      âœ“ should prevent operators from changing their own work station (1624 ms)
      âœ“ should not allow updating operatorId (1598 ms)
      âœ“ should validate email uniqueness on update (1632 ms)
    DELETE /api/v1/operators/:id
      âœ“ should delete operator (1635 ms)
      âœ“ should prevent deleting operator with active orders (1603 ms)
      âœ“ should require operators.manage permission (1786 ms)
      âœ“ should handle non-existent operator (1565 ms)
    POST /api/v1/operators/:id/reset-pin
      âœ“ should reset operator PIN/password (1635 ms)
      âœ“ should clear login attempts on PIN reset (1702 ms)
    GET /api/v1/operators/available
      âœ“ should get available operators sorted by order count (1735 ms)
      âœ“ should respect limit parameter (1690 ms)
      âœ“ should only include active operators (1737 ms)
      âœ“ should require authentication (1648 ms)
    PATCH /api/v1/operators/:id/stats
      âœ“ should update processing statistics (1550 ms)
      âœ“ should update quality score (1557 ms)
      âœ“ should update both stats in one call (1577 ms)
      âœ“ should validate processingTime is positive (1480 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:43.495Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:44.088Z"}
  console.log
    CSRF token generation: {
      sessionID: '92b9b6634a06c0a5a74eba40b9d7ab17',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: JxlJXWlj-wzvDcAX8kyIQ4b9OFpUx6uvguoQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 92b9b6634a06c0a5a74eba40b9d7ab17

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: AhiOna43ky...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 10.820 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:44.950Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:45.145Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 188.279 ms - 544[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:46.126Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fab098c403243a4d6c6a884ec8b54de6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DunR550K-mHy_H7TJ4LKecF-Q8j5GFH3MqU4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fab098c403243a4d6c6a884ec8b54de6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tEHN1Nyrt1...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.164 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:46.350Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":"Invalid password","success":false,"timestamp":"2025-10-17T02:18:46.457Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [33m401[0m 106.771 ms - 58[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:47.310Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f14fe03442dde1b8898903aee24cb354',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: yz6RzXim-hASTEv94EXaLfRDfoUdt48a8X0M

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f14fe03442dde1b8898903aee24cb354

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: g8u3OT7OmO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.332 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:47.461Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":"User not found","success":false,"timestamp":"2025-10-17T02:18:47.490Z","userType":"affiliate","username":"nonexistent"}
[0mPOST /api/v1/auth/affiliate/login [33m401[0m 29.460 ms - 58[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:48.344Z"}
  console.log
    CSRF token generation: {
      sessionID: '7ef8857bf8f9ae80917d3d0a7b0e6ac6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 3QyWRFeA-jkXTf1B3t5dsvaHG8xHGaz4sdos

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7ef8857bf8f9ae80917d3d0a7b0e6ac6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: m8Ehk5v7Ie...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.354 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:48.626Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 178.556 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:49.675Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f2c03a9ab215c43b3ef4c36d5252252d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: VjB3G4cF-22fSmzkT6_SfohkB1xPmsn3tCXk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f2c03a9ab215c43b3ef4c36d5252252d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: X5uraiAJLS...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.549 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:49.931Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 146.438 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:50.936Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fe547482a289a077e4c373d35518bd96',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: K3aIqOr2-S80BHQYRl9SaUWd0GaiQNojTS-Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fe547482a289a077e4c373d35518bd96

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 2dmKAjnKLP...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.386 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:51.191Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 142.766 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:52.191Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e7ad5eb0068691fcb96aed4a20218fa6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: rjSUxMK7-4ouXIc9hcuoVJzpVMamsrvgREDM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e7ad5eb0068691fcb96aed4a20218fa6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Qs4QZQaiX7...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.453 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:52.453Z"}
  console.log
    Customer affiliateId: AFF123

      at log (server/controllers/authController.js:636:13)

  console.log
    Found affiliate: AFF123

      at log (server/controllers/authController.js:637:13)

  console.log
    Affiliate fees: min: 25, per-bag: 5

      at log (server/controllers/authController.js:638:13)

  console.log
    Sending customer login response: {
      "customerId": "CUST123",
      "firstName": "Jane",
      "lastName": "Smith",
      "email": "jane@example.com",
      "phone": "555-987-6543",
      "address": "456 Oak Ave",
      "city": "Austin",
      "state": "TX",
      "zipCode": "78702",
      "affiliateId": "AFF123",
      "numberOfBags": 1,
      "bagCredit": 0,
      "wdfCredit": 0,
      "affiliate": {
        "affiliateId": "AFF123",
        "name": "John Doe",
        "minimumDeliveryFee": 25,
        "perBagDeliveryFee": 5
      }
    }

      at log (server/controllers/authController.js:674:13)

[0mPOST /api/v1/auth/customer/login [32m200[0m 161.302 ms - 704[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:53.478Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f5e4b0cde3c1c48045c5c265e75fa0d0',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Tf80mgFJ-6oCrAoWK1mArzX0vdBiBKW81MNM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f5e4b0cde3c1c48045c5c265e75fa0d0

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: bqtRqrwfy9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.317 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/customer/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:53.625Z"}
[0mPOST /api/v1/auth/customer/login [33m401[0m 28.022 ms - 64[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:54.507Z"}
  console.log
    CSRF token generation: {
      sessionID: '41fc96b0605e4fe058d2a7d61310911b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Tkx4Y3Mh-NehGrDQEwngV-pYp5FJSdaSITPc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 41fc96b0605e4fe058d2a7d61310911b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: TDW7dLykkS...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.939 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:54.736Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:54.875Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 139.666 ms - 544[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:54.878Z"}
[0mGET /api/v1/auth/verify [32m200[0m 29.678 ms - 129[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:55.764Z"}
  console.log
    CSRF token generation: {
      sessionID: '0b9ce12a6294cfa78d066eb6343adcdc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DDZF89X3-ap40EqtdguOvRpi2d8sdDq89Nzs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0b9ce12a6294cfa78d066eb6343adcdc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: PR10hWrtu3...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.837 ms - 67[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:55.906Z"}
[0mGET /api/v1/auth/verify [33m401[0m 1.517 ms - 43[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:56.752Z"}
  console.log
    CSRF token generation: {
      sessionID: '4b738fcc663af157c233fc81d00c2be2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 7d0AAqgk-KVRfNja2xHzwM9WPxzoiQoke_v4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4b738fcc663af157c233fc81d00c2be2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: FLy7I1YSih...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.081 ms - 67[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:56.895Z"}
[0mGET /api/v1/auth/verify [33m401[0m 1.259 ms - 47[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:57.739Z"}
  console.log
    CSRF token generation: {
      sessionID: 'cfa4ac92aa051d1ff084ea690bc6392b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: G8Bt4ltv-Yqv4sw7N_BgQ2xGPIdMcLgkYkEU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: cfa4ac92aa051d1ff084ea690bc6392b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: iAwU3IedEB...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.455 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:57.963Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:18:58.107Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 143.568 ms - 544[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:58.109Z"}
[0mPOST /api/v1/auth/refresh-token [32m200[0m 126.929 ms - 409[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:59.146Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd6eff3f1de2f6a755e92dd6a27a30746',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mJmLXl63-IwSn0bx22HMV-ReHXz-qN_6GhLQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d6eff3f1de2f6a755e92dd6a27a30746

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ON4O-lZcVK...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.081 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:18:59.288Z"}
[0mPOST /api/v1/auth/refresh-token [33m400[0m 1.263 ms - 89[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:00.126Z"}
  console.log
    CSRF token generation: {
      sessionID: '4d1afc319d38e677a6273775dc6d1467',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Nzct79Xc-3N7BdxriHJ9X9Lux89xEBXIhEcA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 4d1afc319d38e677a6273775dc6d1467

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: a-dYJ5GHDt...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.063 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:00.385Z"}
[0mPOST /api/v1/auth/refresh-token [33m401[0m 28.280 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:01.266Z"}
  console.log
    CSRF token generation: {
      sessionID: '7251890be080cc870a34dfb69966443b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: iliYDjcK-omTubaAEtS0ds4L2mEMJHbIGFBQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7251890be080cc870a34dfb69966443b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: DFaAtdpjyI...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.251 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:01.489Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:19:01.631Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 141.823 ms - 544[0m
[34mdebug[39m: POST /api/v1/auth/logout {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:01.633Z"}
  console.log
    CSRF check for: /api/v1/auth/logout {
      sessionID: '7251890be080cc870a34dfb69966443b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7251890be080cc870a34dfb69966443b.aIIn%2BZmulzHCdEymBXZjSrNf0N9WfzXkBmFRMCR06wA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/auth/logout [32m200[0m 98.800 ms - 52[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:01.735Z"}
[0mGET /api/v1/auth/verify [33m401[0m 29.483 ms - 56[0m
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:01.767Z"}
[0mPOST /api/v1/auth/refresh-token [33m401[0m 28.001 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:02.646Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b0ca2461c5f046846d38b904743bbc45',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: kCAQjQ7z-4GoxUmBuBnl5gotihvpw2QgoONI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b0ca2461c5f046846d38b904743bbc45

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Y7xNWhQpwH...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.938 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:02.873Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:19:03.034Z","userType":"affiliate","username":"johndoe"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 161.033 ms - 544[0m
  console.log
    Got refresh token: d26261e5c26bfc455f2ec20d0bb8a07810038b4b6f25cb543ab050e8744038b5abdbea3b53e8d0ca

      at Object.log (tests/integration/auth.test.js:808:15)

  console.log
    Starting concurrent requests...

      at Object.log (tests/integration/auth.test.js:822:15)

[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:03.043Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:03.046Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:03.048Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:03.050Z"}
[34mdebug[39m: POST /api/v1/auth/refresh-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:03.051Z"}
[0mPOST /api/v1/auth/refresh-token [33m401[0m 35.581 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [33m401[0m 40.996 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [33m401[0m 36.235 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [33m401[0m 40.139 ms - 62[0m
[0mPOST /api/v1/auth/refresh-token [32m200[0m 146.294 ms - 409[0m
  console.log
    Responses received: [
      {
        status: 200,
        body: {
          success: true,
          token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZjFhNzk2ZmZjY2I5NWE0ZDFhNjdiYSIsImFmZmlsaWF0ZUlkIjoiQUZGMTIzIiwicm9sZSI6ImFmZmlsaWF0ZSIsImlhdCI6MTc2MDY2NzU0MywiZXhwIjoxNzYwNjcxMTQzLCJhdWQiOiJ3YXZlbWF4LWNsaWVudCIsImlzcyI6IndhdmVtYXgtYXBpIn0.QEEmnzz4GeaoeP1t5OkL3ZWgQy4IUjX4PaAPZud1jEg',
          refreshToken: 'adc0e30ec6a39a419230900296d4b62fdf0a8b02e6f3110b15acbf4806e087e26f73396ef698ba11'
        }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      },
      {
        status: 401,
        body: { success: false, message: 'Invalid or expired refresh token' }
      }
    ]

      at Object.log (tests/integration/auth.test.js:824:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:04.057Z"}
  console.log
    CSRF token generation: {
      sessionID: 'fbc371b8f2664835a20dab8935ba3c97',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: mZvnfTI9-kzcJeVDgbhoGnWADjoZ7fR7gVzU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: fbc371b8f2664835a20dab8935ba3c97

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: sL12VyRaAY...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.976 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:04.303Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:19:04.508Z","userType":"affiliate","username":"johndoe999"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 205.355 ms - 547[0m
[34mdebug[39m: POST /api/v1/auth/affiliate/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:05.611Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/affiliate/login","reason":null,"success":true,"timestamp":"2025-10-17T02:19:05.776Z","userType":"affiliate","username":"johndoe999"}
[0mPOST /api/v1/auth/affiliate/login [32m200[0m 165.323 ms - 547[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:05.779Z"}
[0mGET /api/v1/auth/verify [32m200[0m 28.717 ms - 129[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:05.810Z"}
[0mGET /api/v1/auth/verify [32m200[0m 29.281 ms - 129[0m
[34mdebug[39m: POST /api/v1/auth/logout {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:05.843Z"}
  console.log
    CSRF check for: /api/v1/auth/logout {
      sessionID: 'fbc371b8f2664835a20dab8935ba3c97',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Afbc371b8f2664835a20dab8935ba3c97.cbiQtjS1nPAeYuDUEhqrq7v6yFvKgSsvgz2ME%2FKn5A8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/auth/logout [32m200[0m 92.910 ms - 52[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:05.938Z"}
[0mGET /api/v1/auth/verify [33m401[0m 28.497 ms - 56[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:05.969Z"}
[0mGET /api/v1/auth/verify [32m200[0m 29.582 ms - 129[0m
[34mdebug[39m: POST /api/v1/auth/logout {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:06.002Z"}
  console.log
    CSRF check for: /api/v1/auth/logout {
      sessionID: 'fbc371b8f2664835a20dab8935ba3c97',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Afbc371b8f2664835a20dab8935ba3c97.cbiQtjS1nPAeYuDUEhqrq7v6yFvKgSsvgz2ME%2FKn5A8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/auth/logout [32m200[0m 99.265 ms - 52[0m
[34mdebug[39m: GET /api/v1/auth/verify {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:06.104Z"}
[0mGET /api/v1/auth/verify [33m401[0m 28.215 ms - 56[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:06.982Z"}
  console.log
    CSRF token generation: {
      sessionID: '96d20a98c712292f589645ca72ab4cf5',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xEHnbDPX-5BPoE6dCvUimXtjTnkBuC9G1Bm0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 96d20a98c712292f589645ca72ab4cf5

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: o89iA5CbXy...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.875 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:07.210Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:19:07.358Z","userType":"administrator","username":"admin@example.com"}
info: undefined {"adminId":"ADM001","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","timestamp":"2025-10-17T02:19:07.359Z","userId":"68f1a79bffccb95a4d1a682a","userType":"administrator"}
[0mPOST /api/v1/auth/administrator/login [32m200[0m 149.020 ms - 684[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:08.221Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e2257ab6030d4d9b476cad0c49594859',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: DNBvizmF-RLX1kimoFs64RVFkF4dWH8X7nWI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e2257ab6030d4d9b476cad0c49594859

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lX5q3Lxbvm...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.366 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:08.448Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":"Invalid password","success":false,"timestamp":"2025-10-17T02:19:08.560Z","userType":"administrator","username":"admin@example.com"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 112.997 ms - 55[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:09.411Z"}
  console.log
    CSRF token generation: {
      sessionID: '79cce8805993df3ab0788fd6c42adf7a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0MKUnqwF-CVi_-ez1QxTnrrGN_6Oq5xMJIEg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 79cce8805993df3ab0788fd6c42adf7a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 9Q3ZUEtnpq...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.241 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/administrator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:09.636Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/administrator/login","reason":"Account inactive","success":false,"timestamp":"2025-10-17T02:19:09.664Z","userType":"administrator","username":"admin@example.com"}
[0mPOST /api/v1/auth/administrator/login [33m401[0m 28.415 ms - 90[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:10.525Z"}
  console.log
    CSRF token generation: {
      sessionID: '56aa6ad482dcfe3d78b8907b8b7c38e8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 8Lfbd9oo-BPmS6Nwzok8zxXxXCH0t-fuhOsA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 56aa6ad482dcfe3d78b8907b8b7c38e8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 451Y7xQVI9...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.510 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:10.827Z"}
info: undefined {"eventType":"LOGIN_SUCCESS","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":null,"success":true,"timestamp":"2025-10-17T02:19:10.921Z","userType":"operator","username":"OPR001"}
info: undefined {"ip":"::ffff:127.0.0.1","loginMethod":"PIN","method":"POST","operatorId":"OPR001","path":"/operator/login","shift":"00:00 - 23:59","timestamp":"2025-10-17T02:19:10.922Z","userId":"68f1a79effccb95a4d1a68a8","userType":"operator"}
[0mPOST /api/v1/auth/operator/login [32m200[0m 96.111 ms - 597[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:11.786Z"}
  console.log
    CSRF token generation: {
      sessionID: '81840d201aa061eb07df348d38c82185',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: eLT8X8do-EBdBSe7oaeNslpzwpJyG6nRWsJs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 81840d201aa061eb07df348d38c82185

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: NwIIlzBBYY...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.608 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:12.093Z"}
[0mPOST /api/v1/auth/operator/login [33m400[0m 1.167 ms - 115[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:12.943Z"}
  console.log
    CSRF token generation: {
      sessionID: '3bc21277c43e915ea5c71cfa7ecda9db',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: lsHix6mX-RIO0YDfyiCsDKO9zA2eV-I_Z9Xc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3bc21277c43e915ea5c71cfa7ecda9db

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: XgxdnM-3Tf...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.190 ms - 67[0m
[34mdebug[39m: POST /api/v1/auth/operator/login {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:13.251Z"}
info: undefined {"eventType":"LOGIN_FAILED","ip":"::ffff:127.0.0.1","method":"POST","path":"/operator/login","reason":"Account inactive","success":false,"timestamp":"2025-10-17T02:19:13.279Z","userType":"operator","username":"OPR001"}
[0mPOST /api/v1/auth/operator/login [33m403[0m 28.680 ms - 91[0m
PASS tests/integration/auth.test.js (31.732 s)
  Authentication Integration Tests
    POST /api/v1/auth/affiliate/login
      âœ“ should login affiliate with valid credentials (2054 ms)
      âœ“ should fail with invalid credentials (1184 ms)
      âœ“ should fail with non-existent username (1033 ms)
    POST /api/v1/auth/customer/login
      âœ“ should login customer with valid credentials (1330 ms)
      âœ“ should login customer using emailOrUsername field with email (1262 ms)
      âœ“ should login customer using emailOrUsername field with username (1255 ms)
      âœ“ should prioritize emailOrUsername over username field (1288 ms)
      âœ“ should return error with invalid emailOrUsername (1028 ms)
    GET /api/v1/auth/verify
      âœ“ should verify valid token (1256 ms)
      âœ“ should fail with invalid token (987 ms)
      âœ“ should fail with missing token (987 ms)
    POST /api/v1/auth/refresh-token
      âœ“ should refresh token successfully (1407 ms)
      âœ“ should fail with invalid refresh token (980 ms)
      âœ“ should fail with expired refresh token (1139 ms)
    POST /api/v1/auth/logout
      âœ“ should logout successfully and blacklist tokens (1380 ms)
    Rate limiting tests
      â—‹ skipped should rate limit login attempts
      â—‹ skipped should rate limit refresh token requests
    Concurrent refresh token usage
      âœ“ should handle concurrent refresh token requests safely (1410 ms)
    Token blacklisting after logout
      âœ“ should blacklist all active tokens on logout (2926 ms)
    POST /api/v1/auth/administrator/login
      âœ“ should login administrator with valid credentials (1234 ms)
      âœ“ should fail with invalid administrator credentials (1194 ms)
      âœ“ should fail when administrator is inactive (1114 ms)
    POST /api/v1/auth/operator/login
      âœ“ should login operator with valid credentials (1260 ms)
      âœ“ should fail with invalid operator credentials (1157 ms)
      âœ“ should fail when operator is inactive (1190 ms)

[32minfo[39m: Paygistix configuration loaded from paygistix-forms.json {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:15.138Z"}
  console.log
    Connected to test database: mongodb+srv://***:***@cluster0.yiy75zr.mongodb.net/wavemax_test?retryWrites=true&w=majority

      at Object.log (tests/setup.js:41:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:15.492Z"}
  console.log
    CSRF token generation: {
      sessionID: 'd39c4c627b912989f22495d574f0b88c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: o1aLIyeF-iSgzljg_bLR769QsePqme2cyxdg

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: d39c4c627b912989f22495d574f0b88c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: eqRyg07c9L...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.297 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:16.301Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'd39c4c627b912989f22495d574f0b88c',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ad39c4c627b912989f22495d574f0b88c.4dbbndW0HjBxerSe2B2cu4nWSMe9tvkSTm28RjM52zU',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7a453dd43361678aa16",
      "orderId": "ORD-c43b1b4e-9627-4a26-be05-c58beeeff6d6",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:19:16.517Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a7a453dd43361678aa16",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-c43b1b4e-9627-4a26-be05-c58beeeff6d6",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:19:16.517Z",
      "updatedAt": "2025-10-17T02:19:16.517Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "specialPickupInstructions": "Ring doorbell",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7a453dd43361678aa16",
      "orderId": "ORD-c43b1b4e-9627-4a26-be05-c58beeeff6d6",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:19:16.517Z",
      "updatedAt": "2025-10-17T02:19:16.517Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-c43b1b4e-9627-4a26-be05-c58beeeff6d6
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-c43b1b4e-9627-4a26-be05-c58beeeff6d6
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> Ring doorbell
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 360.728 ms - 293[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:17.715Z"}
  console.log
    CSRF token generation: {
      sessionID: '5fe0354dcf53f74df423623592cf4d44',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: coM6jyCG-eFX7AF9wmvST7QAjUYeivuqt82c

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5fe0354dcf53f74df423623592cf4d44

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: VuJPB2FT5p...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 12.822 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:17.977Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '5fe0354dcf53f74df423623592cf4d44',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A5fe0354dcf53f74df423623592cf4d44.cmZBhu5b%2FlOcKDk1%2FvZhp7tRJ1l%2BJ5%2FDrg9V%2BeXR9Ic',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7a653dd43361678aa57",
      "orderId": "ORD-22bb5529-73c7-44cd-876f-6b1a16e5e3d8",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:19:18.148Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a7a653dd43361678aa57",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-22bb5529-73c7-44cd-876f-6b1a16e5e3d8",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:19:18.148Z",
      "updatedAt": "2025-10-17T02:19:18.148Z",
      "baseRate": 1.25,
      "estimatedTotal": 43.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7a653dd43361678aa57",
      "orderId": "ORD-22bb5529-73c7-44cd-876f-6b1a16e5e3d8",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:19:18.148Z",
      "updatedAt": "2025-10-17T02:19:18.148Z",
      "baseRate": 1.25,
      "estimatedTotal": 43.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-22bb5529-73c7-44cd-876f-6b1a16e5e3d8
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $43.75
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-22bb5529-73c7-44cd-876f-6b1a16e5e3d8
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 15 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 1
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 272.210 ms - 293[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:19.101Z"}
  console.log
    CSRF token generation: {
      sessionID: '9b32057bf3d761f0d11644600e65d389',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 0m9Z0fQ9-AVMVCSRkyCNLxwzyqYWah44tKqA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9b32057bf3d761f0d11644600e65d389

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: N3iZOJ3bz1...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.642 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:19.349Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '9b32057bf3d761f0d11644600e65d389',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A9b32057bf3d761f0d11644600e65d389.F871PrAfyhClegjvTx9lUew5Wd1OpDJuMZRP69srhpA',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "INVALID",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: INVALID

      at log (server/controllers/orderController.js:125:11)

  console.log
    Customer not found with ID: INVALID

      at log (server/controllers/orderController.js:129:13)

[0mPOST /api/v1/orders [33m400[0m 57.351 ms - 49[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:20.256Z"}
  console.log
    CSRF token generation: {
      sessionID: 'f548123e0612a1cadd666da9b28e43f8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: sFtYDfU6-9P4DNSz9Ph5jTXXYkKRLHag7Kvk

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: f548123e0612a1cadd666da9b28e43f8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: jPBMstpqxV...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.972 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:20.513Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'f548123e0612a1cadd666da9b28e43f8',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Af548123e0612a1cadd666da9b28e43f8.XnciZZvs9eV1hDj7H2H9qdFB6KyWKJJqa%2FDL2cX%2BaAQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "INVALID",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: INVALID

      at log (server/controllers/orderController.js:153:11)

  console.log
    Affiliate not found with ID: INVALID

      at log (server/controllers/orderController.js:157:13)

[0mPOST /api/v1/orders [33m400[0m 113.314 ms - 50[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:21.477Z"}
  console.log
    CSRF token generation: {
      sessionID: '108524fe421c04d20b092a904f7a3d81',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ApYvtCE6-tWZK9ZFeGfeq3MB2Bj7zP5uDe-4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 108524fe421c04d20b092a904f7a3d81

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: j44EiFex-5...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.449 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:21.762Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '108524fe421c04d20b092a904f7a3d81',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A108524fe421c04d20b092a904f7a3d81.OP6N%2BenvgD5MamIXmdc8eVNEk8YZGq0Ic7S6Vmp2jXM',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST999",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST999

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Bob Jones

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

[0mPOST /api/v1/orders [33m403[0m 112.517 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:22.726Z"}
  console.log
    CSRF token generation: {
      sessionID: '3b287f0fd790740b9e5797920b8a7312',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xg4Etm0X-uAD2KY72Q9lImKWnsbkTAXwbuec

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3b287f0fd790740b9e5797920b8a7312

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: d7-IjIwynj...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.289 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:22.980Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '3b287f0fd790740b9e5797920b8a7312',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A3b287f0fd790740b9e5797920b8a7312.Ba%2FNl8C%2F%2BZX%2BfizBomwqbIbSrXY0D6AAHWbEwM7ZEbs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Validation errors: [
      {
        type: 'field',
        value: undefined,
        msg: 'Valid pickup date is required',
        path: 'pickupDate',
        location: 'body'
      },
      {
        type: 'field',
        value: undefined,
        msg: 'Invalid pickup time',
        path: 'pickupTime',
        location: 'body'
      },
      {
        type: 'field',
        value: undefined,
        msg: 'Number of bags must be at least 1',
        path: 'numberOfBags',
        location: 'body'
      },
      {
        type: 'field',
        value: undefined,
        msg: 'Estimated weight must be a positive number',
        path: 'estimatedWeight',
        location: 'body'
      }
    ]

      at log (server/controllers/orderController.js:97:13)

[0mPOST /api/v1/orders [33m400[0m 30.728 ms - 444[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:23.859Z"}
  console.log
    CSRF token generation: {
      sessionID: 'c36b6e50e7e633555325882bdd4648d8',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 9aDPhABH-ApmWESeI1vDpAEHHppkmS3T9iTw

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: c36b6e50e7e633555325882bdd4648d8

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: EMYSV1i146...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.618 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/ORD123456 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:24.179Z"}
[0mGET /api/v1/orders/ORD123456 [32m200[0m 119.426 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:25.157Z"}
  console.log
    CSRF token generation: {
      sessionID: '6e0ff6768cc5ced144cf89b7ffea2e9a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: sNDbP3KA-FQYsQ09q_7B3JqvQ7lWKQ6gNSTc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6e0ff6768cc5ced144cf89b7ffea2e9a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: E9ltwZK9rT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.885 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/ORD123456 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:25.447Z"}
[0mGET /api/v1/orders/ORD123456 [32m200[0m 110.558 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:26.408Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b888dbb42de81d384d82415ea5e8db30',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FOGG6BmG-5-kGaQEmv6ZPUgLVM07iNp_1QvA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b888dbb42de81d384d82415ea5e8db30

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 1TXR7un6k6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.077 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/ORD123456 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:26.727Z"}
[0mGET /api/v1/orders/ORD123456 [33m403[0m 54.728 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:27.639Z"}
  console.log
    CSRF token generation: {
      sessionID: '9c7efb3a78be31f99a7e7e8fa38e808c',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: LCkkcQ0i-bt8-REHfnG7V03mblxuLcrQocOA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9c7efb3a78be31f99a7e7e8fa38e808c

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: EVGu_ZENdb...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.507 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/NONEXISTENT {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:27.927Z"}
[0mGET /api/v1/orders/NONEXISTENT [33m404[0m 54.251 ms - 45[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:28.838Z"}
  console.log
    CSRF token generation: {
      sessionID: '76c47670340ec48db4395ba87bf0c306',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: g8skdE06-qBaDfvpjEWjfG80ip5slIf70CT0

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 76c47670340ec48db4395ba87bf0c306

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: lRED5TlJpx...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.331 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:29.145Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '76c47670340ec48db4395ba87bf0c306',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A76c47670340ec48db4395ba87bf0c306.78jfmIXiJvzrpC3TmeZIYD%2Fdk5ghGlnNtYECCSqep10',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-status, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Update: Laundry Processing

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Status Update</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .status-update { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #2196f3; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Status Update</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>We have an update on your laundry order!</p>
                
                <div class="status-update">
                    <h2 style="color: #1976d2; margin-bottom: 15px;">Status Update</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row" style="font-size: 18px; color: #1976d2;">
                        <span class="detail-label">Status:</span> Your laundry has been received and is being processed
                    </div>
                    
                    
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Order Details</a>
                </p>
                
                <p>Thank you for choosing WaveMAX Laundry!</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPUT /api/v1/orders/ORD123456/status [32m200[0m 149.361 ms - 131[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:30.177Z"}
  console.log
    CSRF token generation: {
      sessionID: '7af3371a6acb4b3e0fcd51f997c0087e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: VrXFYa5a-Rj3HsJufHDt4JaE_tC-4mZ2cA4Y

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 7af3371a6acb4b3e0fcd51f997c0087e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: JI10UMG8V6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.720 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:30.502Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '7af3371a6acb4b3e0fcd51f997c0087e',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A7af3371a6acb4b3e0fcd51f997c0087e.DreDavuoCuNsNDBcJIH18TUU4EgohxYLO4mI2QTvYhc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-status, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Update: Ready for Pickup

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Status Update</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .status-update { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #2196f3; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Status Update</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>We have an update on your laundry order!</p>
                
                <div class="status-update">
                    <h2 style="color: #1976d2; margin-bottom: 15px;">Status Update</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row" style="font-size: 18px; color: #1976d2;">
                        <span class="detail-label">Status:</span> Your laundry is ready for pickup by the affiliate
                    </div>
                    <div class="detail-row"><span class="detail-label">Weight:</span> 25.5 lbs</div>
                    <div class="detail-row"><span class="detail-label">Final Total:</span> $48.20</div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Order Details</a>
                </p>
                
                <p>Thank you for choosing WaveMAX Laundry!</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPUT /api/v1/orders/ORD123456/status [32m200[0m 152.882 ms - 172[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:31.549Z"}
  console.log
    CSRF token generation: {
      sessionID: '070d14fffdcdd0868a85a94e5f03879b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Bo5M34vF-MNnkhW9oENiulxtJzJyhSUlACNY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 070d14fffdcdd0868a85a94e5f03879b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: DlgvmRuojF...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.512 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:31.878Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '070d14fffdcdd0868a85a94e5f03879b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A070d14fffdcdd0868a85a94e5f03879b.7OhXWhYzITXo8yOlUDDtwiILSlIcLTRLPJz7gg6sGMg',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/status [33m400[0m 60.710 ms - 80[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:32.800Z"}
  console.log
    CSRF token generation: {
      sessionID: '3323fcfc3adaaa5373a224e1f24dee1f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: HbkGgB0J-CrLsmXgCXe7hMxXeIqoDA5waGuY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3323fcfc3adaaa5373a224e1f24dee1f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: DErCOlvfwv...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.339 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:33.090Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '3323fcfc3adaaa5373a224e1f24dee1f',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A3323fcfc3adaaa5373a224e1f24dee1f.Yos9JVUnMGWHcdIqDS1L1YX2GubB6vHHwk0vv6EPs34',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/status [33m403[0m 57.027 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:34.085Z"}
  console.log
    CSRF token generation: {
      sessionID: '6d2d609054e436cae0b95068e124194b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Hoer5kPt-Xd13UHcXEx9RTjCGR0mMB8LhO0c

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 6d2d609054e436cae0b95068e124194b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: BAXu0OaLLu...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.422 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:34.371Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/status {
      sessionID: '6d2d609054e436cae0b95068e124194b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A6d2d609054e436cae0b95068e124194b.%2BIsLmv5vhbfRdGNJ0%2BCFpxVeGwcTuKoUjRA9ANj7VCw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/status [33m403[0m 56.726 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:35.277Z"}
  console.log
    CSRF token generation: {
      sessionID: '405a111e105ba687752cc5536e95496f',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BvWnbetk-CzOcr5j_6E74H-sxkl50HEAwsXE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 405a111e105ba687752cc5536e95496f

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LjFRYWlAE6...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.859 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:35.559Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: '405a111e105ba687752cc5536e95496f',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A405a111e105ba687752cc5536e95496f.dMyXdceLaSmPMThV3NOm5iVsWQflPukpa279Bt3v3Uc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Order Has Been Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Order Has Been Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Your laundry pickup order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 2:19:35 AM
                    </div>
                </div>
                
                <p>If you'd like to schedule a new pickup, you can do so at any time:</p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule New Pickup</a>
                </p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" style="color: #3b82f6;">View Your Dashboard</a>
                </p>
                
                <p>We're sorry for any inconvenience. If you have any questions, please contact your affiliate partner.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>We wanted to inform you that an order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 2:19:35 AM
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Dashboard</a>
                </p>
                
                <p>Please do not proceed with this pickup. The customer may reschedule at a later time.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders/ORD123456/cancel [32m200[0m 152.055 ms - 137[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:36.603Z"}
  console.log
    CSRF token generation: {
      sessionID: '16fce81e2527d1a4d0523834616da962',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: osmuo4Ra-mieMnNXz4kfZqBFp3Wd_3uwrK8o

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 16fce81e2527d1a4d0523834616da962

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: s4fdt6-ydr...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.526 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:36.906Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: '16fce81e2527d1a4d0523834616da962',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A16fce81e2527d1a4d0523834616da962.k%2BuhKUUwpvwxNMN5ney8cbNfuffLZ58aw1fy9vjmLT4',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Language-specific template not found for en/customer-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Order Has Been Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Order Has Been Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Your laundry pickup order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 2:19:37 AM
                    </div>
                </div>
                
                <p>If you'd like to schedule a new pickup, you can do so at any time:</p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer&pickup=true" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Schedule New Pickup</a>
                </p>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" style="color: #3b82f6;">View Your Dashboard</a>
                </p>
                
                <p>We're sorry for any inconvenience. If you have any questions, please contact your affiliate partner.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-order-cancelled, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Order Cancelled

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Order Cancelled</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #dc2626; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .cancellation-details { background-color: #fee2e2; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #f87171; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Order Cancelled</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>We wanted to inform you that an order has been cancelled.</p>
                
                <div class="cancellation-details">
                    <h2 style="color: #dc2626; margin-bottom: 15px;">Cancellation Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD123456
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Original Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Cancelled At:</span> 2:19:37 AM
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View Dashboard</a>
                </p>
                
                <p>Please do not proceed with this pickup. The customer may reschedule at a later time.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders/ORD123456/cancel [32m200[0m 151.707 ms - 137[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:37.918Z"}
  console.log
    CSRF token generation: {
      sessionID: '50506107643e61165e635d29f97ab54b',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: FyCOwL1b-LUg3Idvyzsw85tvdsiSeBwHQAiU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 50506107643e61165e635d29f97ab54b

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: zZ4YecYG3D...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.883 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:38.257Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: '50506107643e61165e635d29f97ab54b',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A50506107643e61165e635d29f97ab54b.YbDVRDnPQWYHVzDGg4lN1MlSKJ2%2B1NB%2FayntrS0a2kw',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/orders/ORD123456/cancel [33m400[0m 57.017 ms - 116[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:39.167Z"}
  console.log
    CSRF token generation: {
      sessionID: '3ed8a8067591dda63dee5d4bb3a69eda',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: H2Ouinut-T3Cz4DL7h2VNBUq2a0rQ95xgiZs

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3ed8a8067591dda63dee5d4bb3a69eda

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: y23o8imRfu...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.757 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/ORD123456/cancel {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:39.459Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/cancel {
      sessionID: '3ed8a8067591dda63dee5d4bb3a69eda',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A3ed8a8067591dda63dee5d4bb3a69eda.CY9MyMDWAXmepxkh7yiLoSKqrEYSgC2XoUq2dAuAyqQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/orders/ORD123456/cancel [33m403[0m 57.395 ms - 42[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:40.387Z"}
  console.log
    CSRF token generation: {
      sessionID: '31ffd858f05cb6968ad2f9471f6f6af1',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ElthQPJV-NtOs_wW_MbRlkwYMJxbkQRfPTNQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 31ffd858f05cb6968ad2f9471f6f6af1

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: FiiSDFs0db...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.063 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/bulk/status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:40.679Z"}
  console.log
    CSRF check for: /api/v1/orders/bulk/status {
      sessionID: '31ffd858f05cb6968ad2f9471f6f6af1',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A31ffd858f05cb6968ad2f9471f6f6af1.gCkVYPZeFomIewz8Q3PoJnjwaQnebrlhkgjzoQoy19I',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/bulk/status [32m200[0m 124.766 ms - 201[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:41.708Z"}
  console.log
    CSRF token generation: {
      sessionID: '90280396a71673e559cef096eb1bbd03',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ggKhUJZ6-TuEFZH4VclC0W7TS8e9UQ8ks660

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 90280396a71673e559cef096eb1bbd03

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: pQDhoYSSXJ...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.736 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/bulk/status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:42.034Z"}
  console.log
    CSRF check for: /api/v1/orders/bulk/status {
      sessionID: '90280396a71673e559cef096eb1bbd03',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A90280396a71673e559cef096eb1bbd03.RNACf8rmCfifQ0doHSL2psBk0OLAGG%2F8yJqZlI6Y5GQ',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/bulk/status [32m200[0m 122.445 ms - 296[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:43.001Z"}
  console.log
    CSRF token generation: {
      sessionID: 'bbc8da9ae07f175c8e53223c019ad8de',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: tzOqa1Ac-cJ6pVesftkdfWFZyl9bRPsKwndY

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: bbc8da9ae07f175c8e53223c019ad8de

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: RR8_FOZQU-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.351 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders/bulk/cancel {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:43.289Z"}
  console.log
    CSRF check for: /api/v1/orders/bulk/cancel {
      sessionID: 'bbc8da9ae07f175c8e53223c019ad8de',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Abbc8da9ae07f175c8e53223c019ad8de.kUIkmRzfzFQQdUvbY8RO%2B32Mq550MKewJcJiEB%2FSynE',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPOST /api/v1/orders/bulk/cancel [32m200[0m 159.206 ms - 161[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:44.321Z"}
  console.log
    CSRF token generation: {
      sessionID: '8ea329c164e9169eefe7b4fb47cad247',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: xJtaGci0-jES0ioFBPCNeO-Xwp6v_x4Ll4NE

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 8ea329c164e9169eefe7b4fb47cad247

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: x83sMLLlYc...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.036 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=csv&startDate=2025-05-01&endDate=2025-05-31&affiliateId=AFF123 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:44.624Z"}
[0mGET /api/v1/orders/export?format=csv&startDate=2025-05-01&endDate=2025-05-31&affiliateId=AFF123 [32m200[0m 88.984 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:45.562Z"}
  console.log
    CSRF token generation: {
      sessionID: '01e21bb5bfe60cd66867450f728bf345',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: y9SQ7RIL-GY3z2_FoAf1azCGNwBwlGzBTCUc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 01e21bb5bfe60cd66867450f728bf345

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: qJYY3zt_LO...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 9.197 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=json&status=complete&affiliateId=AFF123 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:45.911Z"}
[0mGET /api/v1/orders/export?format=json&status=complete&affiliateId=AFF123 [32m200[0m 85.512 ms - -[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:46.848Z"}
  console.log
    CSRF token generation: {
      sessionID: 'b3afc3a2aa0a7dc866942dc1b22b97ca',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Mv05XV3m-dq2eKlDQBY42Uutz194F5yjo9Lc

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: b3afc3a2aa0a7dc866942dc1b22b97ca

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: tOZrpTVc4O...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.135 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=excel&customerId=CUST123 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:47.149Z"}
[0mGET /api/v1/orders/export?format=excel&customerId=CUST123 [31m501[0m 85.145 ms - 62[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:48.107Z"}
  console.log
    CSRF token generation: {
      sessionID: '5672aec7f04358f406cea35d08f554cc',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 4Spgbvk8-evQmafzVzKgvpBYlURy611h8W7E

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 5672aec7f04358f406cea35d08f554cc

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: rFcFilYnFT...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.363 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/export?format=csv {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:48.408Z"}
[0mGET /api/v1/orders/export?format=csv [33m403[0m 30.483 ms - 70[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:49.331Z"}
  console.log
    CSRF token generation: {
      sessionID: 'db780f8cf16ef752a845313bd31163f9',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: KZpGlsjx-JQOcnY4l25cKw-bGSS7dGQQUbTM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: db780f8cf16ef752a845313bd31163f9

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 05f6zxfv8X...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.665 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:49.624Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: 'db780f8cf16ef752a845313bd31163f9',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Adb780f8cf16ef752a845313bd31163f9.B3dzwr7SgaQGAr4tZLSLVjhzzvBRDaSLzfqdRqbDmGs',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [32m200[0m 91.358 ms - 223[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:50.618Z"}
  console.log
    CSRF token generation: {
      sessionID: 'e5ccc34bb6351b7881d11a24b5a67508',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: x7LRx33n-ik8gKxAXzKiIgWW200UVeuZVUlo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: e5ccc34bb6351b7881d11a24b5a67508

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: mLRl2m-9gb...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.850 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:50.925Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: 'e5ccc34bb6351b7881d11a24b5a67508',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Ae5ccc34bb6351b7881d11a24b5a67508.O6huSFZw%2FAVtdkueDyzIAZ0RhGHBD4RhpWcI7sGT%2Bww',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [32m200[0m 89.717 ms - 180[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:51.867Z"}
  console.log
    CSRF token generation: {
      sessionID: 'a91aba4e8ea1e25fb9c3f3ced8bbddd3',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Go5I3f7Q-thtuEZ3OZS9SCTm3zc0oQnKTyo4

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: a91aba4e8ea1e25fb9c3f3ced8bbddd3

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ZvDjRBbwSz...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.457 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:52.203Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: 'a91aba4e8ea1e25fb9c3f3ced8bbddd3',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aa91aba4e8ea1e25fb9c3f3ced8bbddd3.U8XkZ0TOxeYzerI2CHpv4heOwXrI%2Fi%2BGM1a%2FxHZK23M',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [33m400[0m 57.264 ms - 82[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:53.108Z"}
  console.log
    CSRF token generation: {
      sessionID: '0bc65dcf714ad302d4f7a0d670063eb6',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: e7O3ekG9-d8dE6kPRoeBZdsskE9fvxeII4WA

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 0bc65dcf714ad302d4f7a0d670063eb6

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: 8ViI7uv58N...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.430 ms - 67[0m
[34mdebug[39m: PUT /api/v1/orders/ORD123456/payment-status {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:53.433Z"}
  console.log
    CSRF check for: /api/v1/orders/ORD123456/payment-status {
      sessionID: '0bc65dcf714ad302d4f7a0d670063eb6',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A0bc65dcf714ad302d4f7a0d670063eb6.4mSprujZrXXbPyf2YnBYyb1SHzYQr229vuos1ebdSKc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

[0mPUT /api/v1/orders/ORD123456/payment-status [32m200[0m 89.094 ms - 319[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:54.380Z"}
  console.log
    CSRF token generation: {
      sessionID: '1d92849696e8057cac7c2f16d771870a',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: LfTd57p6-kXOeMdfjbOyK6lZLhETPLxkkYbQ

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1d92849696e8057cac7c2f16d771870a

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: WHHxQFE2U_...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.309 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/search?search=alice&affiliateId=AFF123 {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:54.708Z"}
[0mGET /api/v1/orders/search?search=alice&affiliateId=AFF123 [32m200[0m 144.133 ms - 874[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:55.723Z"}
  console.log
    CSRF token generation: {
      sessionID: '1be08a983fd5956b8746e7d9be749639',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: ODvHtkDo-rsp-9dBmMktZYrUpICCyrkeq4RM

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 1be08a983fd5956b8746e7d9be749639

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: _0RPGhz2py...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 4.382 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF123/orders?status=complete&date=month {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:56.059Z"}
[0mGET /api/v1/affiliates/AFF123/orders?status=complete&date=month [32m200[0m 108.336 ms - 116[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:57.020Z"}
  console.log
    CSRF token generation: {
      sessionID: '13f5d9a9cae25f4a0814124109239b6e',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: Z7CjKM9v-IBmkUFmkRdjg5pQlfd9lGkO-WpI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 13f5d9a9cae25f4a0814124109239b6e

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: ff_39L4JU-...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.579 ms - 67[0m
[34mdebug[39m: GET /api/v1/affiliates/AFF123/orders?status=all {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:57.340Z"}
[0mGET /api/v1/affiliates/AFF123/orders?status=all [32m200[0m 111.523 ms - 945[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:58.300Z"}
  console.log
    CSRF token generation: {
      sessionID: 'dd3c61b35b55f19f655e56ac1d8c535d',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: 00hifm8g-aJoX-960NcyJzWJwU46HQHtuyVI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: dd3c61b35b55f19f655e56ac1d8c535d

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: LMEf4QBhVX...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.180 ms - 67[0m
[34mdebug[39m: GET /api/v1/orders/statistics?affiliateId=AFF123&includeStats=true {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:58.629Z"}
[0mGET /api/v1/orders/statistics?affiliateId=AFF123&includeStats=true [32m200[0m 56.471 ms - 239[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:19:59.538Z"}
  console.log
    CSRF token generation: {
      sessionID: '9aa1ff194389d8c330f1d046e3bda604',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: BgziEEqN-ymMDsNVjX__kxVNNtpWJC3xDKNo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 9aa1ff194389d8c330f1d046e3bda604

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: w5iSH3zglN...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 6.234 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:00.341Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '9aa1ff194389d8c330f1d046e3bda604',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A9aa1ff194389d8c330f1d046e3bda604.nCdZkFGBEGkX5UUYxqdGVtdpvDvvq2YLB4a0UCClSls',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d053dd43361678b07a",
      "orderId": "ORD-92c9311d-bc72-4acd-baf9-08752075c948",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:00.516Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a7d053dd43361678b07a",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-92c9311d-bc72-4acd-baf9-08752075c948",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:00.516Z",
      "updatedAt": "2025-10-17T02:20:00.516Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d053dd43361678b07a",
      "orderId": "ORD-92c9311d-bc72-4acd-baf9-08752075c948",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:00.516Z",
      "updatedAt": "2025-10-17T02:20:00.516Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-92c9311d-bc72-4acd-baf9-08752075c948
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-92c9311d-bc72-4acd-baf9-08752075c948
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 275.431 ms - 293[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:01.670Z"}
  console.log
    CSRF token generation: {
      sessionID: '2c69747555eda96cc7bd634570b60ab4',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: pRJBsyV3-5fdFQ1BgsmmlXDImfa7D4jcNIcI

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 2c69747555eda96cc7bd634570b60ab4

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: QzbylbbOT1...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 5.922 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:02.583Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '2c69747555eda96cc7bd634570b60ab4',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A2c69747555eda96cc7bd634570b60ab4.cHrCNp4LsSNn%2B7gXGHkkyOvHXH9rSrIQGsUKtXSVML8',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "numberOfBags": 3
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "numberOfBags": 3,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d253dd43361678b0c1",
      "orderId": "ORD-3b449209-a63f-4a6d-a958-364745c71f8f",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:02.752Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a7d253dd43361678b0c1",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-3b449209-a63f-4a6d-a958-364745c71f8f",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:02.752Z",
      "updatedAt": "2025-10-17T02:20:02.752Z",
      "baseRate": 2,
      "estimatedTotal": 125,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 50,
      "status": "pending",
      "numberOfBags": 3,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 3,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d253dd43361678b0c1",
      "orderId": "ORD-3b449209-a63f-4a6d-a958-364745c71f8f",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:02.752Z",
      "updatedAt": "2025-10-17T02:20:02.752Z",
      "baseRate": 2,
      "estimatedTotal": 125,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-3b449209-a63f-4a6d-a958-364745c71f8f
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $125.00
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-3b449209-a63f-4a6d-a958-364745c71f8f
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 50 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 3
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 268.649 ms - 294[0m
  console.log
    Order baseRate: 2 Expected: 2.00

      at Object.log (tests/integration/order.test.js:1136:15)

[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:04.009Z"}
  console.log
    CSRF token generation: {
      sessionID: 'aa72aea71f28928cfd2a74eb0bd868b7',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: AkzEJVEx-w1mMEpM8J4VVENvW15_4dUZcdXU

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: aa72aea71f28928cfd2a74eb0bd868b7

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: Odw16bNIaA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 8.177 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:05.020Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'aa72aea71f28928cfd2a74eb0bd868b7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa72aea71f28928cfd2a74eb0bd868b7.0VkEPGuH7GSJgav4V7jMTL4GqHlJrGhM6CNj%2BBqkrZc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST-COMM-0

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Test0 Customer

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d553dd43361678b107",
      "orderId": "ORD-5a0a3845-2846-41ba-857a-9377864db7ef",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.193Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a7d553dd43361678b107",
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-5a0a3845-2846-41ba-857a-9377864db7ef",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.193Z",
      "updatedAt": "2025-10-17T02:20:05.193Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST-COMM-0",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d553dd43361678b107",
      "orderId": "ORD-5a0a3845-2846-41ba-857a-9377864db7ef",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.193Z",
      "updatedAt": "2025-10-17T02:20:05.193Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: test0@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test0@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test0,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-5a0a3845-2846-41ba-857a-9377864db7ef
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-5a0a3845-2846-41ba-857a-9377864db7ef
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test0 Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 123 Test St, Austin, TX 78701
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 273.342 ms - 293[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:05.378Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'aa72aea71f28928cfd2a74eb0bd868b7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa72aea71f28928cfd2a74eb0bd868b7.0VkEPGuH7GSJgav4V7jMTL4GqHlJrGhM6CNj%2BBqkrZc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST-COMM-1

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Test1 Customer

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d553dd43361678b113",
      "orderId": "ORD-55ecad92-92a6-4d8b-815d-40d90eea984f",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.583Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a7d553dd43361678b113",
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-55ecad92-92a6-4d8b-815d-40d90eea984f",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.583Z",
      "updatedAt": "2025-10-17T02:20:05.583Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST-COMM-1",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d553dd43361678b113",
      "orderId": "ORD-55ecad92-92a6-4d8b-815d-40d90eea984f",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.583Z",
      "updatedAt": "2025-10-17T02:20:05.583Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: test1@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test1@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test1,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-55ecad92-92a6-4d8b-815d-40d90eea984f
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-55ecad92-92a6-4d8b-815d-40d90eea984f
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test1 Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 123 Test St, Austin, TX 78701
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 306.610 ms - 293[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:05.773Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: 'aa72aea71f28928cfd2a74eb0bd868b7',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3Aaa72aea71f28928cfd2a74eb0bd868b7.0VkEPGuH7GSJgav4V7jMTL4GqHlJrGhM6CNj%2BBqkrZc',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST-COMM-2

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Test2 Customer

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "numberOfBags": 2,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d553dd43361678b11f",
      "orderId": "ORD-08e9509f-f2c7-4927-9e2b-81c33a9eaf7c",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.946Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "_id": "68f1a7d553dd43361678b11f",
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-08e9509f-f2c7-4927-9e2b-81c33a9eaf7c",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.946Z",
      "updatedAt": "2025-10-17T02:20:05.946Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST-COMM-2",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-25T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 30,
      "status": "pending",
      "numberOfBags": 2,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 2,
        "minimumFee": 25,
        "perBagFee": 5,
        "totalFee": 25,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d553dd43361678b11f",
      "orderId": "ORD-08e9509f-f2c7-4927-9e2b-81c33a9eaf7c",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:05.946Z",
      "updatedAt": "2025-10-17T02:20:05.946Z",
      "baseRate": 1.25,
      "estimatedTotal": 62.5,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: test2@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: test2@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Test2,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-08e9509f-f2c7-4927-9e2b-81c33a9eaf7c
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $62.50
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-08e9509f-f2c7-4927-9e2b-81c33a9eaf7c
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Test2 Customer
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-0123
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 123 Test St, Austin, TX 78701
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/25/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 30 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 2
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 273.677 ms - 293[0m
[34mdebug[39m: GET /api/csrf-token {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:07.125Z"}
  console.log
    CSRF token generation: {
      sessionID: '3a82d931c288afb91c7cb8c5245907b2',
      hasSession: true,
      hasCsrfSecret: false
    }

      at log (server/config/csrf-config.js:313:11)

  console.log
    === Generated CSRF token ===

      at log (server/config/csrf-config.js:330:13)

  console.log
    Token: uP3ZqGyC-D5hC5RfFPwsepP9veKezelzucqo

      at log (server/config/csrf-config.js:331:13)

  console.log
    Session ID: 3a82d931c288afb91c7cb8c5245907b2

      at log (server/config/csrf-config.js:332:13)

  console.log
    CSRF Secret: X-oNQO9zZA...

      at log (server/config/csrf-config.js:333:13)

  console.log
    ===========================

      at log (server/config/csrf-config.js:334:13)

[0mGET /api/csrf-token [32m200[0m 7.093 ms - 67[0m
[34mdebug[39m: POST /api/v1/orders {"service":"wavemax-affiliate","timestamp":"2025-10-17T02:20:07.931Z"}
  console.log
    CSRF check for: /api/v1/orders {
      sessionID: '3a82d931c288afb91c7cb8c5245907b2',
      hasSession: true,
      sessionCookie: 'wavemax.sid=s%3A3a82d931c288afb91c7cb8c5245907b2.TR1fEkYDaJMhcKnGX%2FOpIXhDa%2Bk7C6IrDDbw%2FtLFoZo',
      hasCsrfSecret: true,
      hasAuth: true,
      origin: undefined,
      referer: undefined,
      userAgent: undefined
    }

      at log (server/config/csrf-config.js:242:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1
    }

      at log (server/controllers/orderController.js:101:11)

  console.log
    AddOns received: undefined

      at log (server/controllers/orderController.js:122:11)

  console.log
    Looking for customer with ID: CUST123

      at log (server/controllers/orderController.js:125:11)

  console.log
    Found customer: Jane Smith

      at log (server/controllers/orderController.js:132:11)

  console.log
    Looking for affiliate with ID: AFF123

      at log (server/controllers/orderController.js:153:11)

  console.log
    Found affiliate: John Doe

      at log (server/controllers/orderController.js:160:11)

  console.log
    Creating order with data: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "numberOfBags": 1,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "status": "pending"
    }

      at log (server/controllers/orderController.js:227:13)

  console.log
    Order instance before save: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d853dd43361678b168",
      "orderId": "ORD-4c36d8d3-b05a-4bbe-ac91-bbf3d1266c3c",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:08.104Z"
    }

      at log (server/controllers/orderController.js:229:13)

  console.log
    Order fetched after save: {
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "_id": "68f1a7d853dd43361678b168",
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOnTotal": 0,
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "orderId": "ORD-4c36d8d3-b05a-4bbe-ac91-bbf3d1266c3c",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:08.104Z",
      "updatedAt": "2025-10-17T02:20:08.104Z",
      "baseRate": 1.25,
      "estimatedTotal": 68.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:235:13)

  console.log
    Order saved with addOns: { premiumDetergent: false, fabricSoftener: false, stainRemover: false }

      at log (server/controllers/orderController.js:237:13)

  console.log
    Full order object: {
      "customerId": "CUST123",
      "affiliateId": "AFF123",
      "pickupDate": "2025-05-26T00:00:00.000Z",
      "pickupTime": "morning",
      "estimatedWeight": 15,
      "status": "pending",
      "numberOfBags": 1,
      "bagsWeighed": 0,
      "bagsProcessed": 0,
      "bagsPickedUp": 0,
      "addOns": {
        "premiumDetergent": false,
        "fabricSoftener": false,
        "stainRemover": false
      },
      "addOnTotal": 0,
      "feeBreakdown": {
        "numberOfBags": 1,
        "minimumFee": 50,
        "perBagFee": 10,
        "totalFee": 50,
        "minimumApplied": true
      },
      "bagCreditApplied": 0,
      "wdfCreditApplied": 0,
      "wdfCreditGenerated": 0,
      "weightDifference": 0,
      "affiliateCommission": 0,
      "paymentStatus": "pending",
      "paymentMethod": "card",
      "isPaid": false,
      "qualityCheckPassed": null,
      "v2PaymentStatus": "pending",
      "v2PaymentMethod": "pending",
      "v2PaymentAmount": 0,
      "v2PaymentCheckAttempts": 0,
      "v2PaymentReminderCount": 0,
      "v2ReminderCount": 0,
      "isTestOrder": false,
      "_id": "68f1a7d853dd43361678b168",
      "orderId": "ORD-4c36d8d3-b05a-4bbe-ac91-bbf3d1266c3c",
      "bagWeights": [],
      "bags": [],
      "v2PaymentReminders": [],
      "createdAt": "2025-10-17T02:20:08.104Z",
      "updatedAt": "2025-10-17T02:20:08.104Z",
      "baseRate": 1.25,
      "estimatedTotal": 68.75,
      "__v": 0
    }

      at log (server/controllers/orderController.js:238:13)

  console.log
    Language-specific template not found for en/customer-order-confirmation, using default

      at log (server/utils/emailService.js:55:15)

  console.warn
    Email template placeholder [DELIVERY_DATE] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.warn
    Email template placeholder [DELIVERY_TIME] not found in data

      115 |     } else {
      116 |       // If not found, return empty string for cleaner emails
    > 117 |       console.warn(`Email template placeholder [${placeholder}] not found in data`);
          |               ^
      118 |       return '';
      119 |     }
      120 |   });

      at warn (server/utils/emailService.js:117:15)
          at String.replace (<anonymous>)
      at replace (server/utils/emailService.js:103:19)
      at Object.fillTemplate [as sendCustomerOrderConfirmationEmail] (server/utils/emailService.js:1328:18)
      at server/controllers/orderController.js:265:7

  console.log
    [sendEmail] Sending email to: jane@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: jane@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: Your Laundry Pickup Confirmation

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Your Laundry Pickup Confirmation</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
            .affiliate-info { background-color: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 5px; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Your Laundry Pickup is Confirmed!</h1>
            </div>
            <div class="content">
                <p>Hello Jane,</p>
                
                <p>Thank you for scheduling your laundry pickup with WaveMAX Laundry. Your order has been confirmed and your affiliate partner has been notified.</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Summary</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-4c36d8d3-b05a-4bbe-ac91-bbf3d1266c3c
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Date:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Delivery Time:</span> 
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Total:</span> $68.75
                    </div>
                </div>
                
                <div class="affiliate-info">
                    <h3 style="margin-top: 0;">Your Affiliate Partner</h3>
                    <div class="detail-row">
                        <span class="detail-label">Name:</span> John Doe
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-123-4567
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Email:</span> john@example.com
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=customer" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">Login to View Your Order</a>
                </p>
                
                <p><strong>What happens next?</strong></p>
                <ul><li>Your affiliate partner will arrive during your selected pickup window</li><li>Please have your laundry ready in bags</li><li>You'll receive updates as your order progresses</li><li>Final pricing will be based on the actual weight of your laundry</li></ul>
                
                <p>If you need to make any changes to your order, please contact your affiliate partner directly.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

  console.log
    Language-specific template not found for en/affiliate-new-order, using default

      at log (server/utils/emailService.js:55:15)

  console.log
    [sendEmail] Sending email to: john@example.com

      at log (server/utils/emailService.js:127:13)

  console.log
    === EMAIL CONSOLE LOG ===

      at Object.log [as sendMail] (server/utils/emailService.js:17:17)

  console.log
    From: "WaveMAX Laundry" <test@wavemax.promo>

      at Object.log [as sendMail] (server/utils/emailService.js:18:17)

  console.log
    To: john@example.com

      at Object.log [as sendMail] (server/utils/emailService.js:19:17)

  console.log
    Subject: New Laundry Pickup Order

      at Object.log [as sendMail] (server/utils/emailService.js:20:17)

  console.log
    HTML: <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>New Laundry Pickup Order</title>
        <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: #1e3a8a; color: #ffffff !important; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .order-details { background-color: #ffffff !important; padding: 15px; margin: 15px 0; border-radius: 5px; border: 1px solid #e0e0e0; }
            .footer { background-color: #f5f5f5; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 5px 5px; }
            .button { display: inline-block; padding: 12px 30px; background-color: #ffffff !important; color: #ffffff !important; text-decoration: none !important; border-radius: 5px; margin: 15px 0; }
            .detail-row { margin: 10px 0; }
            .detail-label { font-weight: bold; color: #555; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>New Laundry Pickup Order</h1>
            </div>
            <div class="content">
                <p>Hello John,</p>
                
                <p>You have a new laundry pickup order to process!</p>
                
                <div class="order-details">
                    <h2 style="color: #1e3a8a; margin-bottom: 15px;">Order Details</h2>
                    <div class="detail-row">
                        <span class="detail-label">Order ID:</span> ORD-4c36d8d3-b05a-4bbe-ac91-bbf3d1266c3c
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Customer:</span> Jane Smith
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Phone:</span> 555-987-6543
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span> 456 Oak Ave, Austin, TX 78702
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date:</span> 5/26/2025
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time:</span> Morning (8am - 12pm)
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Estimated Weight:</span> 15 lbs
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags:</span> 1
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Special Instructions:</span> None
                    </div>
                </div>
                
                <p style="text-align: center;">
                    <a href="https://www.wavemaxlaundry.com/austin-tx/wavemax-austin-affiliate-program?login=affiliate" class="button" style="display: inline-block; background-color: #1e3a8a !important; color: #ffffff !important; padding: 12px 20px; text-decoration: none !important; border-radius: 4px; font-weight: bold; text-align: center;">View in Dashboard</a>
                </p>
                
                <p>Please ensure you pick up the laundry during the specified time window. The customer will be expecting you.</p>
                
                <p>Best regards,<br>The WaveMAX Laundry Team</p>
            </div>
            <div class="footer">
                <p>&copy; 2025 CRHS Enterprises, LLC. All rights reserved.</p>
                <p>This is an automated message. Please do not reply to this email.</p>
            </div>
        </div>
    </body>
    </html>

      at Object.log [as sendMail] (server/utils/emailService.js:21:17)

  console.log
    =========================

      at Object.log [as sendMail] (server/utils/emailService.js:22:17)

  console.log
    Email sent: console-message-id

      at log (server/utils/emailService.js:151:13)

[0mPOST /api/v1/orders [32m201[0m 272.003 ms - 293[0m
PASS tests/integration/order.test.js (54.871 s)
  Order Integration Tests
    POST /api/v1/orders
      âœ“ should create order as customer (2239 ms)
      âœ“ should create order as affiliate for their customer (1386 ms)
      âœ“ should fail with invalid customer ID (1155 ms)
      âœ“ should fail with invalid affiliate ID (1221 ms)
      âœ“ should fail when customer tries to create order for another customer (1249 ms)
      âœ“ should validate required fields (1133 ms)
    GET /api/v1/orders/:orderId
      âœ“ should return order details for customer (1298 ms)
      âœ“ should return order details for affiliate (1251 ms)
      âœ“ should fail for unauthorized customer (1231 ms)
      âœ“ should return 404 for non-existent order (1199 ms)
    PUT /api/v1/orders/:orderId/status
      âœ“ should update order status as affiliate (1339 ms)
      âœ“ should update weight when processing (1373 ms)
      âœ“ should prevent invalid status transitions (1249 ms)
      âœ“ should fail for unauthorized affiliate (1286 ms)
      âœ“ should fail for customers (1192 ms)
    POST /api/v1/orders/:orderId/cancel
      âœ“ should cancel order as customer (1326 ms)
      âœ“ should cancel order as affiliate (1315 ms)
      âœ“ should prevent cancelling non-cancellable orders (1249 ms)
      âœ“ should fail for unauthorized user (1220 ms)
    Bulk order operations
      âœ“ should update multiple orders status in bulk (1320 ms)
      âœ“ should handle partial bulk update failures (1293 ms)
      âœ“ should cancel multiple orders in bulk (1319 ms)
    Order export functionality
      âœ“ should export orders as CSV (1241 ms)
      âœ“ should export orders as JSON (1287 ms)
      âœ“ should export orders as Excel (1258 ms)
      âœ“ should respect export permissions (1224 ms)
    Payment status updates
      âœ“ should update payment status (1287 ms)
      âœ“ should handle payment failure (1249 ms)
      âœ“ should prevent payment status update on non-complete orders (1241 ms)
      âœ“ should record refund (1271 ms)
    Order filtering and search
      âœ“ should search orders by customer name (1344 ms)
      âœ“ should filter orders by multiple criteria (1297 ms)
      âœ“ should filter by pickup time slots (1279 ms)
      âœ“ should provide aggregated statistics with filters (1238 ms)
    Commission Calculation Tests
      âœ“ should calculate commission correctly when order is completed (2132 ms)
      âœ“ should use dynamic WDF rate from SystemConfig (2338 ms)
      âœ“ should calculate commission for multiple orders (3109 ms)
      âœ“ should handle high delivery fee scenarios (2039 ms)

------------------------------|---------|----------|---------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                                                                                                                                                                          
------------------------------|---------|----------|---------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                     |   78.61 |    69.05 |   86.28 |   78.77 |                                                                                                                                                                                                                                                                                                                            
 config                       |   96.72 |    85.21 |     100 |   96.59 |                                                                                                                                                                                                                                                                                                                            
  csrf-config.js              |    86.2 |    72.72 |     100 |    86.2 | 257-281,291-292,307,322-323                                                                                                                                                                                                                                                                                                
  passport-config.js          |     100 |    82.81 |     100 |     100 | 20,211,226,235,268,301,319-332,340,364,386,426,434-444,485,500,526-527                                                                                                                                                                                                                                                     
  paygistix.config.js         |   95.34 |      100 |     100 |   95.34 | 29-30                                                                                                                                                                                                                                                                                                                      
  storeIPs.js                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
 controllers                  |   72.84 |    61.69 |   80.28 |   73.12 |                                                                                                                                                                                                                                                                                                                            
  administratorController.js  |   84.28 |    77.28 |    87.3 |    84.1 | 210,227,334,407,455-456,473,483,508,588-589,676-694,728,788-789,872,930-931,991-992,1713,1755,1766-1767,1798-1799,1839-1840,1849-1850,1996-1998,2023,2230,2298-2299,2416-2417,2434,2530-2559,2570-2615,2626-2645,2656-2725                                                                                                 
  affiliateController.js      |    82.7 |    76.36 |   94.11 |   82.37 | 22-78,130,151,157,298,308,333-334,372-373,390,400,415,474-475,590,621-624,639-640,711-712,729,787-788,804,887-888,923,1005-1006,1015-1048                                                                                                                                                                                  
  authController.js           |   82.37 |    72.25 |     100 |   82.37 | 143-144,156,189-194,198,228-229,247-248,292-301,353-354,375,461-462,475,484-485,505-506,523-524,575-576,677-678,693,705-710,745-753,761-762,777,812,853-854,879,920,944,954,964-965,1033,1115-1143,1172,1353,1365,1498,1545-1546,1562,1616,1667,1806,1915,2025,2053,2089-2127,2139,2175,2189-2190,2202,2215,2272,2321-2322 
  customerController.js       |   36.74 |    25.54 |   33.33 |   39.05 | 33,64,107-110,161-168,270,276,279-283,419,479-517,584,589,594,630-714,732-939,947-1030,1038-1129,1138-1171                                                                                                                                                                                                                 
  facebookDataController.js   |     100 |    97.22 |     100 |     100 | 96                                                                                                                                                                                                                                                                                                                         
  operatorController.js       |   38.17 |    25.45 |   58.69 |   37.09 | 16-98,111,115-117,153-207,214-278,284-349,355-392,398-428,434-497,503-609,615-637,643-682,688-874,899,915,932-933,943-999,1014,1079-1102,1128-1129,1138-1211,1228,1245,1268,1337-1339,1386-1388,1405,1481,1534-1535,1575-1585,1604-1607,1631-1680,1724-1745,1842-1879                                                      
  orderController.js          |   90.99 |    80.42 |     100 |   91.18 | 108,384,459,539,568,578,631-636,647-648,663,673,686,699-704,727-728,867,913,930,972-973,1001-1003,1010,1092,1154-1155,1187,1242,1274,1282,1297-1301,1316-1317                                                                                                                                                              
  paymentController.js        |   93.06 |    78.43 |     100 |   93.06 | 195-196,215,252-253,338-339                                                                                                                                                                                                                                                                                                
  quickbooksController.js     |   94.73 |    81.81 |     100 |   94.35 | 269-270,332,408-409,438-439                                                                                                                                                                                                                                                                                                
  w9ControllerDocuSign.js     |   93.96 |    84.78 |     100 |   93.96 | 207,222,280,285-286,334-336,421-422,475,676                                                                                                                                                                                                                                                                                
 jobs                         |   74.45 |    62.12 |   85.71 |   74.45 |                                                                                                                                                                                                                                                                                                                            
  paymentVerificationJob.js   |   74.45 |    62.12 |   85.71 |   74.45 | 47,55,76-77,118-128,151-158,179,186,217-218,254,272,294-331,378                                                                                                                                                                                                                                                            
 middleware                   |   85.38 |    76.72 |   94.52 |   85.62 |                                                                                                                                                                                                                                                                                                                            
  auth.js                     |     100 |    96.07 |     100 |     100 | 43                                                                                                                                                                                                                                                                                                                         
  authorizationHelpers.js     |   55.96 |    56.03 |      80 |   55.55 | 141,148,159,178-277,310-334                                                                                                                                                                                                                                                                                                
  cspNonce.js                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  errorHandler.js             |    72.3 |    63.26 |     100 |    72.3 | 10,81-96,102-103                                                                                                                                                                                                                                                                                                           
  locationValidation.js       |   89.18 |       80 |     100 |     100 | 6,16,26,41                                                                                                                                                                                                                                                                                                                 
  rateLimiting.js             |     100 |    63.63 |     100 |     100 | 19,43-99,166,191-203                                                                                                                                                                                                                                                                                                       
  rbac.js                     |     100 |    95.45 |     100 |     100 | 248,268,274,301                                                                                                                                                                                                                                                                                                            
  sanitization.js             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
 models                       |   98.47 |    94.42 |     100 |   98.95 |                                                                                                                                                                                                                                                                                                                            
  Administrator.js            |   97.43 |    94.44 |     100 |     100 | 233-240                                                                                                                                                                                                                                                                                                                    
  Affiliate.js                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  BetaRequest.js              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  CallbackPool.js             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  Customer.js                 |     100 |       50 |     100 |     100 | 30-36                                                                                                                                                                                                                                                                                                                      
  DataDeletionRequest.js      |   97.72 |    54.54 |     100 |     100 | 100-106,147-160                                                                                                                                                                                                                                                                                                            
  DocuSignToken.js            |   86.36 |    81.81 |     100 |   86.36 | 101,126-127                                                                                                                                                                                                                                                                                                                
  OAuthSession.js             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  Operator.js                 |   97.91 |    95.12 |     100 |   97.87 | 168,179                                                                                                                                                                                                                                                                                                                    
  Order.js                    |     100 |    96.92 |     100 |     100 | 221,257                                                                                                                                                                                                                                                                                                                    
  Payment.js                  |   97.61 |    94.44 |     100 |   97.61 | 240                                                                                                                                                                                                                                                                                                                        
  PaymentExport.js            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  PaymentToken.js             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  RefreshToken.js             |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  SystemConfig.js             |     100 |     98.3 |     100 |     100 | 70                                                                                                                                                                                                                                                                                                                         
  TokenBlacklist.js           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  Transaction.js              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
 routes                       |   84.48 |    71.23 |   85.71 |   84.74 |                                                                                                                                                                                                                                                                                                                            
  administratorRoutes.js      |   96.15 |      100 |     100 |   96.15 | 100-101                                                                                                                                                                                                                                                                                                                    
  affiliateRoutes.js          |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  authRoutes.js               |   91.66 |    83.33 |      75 |   91.66 | 66,190-191                                                                                                                                                                                                                                                                                                                 
  coverageRoutes.js           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  customerRoutes.js           |   78.04 |    55.55 |   71.42 |   78.04 | 17-18,32-42,64,73,89                                                                                                                                                                                                                                                                                                       
  docsRoutes.js               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  embedRoutes.js              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  facebookDataRoutes.js       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  generalPaymentCallback.js   |   93.02 |    95.83 |     100 |   93.02 | 45-46,82-83,303-304                                                                                                                                                                                                                                                                                                        
  monitoringRoutes.js         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  operatorRoutes.js           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  orderRoutes.js              |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  paymentCallbackRoute.js     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  paymentRoutes.js            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  quickbooksRoutes.js         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  routingRoutes.js            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  serviceAreaRoutes.js        |   80.64 |       75 |     100 |   80.64 | 23-24,44-45,65-66,86-87,116-117,146-147                                                                                                                                                                                                                                                                                    
  socialAuthRoutes.js         |   85.71 |    76.47 |   77.77 |   85.71 | 50-51,81,93-98,167                                                                                                                                                                                                                                                                                                         
  systemConfigRoutes.js       |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  testRoutes.js               |    49.5 |    43.24 |   45.45 |   50.24 | 23-58,107,150,268-270,285-300,306-329,335-480,498                                                                                                                                                                                                                                                                          
  v2CustomerRoutes.js         |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  w9Routes.js                 |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
 services                     |   65.97 |    58.75 |   74.16 |   66.27 |                                                                                                                                                                                                                                                                                                                            
  addressValidationService.js |   97.29 |    95.74 |     100 |   97.29 | 37,114                                                                                                                                                                                                                                                                                                                     
  callbackPoolManager.js      |   94.54 |    61.11 |     100 |   94.54 | 13-17                                                                                                                                                                                                                                                                                                                      
  docusignService.js          |      90 |    79.34 |     100 |   89.88 | 67-75,172,231-232,265,360,453-454,509-510,572-573,595-596,625-626                                                                                                                                                                                                                                                          
  imapEmailScanner.js         |    8.88 |     6.77 |   15.38 |    7.57 | 21-211,225-232,244-265,278-279                                                                                                                                                                                                                                                                                             
  mailcowService.js           |   18.36 |    11.11 |   27.27 |   18.55 | 38-173,190-302                                                                                                                                                                                                                                                                                                             
  paymentEmailScanner.js      |   79.02 |    68.29 |     100 |   79.41 | 61-62,96,102,110-111,136-144,185-188,211-212,228-229,287-288,315,333,354,375-376,389-390,400,415,429,482-486,495-496,512-513,579-580                                                                                                                                                                                       
  paymentLinkService.js       |   88.67 |    81.81 |     100 |   88.46 | 31-32,66-67,126-127                                                                                                                                                                                                                                                                                                        
  serviceAreaService.js       |   72.72 |    52.08 |   93.75 |   76.81 | 43-44,127-153                                                                                                                                                                                                                                                                                                              
 services/paygistix           |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  index.js                    |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
 utils                        |   83.27 |     73.4 |   90.54 |   82.97 |                                                                                                                                                                                                                                                                                                                            
  auditLogger.js              |     100 |    97.14 |     100 |     100 | 103                                                                                                                                                                                                                                                                                                                        
  controllerHelpers.js        |   61.11 |    62.13 |   85.71 |   61.11 | 17-29,169-176,181,184-185,206-230                                                                                                                                                                                                                                                                                          
  cspHelper.js                |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  emailService.js             |   72.58 |    56.21 |    75.6 |   72.58 | 374-375,379-380,534,672,898,925,956-957,1199-1200,1345,1507,1621,1648,1770,1797,1920,2036,2186,2370-2444,2509,2516,2532-2533,2541-2585,2593-2642,2650-2718,2775-2776,2784-2871,2880-2945,2953-3022,3030-3174                                                                                                               
  encryption.js               |   76.66 |    55.55 |      75 |   78.57 | 154-160,170-176                                                                                                                                                                                                                                                                                                            
  facebookUtils.js            |   94.52 |      100 |     100 |   94.52 | 48-49,61-62                                                                                                                                                                                                                                                                                                                
  fieldFilter.js              |   85.71 |    72.41 |     100 |   87.71 | 146,207-212                                                                                                                                                                                                                                                                                                                
  formatters.js               |   95.32 |    95.12 |     100 |      95 | 28,70,103,133,138,199,215,223                                                                                                                                                                                                                                                                                              
  helpers.js                  |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  logger.js                   |     100 |       50 |     100 |     100 | 11-30                                                                                                                                                                                                                                                                                                                      
  paginationMiddleware.js     |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  passwordValidator.js        |   90.83 |    89.71 |     100 |   89.81 | 141-145,193,231-232,234-235,246-247                                                                                                                                                                                                                                                                                        
  qrCodeGenerator.js          |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  securityUtils.js            |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
  validators.js               |     100 |      100 |     100 |     100 |                                                                                                                                                                                                                                                                                                                            
------------------------------|---------|----------|---------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Jest: "global" coverage threshold for statements (80%) not met: 78.61%
Jest: "global" coverage threshold for branches (80%) not met: 69.05%
Jest: "global" coverage threshold for lines (80%) not met: 78.77%
Summary of all failing tests
FAIL tests/unit/addressValidationService.test.js
  â— AddressValidationService â€º validateAddress â€º should return invalid for ZIP code mismatch

    expect(received).toBe(expected) // Object.is equality

    Expected: false
    Received: true

      155 |       const result = await addressValidationService.validateAddress(validAddressData);
      156 |
    > 157 |       expect(result.valid).toBe(false);
          |                            ^
      158 |       expect(result.message).toContain('does not match the provided zip code');
      159 |     });
      160 |

      at Object.toBe (tests/unit/addressValidationService.test.js:157:28)

  â— AddressValidationService â€º calculateDistance â€º should calculate distance between two points

    expect(received).toBeGreaterThan(expected)

    Expected: > 190
    Received:   182.13206606439326

      342 |       );
      343 |
    > 344 |       expect(distance).toBeGreaterThan(190);
          |                        ^
      345 |       expect(distance).toBeLessThan(200);
      346 |     });
      347 |

      at Object.toBeGreaterThan (tests/unit/addressValidationService.test.js:344:24)

FAIL tests/unit/imapEmailScanner.test.js (12.388 s)
  â— IMAPEmailScanner â€º connect â€º should connect to IMAP server successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:47:7)

  â— IMAPEmailScanner â€º connect â€º should return false if password is not configured

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:77:7)

  â— IMAPEmailScanner â€º connect â€º should handle connection errors

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:87:7)

  â— IMAPEmailScanner â€º connect â€º should handle end event

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:105:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should fetch unread emails successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:137:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should return empty array if not connected and connection fails

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:195:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should return empty array when no unread emails

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:204:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should handle errors opening inbox

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:231:7)

  â— IMAPEmailScanner â€º getUnreadEmails â€º should handle errors searching emails

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:253:7)

  â— IMAPEmailScanner â€º markAsRead â€º should mark email as read successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:280:7)

  â— IMAPEmailScanner â€º markAsRead â€º should handle errors marking as read

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:310:7)

  â— IMAPEmailScanner â€º moveToFolder â€º should move email to folder successfully

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:336:7)

  â— IMAPEmailScanner â€º moveToFolder â€º should handle copy errors

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:373:7)

  â— IMAPEmailScanner â€º moveToFolder â€º should handle delete errors after successful copy

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:397:7)

  â— IMAPEmailScanner â€º disconnect â€º should disconnect from IMAP server

    Configuration key not found: payment_email_password

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/imapEmailScanner.test.js:426:7)

FAIL tests/unit/mailcowService.test.js (20.972 s)
  â— MailcowService â€º initialize â€º should initialize service successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:33:7)

  â— MailcowService â€º initialize â€º should skip initialization if already initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:56:7)

  â— MailcowService â€º initialize â€º should not initialize if API key is not configured

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:69:7)

  â— MailcowService â€º initialize â€º should handle initialization errors

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:79:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should fetch unread payment emails successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should return empty array if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should try alternative method on 404 error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadPaymentEmails â€º should return empty array on other errors

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:88:7)

  â— MailcowService â€º getUnreadEmailsAlternative â€º should fetch emails using alternative endpoint

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:160:7)

  â— MailcowService â€º getUnreadEmailsAlternative â€º should return empty array on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:160:7)

  â— MailcowService â€º markEmailAsProcessed â€º should mark email as processed successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:203:7)

  â— MailcowService â€º markEmailAsProcessed â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:203:7)

  â— MailcowService â€º markEmailAsProcessed â€º should try alternative method on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:203:7)

  â— MailcowService â€º markEmailAsProcessedAlternative â€º should mark email as processed using alternative method

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:251:7)

  â— MailcowService â€º markEmailAsProcessedAlternative â€º should return false on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:251:7)

  â— MailcowService â€º searchEmails â€º should search emails successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:282:7)

  â— MailcowService â€º searchEmails â€º should return empty array if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:282:7)

  â— MailcowService â€º searchEmails â€º should return empty array on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:282:7)

  â— MailcowService â€º getEmailById â€º should fetch email by ID successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:329:7)

  â— MailcowService â€º getEmailById â€º should return null if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:329:7)

  â— MailcowService â€º getEmailById â€º should return null on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:329:7)

  â— MailcowService â€º moveEmail â€º should move email successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:369:7)

  â— MailcowService â€º moveEmail â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:369:7)

  â— MailcowService â€º moveEmail â€º should return false on error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:369:7)

  â— MailcowService â€º createFolder â€º should create folder successfully

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º createFolder â€º should return true if folder already exists (409)

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º createFolder â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º createFolder â€º should return false on other errors

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:410:7)

  â— MailcowService â€º testConnection â€º should return true if connection successful

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:465:7)

  â— MailcowService â€º testConnection â€º should return false if service not initialized

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:465:7)

  â— MailcowService â€º testConnection â€º should return false on connection error

    Configuration key not found: mailcow_api_key

      134 |   const config = await this.findOne({ key });
      135 |   if (!config) {
    > 136 |     throw new Error(`Configuration key not found: ${key}`);
          |           ^
      137 |   }
      138 |
      139 |   if (!config.isEditable) {

      at Function.Object.<anonymous>.systemConfigSchema.statics.setValue (server/models/SystemConfig.js:136:11)
      at Object.<anonymous> (tests/unit/mailcowService.test.js:465:7)


Test Suites: 3 failed, 6 skipped, 137 passed, 140 of 146 total
Tests:       48 failed, 70 skipped, 2591 passed, 2709 total
Snapshots:   0 total
Time:        801.019 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
